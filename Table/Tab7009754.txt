OBJECT Table 7009754 Plan de vuelo
{
  OBJECT-PROPERTIES
  {
    Date=28/07/15;
    Time=13:51:17;
    Modified=Yes;
    Version List=AIC2009,OC-14045;
  }
  PROPERTIES
  {
    OnInsert=BEGIN
               rPar.FINDFIRST;

               IF NOT rPar."Empresa Delegacion" THEN
                 ERROR(Text001);

               IF rAer.GET(Destino) THEN
               BEGIN
                 IF rAer."Aeropuerto Local" THEN
                   "Entrada/Salida":= "Entrada/Salida"::Entrada
                 ELSE
                   "Entrada/Salida":= "Entrada/Salida"::Salida;
               END;
             END;

    OnModify=BEGIN
               rPar.FINDFIRST;
               IF NOT rPar."Empresa Delegacion" THEN
                 ERROR(Text002);

               Replicado             := FALSE;
               "Modificacion manual" := TRUE;
               "Ultima modificacion" := TODAY;
               Usuario               := USERID;
             END;

    OnDelete=VAR
               lrPers@1100253000 : Record 7009907;
             BEGIN
               rPar.FINDFIRST;
               IF NOT rPar."Empresa Delegacion" THEN
                 ERROR(Text003);

               rRsvTra.RESET;
               IF "Entrada/Salida" = "Entrada/Salida"::Entrada THEN BEGIN
                 rRsvTra.SETCURRENTKEY("Fecha entrada",
                                       "Compa¤ia entrada",
                                       "Vuelo entrada",
                                       "IATA origen entrada");
                 rRsvTra.SETRANGE("Fecha entrada"      , xRec.Fecha);
                 rRsvTra.SETRANGE("Compa¤ia entrada"   , xRec.Compa¤ia);
                 rRsvTra.SETRANGE("Vuelo entrada"      , xRec.Vuelo);
                 rRsvTra.SETRANGE("IATA origen entrada", xRec.Origen);
               END
               ELSE BEGIN
                 rRsvTra.SETCURRENTKEY("Fecha salida",
                                       "Compa¤ia salida",
                                       "Vuelo salida",
                                       "IATA destino salida");
                 rRsvTra.SETRANGE("Fecha salida"       , xRec.Fecha);
                 rRsvTra.SETRANGE("Compa¤ia salida"    , xRec.Compa¤ia);
                 rRsvTra.SETRANGE("Vuelo salida"       , xRec.Vuelo);
                 rRsvTra.SETRANGE("IATA destino salida", xRec.Destino);
               END;

               // Aviso si el vuelo tiene reservas

               IF NOT rRsvTra.ISEMPTY THEN
                 IF NOT CONFIRM(Text004) THEN
                   ERROR(Text005);

               // $002 JPT 14/05/12 CNT-CAR-12004 / FLI-07 Airport Assitance Service
               // Borramos los registros Persona Asistencia x Vuelo
               CLEAR(lrPers);
               lrPers.SETRANGE(Fecha    , Fecha);
               lrPers.SETRANGE(Compa¤ia , Compa¤ia);
               lrPers.SETRANGE(Vuelo    , Vuelo);
               lrPers.SETRANGE(Origen   , Origen);
               lrPers.SETRANGE(Destino  , Destino);
               lrPers.DELETEALL;
             END;

    OnRename=BEGIN
               rPar.FINDFIRST;
               IF NOT rPar."Empresa Delegacion" THEN
                 ERROR(Text006);

               Replicado := FALSE;
               IF xRec.Fecha <> Fecha THEN
                 ERROR(Text007);

               // Modificacion de las reservas
               modifica_reservas;
             END;

    CaptionML=[ENU=Flight plan;
               ESP=Plan de vuelo];
    LookupFormID=Form7009799;
    DrillDownFormID=Form7009799;
  }
  FIELDS
  {
    { 1   ;   ;Fecha               ;Date          ;OnValidate=BEGIN
                                                                //+$008 <
                                                                IF CurrFieldNo = FIELDNO(Fecha) THEN
                                                                  _CheckFecha;
                                                                //+$008 >
                                                              END;

                                                   CaptionML=[ENU=Date;
                                                              ESP=Fecha];
                                                   NotBlank=Yes;
                                                   Description=PK }
    { 3   ;   ;Compa¤ia            ;Code10        ;TableRelation="Compa¤ia aerea".Codigo;
                                                   CaptionML=[ENU=Company;
                                                              ESP=Compa¤ia];
                                                   Description=PK, FK Compa¤ia }
    { 5   ;   ;Vuelo               ;Code10        ;CaptionML=[ENU=Flight;
                                                              ESP=Vuelo];
                                                   Description=PK }
    { 7   ;   ;Origen              ;Code10        ;TableRelation=Aeropuerto.Aeropuerto;
                                                   CaptionML=[ENU=Origin;
                                                              ESP=Origen];
                                                   Description=PK, FK Aeropuerto }
    { 9   ;   ;Destino             ;Code10        ;TableRelation=Aeropuerto.Aeropuerto;
                                                   OnValidate=BEGIN
                                                                //+$012 <
                                                                IF rAer.GET(Destino) THEN
                                                                BEGIN
                                                                  IF rAer."Aeropuerto Local" THEN
                                                                    "Entrada/Salida":= "Entrada/Salida"::Entrada
                                                                  ELSE
                                                                    "Entrada/Salida":= "Entrada/Salida"::Salida;
                                                                END;
                                                                //+$012 <
                                                              END;

                                                   CaptionML=[ENU=Destination;
                                                              ESP=Destino];
                                                   Description=PK, FK Aeropuerto }
    { 11  ;   ;TourOperador        ;Code10        ;TableRelation=TourOperador.TourOperador;
                                                   OnValidate=BEGIN
                                                                //$013-
                                                                rTTOO.RESET;
                                                                rTTOO.GET(TourOperador);
                                                                rTTOO.TESTFIELD(Bloqueado, FALSE);
                                                                //$013+
                                                              END;

                                                   CaptionML=[ENU=TourOperator;
                                                              ESP=TourOperador];
                                                   Description=FK TourOperador }
    { 13  ;   ;Hora Salida         ;Time          ;OnValidate=BEGIN
                                                                IF ("Hora Salida" <> xRec."Hora Salida") AND (Observaciones <> 'TEMP') THEN //+$019
                                                                BEGIN
                                                                  wActualizacionDirecta := (CurrFieldNo = FIELDNO("Hora Salida"));

                                                                  IF "Entrada/Salida" = "Entrada/Salida"::Salida THEN
                                                                  BEGIN
                                                                    rRsvTra.RESET;
                                                                    rRsvTra.SETCURRENTKEY("Fecha salida",
                                                                                          "Compa¤ia salida",
                                                                                          "Vuelo salida",
                                                                                          "IATA destino salida",
                                                                                          "Zona servicio salida",
                                                                                          "Hotel salida");
                                                                    rRsvTra.SETRANGE("Fecha salida"       , Fecha);
                                                                    rRsvTra.SETRANGE("Compa¤ia salida"    , Compa¤ia);
                                                                    rRsvTra.SETRANGE("Vuelo salida"       , Vuelo);
                                                                    rRsvTra.SETRANGE("IATA destino salida", Destino);
                                                                    IF rRsvTra.FINDSET THEN
                                                                    BEGIN
                                                                      ventana.OPEN(Text008);
                                                                      rRsvTra.MODIFYALL("Hora salida", "Hora Salida");

                                                                      //+$001
                                                                      IF Fecha >= TODAY THEN
                                                                      BEGIN
                                                                        IF NOT Conservar THEN
                                                                          _DejarSinAgrupacionSalida(rRsvTra);
                                                                      END;
                                                                      //+$001

                                                                      ventana.CLOSE;
                                                                    END;
                                                                    rRsvTra.RESET;

                                                                    // Modificamos los Acumulados x Vuelo

                                                                    rAcumVue.RESET;
                                                                    rAcumVue.SETRANGE(Fecha   , Fecha);
                                                                    rAcumVue.SETRANGE(Compa¤ia, Compa¤ia);
                                                                    rAcumVue.SETRANGE(Vuelo   , Vuelo);
                                                                    IF "Entrada/Salida" = "Entrada/Salida"::Entrada THEN
                                                                      rAcumVue.SETRANGE(IATA    , Origen)
                                                                    ELSE
                                                                      rAcumVue.SETRANGE(IATA    , Destino);
                                                                    IF rAcumVue.FINDSET THEN BEGIN
                                                                      REPEAT
                                                                        rAcumVue2 := rAcumVue;
                                                                        rAcumVue3 := rAcumVue;
                                                                        IF "Entrada/Salida" = "Entrada/Salida"::Entrada THEN
                                                                          rAcumVue2.Hora := "Hora Entrada"
                                                                        ELSE
                                                                          rAcumVue2.Hora := "Hora Salida";
                                                                        rAcumVue3.DELETE;
                                                                        IF NOT rAcumVue2.FIND THEN
                                                                          rAcumVue2.INSERT;
                                                                      UNTIL rAcumVue.NEXT = 0;
                                                                    END;
                                                                    rAcumVue.RESET;

                                                                    // Modificamos los Acumulados x Hotel x Vuelo

                                                                    rAcumVueHot.RESET;
                                                                    rAcumVueHot.SETRANGE(Fecha   , Fecha);
                                                                    rAcumVueHot.SETRANGE(Compa¤ia, Compa¤ia);
                                                                    rAcumVueHot.SETRANGE("Num. Vuelo"   , Vuelo);
                                                                    IF "Entrada/Salida" = "Entrada/Salida"::Entrada THEN
                                                                      rAcumVueHot.SETRANGE(IATA    , Origen)
                                                                    ELSE
                                                                      rAcumVueHot.SETRANGE(IATA    , Destino);
                                                                    IF rAcumVueHot.FINDSET THEN BEGIN
                                                                      REPEAT
                                                                        IF "Entrada/Salida" = "Entrada/Salida"::Entrada THEN
                                                                          rAcumVueHot.Hora := "Hora Entrada"
                                                                        ELSE
                                                                          rAcumVueHot.Hora := "Hora Salida";
                                                                        rAcumVueHot.MODIFY;
                                                                      UNTIL rAcumVueHot.NEXT = 0;
                                                                    END;
                                                                    rAcumVueHot.RESET;

                                                                    //. Actualizar las recogidas de las agrupaciones
                                                                    IF (Fecha >= TODAY) AND (xRec."Hora Salida" <> 0T) THEN
                                                                      _ActualizaRecogidas;

                                                                    //. Pasar el cambio de hora a los registros del mismo vuelo de diferentes aeropuertos
                                                                    _ActualizaMismoVuelo;
                                                                  END;
                                                                END;

                                                                CompHoras;
                                                              END;

                                                   CaptionML=[ENU=Departure time;
                                                              ESP=Hora salida] }
    { 15  ;   ;Hora Entrada        ;Time          ;OnValidate=BEGIN
                                                                IF ("Hora Entrada" <> xRec."Hora Entrada") AND (Observaciones <> 'TEMP') THEN //+$014
                                                                BEGIN
                                                                  IF "Entrada/Salida" = "Entrada/Salida"::Entrada THEN
                                                                  BEGIN
                                                                    rRsvTra.RESET;
                                                                    rRsvTra.SETCURRENTKEY("Fecha entrada",
                                                                                          "Compa¤ia entrada",
                                                                                          "Vuelo entrada",
                                                                                          "IATA origen entrada",
                                                                                          "Zona servicio entrada",
                                                                                          "Hotel entrada");
                                                                    rRsvTra.SETRANGE("Fecha entrada"       , Fecha);
                                                                    rRsvTra.SETRANGE("Compa¤ia entrada"    , Compa¤ia);
                                                                    rRsvTra.SETRANGE("Vuelo entrada"       , Vuelo);
                                                                    rRsvTra.SETRANGE("IATA origen entrada" , Origen);
                                                                    IF rRsvTra.FINDSET(TRUE) THEN BEGIN
                                                                      ventana.OPEN(Text010);
                                                                      rRsvTra.MODIFYALL("Hora entrada", "Hora Entrada");

                                                                      //+$001
                                                                      IF Fecha >= TODAY THEN
                                                                      BEGIN
                                                                        IF NOT Conservar THEN
                                                                          _DejarSinAgrupacionEntrada(rRsvTra);
                                                                      END;
                                                                      //+$001

                                                                      ventana.CLOSE;
                                                                    END;
                                                                    rRsvTra.RESET;

                                                                    //. Modificamos los Acumulados x Vuelo

                                                                    rAcumVue.RESET;
                                                                    rAcumVue.SETRANGE(Fecha   , Fecha);
                                                                    rAcumVue.SETRANGE(Compa¤ia, Compa¤ia);
                                                                    rAcumVue.SETRANGE(Vuelo   , Vuelo);
                                                                    IF "Entrada/Salida" = "Entrada/Salida"::Entrada THEN
                                                                      rAcumVue.SETRANGE(IATA    , Origen)
                                                                    ELSE
                                                                      rAcumVue.SETRANGE(IATA    , Destino);
                                                                    IF rAcumVue.FINDSET THEN BEGIN
                                                                      REPEAT
                                                                        rAcumVue2 := rAcumVue;
                                                                        rAcumVue3 := rAcumVue;
                                                                        IF "Entrada/Salida" = "Entrada/Salida"::Entrada THEN
                                                                          rAcumVue2.Hora := "Hora Entrada"
                                                                        ELSE
                                                                          rAcumVue2.Hora := "Hora Salida";
                                                                        rAcumVue3.DELETE;
                                                                        IF NOT rAcumVue2.INSERT THEN
                                                                          rAcumVue2.MODIFY;
                                                                      UNTIL rAcumVue.NEXT = 0;
                                                                    END;
                                                                    rAcumVue.RESET;

                                                                    // Modificamos los Acumulados x Hotel x Vuelo

                                                                    rAcumVueHot.RESET;
                                                                    rAcumVueHot.SETRANGE(Fecha   , Fecha);
                                                                    rAcumVueHot.SETRANGE(Compa¤ia, Compa¤ia);
                                                                    rAcumVueHot.SETRANGE("Num. Vuelo"   , Vuelo);
                                                                    IF "Entrada/Salida" = "Entrada/Salida"::Entrada THEN
                                                                      rAcumVueHot.SETRANGE(IATA    , Origen)
                                                                    ELSE
                                                                      rAcumVueHot.SETRANGE(IATA    , Destino);
                                                                    IF rAcumVueHot.FINDSET THEN BEGIN
                                                                      REPEAT
                                                                        IF "Entrada/Salida" = "Entrada/Salida"::Entrada THEN
                                                                          rAcumVueHot.Hora := "Hora Entrada"
                                                                        ELSE
                                                                          rAcumVueHot.Hora := "Hora Salida";
                                                                        rAcumVueHot.MODIFY;
                                                                      UNTIL rAcumVueHot.NEXT = 0;
                                                                    END;
                                                                    rAcumVueHot.RESET;

                                                                    //. Pasar el cambio de hora a los registros del mismo vuelo de diferentes aeropuertos
                                                                    _ActualizaMismoVuelo;
                                                                  END;
                                                                END;

                                                                CompHoras;
                                                              END;

                                                   CaptionML=[ENU=Arrival time;
                                                              ESP=Hora entrada] }
    { 17  ;   ;Plazas libres       ;Integer       ;CaptionML=[ENU=Free places;
                                                              ESP=Plazas libres];
                                                   Editable=No }
    { 19  ;   ;Terminal            ;Code1         ;CaptionML=[ENU=Terminal;
                                                              ESP=Terminal] }
    { 21  ;   ;Entrada/Salida      ;Option        ;OnValidate=BEGIN
                                                                IF "Entrada/Salida" <> xRec."Entrada/Salida" THEN
                                                                BEGIN
                                                                  "Hora Salida"  := 0T;
                                                                  "Hora Entrada" := 0T;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Arrival/Departure;
                                                              ESP=Entrada/Salida];
                                                   OptionCaptionML=[ENU=Arrival,Departure;
                                                                    ESP=Entrada,Salida];
                                                   OptionString=Entrada,Salida }
    { 23  ;   ;Cod. Serie          ;Code10        ;CaptionML=[ENU=Serial code;
                                                              ESP=Cod. Serie] }
    { 25  ;   ;Identificador serie ;Code18        ;CaptionML=[ENU=Serial identifier;
                                                              ESP=Identificador serie] }
    { 27  ;   ;Total Pax           ;Integer       ;CaptionML=[ENU=Total pax;
                                                              ESP=Total Pax];
                                                   Editable=No }
    { 29  ;   ;Pax garantizados    ;Integer       ;CaptionML=[ENU=Guaranteed pax;
                                                              ESP=Pax garantizados] }
    { 31  ;   ;Asientos vendidos   ;Integer       ;CaptionML=[ENU=Sold seats;
                                                              ESP=Asientos vendidos] }
    { 33  ;   ;en opcion           ;Integer       ;CaptionML=[ENU=available;
                                                              ESP=en opcion] }
    { 35  ;   ;Porcentaje ocupacion;Decimal       ;CaptionML=[ENU=Occupancy percentage;
                                                              ESP=Porcentaje ocupacion];
                                                   DecimalPlaces=0:2;
                                                   Editable=No }
    { 37  ;   ;Temporada           ;Code1         ;CaptionML=[ENU=Season;
                                                              ESP=Temporada] }
    { 38  ;   ;Pax Entrada E       ;Integer       ;OnValidate=BEGIN
                                                                CompPlazas;
                                                              END;

                                                   CaptionML=[ENU=E Check-in Pax;
                                                              ESP=Pax Entrada E] }
    { 39  ;   ;Pax Entrada C       ;Integer       ;OnValidate=BEGIN
                                                                CompPlazas;
                                                              END;

                                                   CaptionML=[ENU=C Check-in Pax;
                                                              ESP=Pax Entrada C] }
    { 40  ;   ;Pax Salida E        ;Integer       ;OnValidate=BEGIN
                                                                CompPlazas;
                                                              END;

                                                   CaptionML=[ENU=E Check-out Pax;
                                                              ESP=Pax Salida E] }
    { 41  ;   ;Pax Salida C        ;Integer       ;OnValidate=BEGIN
                                                                CompPlazas;
                                                              END;

                                                   CaptionML=[ENU=C Check-out Pax;
                                                              ESP=Pax Salida C] }
    { 43  ;   ;Observaciones       ;Text30        ;CaptionML=[ENU=Comments;
                                                              ESP=Observaciones] }
    { 45  ;   ;Cupo agencia        ;Integer       ;CaptionML=[ENU=Agency allotment;
                                                              ESP=Cupo agencia] }
    { 47  ;   ;Vendidos agencia    ;Integer       ;CaptionML=[ENU=Sold Agencies;
                                                              ESP=Vendidos agencia] }
    { 49  ;   ;Conservar           ;Boolean       ;CaptionML=[ENU=Keep it;
                                                              ESP=Conservar] }
    { 50  ;   ;Replicado           ;Boolean       ;InitValue=No;
                                                   CaptionML=[ENU=Replicated;
                                                              ESP=Replicado];
                                                   Description=Campo usado por el replicador }
    { 51  ;   ;Vuelo dia siguiente ;Boolean       ;CaptionML=[ENU=Flight next day;
                                                              ESP=Vuelo dia siguiente] }
    { 53  ;   ;Modificacion manual ;Boolean       ;CaptionML=[ENU=Manual modification;
                                                              ESP=Modificacion manual];
                                                   Editable=No }
    { 55  ;   ;Ultima modificacion ;Date          ;CaptionML=[ENU=Last modification;
                                                              ESP=Ultima modificacion] }
    { 57  ;   ;Usuario             ;Code20        ;TableRelation=User."User ID";
                                                   CaptionML=[ENU=User;
                                                              ESP=Usuario];
                                                   Description=FK Usuario }
    { 58  ;   ;Vuelo completado    ;Boolean       ;OnValidate=BEGIN
                                                                IF "Vuelo completado" THEN BEGIN
                                                                  "Usuario confirmacion" := USERID;
                                                                  BuscaTarifaAsistencia(TRUE); // $002
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Completed Flight;
                                                              ESP=Vuelo completado] }
    { 59  ;   ;Personas en vuelo   ;Decimal       ;CaptionML=[ENU=Passengers;
                                                              ESP=Personas en vuelo] }
    { 60  ;   ;Entrada/Pax transfer;Integer       ;FieldClass=FlowField;
                                                   CalcFormula=Count("Reserva Transfer" WHERE (Fecha entrada=FIELD(Fecha),
                                                                                               Compa¤ia entrada=FIELD(Compa¤ia),
                                                                                               Vuelo entrada=FIELD(Vuelo),
                                                                                               IATA origen entrada=FIELD(Origen),
                                                                                               IATA destino entrada=FIELD(Destino)));
                                                   CaptionML=[ENU=Check-in/Pax transfer;
                                                              ESP=Entrada/Pax transfer];
                                                   Description=Calculado;
                                                   Editable=No }
    { 61  ;   ;Salida/Pax transfer ;Integer       ;FieldClass=FlowField;
                                                   CalcFormula=Count("Reserva Transfer" WHERE (Fecha salida=FIELD(Fecha),
                                                                                               Compa¤ia salida=FIELD(Compa¤ia),
                                                                                               Vuelo salida=FIELD(Vuelo),
                                                                                               IATA origen salida=FIELD(Origen),
                                                                                               IATA destino salida=FIELD(Destino)));
                                                   CaptionML=[ENU=Check-out/Pax transfer;
                                                              ESP=Salida/Pax transfer];
                                                   Description=Calculado;
                                                   Editable=No }
    { 100 ;   ;Matricula           ;Code10        ;CaptionML=[ENU=License Plate;
                                                              ESP=Matricula] }
    { 101 ;   ;Aeronave            ;Code10        ;CaptionML=[ENU=Aircraft;
                                                              ESP=Aeronave] }
    { 102 ;   ;Hora On Block       ;Time          ;OnValidate=BEGIN
                                                                CompHoras;
                                                              END;

                                                   CaptionML=[ENU=Time On Block;
                                                              ESP=Hora On Block] }
    { 103 ;   ;Hora Off Block      ;Time          ;OnValidate=BEGIN
                                                                CompHoras;
                                                              END;

                                                   CaptionML=[ENU=Time Off Block;
                                                              ESP=Hora Off Block] }
    { 104 ;   ;Usuario confirmacion;Code20        ;TableRelation=User."User ID";
                                                   CaptionML=[ENU=Confirmation user;
                                                              ESP=Usuario confirmacion];
                                                   Editable=No }
    { 105 ;   ;Supervisor de vuelo ;Text30        ;CaptionML=[ENU=Flight Supervisor;
                                                              ESP=Supervisor de vuelo] }
    { 106 ;   ;Total Pax TTOO      ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Detalle TTOO x Plan Vuelo".Paxes WHERE (Fecha=FIELD(Fecha),
                                                                                                            Compa¤ia=FIELD(Compa¤ia),
                                                                                                            Vuelo=FIELD(Vuelo),
                                                                                                            Origen=FIELD(Origen),
                                                                                                            Destino=FIELD(Destino)));
                                                   CaptionML=[ENU=Total Pax TTOO;
                                                              ESP=Total Pax TTOO];
                                                   DecimalPlaces=0:2;
                                                   Description=Calculado;
                                                   Editable=No }
    { 107 ;   ;Total Plazas        ;Decimal       ;OnValidate=BEGIN
                                                                CompPlazas;
                                                              END;

                                                   CaptionML=[ENU=Total places;
                                                              ESP=Total Plazas];
                                                   DecimalPlaces=0:2;
                                                   MinValue=0 }
    { 108 ;   ;Nombre Capitan      ;Text30        ;CaptionML=[ENU=Captain Name;
                                                              ESP=Nombre Capitan] }
    { 109 ;   ;Total Tripulantes   ;Integer       ;CaptionML=[ENU=Total Crew;
                                                              ESP=Total Tripulantes];
                                                   MinValue=0 }
    { 110 ;   ;Carga Llegada       ;Decimal       ;OnValidate=BEGIN
                                                                "Carga Llegada Kg" := ROUND("Carga Llegada" / 2.2);
                                                              END;

                                                   CaptionML=[ENU=Arrival charge;
                                                              ESP=Carga Llegada];
                                                   MinValue=0 }
    { 111 ;   ;Carga Salida        ;Decimal       ;OnValidate=BEGIN
                                                                "Carga Salida Kg" := ROUND("Carga Salida" / 2.2);
                                                              END;

                                                   CaptionML=[ENU=Departure charge;
                                                              ESP=Carga Salida];
                                                   MinValue=0 }
    { 112 ;   ;Codigo Retraso      ;Code10        ;TableRelation="Codigos Retraso Plan Vuelo".Codigo;
                                                   CaptionML=[ENU=Delayed code;
                                                              ESP=Codigo Retraso] }
    { 113 ;   ;Econ                ;Decimal       ;CaptionML=[ENU=Econ;
                                                              ESP=Econ];
                                                   DecimalPlaces=0:2;
                                                   MinValue=0 }
    { 114 ;   ;FCC                 ;Decimal       ;CaptionML=[ENU=FCC;
                                                              ESP=FCC];
                                                   DecimalPlaces=0:2;
                                                   MinValue=0 }
    { 115 ;   ;SPML                ;Decimal       ;CaptionML=[ENU=SPML;
                                                              ESP=SPML];
                                                   DecimalPlaces=0:2;
                                                   MinValue=0 }
    { 116 ;   ;Carga Llegada Kg    ;Decimal       ;CaptionML=[ENU=Kg Arrival charge;
                                                              ESP=Carga Llegada Kg];
                                                   Editable=No }
    { 117 ;   ;Carga Salida Kg     ;Decimal       ;CaptionML=[ENU=Kg Departure charge;
                                                              ESP=Carga Salida Kg];
                                                   Editable=No }
    { 118 ;   ;Codigo Retraso adicional;Code10    ;TableRelation="Codigos Retraso Plan Vuelo".Codigo;
                                                   CaptionML=[ENU=Additional delayed code;
                                                              ESP=Codigo Retraso adicional] }
    { 120 ;   ;Personal Asistencia Vuelo;Integer  ;FieldClass=FlowField;
                                                   CalcFormula=Count("Personal asistencia x vuelo" WHERE (Fecha=FIELD(Fecha),
                                                                                                          Compa¤ia=FIELD(Compa¤ia),
                                                                                                          Vuelo=FIELD(Vuelo),
                                                                                                          Origen=FIELD(Origen),
                                                                                                          Destino=FIELD(Destino)));
                                                   CaptionML=[ENU=Assistance Flight Staff;
                                                              ESP=Personal asistencia vuelo];
                                                   Description=Flowfield;
                                                   Editable=No }
  }
  KEYS
  {
    {    ;Fecha,Compa¤ia,Vuelo,Origen,Destino     ;Clustered=Yes }
    {    ;Entrada/Salida                          ;KeyGroups=RENUMERING }
    {    ;Compa¤ia,Vuelo,Origen,Destino,Fecha     ;KeyGroups=RENUMERING }
    {    ;Fecha,Hora Entrada                       }
    {    ;Fecha,Vuelo dia siguiente,Hora Salida    }
  }
  FIELDGROUPS
  {
  }
  CODE
  {
    VAR
      Text001@1103355021 : TextConst 'ENU=To sign up flight plans is only available in the local offices;ESP=Solo es posible dar de alta Planes de vuelo en las delegaciones.';
      Text002@1103355022 : TextConst 'ENU=To modify flight plans is only available in the local offices;ESP=Solo es posible modificar Planes de vuelo en las delegaciones.';
      Text003@1103355023 : TextConst 'ENU=To cancel flight plans is only available in the local offices;ESP=Solo es posible dar de baja Planes de vuelo en las delegaciones.';
      Text004@1103355024 : TextConst 'ENU=Flight plan has associated bookings, would you like to continue;ESP=El plan de vuelo tiene reservas asociadas, desea continuar';
      Text005@1103355025 : TextConst 'ENU="Erasure cancelled ";ESP=Borrado anulado.';
      Text006@1103355026 : TextConst 'ENU=To rename associated bookings is only available in the local offices;ESP=Solo es posible renombrar Planes de vuelo en las delegaciones.';
      Text007@1103355027 : TextConst 'ENU=Unable to change the time of a flight plan;ESP=No es posible cambiar la fecha de un plan de vuelo.';
      Text008@1103355028 : TextConst 'ENU=" MODIFYING THE DEPARTURE TIME IN THE BOOKINGS";ESP=" MODIFICANDO LA HORA DE SALIDA EN LAS RESERVAS."';
      Text009@1103355029 : TextConst 'ENU=Would you like to deblundling the grouped booking.;ESP=Desea desagrupar si hay alguna reserva agrupada.';
      Text010@1103355030 : TextConst 'ENU=" MODIFYING THE ARRIVAL TIME IN THE BOOKINGS";ESP=" MODIFICANDO LA HORA DE ENTRADA EN LAS RESERVAS."';
      Text011@1103355031 : TextConst 'ENU=CHANGING FLIGHT BOOKINGS\;ESP=CAMBIANDO RESERVAS DE VUELO\';
      Text012@1103355032 : TextConst 'ENU=Booking #1#####;ESP=Reserva #1#####';
      Text013@1103355033 : TextConst 'ENU=Cannot be more pax than allocations;ESP=No puede haber m s pax que plazas';
      Text014@1103355034 : TextConst 'ENU=Cannot be more Touroperators pax than allocations;ESP=No puede haber m s pax Touroperador que plazas';
      Text015@1103355035 : TextConst 'ENU=%1 cannot be after than %2;ESP=%1 No Puede ser Posterior a %2';
      Text016@1103355036 : TextConst 'ENU=%1 cannot be previous than %2;ESP=%1 No Puede ser Anterior a %2';
      rPar@1103355000 : Record 7009700;
      rRsvTra@1103355001 : Record 7009744;
      rAer@1103355002 : Record 7009704;
      rTTOO@1000000000 : Record 7009717;
      ventana@1103355003 : Dialog;
      rAgr@1103355004 : Record 7009796;
      rHorAgr@1103355005 : Record 7009800;
      rHorAgr2@1103355006 : Record 7009800;
      rHorAgr3@1103355007 : Record 7009800;
      rVueAgr@1103355008 : Record 7009797;
      rVueAgr2@1103355009 : Record 7009797;
      rVueAgr3@1103355010 : Record 7009797;
      rHotAgr@1103355011 : Record 7009798;
      rHotAgr2@1103355012 : Record 7009798;
      rHotAgr3@1103355013 : Record 7009798;
      rAcumVue@1103355014 : Record 7009794;
      rAcumVue2@1103355015 : Record 7009794;
      rAcumVue3@1103355016 : Record 7009794;
      rAcumVueHot@1103355017 : Record 7009795;
      rAcumVueHot2@1103355018 : Record 7009795;
      rAcumVueHot3@1103355019 : Record 7009795;
      Text017@1100253000 : TextConst 'ENU=There''s not any Assistance Flight Staff Rate for %1;ESP="No se encuentra Tarifa Personal Asistencia para %1 "';
      wActualizacionDirecta@1100217000 : Boolean;
      Text018@1100217001 : TextConst 'ENU=Do you want to apply the delay to the pick up times.;ESP=Desea aplicar el retraso en los horarios de recogida.';
      Text019@1100217002 : TextConst 'ENU=You cannot create flights for dates prior to %1;ESP=No se puede introducir un vuelo con fecha anterior a dia %1.';

    PROCEDURE registro_actual@1(VAR par_plan@1103355000 : Record 7009754);
    BEGIN
    END;

    PROCEDURE modifica_reservas@2();
    VAR
      rRsvTra2@1103355000 : Record 7009744;
      lcFunCua@1100217000 : Codeunit 7009733;
      aux_pos@1103355001 : Integer;
      aux_lon@1103355002 : Integer;
    BEGIN
      // modifica_reservas

      rRsvTra.RESET;
      IF "Entrada/Salida" = "Entrada/Salida"::Entrada THEN BEGIN
        rRsvTra.SETCURRENTKEY("Fecha entrada",
                              "Compa¤ia entrada",
                              "Vuelo entrada",
                              "IATA origen entrada");
        rRsvTra.SETRANGE("Fecha entrada"      , xRec.Fecha);
        rRsvTra.SETRANGE("Compa¤ia entrada"   , xRec.Compa¤ia);
        rRsvTra.SETRANGE("Vuelo entrada"      , xRec.Vuelo);
        rRsvTra.SETRANGE("IATA origen entrada", xRec.Origen);
      END
      ELSE BEGIN
        rRsvTra.SETCURRENTKEY("Fecha salida",
                              "Compa¤ia salida",
                              "Vuelo salida",
                              "IATA destino salida");
        rRsvTra.SETRANGE("Fecha salida"       , xRec.Fecha);
        rRsvTra.SETRANGE("Compa¤ia salida"    , xRec.Compa¤ia);
        rRsvTra.SETRANGE("Vuelo salida"       , xRec.Vuelo);
        rRsvTra.SETRANGE("IATA destino salida", xRec.Destino);
      END;

      // Iniciamos el cambio en las reservas de transfer

      IF rRsvTra.FINDSET THEN BEGIN
        ventana.OPEN(Text011+
                     '\'+
                     Text012);
        REPEAT
          ventana.UPDATE(1, rRsvTra."N§ Reserva");
          rRsvTra2 := rRsvTra;
          IF "Entrada/Salida" = "Entrada/Salida"::Entrada THEN BEGIN
            rRsvTra2."Compa¤ia entrada"    := Compa¤ia;
            rRsvTra2."Vuelo entrada"       := Vuelo;
            rRsvTra2."IATA origen entrada" := Origen;
            rRsvTra2.MODIFY;

            IF rRsvTra."Agrupacion entrada" <> 0 THEN BEGIN
              // Modificamos los vuelos agrupacion
              rVueAgr.RESET;
              rVueAgr.SETRANGE("N§ Agrupacion", rRsvTra."Agrupacion entrada");
              rVueAgr.SETRANGE(Fecha          , xRec.Fecha);
              rVueAgr.SETRANGE(Compa¤ia       , xRec.Compa¤ia);
              rVueAgr.SETRANGE(Vuelo          , xRec.Vuelo);
              rVueAgr.SETRANGE(IATA           , xRec.Origen);
              IF rVueAgr.FINDSET THEN BEGIN
                REPEAT
                  rVueAgr3 := rVueAgr;
                  rVueAgr3.DELETE;

                  rVueAgr2          := rVueAgr;
                  rVueAgr2.Compa¤ia := Compa¤ia;
                  rVueAgr2.Vuelo    := Vuelo;
                  rVueAgr2.IATA     := Origen;
                  IF rVueAgr2.FIND THEN
                    rVueAgr2.INSERT;
                UNTIL rVueAgr.NEXT = 0;
              END;
              rVueAgr.RESET;

              // Modificamos los hoteles agrupacion
              rHotAgr.RESET;
              rHotAgr.SETRANGE("N§ Agrupacion", rRsvTra."Agrupacion entrada");
              rHotAgr.SETRANGE(Fecha          , xRec.Fecha);
              rHotAgr.SETRANGE(Compa¤ia       , xRec.Compa¤ia);
              rHotAgr.SETRANGE(Vuelo          , xRec.Vuelo);
              rHotAgr.SETRANGE(IATA           , xRec.Origen);
              IF rHotAgr.FINDSET THEN BEGIN
                REPEAT
                  rHotAgr3 := rHotAgr;
                  rHotAgr3.DELETE;

                  rHotAgr2          := rHotAgr;
                  rHotAgr2.Compa¤ia := Compa¤ia;
                  rHotAgr2.Vuelo    := Vuelo;
                  rHotAgr2.IATA     := Origen;
                  IF rHotAgr2.FIND THEN
                    rHotAgr2.INSERT;
                UNTIL rHotAgr.NEXT = 0;
              END;
              rHotAgr.RESET;

              // Modificamos las horas agrupacion
              rHorAgr.RESET;
              rHorAgr.SETRANGE("N§ Agrupacion", rRsvTra."Agrupacion salida");
              rHorAgr.SETRANGE(Fecha          , xRec.Fecha);
              rHorAgr.SETRANGE(Compa¤ia       , xRec.Compa¤ia);
              rHorAgr.SETRANGE(Vuelo          , xRec.Vuelo);
              rHorAgr.SETRANGE(IATA           , xRec.Destino);
              IF rHorAgr.FINDSET THEN BEGIN
                REPEAT
                  rHorAgr3 := rHorAgr;
                  rHorAgr3.DELETE;

                  rHorAgr2          := rHorAgr;
                  rHorAgr2.Compa¤ia := Compa¤ia;
                  rHorAgr2.Vuelo    := Vuelo;
                  rHorAgr2.IATA     := Destino;
                  IF rHorAgr2.FIND THEN
                    rHorAgr2.INSERT;
                UNTIL rHorAgr.NEXT = 0;
              END;
              rHorAgr.RESET;

              // Modificamos el campo vuelos en la agrupacion
              IF rAgr.GET(rRsvTra."Agrupacion entrada") THEN
              BEGIN
                lcFunCua.CampoVuelosAgrupacion(rRsvTra."Agrupacion entrada", rAgr.Vuelos, rAgr."N§ vuelos");
                rAgr.MODIFY;
              END;
            END;
          END
          ELSE
          BEGIN
            rRsvTra2."Compa¤ia salida"     := Compa¤ia;
            rRsvTra2."Vuelo salida"        := Vuelo;
            rRsvTra2."IATA destino salida" := Destino;
            rRsvTra2.MODIFY;
            IF rRsvTra."Agrupacion salida" <> 0 THEN BEGIN
              // Modificamos los vuelos agrupacion
              rVueAgr.RESET;
              rVueAgr.SETRANGE("N§ Agrupacion", rRsvTra."Agrupacion salida");
              rVueAgr.SETRANGE(Fecha          , xRec.Fecha);
              rVueAgr.SETRANGE(Compa¤ia       , xRec.Compa¤ia);
              rVueAgr.SETRANGE(Vuelo          , xRec.Vuelo);
              rVueAgr.SETRANGE(IATA           , xRec.Destino);
              IF rVueAgr.FINDSET THEN BEGIN
                REPEAT
                  rVueAgr3 := rVueAgr;
                  rVueAgr3.DELETE;

                  rVueAgr2          := rVueAgr;
                  rVueAgr2.Compa¤ia := Compa¤ia;
                  rVueAgr2.Vuelo    := Vuelo;
                  rVueAgr2.IATA     := Destino;
                  IF rVueAgr2.FIND THEN
                    rVueAgr2.INSERT;
                UNTIL rVueAgr.NEXT = 0;
              END;
              rVueAgr.RESET;

              // Modificamos los hoteles agrupacion
              rHotAgr.RESET;
              rHotAgr.SETRANGE("N§ Agrupacion", rRsvTra."Agrupacion salida");
              rHotAgr.SETRANGE(Fecha          , xRec.Fecha);
              rHotAgr.SETRANGE(Compa¤ia       , xRec.Compa¤ia);
              rHotAgr.SETRANGE(Vuelo          , xRec.Vuelo);
              rHotAgr.SETRANGE(IATA           , xRec.Destino);
              IF rHotAgr.FINDSET THEN BEGIN
                REPEAT
                  rHotAgr3 := rHotAgr;
                  rHotAgr3.DELETE;

                  rHotAgr2          := rHotAgr;
                  rHotAgr2.Compa¤ia := Compa¤ia;
                  rHotAgr2.Vuelo    := Vuelo;
                  rHotAgr2.IATA     := Destino;
                  IF rHotAgr2.FIND THEN
                    rHotAgr2.INSERT;
                UNTIL rHotAgr.NEXT = 0;
              END;
              rHotAgr.RESET;

              // Modificamos las horas agrupacion
              rHorAgr.RESET;
              rHorAgr.SETRANGE("N§ Agrupacion", rRsvTra."Agrupacion salida");
              rHorAgr.SETRANGE(Fecha          , xRec.Fecha);
              rHorAgr.SETRANGE(Compa¤ia       , xRec.Compa¤ia);
              rHorAgr.SETRANGE(Vuelo          , xRec.Vuelo);
              rHorAgr.SETRANGE(IATA           , xRec.Destino);
              IF rHorAgr.FINDSET THEN BEGIN
                REPEAT
                  rHorAgr3 := rHorAgr;
                  rHorAgr3.DELETE;

                  rHorAgr2          := rHorAgr;
                  rHorAgr2.Compa¤ia := Compa¤ia;
                  rHorAgr2.Vuelo    := Vuelo;
                  rHorAgr2.IATA     := Destino;
                  IF rHorAgr2.FIND THEN
                    rHorAgr2.INSERT;
                UNTIL rHorAgr.NEXT = 0;
              END;
              rHorAgr.RESET;

              // Modificamos el campo vuelos en la agrupacion
              IF rAgr.GET(rRsvTra."Agrupacion salida") THEN BEGIN
                lcFunCua.CampoVuelosAgrupacion(rRsvTra."Agrupacion entrada", rAgr.Vuelos, rAgr."N§ vuelos");
                rAgr.MODIFY;
              END;
            END;
          END;
        UNTIL rRsvTra.NEXT = 0;
        ventana.CLOSE;
      END;
      rRsvTra.RESET;

      // Modificamos los Acumulados x Vuelo
      rAcumVue.RESET;
      rAcumVue.SETRANGE(Fecha   , xRec.Fecha);
      rAcumVue.SETRANGE(Compa¤ia, xRec.Compa¤ia);
      rAcumVue.SETRANGE(Vuelo   , xRec.Vuelo);
      IF "Entrada/Salida" = "Entrada/Salida"::Entrada THEN
        rAcumVue.SETRANGE(IATA    , xRec.Origen)
      ELSE
        rAcumVue.SETRANGE(IATA    , xRec.Destino);
      IF rAcumVue.FINDSET THEN
      BEGIN
        REPEAT
          rAcumVue2 := rAcumVue;
          rAcumVue2.Compa¤ia := Compa¤ia;
          rAcumVue2.Vuelo := Vuelo;
          IF "Entrada/Salida" = "Entrada/Salida"::Entrada THEN
            rAcumVue2.IATA := Origen
          ELSE
            rAcumVue2.IATA := Destino;

          rAcumVue3 := rAcumVue;
          rAcumVue3.DELETE;
          IF rAcumVue2.FIND THEN
            rAcumVue2.INSERT;
        UNTIL rAcumVue.NEXT = 0;
      END;
      rAcumVue.RESET;

      //. Modificamos los Acumulados x Hotel x Vuelo
      rAcumVueHot.RESET;
      rAcumVueHot.SETRANGE(Fecha   , xRec.Fecha);
      rAcumVueHot.SETRANGE(Compa¤ia, xRec.Compa¤ia);
      rAcumVueHot.SETRANGE("Num. Vuelo"   , xRec.Vuelo);
      IF "Entrada/Salida" = "Entrada/Salida"::Entrada THEN
        rAcumVueHot.SETRANGE(IATA    , xRec.Origen)
      ELSE
        rAcumVueHot.SETRANGE(IATA    , xRec.Destino);
      IF rAcumVueHot.FINDSET THEN
      BEGIN
        REPEAT
          rAcumVueHot2 := rAcumVueHot;
          rAcumVueHot2.Compa¤ia     := Compa¤ia;
          rAcumVueHot2."Num. Vuelo" := Vuelo;
          rAcumVueHot2.Vuelo        := DELCHR(Compa¤ia, '<>' + ' ' + DELCHR(Vuelo, '<>')); //+$018

          IF "Entrada/Salida" = "Entrada/Salida"::Entrada THEN
            rAcumVueHot2.IATA := Origen
          ELSE
            rAcumVueHot2.IATA := Destino;
          rAcumVueHot2."Fecha/Hora Vuelo" := CREATEDATETIME(rAcumVueHot2.Fecha, rAcumVueHot2.Hora); //+$017

          rAcumVueHot3 := rAcumVueHot;
          rAcumVueHot3.DELETE;
          IF rAcumVueHot2.FIND THEN
            rAcumVueHot2.INSERT;
        UNTIL rAcumVueHot.NEXT = 0;
      END;
      rAcumVueHot.RESET;
    END;

    PROCEDURE CompPlazas@5();
    VAR
      lwPax@1103355000 : Integer;
    BEGIN
      // CompPlazas
      // Comprueba el total de pax no sobrepase las plazas disponibles

      lwPax := "Pax Entrada E" + "Pax Entrada C" + "Pax Salida E" + "Pax Salida C";
      IF "Total Plazas" < lwPax THEN
        ERROR(Text013);

      "Total Pax" := lwPax;

      CALCFIELDS("Total Pax TTOO");

      IF "Total Plazas" < "Total Pax TTOO" THEN
        ERROR(Text014);

      "Plazas libres" := "Total Plazas" - "Total Pax";
      CLEAR("Porcentaje ocupacion");
      IF "Total Plazas" <> 0 THEN
        "Porcentaje ocupacion" :=  ROUND("Total Pax"/"Total Plazas"*100);
    END;

    PROCEDURE CompHoras@3();
    BEGIN
      // CompHoras

      IF ("Hora Entrada" > "Hora On Block") AND ("Hora On Block" <> 0T) THEN
        ERROR(Text015,FIELDCAPTION("Hora Entrada"),FIELDCAPTION("Hora On Block"));

      IF ("Hora Salida" < "Hora Off Block") AND ("Hora Off Block" <> 0T) THEN
        ERROR(Text016,FIELDCAPTION("Hora Salida"),FIELDCAPTION("Hora Off Block"));
    END;

    LOCAL PROCEDURE _DejarSinAgrupacionEntrada@1100253000(VAR prReserva@1100253000 : Record 7009744);
    BEGIN
      IF CONFIRM(Text009) THEN BEGIN
        prReserva.FINDSET(TRUE);
        REPEAT
          prReserva.VALIDATE("Agrupacion entrada", 0);
          prReserva.MODIFY;
        UNTIL prReserva.NEXT = 0;
      END;
    END;

    LOCAL PROCEDURE _DejarSinAgrupacionSalida@1100253001(VAR prReserva@1100253000 : Record 7009744);
    BEGIN
      IF CONFIRM(Text009) THEN BEGIN
        prReserva.FINDSET(TRUE);
        REPEAT
          prReserva.VALIDATE("Agrupacion salida", 0);
          prReserva.MODIFY;
        UNTIL prReserva.NEXT = 0;
      END;
    END;

    PROCEDURE ShowPersonalAsistencia@1100253002();
    VAR
      lrPers@1100253000 : Record 7009907;
    BEGIN
      // ShowPersonalAsistencia

      CLEAR(lrPers);
      lrPers.FILTERGROUP(2);
      lrPers.SETRANGE(Fecha    , Fecha);
      lrPers.SETRANGE(Compa¤ia , Compa¤ia);
      lrPers.SETRANGE(Vuelo    , Vuelo);
      lrPers.SETRANGE(Origen   , Origen);
      lrPers.SETRANGE(Destino  , Destino);
      lrPers.FILTERGROUP(0);
      FORM.RUN(0, lrPers);
    END;

    PROCEDURE BuscaTarifaAsistencia@1100253003(pwError@1100253006 : Boolean) : Boolean;
    VAR
      lrPar@1100217000 : Record 7009700;
      lrTarf@1100253003 : Record 7009901;
      lwEnc@1100253001 : Boolean;
    BEGIN
      // BuscaTarifaAsistencia
      // Devuelve TRUE si encuentra tarifa
      // pwError : genera un error si no se encuentra
      // $002

      //+$003
      lrPar.FINDFIRST;
      IF NOT lrPar."Personal asistencia vuelo obli" THEN
        EXIT;
      //+$003

      // Buscamos las tarifa
      CLEAR(lrTarf);
      lrTarf.SETRANGE("Tipo Tarifa", lrTarf."Tipo Tarifa"::Asistencia);
      lrTarf.SETFILTER("Fecha Inicial", '<=%1', Fecha);
      lrTarf.SETFILTER("Fecha Final"  , '>=%1', Fecha);
      lwEnc := lrTarf.FINDFIRST;

      IF (NOT lwEnc) AND (pwError) THEN
        ERROR(Text017, Fecha);

      EXIT(lwEnc);
    END;

    LOCAL PROCEDURE _ActualizaRecogidas@1100217000();
    VAR
      lrPrev@1100217000 : Record 7010246;
      lrHorAgr@1100217002 : Record 7009800;
      lwRetraso@1100217001 : Decimal;
    BEGIN
      // _ActualizaRecogidas

      IF GUIALLOWED THEN
      BEGIN
        IF NOT CONFIRM(Text018) THEN
          EXIT;
      END
      ELSE
        EXIT;

      lwRetraso := xRec."Hora Salida" - "Hora Salida";

      lrPrev.RESET;
      lrPrev.SETRANGE(Fecha   , Fecha);
      lrPrev.SETRANGE(Compa¤ia, Compa¤ia);
      lrPrev.SETRANGE(Vuelo   , Vuelo);
      IF lrPrev.FINDSET THEN
      BEGIN
        REPEAT
          IF lrPrev."Hora recogida" <> 0T THEN
          BEGIN
            lrPrev."Hora recogida" := lrPrev."Hora recogida" - lwRetraso; //+$011
            lrPrev.MODIFY;
          END;
        UNTIL lrPrev.NEXT = 0;
      END;

      lrHorAgr.RESET;
      lrHorAgr.SETCURRENTKEY(Fecha, Zona, "Tipo transfer", Hotel, Compa¤ia, Vuelo, IATA, "Hora vuelo");
      lrHorAgr.SETRANGE(Fecha          , Fecha);
      lrHorAgr.SETRANGE("Tipo transfer", lrHorAgr."Tipo transfer"::Salida);
      lrHorAgr.SETRANGE(Compa¤ia       , Compa¤ia);
      lrHorAgr.SETRANGE(Vuelo          , Vuelo);
      IF lrHorAgr.FINDSET THEN
      BEGIN
        REPEAT
          IF lrHorAgr."Hora recogida" <> 0T THEN
          BEGIN
            lrHorAgr."Hora recogida" := lrHorAgr."Hora recogida" - lwRetraso; //+$011
            lrHorAgr.MODIFY;
          END;
        UNTIL lrHorAgr.NEXT = 0;
      END;
    END;

    LOCAL PROCEDURE _ActualizaMismoVuelo@1100217007();
    VAR
      lrVuelo@1100217000 : Record 7009754;
    BEGIN
      // _ActualizaMismoVuelo

      //. Actualizar el horario de los vuelos que comparten el mismo numero de vuelo con diferentes aeropuertos

      IF "Entrada/Salida" = "Entrada/Salida"::Entrada THEN
      BEGIN
        lrVuelo.RESET;
        lrVuelo.SETRANGE (Fecha   , Fecha);
        lrVuelo.SETRANGE (Compa¤ia, Compa¤ia);
        lrVuelo.SETRANGE (Vuelo   , Vuelo);
        lrVuelo.SETFILTER(Origen  , '<>%1', Origen);
        IF lrVuelo.FINDSET THEN
          lrVuelo.MODIFYALL("Hora Entrada", "Hora Entrada");
      END
      ELSE
      BEGIN
        lrVuelo.RESET;
        lrVuelo.SETRANGE (Fecha   , Fecha);
        lrVuelo.SETRANGE (Compa¤ia, Compa¤ia);
        lrVuelo.SETRANGE (Vuelo   , Vuelo);
        lrVuelo.SETFILTER(Destino  , '<>%1', Destino);
        IF lrVuelo.FINDSET THEN
          lrVuelo.MODIFYALL("Hora Salida", "Hora Salida");
      END;
    END;

    LOCAL PROCEDURE _CheckFecha@1100217001();
    VAR
      lwFecha@1100217000 : Date;
    BEGIN
      // _CheckFecha

      lwFecha := TODAY - 7;
      IF Fecha < lwFecha THEN
        ERROR(Text019, lwFecha);
    END;

    BEGIN
    {
      ## AJS 02.03.2009

        .- Nueva clave Compa¤ia,Vuelo,Origen,Destino,Fecha para el report 50091

      $001 AJS 17042012 Modifico para validar todas las reservas si dejamos la agrupacion en cero con un cambio de hora,
                        tambien pongo un filtro para no se modifiquen el campo agrupacion si la fecha del vuelo ya ha pasado

      $002 JPT 14/05/12 CNT-CAR-12004 / FLI-07 Airport Assistance Service

      $003 AJS 08102012 El personal de asistencia en vuelo es obligatorio a partir de un parametro

      $004 AJS 27022013 Cuando se modifica un horario de salida paso el desfase horario (retraso) a las recogidas

      $005 AJS 27022013 Cuando se modifica un horario de vuelo actualizo todos los vuelos que tienen el mismo numero pero
                        con distinto aeropuerto

      $006 AJS 04032013 Las modificaciones por interface no actualizan horarios de recogida

      $007 AJS 20032013 Aseguramos los registros de horas recogida agrupacion tambien para llegadas

      $008 AJS 05022014 Control para que no puedan meter vuelos con fechas pasadas

      $009 AJS 05022014 Cuando pasamos un vuelo de entrada a salida o viceversa, dejar en blanco las horas

      $010 AJS 01052014 Nueva clave Fecha, Hora para el reporte de aeropuerto de CNT

      $011 AJS 06052014 Corrijo un error al aplicar los retrasos a las horas de recogida

      $012 AJS 16052014 Pongo el codigo para seleccionar vuelo de entrada/salida en el campo Destino

      $013 MNC 22072014 CNT-LP-14054 No se pueden usar TTOO bloqueados

      $014 AJS 30092014 Cuando estamos creando un vuelo desde reservas, pongo TEMP en observaciones para que no de mensaje
                        al poner una hora

      $015 AJS 07102014 Nueva clave Fecha,Vuelo dia siguiente,Hora Salida para el reporte de salidas aeropuerto de CNT

      $016 AJS 10102014 Elimino el parametro equivalencia libras-kilos porque es un valor que no necesita ser configurado

      $017 AJS 04032015 Rellenar nuevo campo DateTime en Acumulado x hotel x vuelo

      $018 AJS 16052015 Nuevo campo Vuelo que concatena la compa¤ia y el numero de vuelo

      $019 AJS 28072015 Cuando estamos creado un vuelo de salida desde reservas, pongo TEMP en observaciones para evitar mensajes
                        al cambiar la hora

      $020 AJS 28072015 Modifico la funcion _ActualizaRecogidas para corregir error si las recogidas no estan actualizadas
    }
    END.
  }
}
