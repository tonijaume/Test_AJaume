OBJECT Table 7009748 Acompa¤ante reserva
{
  OBJECT-PROPERTIES
  {
    Date=09/06/15;
    Time=17:37:35;
    Modified=Yes;
    Version List=AIC2009,CNT-OC-14035;
  }
  PROPERTIES
  {
    OnInsert=VAR
               rPaxTO@1103355000 : Record 7010188;
             BEGIN
               rPar.FINDFIRST;
               IF NOT rPar."Empresa Delegacion" THEN
                 ERROR(Text001);

               rParPer.FINDFIRST;

               rAco.RESET;
               rAco.SETRANGE(Delegacion  , Delegacion);
               rAco.SETRANGE("N§ Interno", "N§ Interno");
               IF rAco.FINDLAST THEN
                 "N§ Acompa¤ante" := rAco."N§ Acompa¤ante" + 1
               ELSE
                 "N§ Acompa¤ante" := 1;

               // Copiar los campos del acompa¤ante n§ 1

               IF ("N§ Acompa¤ante" <> _GetPrimeraPersona) AND (_GetPrimeraPersona <> 0) THEN
                 copiar_campos
               ELSE
                 RellenarDatos;

               // Comprobar la habitacion de uso

               IF "Tipo Persona" <> '' THEN
               BEGIN
                 CLEAR(rCab);
                 rPer.RESET;
                 rPer.SETRANGE(Delegacion  , Delegacion);
                 rPer.SETRANGE("N§ Interno", "N§ Interno");
                 IF rPer.FINDSET THEN
                 BEGIN
                   REPEAT
                     IF NOT "Modificacion importacion" THEN
                       rPer.comprobar_habitacion(rCab, rPer, 0);
                   UNTIL rPer.NEXT = 0;
                 END;
                 rPer.RESET;
               END;

               Generado := FALSE;

               // Si la cabecera no est  generada, pero existe Pax TO-Circuito, crearemos el pax

               IF (NOT GesCuaCircuito) AND (rPar."Activar m¢dulo circuitos") THEN
               BEGIN
                 IF rCab.GET(Delegacion, "N§ Interno") THEN
                   IF NOT rCab.Generada THEN
                   BEGIN
                     rPaxTO.SETCURRENTKEY("N§ Interno");
                     rPaxTO.SETRANGE("N§ Interno", rCab."N§ Interno");
                     rPaxTO.SETRANGE(Delegacion  , rCab.Delegacion);
                     IF rPaxTO.FINDFIRST THEN
                     BEGIN
                       CLEAR(rRsvCir);
                       rRsvCir.Delegacion      := rCab.Delegacion;
                       rRsvCir."N§ Interno"    := rCab."N§ Interno";
                       rRsvCir.Bono            := rCab.Bono;
                       rRsvCir."Fecha Entrada" := "Fecha entrada";
                       rRsvCir."Fecha Salida"  := "Fecha salida";
                       rRsvCir.TourOperador    := rCab."TourOperador Venta";
                       rRsvCir.Nombre          := Nombre;
                       rRsvCir.Edad            := Edad;
                       rRsvCir."Tipo Persona"  := "Tipo Persona";
                       rRsvCir.Circuito        := rPaxTO.Circuito;
                       rRsvCir.Orden           := rPaxTO.Orden;
                       rRsvCir."N§ linea"      := rPaxTO."N§ Linea";
                       rRsvCir."N§ Acompa¤ante" := "N§ Acompa¤ante";
                       rRsvCir."C¢d. categor¡a" := rPaxTO."Cod. Categoria";
                       rRsvCir."Tipo habitaci¢n" := rPaxTO."Tipo Habitacion";
                       rRsvCir.INSERT(TRUE);
                     END;
                   END;
               END;

               // Insertar la creacion del acompa¤ante en el Historico
               cPar.intro_historic(Delegacion, "N§ Interno", 0, "N§ Acompa¤ante", 8, Text003,
                                   Text004, FORMAT("Id Pax TO"));
             END;

    OnModify=BEGIN
               rPar.FINDFIRST;
               IF NOT rPar."Empresa Delegacion" THEN
                 ERROR(Text005);

               // Comprobar la habitacion de uso

               rPer.RESET;
               rPer.SETRANGE(Delegacion  , Delegacion);
               rPer.SETRANGE("N§ Interno", "N§ Interno");
               IF rPer.FINDSET THEN
               BEGIN
                 REPEAT
                   IF (xRec."Tipo Persona" <> "Tipo Persona") AND (NOT "Modificacion importacion") THEN
                   BEGIN
                     rCab.GET(Delegacion, "N§ Interno");
                     rPer.comprobar_habitacion(rCab, rPer, 2);
                   END;
                 UNTIL rPer.NEXT = 0;
               END;

               _CheckEnvioConfirmacion; //+$003

               Replicado:= FALSE;
             END;

    OnDelete=VAR
               rBack@1103355000 : Record 7009849;
             BEGIN
               rPar.FINDFIRST;
               IF NOT rPar."Empresa Delegacion" THEN
                 ERROR(Text007);

               rParPer.FINDFIRST;

               // JPT 27/08/03 Incluyo lo de poder borrar el registro aunque sea el acompa¤ante principal
               //IF ("N§ Acompa¤ante" = _GetPrimeraPersona) AND (NOT "Puede Borrar") THEN
               //  ERROR(Text008, Bono);

               _CheckEnvioConfirmacion; //+$003

               _DeleteRelatedInfo; //+$005

               // Modificar los campos Adultos, Ni¤os e Infants en Cabecera

               rCab.RESET;
               IF rCab.GET(Delegacion, "N§ Interno") THEN
               BEGIN
                 CASE "Tipo Persona" OF
                   rParPer."Codigo Adulto": rCab.Adultos := rCab.Adultos - 1;
                   rParPer."Codigo Ni¤o": rCab.Ni¤os := rCab.Ni¤os - 1;
                   rParPer."Codigo Infant": rCab.Infants := rCab.Infants - 1;
                 END;
                 rCab.MODIFY;
               END;
               rCab.RESET;

               // Comprobar la habitacion de uso

               CLEAR(rCab);
               IF NOT "Modificacion importacion" THEN
               BEGIN
                 rPer.RESET;
                 rPer.SETRANGE(Delegacion  , Delegacion);
                 rPer.SETRANGE("N§ Interno", "N§ Interno");
                 IF rPer.FINDSET THEN
                 BEGIN
                   REPEAT
                     rPer.comprobar_habitacion(rCab, rPer, 1);
                   UNTIL rPer.NEXT = 0;
                 END;
                 rPer.RESET;
               END;

               IF rPar."Tipo Anulacion reserva" = rPar."Tipo Anulacion reserva"::Backup THEN
               BEGIN
                 rBack.TRANSFERFIELDS(Rec);
                 IF NOT rBack.FIND THEN
                   rBack.INSERT;
               END;

               // Insertar el borrado en el Historico
               cPar.intro_historic(Delegacion, "N§ Interno", 0, "N§ Acompa¤ante", 8, Text009, Text010, FORMAT("Id Pax TO"));
             END;

    OnRename=BEGIN
               rPar.FINDFIRST;
               IF NOT rPar."Empresa Delegacion" THEN
                 ERROR(Text011);

               Replicado:= FALSE;
             END;

    CaptionML=[ENU=Booking companion;
               ESP=Acompa¤ante reserva];
    LookupFormID=Form7009929;
    DrillDownFormID=Form7009929;
  }
  FIELDS
  {
    { 1   ;   ;Delegacion          ;Code10        ;TableRelation=Delegacion.Codigo;
                                                   CaptionML=[ENU=Local Office;
                                                              ESP=Delegacion];
                                                   Description=PK, FK Delegacion;
                                                   Editable=No }
    { 3   ;   ;N§ Interno          ;Integer       ;TableRelation="Cabecera reserva"."N§ Interno";
                                                   CaptionML=[ENU=Internal No.;
                                                              ESP=N§ Interno];
                                                   Description=PK, FK Cabecera;
                                                   Editable=No }
    { 5   ;   ;N§ Acompa¤ante      ;Integer       ;CaptionML=[ENU=Companion No.;
                                                              ESP=N§ Acompa¤ante];
                                                   Description=PK;
                                                   Editable=No }
    { 7   ;   ;Nombre              ;Text50        ;OnValidate=BEGIN
                                                                IF Nombre <> xRec.Nombre THEN
                                                                BEGIN
                                                                  // Cambios en cabecera

                                                                  IF ("N§ Acompa¤ante" = _GetPrimeraPersona) AND
                                                                     ((CurrFieldNo = FIELDNO(Nombre)) OR ("Modificacion importacion")) THEN
                                                                  BEGIN
                                                                    rCab.RESET;
                                                                    IF rCab.GET(Delegacion, "N§ Interno") THEN
                                                                    BEGIN
                                                                      rCab.VALIDATE(Nombre, Nombre);
                                                                      rCab.MODIFY;
                                                                    END;
                                                                    rCab.RESET;
                                                                  END;

                                                                  // Modificar en reserva hotel
                                                                  rRsvHot.RESET;
                                                                  rRsvHot.SETCURRENTKEY(Delegacion,
                                                                                        "N§ Interno",
                                                                                        "N§ Periodo",
                                                                                        "N§ Acompa¤ante");
                                                                  rRsvHot.SETRANGE(Delegacion      , Delegacion);
                                                                  rRsvHot.SETRANGE("N§ Interno"    , "N§ Interno");
                                                                  rRsvHot.SETRANGE("N§ Acompa¤ante", "N§ Acompa¤ante");
                                                                  IF rRsvHot.FINDSET(TRUE) THEN BEGIN
                                                                    REPEAT
                                                                      rRsvHot.VALIDATE(Nombre, Nombre);
                                                                      rRsvHot.MODIFY(TRUE);
                                                                    UNTIL rRsvHot.NEXT = 0;
                                                                  END;
                                                                  rRsvHot.RESET;

                                                                  // Modificar en reserva transfer

                                                                  rRsvTra.RESET;
                                                                  rRsvTra.SETCURRENTKEY(Delegacion,
                                                                                        "N§ Interno",
                                                                                        "N§ Periodo",
                                                                                        "N§ Acompa¤ante");
                                                                  rRsvTra.SETRANGE(Delegacion      , Delegacion);
                                                                  rRsvTra.SETRANGE("N§ Interno"    , "N§ Interno");
                                                                  rRsvTra.SETRANGE("N§ Acompa¤ante", "N§ Acompa¤ante");
                                                                  IF rRsvTra.FINDSET(TRUE) THEN
                                                                  BEGIN
                                                                    REPEAT
                                                                      rRsvTra.VALIDATE(Nombre, Nombre);
                                                                      rRsvTra.MODIFY;
                                                                    UNTIL rRsvTra.NEXT = 0;
                                                                  END;
                                                                  rRsvTra.RESET;

                                                                  // Modificar en reserva Circuito

                                                                  rPar.FINDFIRST;
                                                                  IF (NOT GesCuaCircuito) AND (rPar."Activar m¢dulo circuitos")THEN
                                                                  BEGIN
                                                                    rRsvCir.RESET;
                                                                    rRsvCir.Establecer_Gestion_Cabecera(TRUE);
                                                                    rRsvCir.SETCURRENTKEY(Delegacion, "N§ Interno");
                                                                    rRsvCir.SETRANGE("N§ Interno"    , "N§ Interno");
                                                                    rRsvCir.SETRANGE(Delegacion      , Delegacion);
                                                                    rRsvCir.SETRANGE("N§ Acompa¤ante", "N§ Acompa¤ante");
                                                                    IF rRsvCir.FINDSET(TRUE) THEN BEGIN
                                                                      REPEAT
                                                                        rRsvCir.Nombre := Nombre;
                                                                        rRsvCir.MODIFY;
                                                                      UNTIL rRsvCir.NEXT = 0;
                                                                    END;
                                                                    rRsvCir.RESET;
                                                                    rRsvCir.Establecer_Gestion_Cabecera(FALSE);
                                                                  END;

                                                                  //. Historico
                                                                  cPar.intro_historic(Delegacion, "N§ Interno", 0, "N§ Acompa¤ante", 8, FIELDCAPTION(Nombre),
                                                                                      xRec.Nombre, Nombre);
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Name;
                                                              ESP=Nombre] }
    { 9   ;   ;Edad                ;Integer       ;OnValidate=BEGIN
                                                                IF Edad <> xRec.Edad THEN BEGIN
                                                                  //. Cambios en cabecera
                                                                  IF ("N§ Acompa¤ante" = _GetPrimeraPersona) AND
                                                                     ((CurrFieldNo = FIELDNO(Edad)) OR ("Modificacion importacion")) THEN
                                                                  BEGIN
                                                                    rCab.RESET;
                                                                    IF rCab.GET(Delegacion, "N§ Interno") THEN
                                                                    BEGIN
                                                                      rCab.VALIDATE(Edad, Edad);
                                                                      rCab.MODIFY;
                                                                    END;
                                                                    rCab.RESET;
                                                                  END;

                                                                  //. Modificar en reserva hotel
                                                                  rRsvHot.RESET;
                                                                  rRsvHot.SETCURRENTKEY(Delegacion,
                                                                                        "N§ Interno",
                                                                                        "N§ Periodo",
                                                                                        "N§ Acompa¤ante");
                                                                  rRsvHot.SETRANGE(Delegacion      , Delegacion);
                                                                  rRsvHot.SETRANGE("N§ Interno"    , "N§ Interno");
                                                                  rRsvHot.SETRANGE("N§ Acompa¤ante", "N§ Acompa¤ante");
                                                                  IF rRsvHot.FIND('-') THEN BEGIN
                                                                    REPEAT
                                                                      rRsvHot.VALIDATE(Edad, Edad);
                                                                      rRsvHot.MODIFY;
                                                                    UNTIL rRsvHot.NEXT = 0;
                                                                  END;
                                                                  rRsvHot.RESET;

                                                                  //. Modificar en reserva transfer
                                                                  rRsvTra.RESET;
                                                                  rRsvTra.SETCURRENTKEY(Delegacion,
                                                                                        "N§ Interno",
                                                                                        "N§ Periodo",
                                                                                        "N§ Acompa¤ante");
                                                                  rRsvTra.SETRANGE(Delegacion      , Delegacion);
                                                                  rRsvTra.SETRANGE("N§ Interno"    , "N§ Interno");
                                                                  rRsvTra.SETRANGE("N§ Acompa¤ante", "N§ Acompa¤ante");
                                                                  IF rRsvTra.FIND('-') THEN BEGIN
                                                                    REPEAT
                                                                      rRsvTra.VALIDATE(Edad, Edad);
                                                                      rRsvTra.MODIFY;
                                                                    UNTIL rRsvTra.NEXT = 0;
                                                                  END;
                                                                  rRsvTra.RESET;

                                                                  //. Modificar en reserva Circuito
                                                                  rPar.FINDFIRST;
                                                                  IF (NOT GesCuaCircuito) AND (rPar."Activar m¢dulo circuitos") THEN BEGIN
                                                                    rRsvCir.RESET;
                                                                    rRsvCir.Establecer_Gestion_Cabecera(TRUE);
                                                                    rRsvCir.SETCURRENTKEY(Delegacion, "N§ Interno");
                                                                    rRsvCir.SETRANGE("N§ Interno"    , "N§ Interno");
                                                                    rRsvCir.SETRANGE(Delegacion      , Delegacion);
                                                                    rRsvCir.SETRANGE("N§ Acompa¤ante", "N§ Acompa¤ante");
                                                                    IF rRsvCir.FIND('-') THEN
                                                                      REPEAT
                                                                        rRsvCir.Edad := Edad;
                                                                        rRsvCir.MODIFY;
                                                                      UNTIL rRsvCir.NEXT = 0;
                                                                    rRsvCir.RESET;
                                                                    rRsvCir.Establecer_Gestion_Cabecera(FALSE);
                                                                  END;

                                                                  //. Historico
                                                                  cPar.intro_historic(Delegacion, "N§ Interno", 0, "N§ Acompa¤ante", 8, FIELDCAPTION(Edad),
                                                                                      STRSUBSTNO('%1', xRec.Edad), STRSUBSTNO('%1', Edad));
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Age;
                                                              ESP=Edad] }
    { 11  ;   ;Tipo Persona        ;Code10        ;TableRelation="Tipo elemento"."Tipo elemento" WHERE (Humano=CONST(Yes));
                                                   OnValidate=BEGIN
                                                                TESTFIELD("Tipo Persona");

                                                                IF "Tipo Persona" <> xRec."Tipo Persona" THEN BEGIN
                                                                  rParPer.FINDFIRST;

                                                                  //. Modificar en reserva hotel
                                                                  rRsvHot.RESET;
                                                                  rRsvHot.SETCURRENTKEY(Delegacion,
                                                                                        "N§ Interno",
                                                                                        "N§ Periodo",
                                                                                        "N§ Acompa¤ante");
                                                                  rRsvHot.SETRANGE(Delegacion      , Delegacion);
                                                                  rRsvHot.SETRANGE("N§ Interno"    , "N§ Interno");
                                                                  rRsvHot.SETRANGE("N§ Acompa¤ante", "N§ Acompa¤ante");
                                                                  IF rRsvHot.FIND('-') THEN BEGIN
                                                                    REPEAT
                                                                      rRsvHot.VALIDATE("Tipo Persona", "Tipo Persona");
                                                                      rRsvHot.MODIFY(TRUE);
                                                                    UNTIL rRsvHot.NEXT = 0;
                                                                  END;
                                                                  rRsvHot.RESET;

                                                                  //. Modificar en reserva transfer
                                                                  rRsvTra.RESET;
                                                                  rRsvTra.SETCURRENTKEY(Delegacion,
                                                                                        "N§ Interno",
                                                                                        "N§ Periodo",
                                                                                        "N§ Acompa¤ante");
                                                                  rRsvTra.SETRANGE(Delegacion      , Delegacion);
                                                                  rRsvTra.SETRANGE("N§ Interno"    , "N§ Interno");
                                                                  rRsvTra.SETRANGE("N§ Acompa¤ante", "N§ Acompa¤ante");
                                                                  IF rRsvTra.FIND('-') THEN BEGIN
                                                                    REPEAT
                                                                      rRsvTra.VALIDATE("Tipo Persona", "Tipo Persona");
                                                                      rRsvTra.MODIFY;
                                                                    UNTIL rRsvTra.NEXT = 0;
                                                                  END;
                                                                  rRsvTra.RESET;

                                                                  //. Modificar en reserva Circuito
                                                                  rPar.FINDFIRST;
                                                                  IF (NOT GesCuaCircuito) AND (rPar."Activar m¢dulo circuitos") THEN BEGIN
                                                                    rRsvCir.RESET;
                                                                    rRsvCir.Establecer_Gestion_Cabecera(TRUE);
                                                                    rRsvCir.SETCURRENTKEY(Delegacion, "N§ Interno");
                                                                    rRsvCir.SETRANGE("N§ Interno"    , "N§ Interno");
                                                                    rRsvCir.SETRANGE(Delegacion      , Delegacion);
                                                                    rRsvCir.SETRANGE("N§ Acompa¤ante", "N§ Acompa¤ante");
                                                                    IF rRsvCir.FIND('-') THEN
                                                                      REPEAT
                                                                        rRsvCir."Tipo Persona" := "Tipo Persona";
                                                                        rRsvCir.MODIFY;
                                                                      UNTIL rRsvCir.NEXT = 0;
                                                                    rRsvCir.RESET;
                                                                    rRsvCir.Establecer_Gestion_Cabecera(FALSE);
                                                                  END;

                                                                  //. Modificar en cabecera reserva
                                                                  rCab.RESET;
                                                                  rCab.SETRANGE(Delegacion  , Delegacion);
                                                                  rCab.SETRANGE("N§ Interno", "N§ Interno");
                                                                  IF rCab.FINDFIRST THEN BEGIN
                                                                    CASE xRec."Tipo Persona" OF
                                                                      rParPer."Codigo Adulto": rCab.Adultos := rCab.Adultos - 1;
                                                                      rParPer."Codigo Ni¤o": rCab.Ni¤os := rCab.Ni¤os - 1;
                                                                      rParPer."Codigo Infant": rCab.Infants := rCab.Infants - 1;
                                                                    END;
                                                                    CASE "Tipo Persona" OF
                                                                      rParPer."Codigo Adulto": rCab.Adultos := rCab.Adultos + 1;
                                                                      rParPer."Codigo Ni¤o": rCab.Ni¤os := rCab.Ni¤os + 1;
                                                                      rParPer."Codigo Infant": rCab.Infants := rCab.Infants + 1;
                                                                    END;
                                                                    IF ("N§ Acompa¤ante" = _GetPrimeraPersona) AND
                                                                       ((CurrFieldNo = FIELDNO("Tipo Persona")) OR ("Modificacion importacion")) THEN
                                                                    BEGIN
                                                                      rCab.VALIDATE("Tipo Persona", "Tipo Persona");
                                                                    END;
                                                                    rCab.MODIFY;
                                                                  END;
                                                                  rCab.RESET;

                                                                  //. Historico
                                                                  cPar.intro_historic(Delegacion, "N§ Interno", 0, "N§ Acompa¤ante", 8, FIELDCAPTION("Tipo Persona"),
                                                                                      xRec."Tipo Persona", "Tipo Persona");
                                                                END;
                                                              END;

                                                   OnLookup=VAR
                                                              lrTipoPer@1100253000 : Record 7009715;
                                                            BEGIN
                                                              lrTipoPer.RESET;
                                                              lrTipoPer.SETRANGE(Humano, TRUE);
                                                              IF FORM.RUNMODAL(7009712, lrTipoPer) = ACTION::LookupOK THEN
                                                                VALIDATE("Tipo Persona", lrTipoPer."Tipo elemento");
                                                            END;

                                                   CaptionML=[ENU=Person type;
                                                              ESP=Tipo Persona];
                                                   Description=FK Tipo elemento }
    { 13  ;   ;Mantenimiento       ;Boolean       ;InitValue=Yes;
                                                   CaptionML=[ENU=Maintenance;
                                                              ESP=Mantenimiento];
                                                   Editable=No }
    { 15  ;   ;Generado            ;Boolean       ;CaptionML=[ENU=Generated;
                                                              ESP=Generado];
                                                   Editable=No }
    { 17  ;   ;N§ Habitacion       ;Code10        ;OnValidate=BEGIN
                                                                IF "N§ Habitacion" <> xRec."N§ Habitacion" THEN BEGIN
                                                                  //. Modificar en reserva hotel
                                                                  rRsvHot.RESET;
                                                                  rRsvHot.SETCURRENTKEY(Delegacion,
                                                                                        "N§ Interno",
                                                                                        "N§ Periodo",
                                                                                        "N§ Acompa¤ante");
                                                                  rRsvHot.SETRANGE(Delegacion      , Delegacion);
                                                                  rRsvHot.SETRANGE("N§ Interno"    , "N§ Interno");
                                                                  rRsvHot.SETRANGE("N§ Acompa¤ante", "N§ Acompa¤ante");
                                                                  IF rRsvHot.FINDSET THEN
                                                                  BEGIN
                                                                    REPEAT
                                                                      rRsvHot.VALIDATE("N§ Habitacion", "N§ Habitacion");
                                                                      rRsvHot.MODIFY;
                                                                    UNTIL rRsvHot.NEXT = 0;
                                                                  END;
                                                                  rRsvHot.RESET;

                                                                  //. Historico
                                                                  cPar.intro_historic(Delegacion, "N§ Interno", 0, "N§ Acompa¤ante", 8, FIELDCAPTION("N§ Habitacion"),
                                                                                      xRec."N§ Habitacion", "N§ Habitacion");
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Room No.;
                                                              ESP=N§ Habitacion] }
    { 19  ;   ;Compa¤ia entrada    ;Code10        ;TableRelation="Compa¤ia aerea".Codigo;
                                                   OnValidate=BEGIN
                                                                //. Periodo reserva

                                                                IF "N§ Acompa¤ante" = _GetPrimeraPersona THEN
                                                                BEGIN
                                                                  rPer.RESET;
                                                                  rPer.SETRANGE(Delegacion  , Delegacion);
                                                                  rPer.SETRANGE("N§ Interno", "N§ Interno");
                                                                  IF Periodo <> 0 THEN
                                                                    rPer.SETRANGE("N§ Periodo", Periodo);
                                                                  IF rPer.FINDFIRST THEN
                                                                  BEGIN
                                                                    rPer."Compa¤ia entrada" := "Compa¤ia entrada";
                                                                    rPer.MODIFY;
                                                                  END;
                                                                  rPer.RESET;
                                                                END;

                                                                // Reserva Hotel
                                                                //
                                                                rRsvHot.RESET;
                                                                rRsvHot.SETCURRENTKEY(Delegacion,
                                                                                      "N§ Interno",
                                                                                      "N§ Periodo",
                                                                                      "N§ Acompa¤ante");
                                                                rRsvHot.SETRANGE(Delegacion      , Delegacion);
                                                                rRsvHot.SETRANGE("N§ Interno"    , "N§ Interno");
                                                                IF Periodo <> 0 THEN
                                                                  rRsvHot.SETRANGE("N§ Periodo"  , Periodo);
                                                                rRsvHot.SETRANGE("N§ Acompa¤ante", "N§ Acompa¤ante");
                                                                IF rRsvHot.FINDSET THEN
                                                                BEGIN
                                                                  REPEAT
                                                                    rRsvHot.VALIDATE("Compa¤ia entrada", "Compa¤ia entrada");
                                                                    rRsvHot.MODIFY(TRUE);
                                                                  UNTIL rRsvHot.NEXT = 0;
                                                                END;
                                                                rRsvHot.RESET;
                                                                // Reserva Transfer
                                                                //
                                                                rRsvTra.RESET;
                                                                rRsvTra.SETCURRENTKEY(Delegacion,
                                                                                      "N§ Interno",
                                                                                      "N§ Periodo",
                                                                                      "N§ Acompa¤ante");
                                                                rRsvTra.SETRANGE(Delegacion      , Delegacion);
                                                                rRsvTra.SETRANGE("N§ Interno"    , "N§ Interno");
                                                                IF Periodo <> 0 THEN
                                                                  rRsvTra.SETRANGE("N§ Periodo"  , Periodo);
                                                                rRsvTra.SETRANGE("N§ Acompa¤ante", "N§ Acompa¤ante");
                                                                IF rRsvTra.FINDSET THEN
                                                                BEGIN
                                                                  REPEAT
                                                                    rRsvTra.VALIDATE("Compa¤ia entrada", "Compa¤ia entrada");
                                                                    rRsvTra.MODIFY;
                                                                  UNTIL rRsvTra.NEXT = 0;
                                                                END;
                                                                rRsvTra.RESET;
                                                                // Historico
                                                                //
                                                                cPar.intro_historic(Delegacion, "N§ Interno", 0, "N§ Acompa¤ante", 8, FIELDCAPTION("Compa¤ia entrada"),
                                                                                    xRec."Compa¤ia entrada", "Compa¤ia entrada");
                                                              END;

                                                   CaptionML=[ENU=Arrival company;
                                                              ESP=Compa¤ia entrada];
                                                   Description=FK Compa¤ia aerea;
                                                   Editable=No }
    { 21  ;   ;Vuelo entrada       ;Code10        ;OnValidate=BEGIN
                                                                // Periodo reserva

                                                                IF "N§ Acompa¤ante" = _GetPrimeraPersona THEN BEGIN
                                                                  rPer.RESET;
                                                                  rPer.SETRANGE(Delegacion  , Delegacion);
                                                                  rPer.SETRANGE("N§ Interno", "N§ Interno");
                                                                  IF Periodo <> 0 THEN
                                                                    rPer.SETRANGE("N§ Periodo", Periodo);
                                                                  IF rPer.FIND('-') THEN BEGIN
                                                                    rPer."Vuelo entrada" := "Vuelo entrada";
                                                                    rPer.MODIFY;
                                                                  END;
                                                                  rPer.RESET;
                                                                END;
                                                                // Reserva Hotel
                                                                //
                                                                rRsvHot.RESET;
                                                                rRsvHot.SETCURRENTKEY(Delegacion,
                                                                                      "N§ Interno",
                                                                                      "N§ Periodo",
                                                                                      "N§ Acompa¤ante");
                                                                rRsvHot.SETRANGE(Delegacion      , Delegacion);
                                                                rRsvHot.SETRANGE("N§ Interno"    , "N§ Interno");
                                                                IF Periodo <> 0 THEN
                                                                  rRsvHot.SETRANGE("N§ Periodo"  , Periodo);
                                                                rRsvHot.SETRANGE("N§ Acompa¤ante", "N§ Acompa¤ante");
                                                                IF rRsvHot.FIND('-') THEN BEGIN
                                                                  REPEAT
                                                                    rRsvHot.VALIDATE("Vuelo entrada", "Vuelo entrada");
                                                                    rRsvHot.MODIFY(TRUE);
                                                                  UNTIL rRsvHot.NEXT = 0;
                                                                END;
                                                                rRsvHot.RESET;
                                                                // Reserva Transfer
                                                                //
                                                                rRsvTra.RESET;
                                                                rRsvTra.SETCURRENTKEY(Delegacion,
                                                                                      "N§ Interno",
                                                                                      "N§ Periodo",
                                                                                      "N§ Acompa¤ante");
                                                                rRsvTra.SETRANGE(Delegacion      , Delegacion);
                                                                rRsvTra.SETRANGE("N§ Interno"    , "N§ Interno");
                                                                IF Periodo <> 0 THEN
                                                                  rRsvTra.SETRANGE("N§ Periodo"  , Periodo);
                                                                rRsvTra.SETRANGE("N§ Acompa¤ante", "N§ Acompa¤ante");
                                                                IF rRsvTra.FIND('-') THEN BEGIN
                                                                  REPEAT
                                                                    rRsvTra.VALIDATE("Vuelo entrada", "Vuelo entrada");
                                                                    rRsvTra.MODIFY;
                                                                  UNTIL rRsvTra.NEXT = 0;
                                                                END;
                                                                rRsvTra.RESET;
                                                                // Historico
                                                                //
                                                                IF xRec."Vuelo entrada" <> '' THEN
                                                                  cPar.intro_historic(Delegacion, "N§ Interno", 0, "N§ Acompa¤ante", 8, FIELDCAPTION("Vuelo entrada"),
                                                                                      xRec."Vuelo entrada", "Vuelo entrada");
                                                              END;

                                                   CaptionML=[ENU=Arrival flight;
                                                              ESP=Vuelo entrada];
                                                   Editable=No }
    { 23  ;   ;Fecha entrada       ;Date          ;OnValidate=BEGIN
                                                                // Periodo reserva

                                                                IF "N§ Acompa¤ante" = _GetPrimeraPersona THEN BEGIN
                                                                  rPer.RESET;
                                                                  rPer.SETRANGE(Delegacion  , Delegacion);
                                                                  rPer.SETRANGE("N§ Interno", "N§ Interno");
                                                                  IF Periodo <> 0 THEN
                                                                    rPer.SETRANGE("N§ Periodo", Periodo);
                                                                  IF rPer.FIND('-') THEN BEGIN
                                                                    rPer."Fecha entrada" := "Fecha entrada";
                                                                    rPer.MODIFY;
                                                                  END;
                                                                  rPer.RESET;
                                                                END;
                                                                // Reserva Hotel
                                                                //
                                                                rRsvHot.RESET;
                                                                rRsvHot.SETCURRENTKEY(Delegacion,
                                                                                      "N§ Interno",
                                                                                      "N§ Periodo",
                                                                                      "N§ Acompa¤ante");
                                                                rRsvHot.SETRANGE(Delegacion      , Delegacion);
                                                                rRsvHot.SETRANGE("N§ Interno"    , "N§ Interno");
                                                                IF Periodo <> 0 THEN
                                                                  rRsvHot.SETRANGE("N§ Periodo"  , Periodo);
                                                                rRsvHot.SETRANGE("N§ Acompa¤ante", "N§ Acompa¤ante");
                                                                IF rRsvHot.FIND('-') THEN
                                                                  REPEAT
                                                                    rRsvHot."Modificacion importacion" := TRUE;
                                                                    rRsvHot.VALIDATE("Fecha entrada", "Fecha entrada");
                                                                    rRsvHot."Modificacion importacion" := FALSE;
                                                                    rRsvHot.MODIFY(TRUE)
                                                                  UNTIL rRsvHot.NEXT = 0;
                                                                rRsvHot.RESET;
                                                                // Reserva Transfer
                                                                //
                                                                rRsvTra.RESET;
                                                                rRsvTra.SETCURRENTKEY(Delegacion,
                                                                                      "N§ Interno",
                                                                                      "N§ Periodo",
                                                                                      "N§ Acompa¤ante");
                                                                rRsvTra.SETRANGE(Delegacion      , Delegacion);
                                                                rRsvTra.SETRANGE("N§ Interno"    , "N§ Interno");
                                                                IF Periodo <> 0 THEN
                                                                  rRsvTra.SETRANGE("N§ Periodo"  , Periodo);
                                                                rRsvTra.SETRANGE("N§ Acompa¤ante", "N§ Acompa¤ante");
                                                                IF rRsvTra.FIND('-') THEN
                                                                  REPEAT
                                                                    rRsvTra.VALIDATE("Fecha entrada", "Fecha entrada");
                                                                    rRsvTra.MODIFY;
                                                                  UNTIL rRsvTra.NEXT = 0;
                                                                rRsvTra.RESET;

                                                                // Modificar en reserva Circuito
                                                                //
                                                                rPar.FIND('-');
                                                                IF (NOT GesCuaCircuito) AND (rPar."Activar m¢dulo circuitos") THEN BEGIN
                                                                  rRsvCir.RESET;
                                                                  rRsvCir.Establecer_Gestion_Cabecera(TRUE);
                                                                  rRsvCir.SETCURRENTKEY(Delegacion, "N§ Interno");
                                                                  rRsvCir.SETRANGE("N§ Interno"    , "N§ Interno");
                                                                  rRsvCir.SETRANGE(Delegacion      , Delegacion);
                                                                  rRsvCir.SETRANGE("N§ Acompa¤ante", "N§ Acompa¤ante");
                                                                  IF rRsvCir.FIND('-') THEN
                                                                    REPEAT
                                                                      rRsvCir.VALIDATE("Fecha Entrada", "Fecha entrada");
                                                                      rRsvCir.MODIFY;
                                                                    UNTIL rRsvCir.NEXT = 0;
                                                                  rRsvCir.RESET;
                                                                  rRsvCir.Establecer_Gestion_Cabecera(FALSE);
                                                                END;

                                                                // Historico
                                                                //
                                                                IF xRec."Fecha entrada" <> 0D THEN
                                                                  cPar.intro_historic(Delegacion, "N§ Interno", 0, "N§ Acompa¤ante", 8, FIELDCAPTION("Fecha entrada"),
                                                                                        STRSUBSTNO('%1', xRec."Fecha entrada"), STRSUBSTNO('%1', "Fecha entrada"));
                                                              END;

                                                   CaptionML=[ENU=Check-in Date;
                                                              ESP=Fecha entrada];
                                                   Editable=No }
    { 25  ;   ;Terminal entrada    ;Code1         ;OnValidate=BEGIN
                                                                // Periodo reserva
                                                                //
                                                                IF "N§ Acompa¤ante" = _GetPrimeraPersona THEN BEGIN
                                                                  rPer.RESET;
                                                                  rPer.SETRANGE(Delegacion  , Delegacion);
                                                                  rPer.SETRANGE("N§ Interno", "N§ Interno");
                                                                  IF Periodo <> 0 THEN
                                                                    rPer.SETRANGE("N§ Periodo", Periodo);
                                                                  IF rPer.FIND('-') THEN BEGIN
                                                                    rPer."Terminal entrada" := "Terminal entrada";
                                                                    rPer.MODIFY;
                                                                  END;
                                                                  rPer.RESET;
                                                                END;
                                                                // Reserva Hotel
                                                                //
                                                                rRsvHot.RESET;
                                                                rRsvHot.SETCURRENTKEY(Delegacion,
                                                                                      "N§ Interno",
                                                                                      "N§ Periodo",
                                                                                      "N§ Acompa¤ante");
                                                                rRsvHot.SETRANGE(Delegacion      , Delegacion);
                                                                rRsvHot.SETRANGE("N§ Interno"    , "N§ Interno");
                                                                IF Periodo <> 0 THEN
                                                                  rRsvHot.SETRANGE("N§ Periodo"  , Periodo);
                                                                rRsvHot.SETRANGE("N§ Acompa¤ante", "N§ Acompa¤ante");
                                                                IF rRsvHot.FIND('-') THEN BEGIN
                                                                  REPEAT
                                                                    rRsvHot.VALIDATE("Terminal entrada", "Terminal entrada");
                                                                    rRsvHot.MODIFY;
                                                                  UNTIL rRsvHot.NEXT = 0;
                                                                END;
                                                                rRsvHot.RESET;
                                                                // Reserva Transfer
                                                                //
                                                                rRsvTra.RESET;
                                                                rRsvTra.SETCURRENTKEY(Delegacion,
                                                                                      "N§ Interno",
                                                                                      "N§ Periodo",
                                                                                      "N§ Acompa¤ante");
                                                                rRsvTra.SETRANGE(Delegacion      , Delegacion);
                                                                rRsvTra.SETRANGE("N§ Interno"    , "N§ Interno");
                                                                IF Periodo <> 0 THEN
                                                                  rRsvTra.SETRANGE("N§ Periodo"  , Periodo);
                                                                rRsvTra.SETRANGE("N§ Acompa¤ante", "N§ Acompa¤ante");
                                                                IF rRsvTra.FIND('-') THEN BEGIN
                                                                  REPEAT
                                                                    rRsvTra.VALIDATE("Terminal entrada", "Terminal entrada");
                                                                    rRsvTra.MODIFY;
                                                                  UNTIL rRsvTra.NEXT = 0;
                                                                END;
                                                                rRsvTra.RESET;
                                                                // Historico
                                                                //
                                                                IF xRec."Terminal entrada" <> '' THEN
                                                                  cPar.intro_historic(Delegacion, "N§ Interno", 0, "N§ Acompa¤ante", 8, FIELDCAPTION("Terminal entrada"),
                                                                                      xRec."Terminal entrada", "Terminal entrada");
                                                              END;

                                                   CaptionML=[ENU=Arrival terminal;
                                                              ESP=Terminal entrada];
                                                   Editable=No }
    { 27  ;   ;Hora entrada        ;Time          ;OnValidate=BEGIN
                                                                // Periodo reserva
                                                                //
                                                                IF "N§ Acompa¤ante" = _GetPrimeraPersona THEN BEGIN
                                                                  rPer.RESET;
                                                                  rPer.SETRANGE(Delegacion  , Delegacion);
                                                                  rPer.SETRANGE("N§ Interno", "N§ Interno");
                                                                  IF Periodo <> 0 THEN
                                                                    rPer.SETRANGE("N§ Periodo", Periodo);
                                                                  IF rPer.FIND('-') THEN BEGIN
                                                                    rPer."Hora entrada" := "Hora entrada";
                                                                    rPer.MODIFY;
                                                                  END;
                                                                  rPer.RESET;
                                                                END;
                                                                // Reserva Hotel
                                                                //
                                                                rRsvHot.RESET;
                                                                rRsvHot.SETCURRENTKEY(Delegacion,
                                                                                      "N§ Interno",
                                                                                      "N§ Periodo",
                                                                                      "N§ Acompa¤ante");
                                                                rRsvHot.SETRANGE(Delegacion      , Delegacion);
                                                                rRsvHot.SETRANGE("N§ Interno"    , "N§ Interno");
                                                                IF Periodo <> 0 THEN
                                                                  rRsvHot.SETRANGE("N§ Periodo"  , Periodo);
                                                                rRsvHot.SETRANGE("N§ Acompa¤ante", "N§ Acompa¤ante");
                                                                IF rRsvHot.FIND('-') THEN BEGIN
                                                                  REPEAT
                                                                    rRsvHot.VALIDATE("Hora entrada", "Hora entrada");
                                                                    rRsvHot.MODIFY(TRUE);
                                                                  UNTIL rRsvHot.NEXT = 0;
                                                                END;
                                                                rRsvHot.RESET;
                                                                // Reserva Transfer
                                                                //
                                                                rRsvTra.RESET;
                                                                rRsvTra.SETCURRENTKEY(Delegacion,
                                                                                      "N§ Interno",
                                                                                      "N§ Periodo",
                                                                                      "N§ Acompa¤ante");
                                                                rRsvTra.SETRANGE(Delegacion      , Delegacion);
                                                                rRsvTra.SETRANGE("N§ Interno"    , "N§ Interno");
                                                                IF Periodo <> 0 THEN
                                                                  rRsvTra.SETRANGE("N§ Periodo"  , Periodo);
                                                                rRsvTra.SETRANGE("N§ Acompa¤ante", "N§ Acompa¤ante");
                                                                IF rRsvTra.FIND('-') THEN  BEGIN
                                                                  REPEAT
                                                                    rRsvTra.VALIDATE("Hora entrada", "Hora entrada");
                                                                    rRsvTra.MODIFY;
                                                                  UNTIL rRsvTra.NEXT = 0;
                                                                END;
                                                                rRsvTra.RESET;
                                                                // Historico
                                                                //
                                                                cPar.intro_historic(Delegacion, "N§ Interno", 0, "N§ Acompa¤ante", 8, FIELDCAPTION("Hora entrada"),
                                                                                    STRSUBSTNO('%1', xRec."Hora entrada"), STRSUBSTNO('%1', "Hora entrada"));
                                                              END;

                                                   CaptionML=[ENU=Arrival time;
                                                              ESP=Hora entrada];
                                                   Editable=No }
    { 29  ;   ;IATA origen entrada ;Code10        ;TableRelation=Aeropuerto.Aeropuerto;
                                                   OnValidate=BEGIN
                                                                // Periodo reserva
                                                                //
                                                                IF "N§ Acompa¤ante" = _GetPrimeraPersona THEN BEGIN
                                                                  rPer.RESET;
                                                                  rPer.SETRANGE(Delegacion  , Delegacion);
                                                                  rPer.SETRANGE("N§ Interno", "N§ Interno");
                                                                  IF Periodo <> 0 THEN
                                                                    rPer.SETRANGE("N§ Periodo", Periodo);
                                                                  IF rPer.FIND('-') THEN BEGIN
                                                                    rPer."IATA origen entrada" := "IATA origen entrada";
                                                                    rPer.MODIFY;
                                                                  END;
                                                                  rPer.RESET;
                                                                END;
                                                                // Reserva Hotel
                                                                //
                                                                rRsvHot.RESET;
                                                                rRsvHot.SETCURRENTKEY(Delegacion,
                                                                                      "N§ Interno",
                                                                                      "N§ Periodo",
                                                                                      "N§ Acompa¤ante");
                                                                rRsvHot.SETRANGE(Delegacion      , Delegacion);
                                                                rRsvHot.SETRANGE("N§ Interno"    , "N§ Interno");
                                                                IF Periodo <> 0 THEN
                                                                  rRsvHot.SETRANGE("N§ Periodo"  , Periodo);
                                                                rRsvHot.SETRANGE("N§ Acompa¤ante", "N§ Acompa¤ante");
                                                                IF rRsvHot.FIND('-') THEN BEGIN
                                                                  REPEAT
                                                                    rRsvHot.VALIDATE("IATA origen entrada", "IATA origen entrada");
                                                                    rRsvHot.MODIFY(TRUE);
                                                                  UNTIL rRsvHot.NEXT = 0;
                                                                END;
                                                                rRsvHot.RESET;
                                                                // Reserva Transfer
                                                                //
                                                                rRsvTra.RESET;
                                                                rRsvTra.SETCURRENTKEY(Delegacion,
                                                                                      "N§ Interno",
                                                                                      "N§ Periodo",
                                                                                      "N§ Acompa¤ante");
                                                                rRsvTra.SETRANGE(Delegacion      , Delegacion);
                                                                rRsvTra.SETRANGE("N§ Interno"    , "N§ Interno");
                                                                IF Periodo <> 0 THEN
                                                                  rRsvTra.SETRANGE("N§ Periodo"  , Periodo);
                                                                rRsvTra.SETRANGE("N§ Acompa¤ante", "N§ Acompa¤ante");
                                                                IF rRsvTra.FIND('-') THEN BEGIN
                                                                  REPEAT
                                                                    rRsvTra.VALIDATE("IATA origen entrada", "IATA origen entrada");
                                                                    rRsvTra.MODIFY;
                                                                  UNTIL rRsvTra.NEXT = 0;
                                                                END;
                                                                rRsvTra.RESET;
                                                                // Historico
                                                                //
                                                                IF xRec."IATA origen entrada" <> '' THEN
                                                                  cPar.intro_historic(Delegacion, "N§ Interno", 0, "N§ Acompa¤ante", 8, FIELDCAPTION("IATA origen entrada"),
                                                                                      xRec."IATA origen entrada", "IATA origen entrada");
                                                              END;

                                                   CaptionML=[ENU=Arrival origin IATA;
                                                              ESP=IATA origen entrada];
                                                   Description=FK Aeropuerto;
                                                   Editable=No }
    { 31  ;   ;IATA destino entrada;Code10        ;TableRelation=Aeropuerto.Aeropuerto;
                                                   OnValidate=BEGIN
                                                                // Periodo reserva
                                                                //
                                                                IF "N§ Acompa¤ante" = _GetPrimeraPersona THEN BEGIN
                                                                  rPer.RESET;
                                                                  rPer.SETRANGE(Delegacion  , Delegacion);
                                                                  rPer.SETRANGE("N§ Interno", "N§ Interno");
                                                                  IF Periodo <> 0 THEN
                                                                    rPer.SETRANGE("N§ Periodo", Periodo);
                                                                  IF rPer.FIND('-') THEN BEGIN
                                                                    rPer."IATA destino entrada" := "IATA destino entrada";
                                                                    rPer.MODIFY;
                                                                  END;
                                                                  rPer.RESET;
                                                                END;
                                                                // Reserva Hotel
                                                                //
                                                                rRsvHot.RESET;
                                                                rRsvHot.SETCURRENTKEY(Delegacion,
                                                                                      "N§ Interno",
                                                                                      "N§ Periodo",
                                                                                      "N§ Acompa¤ante");
                                                                rRsvHot.SETRANGE(Delegacion      , Delegacion);
                                                                rRsvHot.SETRANGE("N§ Interno"    , "N§ Interno");
                                                                IF Periodo <> 0 THEN
                                                                  rRsvHot.SETRANGE("N§ Periodo"  , Periodo);
                                                                rRsvHot.SETRANGE("N§ Acompa¤ante", "N§ Acompa¤ante");
                                                                IF rRsvHot.FIND('-') THEN BEGIN
                                                                  REPEAT
                                                                    rRsvHot.VALIDATE("IATA destino entrada", "IATA destino entrada");
                                                                    rRsvHot.MODIFY(TRUE);
                                                                  UNTIL rRsvHot.NEXT = 0;
                                                                END;
                                                                rRsvHot.RESET;
                                                                // Reserva Transfer
                                                                //
                                                                rRsvTra.RESET;
                                                                rRsvTra.SETCURRENTKEY(Delegacion,
                                                                                      "N§ Interno",
                                                                                      "N§ Periodo",
                                                                                      "N§ Acompa¤ante");
                                                                rRsvTra.SETRANGE(Delegacion      , Delegacion);
                                                                rRsvTra.SETRANGE("N§ Interno"    , "N§ Interno");
                                                                IF Periodo <> 0 THEN
                                                                  rRsvTra.SETRANGE("N§ Periodo"  , Periodo);
                                                                rRsvTra.SETRANGE("N§ Acompa¤ante", "N§ Acompa¤ante");
                                                                IF rRsvTra.FIND('-') THEN BEGIN
                                                                  REPEAT
                                                                    rRsvTra.VALIDATE("IATA destino entrada", "IATA destino entrada");
                                                                    rRsvTra.MODIFY;
                                                                  UNTIL rRsvTra.NEXT = 0;
                                                                END;
                                                                rRsvTra.RESET;
                                                                // Historico
                                                                //
                                                                IF xRec."IATA destino entrada" <> '' THEN
                                                                  cPar.intro_historic(Delegacion, "N§ Interno", 0, "N§ Acompa¤ante", 8, FIELDCAPTION("IATA destino entrada"),
                                                                                      xRec."IATA destino entrada", "IATA destino entrada");
                                                              END;

                                                   CaptionML=[ENU=Arrival destination IATA;
                                                              ESP=IATA destino entrada];
                                                   Description=FK Aeropuerto;
                                                   Editable=No }
    { 33  ;   ;Compa¤ia salida     ;Code10        ;TableRelation="Compa¤ia aerea".Codigo;
                                                   OnValidate=BEGIN
                                                                // Periodo reserva
                                                                //
                                                                IF "N§ Acompa¤ante" = _GetPrimeraPersona THEN BEGIN
                                                                  rPer.RESET;
                                                                  rPer.SETRANGE(Delegacion  , Delegacion);
                                                                  rPer.SETRANGE("N§ Interno", "N§ Interno");
                                                                  IF Periodo <> 0 THEN
                                                                    rPer.SETRANGE("N§ Periodo", Periodo);
                                                                  IF rPer.FIND('-') THEN BEGIN
                                                                    rPer."Compa¤ia salida" := "Compa¤ia salida";
                                                                    rPer.MODIFY;
                                                                  END;
                                                                  rPer.RESET;
                                                                END;
                                                                // Reserva Hotel
                                                                //
                                                                rRsvHot.RESET;
                                                                rRsvHot.SETCURRENTKEY(Delegacion,
                                                                                      "N§ Interno",
                                                                                      "N§ Periodo",
                                                                                      "N§ Acompa¤ante");
                                                                rRsvHot.SETRANGE(Delegacion      , Delegacion);
                                                                rRsvHot.SETRANGE("N§ Interno"    , "N§ Interno");
                                                                IF Periodo <> 0 THEN
                                                                  rRsvHot.SETRANGE("N§ Periodo"  , Periodo);
                                                                rRsvHot.SETRANGE("N§ Acompa¤ante", "N§ Acompa¤ante");
                                                                IF rRsvHot.FIND('-') THEN BEGIN
                                                                  REPEAT
                                                                    rRsvHot.VALIDATE("Compa¤ia salida", "Compa¤ia salida");
                                                                    rRsvHot.MODIFY(TRUE);
                                                                  UNTIL rRsvHot.NEXT = 0;
                                                                END;
                                                                rRsvHot.RESET;
                                                                // Reserva Transfer
                                                                //
                                                                rRsvTra.RESET;
                                                                rRsvTra.SETCURRENTKEY(Delegacion,
                                                                                      "N§ Interno",
                                                                                      "N§ Periodo",
                                                                                      "N§ Acompa¤ante");
                                                                rRsvTra.SETRANGE(Delegacion      , Delegacion);
                                                                rRsvTra.SETRANGE("N§ Interno"    , "N§ Interno");
                                                                IF Periodo <> 0 THEN
                                                                  rRsvTra.SETRANGE("N§ Periodo"  , Periodo);
                                                                rRsvTra.SETRANGE("N§ Acompa¤ante", "N§ Acompa¤ante");
                                                                IF rRsvTra.FIND('-') THEN BEGIN
                                                                  REPEAT
                                                                    rRsvTra.VALIDATE("Compa¤ia salida", "Compa¤ia salida");
                                                                    rRsvTra.MODIFY;
                                                                  UNTIL rRsvTra.NEXT = 0;
                                                                END;
                                                                rRsvTra.RESET;
                                                                // Historico
                                                                //
                                                                IF xRec."Compa¤ia salida" <> '' THEN
                                                                  cPar.intro_historic(Delegacion, "N§ Interno", 0, "N§ Acompa¤ante", 8, FIELDCAPTION("Compa¤ia salida"),
                                                                                      xRec."Compa¤ia salida", "Compa¤ia salida");
                                                              END;

                                                   CaptionML=[ENU=Departure company;
                                                              ESP=Compa¤ia salida];
                                                   Description=FK Compa¤ia aerea;
                                                   Editable=No }
    { 35  ;   ;Vuelo salida        ;Code10        ;OnValidate=BEGIN
                                                                // Periodo reserva
                                                                //
                                                                IF "N§ Acompa¤ante" = _GetPrimeraPersona THEN BEGIN
                                                                  rPer.RESET;
                                                                  rPer.SETRANGE(Delegacion  , Delegacion);
                                                                  rPer.SETRANGE("N§ Interno", "N§ Interno");
                                                                  IF Periodo <> 0 THEN
                                                                    rPer.SETRANGE("N§ Periodo", Periodo);
                                                                  IF rPer.FIND('-') THEN BEGIN
                                                                    rPer."Vuelo salida" := "Vuelo salida";
                                                                    rPer.MODIFY;
                                                                  END;
                                                                  rPer.RESET;
                                                                END;
                                                                // Reserva Hotel
                                                                //
                                                                rRsvHot.RESET;
                                                                rRsvHot.SETCURRENTKEY(Delegacion,
                                                                                      "N§ Interno",
                                                                                      "N§ Periodo",
                                                                                      "N§ Acompa¤ante");
                                                                rRsvHot.SETRANGE(Delegacion      , Delegacion);
                                                                rRsvHot.SETRANGE("N§ Interno"    , "N§ Interno");
                                                                IF Periodo <> 0 THEN
                                                                  rRsvHot.SETRANGE("N§ Periodo"  , Periodo);
                                                                rRsvHot.SETRANGE("N§ Acompa¤ante", "N§ Acompa¤ante");
                                                                IF rRsvHot.FIND('-') THEN BEGIN
                                                                  REPEAT
                                                                    rRsvHot.VALIDATE("Vuelo salida", "Vuelo salida");
                                                                    rRsvHot.MODIFY(TRUE);
                                                                  UNTIL rRsvHot.NEXT = 0;
                                                                END;
                                                                rRsvHot.RESET;
                                                                // Reserva Transfer
                                                                //
                                                                rRsvTra.RESET;
                                                                rRsvTra.SETCURRENTKEY(Delegacion,
                                                                                      "N§ Interno",
                                                                                      "N§ Periodo",
                                                                                      "N§ Acompa¤ante");
                                                                rRsvTra.SETRANGE(Delegacion      , Delegacion);
                                                                rRsvTra.SETRANGE("N§ Interno"    , "N§ Interno");
                                                                IF Periodo <> 0 THEN
                                                                  rRsvTra.SETRANGE("N§ Periodo"  , Periodo);
                                                                rRsvTra.SETRANGE("N§ Acompa¤ante", "N§ Acompa¤ante");
                                                                IF rRsvTra.FIND('-') THEN BEGIN
                                                                  REPEAT
                                                                    rRsvTra.VALIDATE("Vuelo salida", "Vuelo salida");
                                                                    rRsvTra.MODIFY;
                                                                  UNTIL rRsvTra.NEXT = 0;
                                                                END;
                                                                rRsvTra.RESET;
                                                                // Historico
                                                                //
                                                                IF xRec."Vuelo salida" <> '' THEN
                                                                  cPar.intro_historic(Delegacion, "N§ Interno", 0, "N§ Acompa¤ante", 8, FIELDCAPTION("Vuelo salida"),
                                                                                      xRec."Vuelo salida", "Vuelo salida");
                                                              END;

                                                   CaptionML=[ENU=Departure flight;
                                                              ESP=Vuelo salida];
                                                   Editable=No }
    { 37  ;   ;Fecha salida        ;Date          ;OnValidate=BEGIN
                                                                // Periodo reserva
                                                                //
                                                                IF "N§ Acompa¤ante" = _GetPrimeraPersona THEN BEGIN
                                                                  rPer.RESET;
                                                                  rPer.SETRANGE(Delegacion  , Delegacion);
                                                                  rPer.SETRANGE("N§ Interno", "N§ Interno");
                                                                  IF Periodo <> 0 THEN
                                                                    rPer.SETRANGE("N§ Periodo", Periodo);
                                                                  IF rPer.FIND('+') THEN BEGIN
                                                                    rPer."Fecha salida" := "Fecha salida";
                                                                    rPer.MODIFY;
                                                                  END;
                                                                  rPer.RESET;
                                                                END;
                                                                // Reserva Hotel
                                                                //
                                                                rRsvHot.RESET;
                                                                rRsvHot.SETCURRENTKEY(Delegacion,
                                                                                      "N§ Interno",
                                                                                      "N§ Periodo",
                                                                                      "N§ Acompa¤ante");
                                                                rRsvHot.SETRANGE(Delegacion      , Delegacion);
                                                                rRsvHot.SETRANGE("N§ Interno"    , "N§ Interno");
                                                                IF Periodo <> 0 THEN
                                                                  rRsvHot.SETRANGE("N§ Periodo"  , Periodo);
                                                                rRsvHot.SETRANGE("N§ Acompa¤ante", "N§ Acompa¤ante");
                                                                IF rRsvHot.FIND('-') THEN
                                                                  REPEAT
                                                                    rRsvHot."Modificacion importacion" := TRUE;
                                                                    rRsvHot.VALIDATE("Fecha salida", "Fecha salida");
                                                                    rRsvHot."Modificacion importacion" := FALSE;
                                                                    rRsvHot.MODIFY(TRUE)
                                                                  UNTIL rRsvHot.NEXT = 0;
                                                                rRsvHot.RESET;
                                                                // Reserva Transfer
                                                                //
                                                                rRsvTra.RESET;
                                                                rRsvTra.SETCURRENTKEY(Delegacion,
                                                                                      "N§ Interno",
                                                                                      "N§ Periodo",
                                                                                      "N§ Acompa¤ante");
                                                                rRsvTra.SETRANGE(Delegacion      , Delegacion);
                                                                rRsvTra.SETRANGE("N§ Interno"    , "N§ Interno");
                                                                IF Periodo <> 0 THEN
                                                                  rRsvTra.SETRANGE("N§ Periodo"  , Periodo);
                                                                rRsvTra.SETRANGE("N§ Acompa¤ante", "N§ Acompa¤ante");
                                                                IF rRsvTra.FIND('-') THEN
                                                                  REPEAT
                                                                    rRsvTra.VALIDATE("Fecha salida", "Fecha salida");
                                                                    rRsvTra.MODIFY;
                                                                  UNTIL rRsvTra.NEXT = 0;
                                                                rRsvTra.RESET;

                                                                // Modificar en reserva Circuito
                                                                //
                                                                rPar.FIND('-');
                                                                IF (NOT GesCuaCircuito) AND (rPar."Activar m¢dulo circuitos") THEN BEGIN
                                                                  rRsvCir.RESET;
                                                                  rRsvCir.Establecer_Gestion_Cabecera(TRUE);
                                                                  rRsvCir.SETCURRENTKEY(Delegacion, "N§ Interno");
                                                                  rRsvCir.SETRANGE("N§ Interno"    , "N§ Interno");
                                                                  rRsvCir.SETRANGE(Delegacion      , Delegacion);
                                                                  rRsvCir.SETRANGE("N§ Acompa¤ante", "N§ Acompa¤ante");
                                                                  IF rRsvCir.FIND('-') THEN
                                                                    REPEAT
                                                                      rRsvCir.VALIDATE("Fecha Salida", "Fecha salida");
                                                                      rRsvCir.MODIFY;
                                                                    UNTIL rRsvCir.NEXT = 0;
                                                                  rRsvCir.RESET;
                                                                  rRsvCir.Establecer_Gestion_Cabecera(FALSE);
                                                                END;

                                                                // Historico
                                                                //
                                                                cPar.intro_historic(Delegacion, "N§ Interno", 0, "N§ Acompa¤ante", 8, FIELDCAPTION("Fecha salida"),
                                                                                    STRSUBSTNO('%1', xRec."Fecha salida"), STRSUBSTNO('%1', "Fecha salida"));
                                                              END;

                                                   CaptionML=[ENU=Check-out Date;
                                                              ESP=Fecha salida];
                                                   Editable=No }
    { 39  ;   ;Terminal salida     ;Code1         ;OnValidate=BEGIN
                                                                // Periodo reserva
                                                                //
                                                                IF "N§ Acompa¤ante" = _GetPrimeraPersona THEN BEGIN
                                                                  rPer.RESET;
                                                                  rPer.SETRANGE(Delegacion  , Delegacion);
                                                                  rPer.SETRANGE("N§ Interno", "N§ Interno");
                                                                  IF Periodo <> 0 THEN
                                                                    rPer.SETRANGE("N§ Periodo", Periodo);
                                                                  IF rPer.FIND('-') THEN BEGIN
                                                                    rPer."Terminal salida" := "Terminal salida";
                                                                    rPer.MODIFY;
                                                                  END;
                                                                  rPer.RESET;
                                                                END;
                                                                // Reserva Hotel
                                                                //
                                                                rRsvHot.RESET;
                                                                rRsvHot.SETCURRENTKEY(Delegacion,
                                                                                      "N§ Interno",
                                                                                      "N§ Periodo",
                                                                                      "N§ Acompa¤ante");
                                                                rRsvHot.SETRANGE(Delegacion      , Delegacion);
                                                                rRsvHot.SETRANGE("N§ Interno"    , "N§ Interno");
                                                                IF Periodo <> 0 THEN
                                                                  rRsvHot.SETRANGE("N§ Periodo"  , Periodo);
                                                                rRsvHot.SETRANGE("N§ Acompa¤ante", "N§ Acompa¤ante");
                                                                IF rRsvHot.FIND('-') THEN BEGIN
                                                                  REPEAT
                                                                    rRsvHot.VALIDATE("Terminal salida", "Terminal salida");
                                                                    rRsvHot.MODIFY;
                                                                  UNTIL rRsvHot.NEXT = 0;
                                                                END;
                                                                rRsvHot.RESET;
                                                                // Reserva Transfer
                                                                //
                                                                rRsvTra.RESET;
                                                                rRsvTra.SETCURRENTKEY(Delegacion,
                                                                                      "N§ Interno",
                                                                                      "N§ Periodo",
                                                                                      "N§ Acompa¤ante");
                                                                rRsvTra.SETRANGE(Delegacion      , Delegacion);
                                                                rRsvTra.SETRANGE("N§ Interno"    , "N§ Interno");
                                                                IF Periodo <> 0 THEN
                                                                  rRsvTra.SETRANGE("N§ Periodo"  , Periodo);
                                                                rRsvTra.SETRANGE("N§ Acompa¤ante", "N§ Acompa¤ante");
                                                                IF rRsvTra.FIND('-') THEN BEGIN
                                                                  REPEAT
                                                                    rRsvTra.VALIDATE("Terminal salida", "Terminal salida");
                                                                    rRsvTra.MODIFY;
                                                                  UNTIL rRsvTra.NEXT = 0;
                                                                END;
                                                                rRsvTra.RESET;
                                                                // Historico
                                                                //
                                                                IF xRec."Terminal salida" <> '' THEN
                                                                  cPar.intro_historic(Delegacion, "N§ Interno", 0, "N§ Acompa¤ante", 8, FIELDCAPTION("Terminal salida"),
                                                                                      xRec."Terminal salida", "Terminal salida");
                                                              END;

                                                   CaptionML=[ENU=Departure terminal;
                                                              ESP=Terminal salida];
                                                   Editable=No }
    { 41  ;   ;Hora salida         ;Time          ;OnValidate=BEGIN
                                                                // Periodo reserva
                                                                //
                                                                IF "N§ Acompa¤ante" = _GetPrimeraPersona THEN BEGIN
                                                                  rPer.RESET;
                                                                  rPer.SETRANGE(Delegacion  , Delegacion);
                                                                  rPer.SETRANGE("N§ Interno", "N§ Interno");
                                                                  IF Periodo <> 0 THEN
                                                                    rPer.SETRANGE("N§ Periodo", Periodo);
                                                                  IF rPer.FIND('-') THEN BEGIN
                                                                    rPer."Hora salida" := "Hora salida";
                                                                    rPer.MODIFY;
                                                                  END;
                                                                  rPer.RESET;
                                                                END;
                                                                // Reserva Hotel
                                                                //
                                                                rRsvHot.RESET;
                                                                rRsvHot.SETCURRENTKEY(Delegacion,
                                                                                      "N§ Interno",
                                                                                      "N§ Periodo",
                                                                                      "N§ Acompa¤ante");
                                                                rRsvHot.SETRANGE(Delegacion      , Delegacion);
                                                                rRsvHot.SETRANGE("N§ Interno"    , "N§ Interno");
                                                                IF Periodo <> 0 THEN
                                                                  rRsvHot.SETRANGE("N§ Periodo"  , Periodo);
                                                                rRsvHot.SETRANGE("N§ Acompa¤ante", "N§ Acompa¤ante");
                                                                IF rRsvHot.FIND('-') THEN BEGIN
                                                                  REPEAT
                                                                    rRsvHot.VALIDATE("Hora salida", "Hora salida");
                                                                    rRsvHot.MODIFY(TRUE);
                                                                  UNTIL rRsvHot.NEXT = 0;
                                                                END;
                                                                rRsvHot.RESET;
                                                                // Reserva Transfer
                                                                //
                                                                rRsvTra.RESET;
                                                                rRsvTra.SETCURRENTKEY(Delegacion,
                                                                                      "N§ Interno",
                                                                                      "N§ Periodo",
                                                                                      "N§ Acompa¤ante");
                                                                rRsvTra.SETRANGE(Delegacion      , Delegacion);
                                                                rRsvTra.SETRANGE("N§ Interno"    , "N§ Interno");
                                                                IF Periodo <> 0 THEN
                                                                  rRsvTra.SETRANGE("N§ Periodo"  , Periodo);
                                                                rRsvTra.SETRANGE("N§ Acompa¤ante", "N§ Acompa¤ante");
                                                                IF rRsvTra.FIND('-') THEN BEGIN
                                                                  REPEAT
                                                                    rRsvTra.VALIDATE("Hora salida", "Hora salida");
                                                                    rRsvTra.MODIFY;
                                                                  UNTIL rRsvTra.NEXT = 0;
                                                                END;
                                                                rRsvTra.RESET;
                                                                // Historico
                                                                //
                                                                cPar.intro_historic(Delegacion, "N§ Interno", 0, "N§ Acompa¤ante", 8, FIELDCAPTION("Hora salida"),
                                                                                    STRSUBSTNO('%1', xRec."Hora salida"), STRSUBSTNO('%1', "Hora salida"));
                                                              END;

                                                   CaptionML=[ENU=Departure time;
                                                              ESP=Hora salida];
                                                   Editable=No }
    { 43  ;   ;IATA origen salida  ;Code10        ;TableRelation=Aeropuerto.Aeropuerto;
                                                   OnValidate=BEGIN
                                                                // Periodo reserva
                                                                //
                                                                IF "N§ Acompa¤ante" = _GetPrimeraPersona THEN BEGIN
                                                                  rPer.RESET;
                                                                  rPer.SETRANGE(Delegacion  , Delegacion);
                                                                  rPer.SETRANGE("N§ Interno", "N§ Interno");
                                                                  IF Periodo <> 0 THEN
                                                                    rPer.SETRANGE("N§ Periodo", Periodo);
                                                                  IF rPer.FIND('-') THEN BEGIN
                                                                    rPer."IATA origen salida" := "IATA origen salida";
                                                                    rPer.MODIFY;
                                                                  END;
                                                                  rPer.RESET;
                                                                END;
                                                                // Reserva Hotel
                                                                //
                                                                rRsvHot.RESET;
                                                                rRsvHot.SETCURRENTKEY(Delegacion,
                                                                                      "N§ Interno",
                                                                                      "N§ Periodo",
                                                                                      "N§ Acompa¤ante");
                                                                rRsvHot.SETRANGE(Delegacion      , Delegacion);
                                                                rRsvHot.SETRANGE("N§ Interno"    , "N§ Interno");
                                                                IF Periodo <> 0 THEN
                                                                  rRsvHot.SETRANGE("N§ Periodo"  , Periodo);
                                                                rRsvHot.SETRANGE("N§ Acompa¤ante", "N§ Acompa¤ante");
                                                                IF rRsvHot.FIND('-') THEN BEGIN
                                                                  REPEAT
                                                                    rRsvHot.VALIDATE("IATA origen salida", "IATA origen salida");
                                                                    rRsvHot.MODIFY(TRUE);
                                                                  UNTIL rRsvHot.NEXT = 0;
                                                                END;
                                                                rRsvHot.RESET;
                                                                // Reserva Transfer
                                                                //
                                                                rRsvTra.RESET;
                                                                rRsvTra.SETCURRENTKEY(Delegacion,
                                                                                      "N§ Interno",
                                                                                      "N§ Periodo",
                                                                                      "N§ Acompa¤ante");
                                                                rRsvTra.SETRANGE(Delegacion      , Delegacion);
                                                                rRsvTra.SETRANGE("N§ Interno"    , "N§ Interno");
                                                                IF Periodo <> 0 THEN
                                                                  rRsvTra.SETRANGE("N§ Periodo"  , Periodo);
                                                                rRsvTra.SETRANGE("N§ Acompa¤ante", "N§ Acompa¤ante");
                                                                IF rRsvTra.FIND('-') THEN BEGIN
                                                                  REPEAT
                                                                    rRsvTra.VALIDATE("IATA origen salida", "IATA origen salida");
                                                                    rRsvTra.MODIFY;
                                                                  UNTIL rRsvTra.NEXT = 0;
                                                                END;
                                                                rRsvTra.RESET;
                                                                // Historico
                                                                //
                                                                IF xRec."IATA origen salida" <> '' THEN
                                                                  cPar.intro_historic(Delegacion, "N§ Interno", 0, "N§ Acompa¤ante", 8, FIELDCAPTION("IATA origen salida"),
                                                                                      xRec."IATA origen salida", "IATA origen salida");
                                                              END;

                                                   CaptionML=[ENU=Departure origin IATA;
                                                              ESP=IATA origen salida];
                                                   Description=FK Aeropuerto;
                                                   Editable=No }
    { 45  ;   ;IATA destino salida ;Code10        ;TableRelation=Aeropuerto.Aeropuerto;
                                                   OnValidate=BEGIN
                                                                // Periodo reserva
                                                                //
                                                                IF "N§ Acompa¤ante" = _GetPrimeraPersona THEN BEGIN
                                                                  rPer.RESET;
                                                                  rPer.SETRANGE(Delegacion  , Delegacion);
                                                                  rPer.SETRANGE("N§ Interno", "N§ Interno");
                                                                  IF Periodo <> 0 THEN
                                                                    rPer.SETRANGE("N§ Periodo", Periodo);
                                                                  IF rPer.FIND('-') THEN BEGIN
                                                                    rPer."IATA destino salida" := "IATA destino salida";
                                                                    rPer.MODIFY;
                                                                  END;
                                                                  rPer.RESET;
                                                                END;
                                                                // Reserva Hotel
                                                                //
                                                                rRsvHot.RESET;
                                                                rRsvHot.SETCURRENTKEY(Delegacion,
                                                                                      "N§ Interno",
                                                                                      "N§ Periodo",
                                                                                      "N§ Acompa¤ante");
                                                                rRsvHot.SETRANGE(Delegacion      , Delegacion);
                                                                rRsvHot.SETRANGE("N§ Interno"    , "N§ Interno");
                                                                IF Periodo <> 0 THEN
                                                                  rRsvHot.SETRANGE("N§ Periodo"  , Periodo);
                                                                rRsvHot.SETRANGE("N§ Acompa¤ante", "N§ Acompa¤ante");
                                                                IF rRsvHot.FIND('-') THEN BEGIN
                                                                  REPEAT
                                                                    rRsvHot.VALIDATE("IATA destino salida", "IATA destino salida");
                                                                    rRsvHot.MODIFY(TRUE);
                                                                  UNTIL rRsvHot.NEXT = 0;
                                                                END;
                                                                rRsvHot.RESET;
                                                                // Reserva Transfer
                                                                //
                                                                rRsvTra.RESET;
                                                                rRsvTra.SETCURRENTKEY(Delegacion,
                                                                                      "N§ Interno",
                                                                                      "N§ Periodo",
                                                                                      "N§ Acompa¤ante");
                                                                rRsvTra.SETRANGE(Delegacion      , Delegacion);
                                                                rRsvTra.SETRANGE("N§ Interno"    , "N§ Interno");
                                                                IF Periodo <> 0 THEN
                                                                  rRsvTra.SETRANGE("N§ Periodo"  , Periodo);
                                                                rRsvTra.SETRANGE("N§ Acompa¤ante", "N§ Acompa¤ante");
                                                                IF rRsvTra.FIND('-') THEN BEGIN
                                                                  REPEAT
                                                                    rRsvTra.VALIDATE("IATA destino salida", "IATA destino salida");
                                                                    rRsvTra.MODIFY;
                                                                  UNTIL rRsvTra.NEXT = 0;
                                                                END;
                                                                rRsvTra.RESET;
                                                                // Historico
                                                                //
                                                                IF xRec."IATA destino salida" <> '' THEN
                                                                  cPar.intro_historic(Delegacion, "N§ Interno", 0, "N§ Acompa¤ante", 8, FIELDCAPTION("IATA destino salida"),
                                                                                      xRec."IATA destino salida", "IATA destino salida");
                                                              END;

                                                   CaptionML=[ENU=Departure destination IATA;
                                                              ESP=IATA destino salida];
                                                   Description=FK Aeropuerto;
                                                   Editable=No }
    { 47  ;   ;Regimen             ;Code10        ;TableRelation=Regimen.Regimen;
                                                   OnValidate=BEGIN
                                                                IF xRec.Regimen <> Regimen THEN
                                                                BEGIN
                                                                  "Regimen TO" := '';

                                                                  // Bajar a reserva hotel
                                                                  rRsvHot.RESET;
                                                                  rRsvHot.SETCURRENTKEY(Delegacion,
                                                                                        "N§ Interno",
                                                                                        "N§ Periodo",
                                                                                        "N§ Acompa¤ante");
                                                                  rRsvHot.SETRANGE(Delegacion      , Delegacion);
                                                                  rRsvHot.SETRANGE("N§ Interno"    , "N§ Interno");
                                                                  rRsvHot.SETRANGE("N§ Acompa¤ante", "N§ Acompa¤ante");
                                                                  IF rRsvHot.FINDSET(TRUE) THEN
                                                                  BEGIN
                                                                    REPEAT
                                                                      rRsvHot.VALIDATE(Regimen, Regimen);
                                                                      rRsvHot.VALIDATE("Modificacion critica", TRUE);
                                                                      rRsvHot.MODIFY(TRUE);
                                                                    UNTIL rRsvHot.NEXT = 0;
                                                                  END;
                                                                  rRsvHot.RESET;

                                                                  //. Historico
                                                                  cPar.intro_historic(Delegacion, "N§ Interno", 0, "N§ Acompa¤ante", 8, FIELDCAPTION(Regimen),
                                                                                      xRec.Regimen, Regimen);
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Board;
                                                              ESP=Regimen];
                                                   Description=FK Regimen }
    { 49  ;   ;Regimen TO          ;Code10        ;OnValidate=BEGIN
                                                                IF xRec."Regimen TO" <> "Regimen TO" THEN
                                                                  //. Historico
                                                                  cPar.intro_historic(Delegacion, "N§ Interno", 0, "N§ Acompa¤ante", 8, FIELDCAPTION("Regimen TO"),
                                                                                      xRec."Regimen TO", "Regimen TO");
                                                              END;

                                                   OnLookup=BEGIN
                                                              rCab.RESET;
                                                              IF rCab.GET(Delegacion, "N§ Interno") THEN BEGIN
                                                                rRegTO.RESET;
                                                                rRegTO.SETRANGE(TourOperador, rCab.TourOperador);
                                                                IF FORM.RUNMODAL(7009725, rRegTO) = ACTION::LookupOK THEN BEGIN
                                                                  Regimen := rRegTO.Regimen;
                                                                  "Regimen TO" := rRegTO."Regimen TO";
                                                                END;
                                                              END;
                                                            END;

                                                   CaptionML=[ENU=TO Board;
                                                              ESP=Regimen TO];
                                                   Editable=No }
    { 51  ;   ;Fecha venta         ;Date          ;OnValidate=BEGIN
                                                                IF xRec."Fecha venta" <> "Fecha venta" THEN BEGIN
                                                                  // Bajar a Reserva hotel

                                                                  rRsvHot.RESET;
                                                                  rRsvHot.SETCURRENTKEY(Delegacion,
                                                                                        "N§ Interno",
                                                                                        "N§ Periodo",
                                                                                        "N§ Acompa¤ante");
                                                                  rRsvHot.SETRANGE(Delegacion      , Delegacion);
                                                                  rRsvHot.SETRANGE("N§ Interno"    , "N§ Interno");
                                                                  rRsvHot.SETRANGE("N§ Acompa¤ante", "N§ Acompa¤ante");
                                                                  IF rRsvHot.FIND('-') THEN BEGIN
                                                                    REPEAT
                                                                      rRsvHot."Fecha venta" := "Fecha venta";
                                                                      rRsvHot."Modificacion critica" := TRUE;
                                                                      rRsvHot.MODIFY(TRUE);
                                                                    UNTIL rRsvHot.NEXT = 0;
                                                                  END;
                                                                  rRsvHot.RESET;
                                                                END;
                                                                // Historico

                                                                cPar.intro_historic(Delegacion, "N§ Interno", 0, "N§ Acompa¤ante", 8, FIELDCAPTION("Fecha venta"),
                                                                                    STRSUBSTNO('%1', xRec."Fecha venta"), STRSUBSTNO('%1', "Fecha venta"));
                                                              END;

                                                   CaptionML=[ENU=Sale date;
                                                              ESP=Fecha venta];
                                                   Editable=No }
    { 53  ;   ;N§ Fichero          ;Integer       ;OnValidate=BEGIN
                                                                IF xRec."N§ Fichero" <> "N§ Fichero" THEN BEGIN
                                                                  // Bajar a Reserva hotel

                                                                  rRsvHot.RESET;
                                                                  rRsvHot.SETCURRENTKEY(Delegacion,
                                                                                        "N§ Interno",
                                                                                        "N§ Periodo",
                                                                                        "N§ Acompa¤ante");
                                                                  rRsvHot.SETRANGE(Delegacion      , Delegacion);
                                                                  rRsvHot.SETRANGE("N§ Interno"    , "N§ Interno");
                                                                  rRsvHot.SETRANGE("N§ Acompa¤ante", "N§ Acompa¤ante");
                                                                  IF rRsvHot.FIND('-') THEN BEGIN
                                                                    REPEAT
                                                                      rRsvHot."N§ Fichero" := "N§ Fichero";
                                                                      rRsvHot.MODIFY(TRUE);
                                                                    UNTIL rRsvHot.NEXT = 0;
                                                                  END;
                                                                  rRsvHot.RESET;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=File No.;
                                                              ESP=N§ Fichero];
                                                   Editable=No }
    { 55  ;   ;N§ Linea            ;Integer       ;OnValidate=BEGIN
                                                                IF xRec."N§ Linea" <> "N§ Linea" THEN BEGIN
                                                                  // Bajar a Reserva hotel

                                                                  rRsvHot.RESET;
                                                                  rRsvHot.SETCURRENTKEY(Delegacion,
                                                                                        "N§ Interno",
                                                                                        "N§ Periodo",
                                                                                        "N§ Acompa¤ante");
                                                                  rRsvHot.SETRANGE(Delegacion      , Delegacion);
                                                                  rRsvHot.SETRANGE("N§ Interno"    , "N§ Interno");
                                                                  rRsvHot.SETRANGE("N§ Acompa¤ante", "N§ Acompa¤ante");
                                                                  IF rRsvHot.FIND('-') THEN BEGIN
                                                                    REPEAT
                                                                      rRsvHot."N§ Linea" := "N§ Linea";
                                                                      rRsvHot.MODIFY(TRUE);
                                                                    UNTIL rRsvHot.NEXT = 0;
                                                                  END;
                                                                  rRsvHot.RESET;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Line No.;
                                                              ESP=N§ Linea];
                                                   Editable=No }
    { 57  ;   ;Modificacion importacion;Boolean   ;OnValidate=BEGIN
                                                                CLEAR(rRsvHot);
                                                                rRsvHot.SETCURRENTKEY(Delegacion,
                                                                                      "N§ Interno",
                                                                                      "N§ Periodo",
                                                                                      "N§ Acompa¤ante",
                                                                                      "Fecha entrada");
                                                                rRsvHot.SETRANGE(Delegacion      , Delegacion);
                                                                rRsvHot.SETRANGE("N§ Interno"    , "N§ Interno");
                                                                rRsvHot.SETRANGE("N§ Acompa¤ante", "N§ Acompa¤ante");
                                                                IF rRsvHot.FINDSET THEN
                                                                  rRsvHot.MODIFYALL("Modificacion importacion", "Modificacion importacion");
                                                                CLEAR(rRsvHot);
                                                                CLEAR(rRsvTra);
                                                                rRsvTra.SETCURRENTKEY(Delegacion,
                                                                                      "N§ Interno",
                                                                                      "N§ Periodo",
                                                                                      "N§ Acompa¤ante");
                                                                rRsvTra.SETRANGE(Delegacion      , Delegacion);
                                                                rRsvTra.SETRANGE("N§ Interno"    , "N§ Interno");
                                                                rRsvTra.SETRANGE("N§ Acompa¤ante", "N§ Acompa¤ante");
                                                                IF rRsvTra.FINDSET THEN
                                                                  rRsvTra.MODIFYALL("Modificacion importacion", "Modificacion importacion");
                                                                CLEAR(rRsvTra);
                                                              END;

                                                   CaptionML=[ENU=Importation modification;
                                                              ESP=Modificacion importacion];
                                                   Editable=No }
    { 58  ;   ;Replicado           ;Boolean       ;InitValue=No;
                                                   CaptionML=[ENU=Replicated;
                                                              ESP=Replicado];
                                                   Description=Campo usado por el replicador }
    { 60  ;   ;Temporada           ;Code10        ;CaptionML=[ENU=Season;
                                                              ESP=Temporada];
                                                   Editable=No }
    { 62  ;   ;Fecha Nacimiento    ;Date          ;CaptionML=[ENU=Date of Birth;
                                                              ESP=Fecha Nacimiento] }
    { 64  ;   ;N§ Periodo          ;Integer       ;CaptionML=[ENU=Period No.;
                                                              ESP=N§ Periodo] }
    { 66  ;   ;Contador            ;Integer       ;CaptionML=[ENU=Counter;
                                                              ESP=Contador] }
    { 68  ;   ;Bono                ;Code10        ;CaptionML=[ENU=Voucher;
                                                              ESP=Bono] }
    { 70  ;   ;Touroperador        ;Code10        ;CaptionML=[ENU=TourOperator;
                                                              ESP=TourOperador] }
    { 71  ;   ;Puede Borrar        ;Boolean       ;CaptionML=[ENU=Able to erase;
                                                              ESP=Puede Borrar] }
    { 73  ;   ;No show             ;Boolean       ;OnValidate=BEGIN
                                                                //. Historico

                                                                cPar.intro_historic(Delegacion, "N§ Interno", 0, "N§ Acompa¤ante", 8, FIELDCAPTION("No show"),
                                                                                    FORMAT(xRec."No show"), FORMAT("No show"));
                                                              END;

                                                   CaptionML=[ENU=No Show;
                                                              ESP=No Show];
                                                   Description=Marcar las personas que no se presentaron el dia reservado }
    { 100 ;   ;Id Pax TO           ;Integer       ;Description=$002 ID del pax importacion del TTOO }
  }
  KEYS
  {
    {    ;Delegacion,N§ Interno,N§ Acompa¤ante    ;Clustered=Yes }
    {    ;Delegacion,N§ Interno,Nombre,Tipo Persona;
                                                   KeyGroups=RENUMERING }
    {    ;Touroperador,Bono,Temporada,Contador    ;KeyGroups=RENUMERING }
  }
  FIELDGROUPS
  {
  }
  CODE
  {
    VAR
      Text001@1103355014 : TextConst 'ENU=To sign up companions is only available in the local offices.;ESP=Solo es posible dar de alta acompa¤antes en las delegaciones.';
      Text003@1103355016 : TextConst 'ENU=Insert;ESP=Insertar';
      Text004@1103355017 : TextConst 'ENU=Enter register;ESP=Insertar registro';
      Text005@1103355018 : TextConst 'ENU=To modify companions is only available in the local offices;ESP=Solo es posible modificar acompa¤antes en las delegaciones.';
      Text007@1103355020 : TextConst 'ENU=To cancel companions is only available in the local offices;ESP=Solo es posible dar de baja acompa¤antes en las delegaciones.';
      Text008@1103355021 : TextConst 'ENU=Unable to delete the main person in the reservation %1.;ESP=No se puede borrar el acompa¤ante principal de la reserva %1.';
      Text009@1103355022 : TextConst 'ENU=Deleted;ESP=Borrado';
      Text010@1103355023 : TextConst 'ENU=Deleted register;ESP=Borrado registro';
      Text011@1103355024 : TextConst 'ENU=Only is possible to rename companions in the local offices;ESP=Solo es posible renombrar acompa¤antes en las delegaciones.';
      rPar@1103355000 : Record 7009700;
      rParPer@1103355001 : Record 7009701;
      rAco@1103355002 : Record 7009748;
      rRsvHot@1103355003 : Record 7009743;
      rRsvTra@1103355004 : Record 7009744;
      rCab@1103355005 : Record 7009741;
      rPer@1103355006 : Record 7009742;
      rRegTO@1103355007 : Record 7009719;
      cPar@1103355009 : Codeunit 7009700;
      rRsvCir@1103355010 : Record 7010186;
      GesCuaCircuito@1103355011 : Boolean;
      Periodo@1103355012 : Integer;

    PROCEDURE copiar_campos@1();
    BEGIN
      // copiar_campos

      rAco.RESET;
      rAco.SETRANGE(Delegacion  , Delegacion);
      rAco.SETRANGE("N§ Interno", "N§ Interno");
      IF rAco.FINDFIRST THEN
      BEGIN
        "Compa¤ia entrada"     := rAco."Compa¤ia entrada";
        "Vuelo entrada"        := rAco."Vuelo entrada";
        "Fecha entrada"        := rAco."Fecha entrada";
        "Terminal entrada"     := rAco."Terminal entrada";
        "Hora entrada"         := rAco."Hora entrada";
        "IATA origen entrada"  := rAco."IATA origen entrada";
        "IATA destino entrada" := rAco."IATA destino entrada";
        "Compa¤ia salida"      := rAco."Compa¤ia salida";
        "Vuelo salida"         := rAco."Vuelo salida";
        "Fecha salida"         := rAco."Fecha salida";
        "Terminal salida"      := rAco."Terminal salida";
        "Hora salida"          := rAco."Hora salida";
        "IATA origen salida"   := rAco."IATA origen salida";
        "IATA destino salida"  := rAco."IATA destino salida";
        Regimen                := rAco.Regimen;
        "Regimen TO"           := rAco."Regimen TO";
        "Fecha venta"          := rAco."Fecha venta";
        "N§ Fichero"           := rAco."N§ Fichero";
        Bono                   := rAco.Bono;
        Touroperador           := rAco.Touroperador;
        Temporada              := rAco.Temporada;
      END;
    END;

    PROCEDURE RellenarDatos@1000000000();
    VAR
      lrPer@1000000000 : Record 7009742;
    BEGIN
      lrPer.RESET;
      lrPer.SETRANGE(Delegacion  , Delegacion);
      lrPer.SETRANGE("N§ Interno", "N§ Interno");
      IF lrPer.FINDFIRST THEN
      BEGIN
        "Compa¤ia entrada"     := lrPer."Compa¤ia entrada";
        "Vuelo entrada"        := lrPer."Vuelo entrada";
        "Fecha entrada"        := lrPer."Fecha entrada";
        "Terminal entrada"     := lrPer."Terminal entrada";
        "Hora entrada"         := lrPer."Hora entrada";
        "IATA origen entrada"  := lrPer."IATA origen entrada";
        "IATA destino entrada" := lrPer."IATA destino entrada";
        "Compa¤ia salida"      := lrPer."Compa¤ia salida";
        "Vuelo salida"         := lrPer."Vuelo salida";
        "Fecha salida"         := lrPer."Fecha salida";
        "Terminal salida"      := lrPer."Terminal salida";
        "Hora salida"          := lrPer."Hora salida";
        "IATA origen salida"   := lrPer."IATA origen salida";
        "IATA destino salida"  := lrPer."IATA destino salida";
        Regimen                := lrPer.Regimen;
        "Regimen TO"           := lrPer."Regimen TO";
        "Fecha venta"          := lrPer."Fecha venta";
        "N§ Fichero"           := lrPer."N§ Fichero";
        Bono                   := lrPer.Bono;
        Touroperador           := lrPer."TourOperador Venta";
        Temporada              := lrPer.Temporada;
      END;
    END;

    PROCEDURE Gestion_Cuadrante_Circuito@7(par_GesCuaCircuito@1103355000 : Boolean);
    BEGIN
      GesCuaCircuito := par_GesCuaCircuito;
    END;

    PROCEDURE Pasar_Periodo@2(par_periodo@1103355000 : Integer);
    BEGIN
      // Pasar_Periodo
      Periodo := par_periodo;
    END;

    LOCAL PROCEDURE _GetPrimeraPersona@1100217000() : Integer;
    VAR
      lrAcom@1100217000 : Record 7009748;
    BEGIN
      lrAcom.RESET;
      lrAcom.SETRANGE(Delegacion  , Delegacion);
      lrAcom.SETRANGE("N§ Interno", "N§ Interno");
      IF lrAcom.FINDFIRST THEN
        EXIT(lrAcom."N§ Acompa¤ante")
      ELSE
        EXIT(0);
    END;

    LOCAL PROCEDURE _CheckEnvioConfirmacion@1100217001();
    VAR
      lrCab@1100217000 : Record 7009741;
      lrTTOO@1100217001 : Record 7009717;
    BEGIN
      // _CheckEnvioConfirmacion

      IF NOT Generado THEN
        EXIT;

      IF "Tipo Persona" = '' THEN
        EXIT;

      //+$008 <
      IF NOT lrCab.GET(Delegacion, "N§ Interno") THEN
        EXIT;
      //+$008 <

      IF NOT lrCab."Confirmacion servicios enviada" THEN
        EXIT;

      IF NOT lrTTOO.GET(lrCab."TourOperador Venta") THEN
        EXIT;

      IF NOT lrTTOO."Requiere confirmaci¢n por rsv" THEN
        EXIT;

      IF ("Tipo Persona" <> xRec."Tipo Persona") OR
         (Nombre <> xRec.Nombre) OR
         (Edad <> xRec.Edad) OR
         ("Fecha entrada" <> xRec."Fecha entrada") OR
         ("Fecha salida" <> xRec."Fecha salida") THEN
      BEGIN
        lrCab.VALIDATE("Confirmacion servicios enviada", FALSE);
        lrCab.MODIFY;
      END;
    END;

    LOCAL PROCEDURE _DeleteRelatedInfo@1100217002();
    VAR
      lrRsvHot@1100217000 : Record 7009743;
      lrRsvTra@1100217001 : Record 7009744;
      lrRsvCir@1100217002 : Record 7010186;
    BEGIN
      // _DeleteRelatedInfo

      //. Borrar las reservas de hotel
      lrRsvHot.RESET;
      lrRsvHot.SETCURRENTKEY(Delegacion,
                             "N§ Interno",
                             "N§ Periodo",
                             "N§ Acompa¤ante");
      lrRsvHot.SETRANGE(Delegacion      , Delegacion);
      lrRsvHot.SETRANGE("N§ Interno"    , "N§ Interno");
      lrRsvHot.SETRANGE("N§ Acompa¤ante", "N§ Acompa¤ante");
      IF lrRsvHot.FINDSET(TRUE) THEN
      BEGIN
        lrRsvHot.DELETEALL(TRUE);

        //. Si se borran acompa¤antes de las reservas hotel se debe marcar la reserva para volver a comunicar a hotel.
        //. Solo para reservas futuras con un margen de 3 dias desde su llegada
        IF lrRsvHot."Fecha entrada" >= TODAY-3 THEN
        BEGIN
          lrRsvHot.RESET;
          lrRsvHot.SETCURRENTKEY(Delegacion,
                                 "N§ Interno",
                                 "N§ Periodo",
                                 "N§ Acompa¤ante");
          lrRsvHot.SETRANGE(Delegacion      , Delegacion);
          lrRsvHot.SETRANGE("N§ Interno"    , "N§ Interno");
          IF lrRsvHot.FINDSET(TRUE) THEN
            lrRsvHot.MODIFYALL("Comunicado hotel", FALSE);
        END;
      END;

      //. Borrar las reservas de transfer
      lrRsvTra.RESET;
      lrRsvTra.SETCURRENTKEY(Delegacion,
                             "N§ Interno",
                             "N§ Periodo",
                             "N§ Acompa¤ante");
      lrRsvTra.SETRANGE(Delegacion      , Delegacion);
      lrRsvTra.SETRANGE("N§ Interno"    , "N§ Interno");
      lrRsvTra.SETRANGE("N§ Acompa¤ante", "N§ Acompa¤ante");
      IF lrRsvTra.FINDSET(TRUE) THEN
        lrRsvTra.DELETEALL(TRUE);

      //. Borrar las reservas de circuito
      IF (NOT GesCuaCircuito) AND (rPar."Activar m¢dulo circuitos") THEN
      BEGIN
        lrRsvCir.RESET;
        lrRsvCir.SETCURRENTKEY(Delegacion,
                               "N§ Interno");
        lrRsvCir.SETRANGE("N§ Interno"    , "N§ Interno");
        lrRsvCir.SETRANGE(Delegacion      , Delegacion);
        lrRsvCir.SETRANGE("N§ Acompa¤ante", "N§ Acompa¤ante");
        IF lrRsvCir.FINDSET(TRUE) THEN
          lrRsvCir.DELETEALL(TRUE);
      END;
    END;

    BEGIN
    {
      ## AJF 16/07/09

        .- (INC-42334) Al borrar un acompa¤ante, debemos marcar las reservas hotel restantes para
           que se vuelvan a comunicar a hotel.

      $001 AJS 21072012 Nuevo campo No Show para poder marcar las personas que no se presentan  en la fecha reservada

      $002 JPT 17/10/12 A¤ado nuevo campo "Id Pax TO" para indicar el ID del producto para el TTOO en la importacion

      $003 AJS 17032014 CNT-OC-14035 Nueva funcion _CheckEnvioConfirmacion para marcar la cabecera cuando agreguemos/borremos/cambiemos
                        una persona

      $004 AJS 07042014 Modifico las propiedades de LookupFormID y DrillDownID para que apunten al formulario 7009929

      $005 AJS 07042014 CNT-OC-14042 Cuando borramos un acompa¤ante hay que borrar los registros relacionados en los traslados en destino
                        Nueva funcion _DeleteRelatedInfo donde pasamos parte del codigo de OnDelete

      $006 AJS 27052014 Hago que el campo Regimen sea editable

      $007 AJS 28102014 Amplio el campo Nombre a Text50

      $008 AJS 27112014 Modificion de la funcion _CheckEnvioConfirmacion para evitar un error en borrados desde el interface de reservas
    }
    END.
  }
}
