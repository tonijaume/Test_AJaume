OBJECT Codeunit 7010400 TRF-MACRO-GENERAL
{
  OBJECT-PROPERTIES
  {
    Date=12/11/14;
    Time=12:48:18;
    Version List=TRANSFER;
  }
  PROPERTIES
  {
    OnRun=BEGIN
            //OrigenEnPartes;
            crear_informes_FINBUS;
          END;

  }
  CODE
  {
    VAR
      Text50000@1103355005 : TextConst 'ESP=Conductores';
      Text50001@1103355006 : TextConst 'ESP=TRN';
      Text50002@1103355007 : TextConst 'ESP=IBZ';
      Text50003@1103355008 : TextConst 'ESP=UEX';
      Text50004@1103355009 : TextConst 'ESP=Vehiculos';
      Text50005@1103355010 : TextConst 'ESP=Contratacion';
      Text50006@1103355011 : TextConst 'ESP=Servicios';
      Text50007@1103355012 : TextConst 'ESP=SJO';
      Text50008@1103355013 : TextConst 'ESP=Costes';
      Text50009@1103355014 : TextConst 'ESP=Facturacion';
      Text50010@1103355015 : TextConst 'ESP=TER';
      Text50011@1103355016 : TextConst 'ESP=Estadisticas';
      Text50012@1103355017 : TextConst 'ESP=Comparativos de viajes';
      Text50013@1103355018 : TextConst 'ESP=Produccion por vehiculo';
      Text50014@1103355019 : TextConst 'ESP=Produccion por conductor';
      Text50015@1103355020 : TextConst 'ESP=Informe Cliente/Rango/Servicio';
      Text50016@1103355021 : TextConst 'ESP=Estadisticas Viajes x zona';
      Text50017@1103355022 : TextConst 'ESP=Importaciones';
      Text50018@1103355023 : TextConst 'ESP=Actividad Conductores';
      Text50019@1103355024 : TextConst 'ESP=Actividad Vehiculos';
      Text50020@1103355025 : TextConst 'ESP=Kilometros x Vehiculo';
      Text50021@1103355026 : TextConst 'ESP=Vehiculos utilizados';
      Text50022@1103355027 : TextConst 'ESP=Servicios realizados';
      Text50023@1103355028 : TextConst 'ESP=Comparativo servicios';
      Text50024@1103355029 : TextConst 'ESP=Macro obsoleta';
      Text50025@1103355030 : TextConst 'ESP=<-180D>';
      Text50026@1103355031 : TextConst 'ESP=P2004/00248';
      Text50027@1103355032 : TextConst 'ESP=Se va a borrar la factura %1 de venta';
      Text50028@1103355033 : TextConst 'ESP=FACTURA NO ENCONTRADA.';
      Text50029@1103355034 : TextConst 'ESP=¨Desea Realmente Iniciar el proceso?';
      Text50030@1103355035 : TextConst 'ESP=Procesando @1@@@@@@@@@';
      Text50031@1103355036 : TextConst 'ESP=FAC01155';
      Text50032@1103355037 : TextConst 'ESP=¨Desea realmente eliminar todas las facturas con numeracion igual o inferior a %1?';
      Text50033@1103355038 : TextConst 'ESP=Borrando Prefacturas @1@@@@@@@@@';
      Text50034@1103355039 : TextConst 'ESP=Borrando Facturas @1@@@@@@@@@';
      Text50035@1103355040 : TextConst 'ESP=¨Desea InIciar el proceso?';
      Text50036@1103355041 : TextConst 'ESP=VEHICULO';
      Text50037@1103355042 : TextConst 'ESP=Eliminando Informacion operativa\';
      Text50038@1103355043 : TextConst 'ESP=Servicios          @1@@@@@@@@@@@\';
      Text50039@1103355044 : TextConst 'ESP=Partes de Trabajo  @2@@@@@@@@@@@';
      Text50040@1103355045 : TextConst 'ESP=Actualizando Horia Inicio DT @1@@@@@@';
      Text50041@1103355046 : TextConst 'ESP=Macro Obsoleta';
      Text50042@1103355047 : TextConst 'ESP=Rellenando Fecha factura en coste-ingreso';
      Text50043@1103355048 : TextConst 'ESP=¨Quiere empezar el proceso de eliminar campos no utilizados?';
      Text50044@1103355049 : TextConst 'ESP=Limpiando #1################';
      Text50045@1103355050 : TextConst 'ESP=Bono Touroperador';
      Text50046@1103355051 : TextConst 'ESP=Tipo Servicio UEX';
      Text50047@1103355052 : TextConst 'ESP=Zona Abreviada';
      Text50048@1103355053 : TextConst 'ESP=Zona Traslados UEX';
      Text50049@1103355054 : TextConst 'ESP=Rellena nueva tabla @1@@@@@@@@@@@@';
      Text50050@1103355055 : TextConst 'ESP=Rellena Nuevo campo "Gratuito" @1@@@@@@@@@@@@';
      Text50051@1103355056 : TextConst 'ESP=-2M';
      Text50052@1103355057 : TextConst 'ESP=¨Desea Marcar los campos Fecha Confirmaci¢n con fecha de hoy?';
      Text50053@1103355058 : TextConst 'ESP=Proceso Finalizado';
      Text50054@1103355059 : TextConst 'ESP=Hay que rellenar los codigos de dimension global antes de ejecutar esta Macro.';
      Text50055@1103355060 : TextConst 'ESP=Proceso de comprobacion finalizado.';
      Text50056@1103355061 : TextConst 'ESP=¨Desea realmente empezar el proceso de campbiar fecha servicio parte en TTOOxParte?';
      Text50057@1103355062 : TextConst 'ESP="Fecha Desde= #1#########"';
      Text50058@1103355063 : TextConst 'ESP=Debe indicarse una fecha';
      Text50059@1103355064 : TextConst 'ESP=Procesando @1@@@@@@@@@@@@';
      Text50060@1103355065 : TextConst 'ESP=¨Desea realmente empezar el proceso de Rellenar Zona Trabajo?';
      Text50061@1103355066 : TextConst 'ESP=Rellenando Zona Trabajo\@1@@@@@@@@@@@@@@@@';
      Text50062@1103355067 : TextConst 'ESP=Rellenando Facturable @1@@@@@@@@@@@@@@@@@@@@@';
      Text50063@1103355068 : TextConst 'ESP=Revisa Partes\@1@@@@@@@@@@@';
      Text50064@1103355069 : TextConst 'ESP=Se han modificado %1 casos';
      Text50065@1103355070 : TextConst 'ESP=Desea rellenar el campo Coste Precios Por seg£n el nuevo parametro';
      Text50066@1103355071 : TextConst 'ESP=-3M';
      Text50067@1103355072 : TextConst 'ESP=Traspasando precios Venta Pax\ @1@@@@@@@@@@@@@@@@@';
      Text50068@1103355073 : TextConst 'ESP=Traspasando precios Compra Pax\ @1@@@@@@@@@@@@@@@@@';
      Text50069@1103355074 : TextConst 'ESP=¨Desea Realmente lanzar el proceso de Unificaci¢n de Codigos de Servicio?';
      Text50070@1103355075 : TextConst 'ESP=No se ha rellenado ning£n Codigo Unificado en la tabla de Codigos de Servicio';
      Text50071@1103355076 : TextConst 'ESP=El Codigo %1 Tiene como "Codigo Unificado" %2 que a su vez tiene como "Codigo Unificado" %3';
      Text50072@1103355077 : TextConst 'ESP=Se han seleccionado %1 Codigo de Servicio';
      Text50073@1103355078 : TextConst 'ESP=Codigo Servicio  #1##############\Codigo Unificado #2##############\';
      Text50074@1103355079 : TextConst 'ESP=Tabla     #6#### #3##############\ @4@@@@@@@@@\ @5@@@@@@@@@';
      Text50075@1103355080 : TextConst 'ESP=¨Desea iniciar el proceso de rellenar el codigo Vehiculo en TTOO x Parte?';
      Text50076@1103355081 : TextConst 'ESP=Rellena Vehiculo en TTOOxParte\@1@@@@@@@@@@@@@@@@@';
      Text50077@1103355082 : TextConst 'ESP=Touroperador #1#############\Fechas       #2#############';
      Text50078@1103355083 : TextConst 'ESP=Es necesario introducir un Touroperador';
      Text50079@1103355084 : TextConst 'ESP=Es necesario introducir un filtro de Fechas';
      Text50080@1103355085 : TextConst 'ESP=Desea Reiniciar el proceso de recalcular las Salidas de %2?\%1';
      Text50081@1103355086 : TextConst 'ESP=Recalcula Salidas \@1@@@@@@@@@@@@@@@@@';
      Text50082@1103355087 : TextConst 'ESP=Rellenando Descripcion Punto Recogida\#1##############\@2@@@@@@@@@@@@@@';
      Text50083@1103355088 : TextConst 'ESP=Actualizando Servicios Regulares\@1@@@@@@@@@@@@';
      Text50084@1103355089 : TextConst 'ESP=RUTA %1';
      Text50085@1103355090 : TextConst 'ESP=Grupos';
      Text50086@1103355091 : TextConst 'ESP=Servicios Regulares';
      Text50087@1103355092 : TextConst 'ESP=Rellena Motivo en Incidencia Conductor\#1##############';
      Text50088@1103355093 : TextConst 'ESP=Suplemento #1#########\@2@@@@@@@@@';
      Text50089@1103355094 : TextConst 'ESP=Cambio Codigo Touoperador\Codigo Origen  #1###########\Codigo Destino #2###########';
      Text50090@1103355095 : TextConst 'ESP=Debe de rellenar el Codigo Touroperador Origen';
      Text50091@1103355096 : TextConst 'ESP=Debe de rellenar el Codigo Touroperador Destino';
      Text50092@1103355097 : TextConst 'ESP=Ya existe el C¢digo Touroperador %1';
      Text50093@1103355098 : TextConst 'ESP=¨Desea realmente cambia el codigo Touroperador %1 por %2 en todas las referencias?';
      Text50094@1103355099 : TextConst 'ESP=Cambiando Codigo Touroperador %1 por %2\';
      Text50095@1103355100 : TextConst 'ESP=%1 de %2';
      Text50096@1103355101 : TextConst 'ESP=Proceso terminado';
      Text50097@1103355102 : TextConst 'ESP=Introducir Rango de fechas\#1#########\#2#########';
      Text50098@1103355103 : TextConst 'ESP=Debe de introducir un rango de fechas';
      Text50099@1103355104 : TextConst 'ESP=Fecha desde no puede ser superior a fecha hasta';
      Text50100@1103355105 : TextConst 'ESP=Debe de se¤alar un concepto variable';
      Text50101@1103355106 : TextConst 'ESP=El concepto variable debe de ser Maletas,Viajes,Hora Extra o Dietas';
      Text50102@1103355107 : TextConst 'ESP=Desea realmente regenerar el calculo de ingresos para el rango de fechas:\%1 - %2\codigo variable:%3';
      Text50103@1103355108 : TextConst 'ESP="\Tipo de acuerdo=%4?"';
      Text50104@1103355109 : TextConst 'ESP=Modificando el registro de actividad\@1@@@@@@@@@@@@@@';
      Text50105@1103355110 : TextConst 'ESP=No se ha encontrado ning£n registro de actividad para esas fechas';
      Text50106@1103355111 : TextConst 'ESP=Terminando\@1@@@@@@';
      Text50107@1103355112 : TextConst 'ESP=Produccion Coste\@1@@@@@@@@@@@@@';
      Text50108@1103355113 : TextConst 'ESP=Produccion Ingreso\@1@@@@@@@@@@@@@';
      Text50109@1103355114 : TextConst 'ESP=Rellenando Datos Cliente en Factura\@1@@@@@@@@@@@@@';
      Text50110@1103355115 : TextConst 'ESP=REVISANDO PARTE #1######## DIA #2######\@3@@@@@@@@@@@@@@@@';
      Text50111@1103355116 : TextConst 'ESP=Rellenando campo "Carroceria"\@1@@@@@@@@@@@';
      Text50112@1103355117 : TextConst 'ESP=Se ha movido la informaci¢n de usuario a Usuario Transfer';
      Text50113@1103355118 : TextConst 'ESP=Se va a proceder a rellenar el campo "Fecha Real" de la tabla Partes\';
      Text50114@1103355119 : TextConst 'ESP=El proceso se realizara para los partes con fecha superior a\#1#########';
      Text50115@1103355120 : TextConst 'ESP=Debe de indicar una fecha';
      Text50116@1103355121 : TextConst 'ESP=Rellenando Campo "Fecha Real"\@1@@@@@@@@@@';
      Text50117@1103355122 : TextConst 'ESP=Seleccione si y seleccione el directorio donde crear el fichero\';
      Text50118@1103355123 : TextConst 'ESP=de codigos no usados para continuar.';
      Text50119@1103355124 : TextConst 'ESP=Revisando Codigos de servicio: @1@@@@@@@@@@@@@@@@';
      Text50120@1103355125 : TextConst 'ESP=CodServicio_no_Usado.csv';
      Text50121@1103355126 : TextConst 'ESP="Codigo Servicio;Descripcion;Tipo Servicio"';
      Text50122@1103355127 : TextConst 'ESP="Creado fichero "';
      Text000@1100244005 : TextConst 'ESP=Se van a calcular los kilometros realizados por cada vehiculo';
      Text001@1100244006 : TextConst 'ESP=CALCULANDO KILOMETROS REALIZADOS';
      Text002@1100244007 : TextConst 'ESP=INCIDENCIA';
      Text003@1100244008 : TextConst 'ESP=Serie para incidencias de vehiculos';
      Text004@1100244009 : TextConst 'ESP=INC0000001';
      Text005@1100244010 : TextConst 'ESP=ACCIDENTES';
      Text006@1100244011 : TextConst 'ESP=Serie para accidentes de vehiculos';
      Text007@1100244012 : TextConst 'ESP=ACC0000001';
      Text008@1100244013 : TextConst 'ESP=CONTVENTA';
      Text009@1100244014 : TextConst 'ESP=Serie para contratos de venta';
      Text010@1100244015 : TextConst 'ESP=CVE0000001';
      Text011@1100244016 : TextConst 'ESP=CONTCOMPRA';
      Text012@1100244017 : TextConst 'ESP=Serie para contratos de compra';
      Text013@1100244018 : TextConst 'ESP=CCO0000001';
      Text014@1100244019 : TextConst 'ESP=SERVICIOS';
      Text015@1100244020 : TextConst 'ESP=Serie para peticion de servicios';
      Text016@1100244021 : TextConst 'ESP=SER0000001';
      Text017@1100244022 : TextConst 'ESP=PARTES';
      Text018@1100244023 : TextConst 'ESP=Serie para partes de trabajo';
      Text019@1100244024 : TextConst 'ESP=PAR0000001';
      Text020@1100244025 : TextConst 'ESP=CONDUCTOR';
      Text021@1100244026 : TextConst 'ESP=Serie para codigos de conductor';
      Text022@1100244027 : TextConst 'ESP=CON0000001';
      Text023@1100244028 : TextConst 'ESP=CONDVAR';
      Text024@1100244029 : TextConst 'ESP=Serie para condiciones variables';
      Text025@1100244030 : TextConst 'ESP=CVA0000001';
      Text026@1100244031 : TextConst 'ESP=PREVCOSTE';
      Text027@1100244032 : TextConst 'ESP=Serie para previsiones de coste';
      Text028@1100244033 : TextConst 'ESP=PCO0000001';
      Text029@1100244034 : TextConst 'ESP=PREVING';
      Text030@1100244035 : TextConst 'ESP=Serie para previsiones de ingreso';
      Text031@1100244036 : TextConst 'ESP=PIN0000001';
      Text032@1100244037 : TextConst 'ESP=PREFACT';
      Text033@1100244038 : TextConst 'ESP=Serie para prefacturas';
      Text034@1100244039 : TextConst 'ESP=PRE0000001';
      Text035@1100244040 : TextConst 'ESP=REVISANDO LOS COSTES INGRESOS';
      Text036@1100244041 : TextConst 'ESP=PARTE %1';
      Text037@1100244042 : TextConst 'ESP=Se van a repasar los paxes transportados de todos los partes, continuar?';
      Text038@1100244043 : TextConst 'ESP=REVISANDO TRANSPORTADOS EN PARTES';
      Text039@1100244044 : TextConst 'ESP=Control TUI+FLY';
      Text040@1100244045 : TextConst 'ESP=Lista Conductores';
      Text041@1100244046 : TextConst 'ESP=Horas Realizadas';
      Text042@1100244047 : TextConst 'ESP=Lista Condiciones At­picas';
      Text043@1100244048 : TextConst 'ESP=Ranking Antiguedad Conductores';
      Text044@1100244049 : TextConst 'ESP=Estadillo de incidencias';
      Text045@1100244050 : TextConst 'ESP=Estadisticas Conductores';
      Text046@1100244051 : TextConst 'ESP=Ingresos por Conductor';
      Text047@1100244052 : TextConst 'ESP=Conductor x Fin Contrato';
      Text048@1100244053 : TextConst 'ESP=Control actividad conductores';
      Text049@1100244054 : TextConst 'ESP=Listado dias Libres';
      Text050@1100244055 : TextConst 'ESP=Ficha tecnica vehiculos';
      Text051@1100244056 : TextConst 'ESP=Ficha Incidencia';
      Text052@1100244057 : TextConst 'ESP=Estadisticas vehiculos';
      Text053@1100244058 : TextConst 'ESP=Viajes x Pax Transportados';
      Text054@1100244059 : TextConst 'ESP=Actividad por Franjas Horarias';
      Text055@1100244060 : TextConst 'ESP=Vehiculos en Taller';
      Text056@1100244061 : TextConst 'ESP=Gastos de Taller x Vehiculo';
      Text057@1100244062 : TextConst 'ESP=Control actividad vehiculos';
      Text058@1100244063 : TextConst 'ESP=Lista contratos venta';
      Text059@1100244064 : TextConst 'ESP=Contrato venta';
      Text060@1100244065 : TextConst 'ESP=Simulacion Contrato venta';
      Text061@1100244066 : TextConst 'ESP=Estad­sticas Clientes';
      Text062@1100244067 : TextConst 'ESP=Lista contratos compra';
      Text063@1100244068 : TextConst 'ESP=Contrato compra';
      Text064@1100244069 : TextConst 'ESP=Control Trafico Externo';
      Text065@1100244070 : TextConst 'ESP=Resumen Trafico Externo';
      Text066@1100244071 : TextConst 'ESP=Actividad Trafico Externo';
      Text067@1100244072 : TextConst 'ESP=Lista prefactura coste emitida';
      Text069@1100244074 : TextConst 'ESP=Informe de Produccion diaria';
      Text070@1100244075 : TextConst 'ESP=Informe de Pre-Produc. diaria';
      Text071@1100244076 : TextConst 'ESP=Resumen Partes x Touroperador';
      Text072@1100244077 : TextConst 'ESP=Previsi½n Coste-Ingreso';
      Text073@1100244078 : TextConst 'ESP=Informe de errores en calculo';
      Text074@1100244079 : TextConst 'ESP=Hoja de parte - COLL';
      Text075@1100244080 : TextConst 'ESP=Hoja de parte - INVISA';
      Text076@1100244081 : TextConst 'ESP=Hoja de trabajo IATA INVISA';
      Text077@1100244082 : TextConst 'ESP=Control de Servicios x Chofer';
      Text078@1100244083 : TextConst 'ESP=Control de Vehiculos x zonas';
      Text079@1100244084 : TextConst 'ESP=Parte Diario Conductor-UEX';
      Text080@1100244085 : TextConst 'ESP=Parte Trabajo Excursiones-UEX';
      Text081@1100244086 : TextConst 'ESP=Parte Trabajo Traslados-UEX';
      Text082@1100244087 : TextConst 'ESP=Listado Traslados-UEX';
      Text083@1100244088 : TextConst 'ESP=Planing Vehiculos-UEX';
      Text084@1100244089 : TextConst 'ESP=Planing Vehiculos (Sin Salto)';
      Text085@1100244090 : TextConst 'ESP=Resumen Entradas Salidas-UEX';
      Text086@1100244091 : TextConst 'ESP=Hoja Excursiones';
      Text087@1100244092 : TextConst 'ESP=Resumen Transfers Externos';
      Text088@1100244093 : TextConst 'ESP=Consulta ingresos';
      Text089@1100244094 : TextConst 'ESP=Partes Gratuitos';
      Text090@1100244095 : TextConst 'ESP=Partes Trabajo Traslados 2';
      Text091@1100244096 : TextConst 'ESP=Desglose diario tipo servicio';
      Text092@1100244097 : TextConst 'ESP=Disponibilidad conductores';
      Text093@1100244098 : TextConst 'ESP=Prefactura sin resumen';
      Text094@1100244099 : TextConst 'ESP=Prefactura Resumen-Codigo';
      Text095@1100244100 : TextConst 'ESP=Prefactura Resumen - Zona';
      Text096@1100244101 : TextConst 'ESP=Factura sin resumen';
      Text097@1100244102 : TextConst 'ESP=Factura sin resumen registrada';
      Text098@1100244103 : TextConst 'ESP=Factura Resumen-Codigo';
      Text099@1100244104 : TextConst 'ESP=Factura Resumen-Codigo regis.';
      Text100@1100244105 : TextConst 'ESP=Factura Resumen-Zona';
      Text101@1100244106 : TextConst 'ESP=Factura Resumen-Zona registr';
      Text102@1100244107 : TextConst 'ESP=Prefactura Resumen - Vuelo';
      Text103@1100244108 : TextConst 'ESP=Factura Resumen-Vuelo';
      Text104@1100244109 : TextConst 'ESP=Factura Resumen-Vuelo registr';
      Text105@1100244110 : TextConst 'ESP=Prefactura Resumen Dia-Codigo';
      Text106@1100244111 : TextConst 'ESP=Factura Resumen Dia-Codigo';
      Text107@1100244112 : TextConst 'ESP=Factura Resumen Dia-Codigo reg';
      Text108@1100244113 : TextConst 'ESP=Prefactura Zona-Detalle';
      Text109@1100244114 : TextConst 'ESP=Factura Zona-Detalle';
      Text110@1100244115 : TextConst 'ESP=Factura Zona-Detalle registrad';
      Text111@1100244116 : TextConst 'ESP=Pref. Resumen  Zona-Dia-Codigo';
      Text112@1100244117 : TextConst 'ESP=Fra. Resumen Zona-Dia-Codigo';
      Text113@1100244118 : TextConst 'ESP=Fra. Resumen-Zona-Dia-Codigo r';
      Text114@1100244119 : TextConst 'ESP=Prefactura Texto alternativo';
      Text115@1100244120 : TextConst 'ESP=Factura Texto alternativo';
      Text116@1100244121 : TextConst 'ESP=Factura Texto alternativo regi';
      Text119@1100244124 : TextConst 'ESP=Factura Registrada UEX';
      Text120@1100244125 : TextConst 'ESP=Prefactura UEX';
      Text121@1100244126 : TextConst 'ESP=Factura UEX';
      Text122@1100244127 : TextConst 'ESP=Cumplimiento por conductor';
      Text123@1100244128 : TextConst 'ESP=Cumplimiento por Vehiculo';
      Text124@1100244129 : TextConst 'ESP=Informes creados...';
      Text125@1100244130 : TextConst 'ESP=INTRODUZCA EL NUMERO DE PARTE A RENUMERAR\';
      Text126@1100244131 : TextConst 'ESP=No existe el parte %1.';
      Text127@1100244132 : TextConst 'ESP=No se puede renumerar un parte confirmado.';
      Text128@1100244133 : TextConst 'ESP=Se ha renumerado el parte %1 al numero %2.';
      Text129@1100244134 : TextConst 'ESP=ELIMINANDO DATOS HISTORICOS ANTIGUOS';
      Text130@1100244135 : TextConst 'ESP=-30D';
      Text131@1100244136 : TextConst 'ESP=REVISANDO PARTES';
      Text132@1100244137 : TextConst 'ESP=EL PARTE %1 NO TIENE RECOGIDAS ASIGNADAS, DESEA BORRARLO';
      Text133@1100244138 : TextConst 'ESP=Desea crear series de factura para cada proveedor';
      Text134@1100244139 : TextConst 'ESP=FC';
      Text135@1100244140 : TextConst 'ESP="Facturas compra "';
      Text136@1100244141 : TextConst 'ESP=Proceso FINALIZADO';
      Text137@1100244142 : TextConst 'ESP=INTRODUZCA FACTURA A RENUMERAR: #1#############';
      Text138@1100244143 : TextConst 'ESP=SE VA A RENUMERAR LA FACTURA %1, ESTA SEGURO';
      Text139@1100244144 : TextConst 'ESP=PREFACTURA RENUMERADA.';
      Text140@1100244145 : TextConst 'ESP=-90D';
      Text141@1100244146 : TextConst 'ESP=PURGANDO EL HISTORICO SERVICIOS';
      Text142@1100244147 : TextConst 'ESP=PURGANDO EL HISTORICO PARTES';
      Text143@1100244148 : TextConst 'ESP=PURGANDO HISTORICO';
      Text144@1100244149 : TextConst 'ESP=PURGANDO IMPORTACIONES ANTERIORES';
      Text145@1100244150 : TextConst 'ESP=PURGANDO MENSAJES DE ERROR';
      Text146@1100244151 : TextConst 'ESP=ULMA*';
      rPar@1100244155 : Record 7010311;
      rEmp@1103355128 : Record 2000000006;
      wVentana@1100244000 : Dialog;
      wActual@1100244001 : Integer;
      wTotal@1100244002 : Integer;
      Text0001@1100244003 : TextConst 'ESP=Se van a eliminar datos sobrantes del fichero historico de modificaciones, asegurese de que no hay usuarios trabajando';
      Text0002@1100244004 : TextConst 'ESP=Proceso Terminado';
      Text147@1100244152 : TextConst 'ESP=Parte trabajo';
      Text148@1100244153 : TextConst 'ESP=Estructura trabajo diario';
      Text149@1100244154 : TextConst 'ESP=Factura TransUnion';
      Text150@1100244156 : TextConst 'ESP=Servicios Diarios x Codigo';
      Text151@1100244157 : TextConst 'ESP=Importacion Servicios';
      Text152@1100244158 : TextConst 'ESP=Informe Altas Diarias';
      Text153@1100244159 : TextConst 'ESP=Informe Limpieza Vehiculo';
      Text154@1100244160 : TextConst 'ESP=Prefac.Texto alternativo UEX';
      Text155@1100244161 : TextConst 'ESP=Factura Texto alternativo UEX';
      Text156@1100244162 : TextConst 'ESP=Vehiculos operativos x dia';
      Text157@1100244163 : TextConst 'ESP=Proceso Cancelado';
      Text158@1100244164 : TextConst 'ESP=Informe partes pendientes';
      Text159@1100244165 : TextConst 'ESP=Diario Servicios Confirmados';
      Text160@1100244166 : TextConst 'ESP=Planing Servicios';
      Text161@1100244167 : TextConst 'ESP=Revisar paxes facturados';
      Text162@1100244168 : TextConst 'ESP=Debe introducir un periodo de Fechas.';
      Text163@1100244169 : TextConst 'ESP=Fecha Hasta debe ser posterior a Fecha Desde.';
      Text164@1100244170 : TextConst 'ESP=¨Desea eliminar informaci¢n operativa del periodo %1..%2?';
      Text165@1100244171 : TextConst 'ESP=Factura San Jose';
      Text166@1100244172 : TextConst 'ESP=Parte de trabajo San Jose';
      Text167@1100244173 : TextConst 'ESP=Lista Diaria Exc. Exterior';
      Text168@1100244174 : TextConst 'ESP=Resumen Excursiones Ext. Pdtes';
      Text169@1100244175 : TextConst 'ESP=Lista Bonos Reclamar Agencia';
      Text170@1103350000 : TextConst 'ESP=Resumen Serv.Vehi. Agregado';
      Text171@1103350001 : TextConst 'ESP=Vehiculos Pedientes Revisi¢n';
      Text172@1103350002 : TextConst 'ESP=Proximas Revisiones';
      Text173@1103350003 : TextConst 'ESP=Historico Incidencias';
      Text174@1103350005 : TextConst 'ESP=¨Desea realmente limpiar las prefacturas Desactivadas anteriores a 2 meses?';
      Text175@1103350004 : TextConst 'ESP=Resumen Entradas-Salidas Vuelo';
      Text176@1103350006 : TextConst 'ESP=No puede dejar el campo %1 en blanco';
      Text177@1103350007 : TextConst 'ESP=No se encuentra nada pendiente de facturar';
      Text178@1103350008 : TextConst 'ESP=No se encuentra nada facturado en ese periodo';
      Text179@1103350009 : TextConst 'ESP=¨Seguro que quiere marcar todos las lineas pendientes del Servicio Repetitivo %1, (%3..%4) con el numero de factura %2?';
      Text180@1103350010 : TextConst 'ESP=Incidencias Conductores';
      Text181@1103350011 : TextConst 'ESP=Estad x conductor Comparativas';
      Text182@1103350012 : TextConst 'ESP=Estad factura vehic compara.';
      Text183@1103350013 : TextConst 'ESP=Estad pasaje vehic compara.';
      Text184@1103350014 : TextConst 'ESP=Viajes x Zona y conductor';
      Text185@1103350015 : TextConst 'ESP=Viajes x Pax Cliente/TTOO';
      Text186@1103350016 : TextConst 'ESP=Estadisticas Conductores IBZ';
      Text187@1103350017 : TextConst 'ESP=Estad. Fact. Clientes Comp.';
      Text188@1103350018 : TextConst 'ESP=Estad.Pax Fact.Clientes Comp.';
      Text189@1103350019 : TextConst 'ESP=Estad.Pax Trans.Clientes Comp.';
      Text190@1103350020 : TextConst 'ESP=Tarifa Precios x Zona';
      Text191@1103350021 : TextConst 'ESP=FACTURADO MACRO';
      Text192@1103350022 : TextConst 'ESP=Indique una fecha';
      Text193@1103350023 : TextConst 'ESP=¨Desea realmente marcar como facturados todos los partes con fecha inferior o igual a %1?';
      Text194@1103350024 : TextConst 'ESP=Introduzca Fecha Limite #1############';
      Text195@1103350025 : TextConst 'ESP=Se han marcado como facturados %1 partes';
      Text196@1103350026 : TextConst 'ESP=No se ha encontrado ning£n caso';
      Text197@1103350027 : TextConst 'ESP=¨Desea eliminar todos los registros de Hist¢rico Exportacion Proveedor hasta 3 meses atr s (%1)?';
      Text198@1103350028 : TextConst 'ESP=Estadisticas x Garaje';
      Text199@1103350029 : TextConst 'ESP=Balance Coste-Ingreso';
      Text200@1103350030 : TextConst 'ESP=Comparativo Paxes-Maletas';
      Text201@1103355000 : TextConst 'ESP=Revisando contratos - Zona facturacion';
      Text202@1103355001 : TextConst 'ESP=Creando zonas de precios para los traslados';
      Text203@1103355002 : TextConst 'ESP=Actualizando campos de registro diario : @3@@@@@@@@@@@@@@@@.';
      Text204@1103355003 : TextConst 'ESP=Actualizando Garaje en l¡neas de TTOO : @3@@@@@@@@@@@@@@@@.';
      Text205@1103355004 : TextConst 'ESP=Las L¡neas de touroperador de %1 Partes han sido actualizadas.';

    PROCEDURE calcula_kms_realizados@1();
    VAR
      rRegDia@1100244000 : Record 7035342;
      wVehAnteriores@1100244001 : Code[10];
      wKmsAnteriores@1100244002 : Decimal;
      wUltimaRotura@1100244003 : Decimal;
      wTieneRotura@1100244004 : Boolean;
    BEGIN
      // calcula_kms_realizados
      //
      IF NOT CONFIRM(Text000) THEN
        EXIT;

      rRegDia.RESET;
      rRegDia.SETCURRENTKEY(Vehiculo,
                            Dia,
                            "Hora repostaje",
                            Anulado);
      rRegDia.SETRANGE(Anulado, FALSE);
      IF rRegDia.FINDSET(TRUE) THEN BEGIN
        crea_ventana(Text001);

        wTotal         := rRegDia.COUNT;
        wVehAnteriores := '';
        wKmsAnteriores := 0;
        REPEAT
          actualiza_ventana;
          IF rRegDia.Vehiculo <> wVehAnteriores THEN BEGIN
            wKmsAnteriores := 0;
            wVehAnteriores := rRegDia.Vehiculo;
            wTieneRotura   := FALSE;
          END;

          IF rRegDia."Rotura Tacografo" THEN BEGIN
            rRegDia."Kilometros Reales" := rRegDia.Kms + wKmsAnteriores;
            wTieneRotura  := TRUE;
            wUltimaRotura := wKmsAnteriores;
          END
          ELSE BEGIN
            IF wTieneRotura THEN
              rRegDia."Kilometros Reales" := rRegDia.Kms + wUltimaRotura
            ELSE
              rRegDia."Kilometros Reales" := rRegDia.Kms;
          END;

          rRegDia."Kms realizados"    := rRegDia."Kilometros Reales" - wKmsAnteriores;
          rRegDia.MODIFY;

          wKmsAnteriores := rRegDia."Kilometros Reales";
        UNTIL rRegDia.NEXT = 0;
        wVentana.CLOSE;
      END;
    END;

    PROCEDURE crear_series_FINBUS@2();
    VAR
      lrPar@1100244000 : Record 7010311;
    BEGIN
      // crear_series_FINBUS
      //
      nueva_serie(Text002, Text003, Text004);
      nueva_serie(Text005, Text006, Text007);
      nueva_serie(Text008, Text009, Text010);
      nueva_serie(Text011, Text012, Text013);
      nueva_serie(Text014, Text015, Text016);
      nueva_serie(Text017, Text018, Text019);
      nueva_serie(Text020, Text021, Text022);
      nueva_serie(Text023, Text024, Text025);
      nueva_serie(Text026, Text027, Text028);
      nueva_serie(Text029, Text030, Text031);
      nueva_serie(Text032, Text033, Text034);

      CLEAR(lrPar);
      IF NOT lrPar.FINDFIRST THEN
        lrPar.INSERT;

      lrPar."Serie incidencias"         := Text002;
      lrPar."Serie accidentes"          := Text005;
      lrPar."Serie contrato venta"      := Text008;
      lrPar."Serie contrato compra"     := Text011;
      lrPar."Serie Servicios"           := Text014;
      lrPar."Serie Partes"              := Text017;
      lrPar."Serie Conductores"         := Text020;
      lrPar."Serie Condicion Variable"  := Text023;
      lrPar."Serie Previsiones coste"   := Text026;
      lrPar."Serie Previsiones ingreso" := Text029;
      lrPar."Serie Prefacturas"         := Text032;
      lrPar.MODIFY;
    END;

    PROCEDURE nueva_serie@4(pw_codserie@1100244000 : Code[10];pw_descripserie@1100244001 : Text[50];pw_numinicial@1100244002 : Code[20]);
    VAR
      lrNumSerie@1100244003 : Record 308;
      lrLinSerie@1100244004 : Record 309;
    BEGIN
      // nueva_serie ( Se llama desde crear_series_FINBUS)
      //
      CLEAR(lrNumSerie);
      lrNumSerie.VALIDATE(Code          , pw_codserie);
      lrNumSerie.VALIDATE(Description   , pw_descripserie);
      lrNumSerie.VALIDATE("Default Nos.", TRUE);
      lrNumSerie.INSERT(TRUE);

      CLEAR(lrLinSerie);
      lrLinSerie.VALIDATE("Series Code"  , lrNumSerie.Code);
      lrLinSerie.VALIDATE("Line No."     , 10000);
      lrLinSerie.VALIDATE("Starting Date", DMY2DATE(1, 1, 1999));
      lrLinSerie.VALIDATE("Starting No." , pw_numinicial);
      lrLinSerie.INSERT(TRUE);
    END;

    PROCEDURE revisar_costeingreso_sinparte@3();
    VAR
      lrParte@1100244000 : Record 7010360;
      lrCI@1100244001 : Record 7010414;
    BEGIN
      // revisar_costeingreso_sinparte
      //
      lrParte.RESET;

      lrCI.RESET;
      IF lrCI.FINDSET THEN BEGIN
        crea_ventana(Text035);
        wTotal  := lrCI.COUNT;
        REPEAT
          actualiza_ventana;

          IF NOT lrParte.GET(lrCI."N§ Parte") THEN
            MESSAGE(Text036, lrCI."N§ Parte");

        UNTIL lrCI.NEXT = 0;
        wVentana.CLOSE;
      END;
    END;

    PROCEDURE repasa_paxes_transportados@5();
    VAR
      lrParte@1100244000 : Record 7010360;
    BEGIN
      // repasa_paxes_transportados
      //
      IF NOT CONFIRM(Text037) THEN
        EXIT;

      CLEAR(lrParte);
      IF lrParte.FINDSET(TRUE) THEN BEGIN
        crea_ventana(Text038);
        wTotal := lrParte.COUNT;
        REPEAT
          actualiza_ventana;

          lrParte.CALCFIELDS("Adultos transportados", "Ni¤os transportados");
          lrParte."Adultos trans. soporte" := lrParte."Adultos transportados";
          lrParte."Ni¤os trans. soporte"   := lrParte."Ni¤os transportados";
          lrParte.MODIFY;
        UNTIL lrParte.NEXT = 0;
        wVentana.CLOSE;
      END;
    END;

    PROCEDURE crear_informes_FINBUS@8();
    VAR
      rLista@1100244000 : Record 7035384;
      wTipo@1100253000 : 'Informe,Excel';
    BEGIN
      // crear_informes_FINBUS
      //

      rPar.GET;

      // Solo borramos los que el cliente tenga como visible TRUE para evitar que si un cliente se oculta informes
      // le vuelvan a aparecer con cada actualizacion

      rLista.RESET;
      rLista.SETRANGE(Visible, TRUE);
      IF rLista.FINDFIRST THEN
        rLista.DELETEALL;

      // Informes de Conductores

      nuevo_informe(Text50000, 7010310, wTipo::Informe, '', '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50000, 7010312, wTipo::Informe, '', '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50000, 7010314, wTipo::Informe, '', '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50000, 7010316, wTipo::Informe, '', '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50000, 7010313, wTipo::Informe, '', '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50000, 7010315, wTipo::Informe, '', '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50000, 7010414, wTipo::Informe, '', '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50000, 7010419, wTipo::Informe, '', '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50000, 7010429, wTipo::Informe, '', '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50000, 7010376, wTipo::Informe, '', '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50000, 7010435, wTipo::Informe, Text50001, '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50000, 7010382, wTipo::Informe, Text50002, '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50000, 7010387, wTipo::Informe, Text50003, '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50000, 7010396, wTipo::Informe, Text50003, '', rLista."Tipo objeto"::Report);

      // Informes de Vehiculos

      nuevo_informe(Text50004, 7010317, wTipo::Informe, '', '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50004, 7010425, wTipo::Informe, '', '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50004, 7010319, wTipo::Informe, '', '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50004, 7010320, wTipo::Informe, '', '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50004, 7010321, wTipo::Informe, '', '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50004, 7010322, wTipo::Informe, '', '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50004, 7010323, wTipo::Informe, '', '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50004, 7010420, wTipo::Informe, '', '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50004, 7010441, wTipo::Informe, Text50001, '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50004, 7010362, wTipo::Informe, Text50001, '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50004, 7010365, wTipo::Informe, '', '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50004, 7010368, wTipo::Informe, '', '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50004, 7010394, wTipo::Informe, Text50003, '', rLista."Tipo objeto"::Report);

      // Informes de Contratacion

      nuevo_informe(Text50005, 7010335, wTipo::Informe, '', '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50005, 7010336, wTipo::Informe, '', '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50005, 7010337, wTipo::Informe, '', '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50005, 7010338, wTipo::Informe, '', '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50005, 7010377, wTipo::Informe, '', '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50005, 7010378, wTipo::Informe, '', '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50005, 7010379, wTipo::Informe, '', '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50005, 7010380, wTipo::Informe, '', '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50005, 7010381, wTipo::Informe, '', '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50005, 7010383, wTipo::Informe, Text50002, '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50005, 7010384, wTipo::Informe, Text50002, '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50005, 7010410, wTipo::Informe, Text50002, '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50005, 7010443, wTipo::Informe, Text50002, '', rLista."Tipo objeto"::Report);

      // Informes de Servicios

      nuevo_informe(Text50006, 7010328, wTipo::Informe, '', '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50006, 7010329, wTipo::Informe, '', '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50006, 7010331, wTipo::Informe, '', '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50006, 7010324, wTipo::Informe, Text50002, '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50006, 7010327, wTipo::Informe, Text50002, '', rLista."Tipo objeto"::Report);
      //nuevo_informe(Text50006, 7010333, wTipo::Informe, '', '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50006, 7010334, wTipo::Informe, '', '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50006, 7010400, wTipo::Informe, Text50003, '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50006, 7010401, wTipo::Informe, Text50003, '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50006, 7010402, wTipo::Informe, Text50003, '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50006, 7010403, wTipo::Informe, Text50003, '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50006, 7010405, wTipo::Informe, Text50003, '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50006, 7010418, wTipo::Informe, Text50003, '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50006, 7010408, wTipo::Informe, Text50003, '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50006, 7010375, wTipo::Informe, Text50003, '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50006, 7010404, wTipo::Informe, Text50003, '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50006, 7010407, wTipo::Informe, Text50003, '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50006, 7010417, wTipo::Informe, '', '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50006, 7010421, wTipo::Informe, '', '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50006, 7010431, wTipo::Informe, Text50003, '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50006, 7010332, wTipo::Informe, Text50002, '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50006, 7010346, wTipo::Informe, Text50002, '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50006, 7010369, wTipo::Informe, Text50001, '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50006, 7010370, wTipo::Informe, Text50001, '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50006, 7010372, wTipo::Informe, Text50001, '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50006, 7010434, wTipo::Informe, Text50001, '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50006, 7010436, wTipo::Informe, Text50001, '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50006, 7010364, wTipo::Informe, Text50001, '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50006, 7010374, wTipo::Informe, Text50007, '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50006, 7010346, wTipo::Excel, Text50002, '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50006, 7010399, wTipo::Informe, Text50001, '', rLista."Tipo objeto"::Report);

      // Informes de Control Costes

      nuevo_informe(Text50008, 7010340, wTipo::Informe, '', '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50008, 7010341, wTipo::Informe, '', '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50008, 7010406, wTipo::Informe, '', '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50008, 7010409, wTipo::Informe, '', '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50008, 7010423, wTipo::Informe, '', '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50008, 7010428, wTipo::Informe, '', '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50008, 7010348, wTipo::Informe, Text50003, '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50008, 7010350, wTipo::Informe, Text50003, '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50008, 7010353, wTipo::Informe, Text50003, '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50008, 7010359, wTipo::Informe, Text50003, '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50008, 7010430, wTipo::Informe, ''   , '', rLista."Tipo objeto"::Report);


      // Informes de Facturacion

      nuevo_informe(Text50009, 7010342, wTipo::Informe, '', '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50009, 7010343, wTipo::Informe, '', '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50009, 7010344, wTipo::Informe, '', '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50009, 7010345, wTipo::Informe, '', '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50009, 7010347, wTipo::Informe, '', '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50009, 7010349, wTipo::Informe, '', '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50009, 7010351, wTipo::Informe, '', '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50009, 7010352, wTipo::Informe, '', '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50009, 7010354, wTipo::Informe, '', '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50009, 7010355, wTipo::Informe, '', '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50009, 7010357, wTipo::Informe, '', '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50009, 7010358, wTipo::Informe, '', '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50009, 7010360, wTipo::Informe, '', '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50009, 7010361, wTipo::Informe, '', '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50009, 7010366, wTipo::Informe, '', '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50009, 7010367, wTipo::Informe, '', '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50009, 7010326, wTipo::Informe, '', '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50009, 7010330, wTipo::Informe, '', '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50009, 7010339, wTipo::Informe, '', '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50009, 7010413, wTipo::Informe, Text50003, '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50009, 7010415, wTipo::Informe, Text50003, '', rLista."Tipo objeto"::Report);
      //nuevo_informe(Text50009, 7010416, wTipo::Informe, Text50003, '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50009, 7010438, wTipo::Informe, Text50003, '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50009, 7010439, wTipo::Informe, Text50003, '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50009, 7010363, wTipo::Informe, Text50007, '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50009, 7010371, wTipo::Informe, Text50001, '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50009, 7010385, wTipo::Informe, Text50010, '', rLista."Tipo objeto"::Report);

      // Informes de Estadisticas

      nuevo_informe(Text50011, 7010432, wTipo::Informe, Text50003, '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50011, 7010433, wTipo::Informe, Text50003, '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50011, 7010411, wTipo::Informe, Text50001, '', rLista."Tipo objeto"::Report);
      nuevo_informe(Text50011, 7010386, wTipo::Informe, Text50003, '', rLista."Tipo objeto"::Report);

      nuevo_informe(Text50011, 7010488, wTipo::Excel, Text50002, Text50012, rLista."Tipo objeto"::Form);
      nuevo_informe(Text50011, 7010388, wTipo::Excel, '', Text50013, rLista."Tipo objeto"::Report);
      nuevo_informe(Text50011, 7010391, wTipo::Excel, Text50001, Text50014, rLista."Tipo objeto"::Report);
      nuevo_informe(Text50011, 7010392, wTipo::Excel, '', Text50015, rLista."Tipo objeto"::Report);
      nuevo_informe(Text50011, 7010445, wTipo::Informe, Text50002, Text50016, rLista."Tipo objeto"::Report);

      // Informes Menu importaciones

      nuevo_informe(Text50017, 7035322, wTipo::Excel, Text50003, Text50018, rLista."Tipo objeto"::Codeunit);
      nuevo_informe(Text50017, 7035322, wTipo::Excel, Text50003, Text50019, rLista."Tipo objeto"::Codeunit);
      nuevo_informe(Text50017, 7035322, wTipo::Excel, Text50003, Text50020, rLista."Tipo objeto"::Codeunit);
      nuevo_informe(Text50017, 7035322, wTipo::Excel, Text50003, Text50021, rLista."Tipo objeto"::Codeunit);
      nuevo_informe(Text50017, 7035322, wTipo::Excel, Text50003, Text50022, rLista."Tipo objeto"::Codeunit);
      nuevo_informe(Text50017, 7010312, wTipo::Excel, Text50003, Text50023, rLista."Tipo objeto"::Codeunit);

      {-}
      MESSAGE(Text124);
    END;

    PROCEDURE nuevo_informe@7(wMenu@1100244000 : Code[20];wInforme@1100244002 : Integer;wTipo@1100253000 : 'Informe,Excel';wEmpresa@1100253001 : Code[10];wDescripcion@1100253002 : Text[30];wTipoObjeto@1100253003 : 'TableData,Table,Form,Report,Dataport,Codeunit,XMLPort,MenuSuite,System,FieldNumber');
    VAR
      rLista@1100244003 : Record 7035384;
    BEGIN
      // nuevo_informe
      //

      rPar.FINDFIRST;
      IF (FORMAT(rPar."Empresa Real") <> wEmpresa) AND (wEmpresa <> '') THEN
        EXIT;

      CASE wTipo OF
        wTipo::Informe:
        BEGIN
          CLEAR(rLista);
          rLista.VALIDATE("Id. Informe", wInforme);
        END;
        wTipo::Excel:
        BEGIN
          CLEAR(rLista);
          rLista."Id. Informe"    := wInforme;
          rLista."Nombre Informe" := wDescripcion;
          rLista.Texto            := wDescripcion;
        END;
      END;

      rLista.Menu           := wMenu;
      rLista.Tipo           := wTipo;
      rLista."Empresa Real" := wEmpresa;
      rLista."Tipo objeto"  := wTipoObjeto;
      rLista.INSERT(TRUE);
    END;

    PROCEDURE renumera_parte_trabajo@9();
    VAR
      wAntParte@1100244000 : Code[10];
      rParte@1100244001 : Record 7010360;
      rParte2@1100244002 : Record 7010360;
      rSerPar@1100244003 : Record 7010359;
      rSerPar2@1100244004 : Record 7010359;
      rHist@1100244005 : Record 7010361;
      rHist2@1100244006 : Record 7010361;
      rHist3@1100244007 : Record 7010361;
      rTOParte@1100244008 : Record 7010365;
      rTOParte2@1100244009 : Record 7010365;
      rTOParte3@1100244010 : Record 7010365;
      rExtParte@1100244011 : Record 7010362;
      rExtParte2@1100244012 : Record 7010362;
      rExtParte3@1100244013 : Record 7010362;
      rMargen@1100244014 : Record 7010412;
      rMargen2@1100244015 : Record 7010412;
      rMargen3@1100244016 : Record 7010412;
      rError@1100244017 : Record 7010413;
      rError2@1100244018 : Record 7010413;
      rError3@1100244019 : Record 7010413;
      rZonPre@1100244020 : Record 7010364;
      rZonPre2@1100244021 : Record 7010364;
      rZonPre3@1100244022 : Record 7010364;
      rZonPar@1100244023 : Record 7010366;
      rZonPar2@1100244024 : Record 7010366;
      rZonPar3@1100244025 : Record 7010366;
      rElemPto@1100244026 : Record 7010363;
      rElemPto2@1100244027 : Record 7010363;
      rElemPto3@1100244028 : Record 7010363;
    BEGIN
      // renumera_parte_trabajo
      //
      wVentana.OPEN(Text125 +
                   '\' +
                   '#1########');
      wVentana.INPUT(1, wAntParte);
      wVentana.CLOSE;

      IF wAntParte = '' THEN
        EXIT;

      IF NOT rParte.GET(wAntParte) THEN
        ERROR(Text126, wAntParte);

      IF rParte.Confirmado THEN
        ERROR(Text127);

      CLEAR(rParte2);
      rParte2.INSERT(TRUE);
      rParte2.TRANSFERFIELDS(rParte, FALSE);
      rParte2.MODIFY(TRUE);

      rSerPar.RESET;
      rSerPar.SETCURRENTKEY("N§ Parte");
      rSerPar.SETRANGE("N§ Parte", wAntParte);
      IF rSerPar.FINDSET(TRUE) THEN BEGIN
        REPEAT
          rSerPar2 := rSerPar;
          rSerPar2."N§ Parte" := rParte2."N§ Parte";
          rSerPar2.MODIFY;
        UNTIL rSerPar.NEXT = 0;
      END;

      rHist.RESET;
      rHist.SETRANGE("Tipo Fichero", rHist."Tipo Fichero"::Parte);
      rHist.SETRANGE("N§"          , wAntParte);
      IF rHist.FINDSET(TRUE) THEN BEGIN
        REPEAT
          rHist2 := rHist;
          rHist2."N§" := rParte2."N§ Parte";
          IF NOT rHist2.GET(rHist2."Tipo Fichero", rHist2."N§", rHist2."N§ Linea", rHist2.Orden) THEN
            rHist2.INSERT;

          rHist3 := rHist;
          rHist3.DELETE;
        UNTIL rHist.NEXT = 0;
      END;

      rHist.RESET;
      rHist.SETFILTER("Tipo Fichero", '%1|%2', rHist."Tipo Fichero"::Servicio, rHist."Tipo Fichero"::Linea);
      rHist.SETRANGE (NoParte       , wAntParte);
      IF rHist.FINDSET(TRUE) THEN BEGIN
        REPEAT
          rHist2 := rHist;
          rHist2.NoParte := rParte2."N§ Parte";
          rHist2.MODIFY;

        UNTIL rHist.NEXT = 0;
      END;

      rTOParte.RESET;
      rTOParte.SETRANGE("N§ Parte", wAntParte);
      IF rTOParte.FINDSET(TRUE) THEN BEGIN
        REPEAT
          rTOParte2 := rTOParte;
          rTOParte2."N§ Parte" := rParte2."N§ Parte";
          rTOParte2.INSERT;

          rTOParte3 := rTOParte;
          rTOParte3.DELETE;
        UNTIL rTOParte.NEXT = 0;
      END;

      rExtParte.RESET;
      rExtParte.SETRANGE("N§ Parte", wAntParte);
      IF rExtParte.FINDSET(TRUE) THEN BEGIN
        REPEAT
          rExtParte2 := rExtParte;
          rExtParte2."N§ Parte" := rParte2."N§ Parte";
          rExtParte2.INSERT;

          rExtParte3 := rExtParte;
          rExtParte3.DELETE;
        UNTIL rExtParte.NEXT = 0;
      END;

      rMargen.RESET;
      rMargen.SETRANGE("N§ Parte", wAntParte);
      IF rMargen.FINDSET(TRUE) THEN BEGIN
        REPEAT
          rMargen2 := rMargen;
          rMargen2."N§ Parte" := rParte2."N§ Parte";
          rMargen2.INSERT;

          rMargen3 := rMargen;
          rMargen3.DELETE;
        UNTIL rMargen.NEXT = 0;
      END;

      rError.RESET;
      rError.SETRANGE("N§ Parte", wAntParte);
      IF rError.FINDSET(TRUE) THEN BEGIN
        REPEAT
          rError2 := rError;
          rError2."N§ Parte" := rParte2."N§ Parte";
          rError2.INSERT;

          rError3 := rError;
          rError3.DELETE;
        UNTIL rError.NEXT = 0;
      END;

      rZonPre.RESET;
      rZonPre.SETRANGE("N§ Parte", wAntParte);
      IF rZonPre.FINDSET(TRUE) THEN BEGIN
        REPEAT
          rZonPre2 := rZonPre;
          rZonPre2."N§ Parte" := rParte2."N§ Parte";
          rZonPre2.INSERT;

          rZonPre3 := rZonPre;
          rZonPre3.DELETE;
        UNTIL rZonPre.NEXT = 0;
      END;

      rZonPar.RESET;
      rZonPar.SETRANGE("N§ Parte", wAntParte);
      IF rZonPar.FINDSET(TRUE) THEN BEGIN
        REPEAT
          rZonPar2 := rZonPar;
          rZonPar2."N§ Parte" := rParte2."N§ Parte";
          rZonPar2.INSERT;

          rZonPar3 := rZonPar;
          rZonPar3.DELETE;
        UNTIL rZonPar.NEXT = 0;
      END;

      rElemPto.RESET;
      rElemPto.SETRANGE("N§ Parte", wAntParte);
      IF rElemPto.FINDSET(TRUE) THEN BEGIN
        REPEAT
          rElemPto2 := rElemPto;
          rElemPto2."N§ Parte" := rParte2."N§ Parte";
          rElemPto2.MODIFY;
        UNTIL rElemPto.NEXT = 0;
      END;

      rParte.DELETE;

      MESSAGE(Text128, wAntParte, rParte2."N§ Parte");
    END;

    PROCEDURE elimina_historico_partes@10();
    VAR
      lrHist@1100244000 : Record 7010361;
    BEGIN
      // elimina_historico_partes
      //
      IF NOT CONFIRM(Text0001) THEN
        EXIT;

      lrHist.RESET;
      lrHist.SETFILTER(Fecha, '<%1', DMY2DATE(1, 1, 2003));
      IF lrHist.FINDSET(TRUE) THEN BEGIN
        crea_ventana(Text129);
        wTotal := lrHist.COUNT;
        REPEAT
          actualiza_ventana;

          IF (wActual MOD 1000) = 0 THEN
            COMMIT;

          lrHist.DELETE;
        UNTIL lrHist.NEXT = 0;
      END;
    END;

    PROCEDURE crea_ventana@11(pwTexto@1100244000 : Text[200]);
    BEGIN
      // crea_ventana
      //
      wVentana.OPEN(pwTexto + '\' +
                    '\' +
                    '@1@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@');
      wActual := 0;
    END;

    PROCEDURE actualiza_ventana@13();
    BEGIN
      // actualiza_ventana
      //
      wActual += 1;
      wVentana.UPDATE(1, ROUND(wActual / wTotal * 10000, 1));
    END;

    PROCEDURE partes_sin_recogidas@12();
    VAR
      lrParte@1100244000 : Record 7010360;
      lrParte2@1100244001 : Record 7010360;
      lrParSer@1100244002 : Record 7010359;
      lwFecha@1100244003 : Date;
    BEGIN
      // partes_sin_recogidas
      //

      lwFecha := CALCDATE(Text130, TODAY);

      lrParSer.RESET;
      lrParSer.SETCURRENTKEY("N§ Parte");

      lrParte.RESET;
      lrParte.SETCURRENTKEY(Confirmado,
                            Fecha);
      lrParte.SETRANGE(Confirmado, FALSE);
      lrParte.SETRANGE(Fecha     , lwFecha, TODAY);
      IF lrParte.FINDSET(TRUE) THEN BEGIN
        crea_ventana(Text131);
        wTotal := lrParte.COUNT;
        REPEAT
          actualiza_ventana;

          lrParSer.SETRANGE("N§ Parte", lrParte."N§ Parte");
          IF NOT lrParSer.FINDFIRST THEN BEGIN
            IF CONFIRM(Text132, FALSE, lrParte."N§ Parte") THEN BEGIN
              lrParte2 := lrParte;
              lrParte2.DELETE;
            END;
          END;
        UNTIL lrParte.NEXT = 0;
      END;
    END;

    PROCEDURE crea_series_proveedores@14();
    VAR
      lrNumSer@1100244000 : Record 308;
      lrProv@1100244001 : Record 23;
      lrContCmp@1100244002 : Record 7010408;
    BEGIN
      // crea_series_proveedores
      //
      IF NOT CONFIRM(Text133) THEN
        EXIT;

      lrContCmp.SETCURRENTKEY(Proveedor);

      lrProv.RESET;
      IF lrProv.FINDSET THEN BEGIN
        REPEAT
          IF NOT lrNumSer.GET(Text134 + COPYSTR(lrProv."No.", 1, 18)) THEN BEGIN
            lrNumSer.RESET;
            lrNumSer.Code                := Text134 + COPYSTR(lrProv."No.", 1, 18);
            lrNumSer.Description           := Text135 + lrProv."Search Name";
            lrNumSer."Default Nos." := TRUE;
            lrNumSer."Date Order" := TRUE;
            lrNumSer.INSERT;

            lrContCmp.SETRANGE(Proveedor, lrProv."No.");
            IF lrContCmp.FINDFIRST THEN
              lrContCmp.MODIFYALL("Cod. Serie", lrNumSer.Code);
          END;
        UNTIL lrProv.NEXT = 0;
      END;

      MESSAGE(Text136);
    END;

    PROCEDURE BorraRegistroDiarioVeh307@15();
    VAR
      lrRegDia@1100244000 : Record 7035342;
    BEGIN
      // BorraRegistroDiarioVeh307
      // Borra las linea de registro diario del vehiculo 307

      lrRegDia.RESET;
      lrRegDia.SETRANGE(Vehiculo,'307');
      lrRegDia.SETFILTER(Dia , '<=30/04/03');
      IF lrRegDia.FINDFIRST THEN
        lrRegDia.DELETEALL;
      MESSAGE(Text0002);
    END;

    PROCEDURE rellena_serviciopropio_CI@16();
    VAR
      lrParte@1100244000 : Record 7010360;
      lrCI@1100244001 : Record 7010414;
      lrZonPre@1100244002 : Record 7010364;
    BEGIN
      // rellenar_serviciopropio_CI
      //
      lrParte.RESET;
      lrParte.SETCURRENTKEY(Vehiculo,
                            Fecha,
                            Confirmado,
                            Proveedor);
      lrParte.SETRANGE (Confirmado, TRUE);
      lrParte.SETFILTER(Proveedor , '=%1', '');
      IF lrParte.FINDSET THEN BEGIN
        crea_ventana(Text131);
        wTotal := lrParte.COUNT;
        REPEAT
          actualiza_ventana;

          lrCI.SETRANGE("N§ Parte", lrParte."N§ Parte");
          IF lrCI.FINDFIRST THEN
            lrCI.MODIFYALL("Servicio propio", TRUE);

          lrZonPre.SETRANGE("N§ Parte", lrParte."N§ Parte");
          IF lrZonPre.FINDFIRST THEN
            lrZonPre.MODIFYALL("Servicio propio", TRUE);
        UNTIL lrParte.NEXT = 0;
      END;
    END;

    PROCEDURE renumera_facturaCompra@17();
    VAR
      lwVentana@1100244000 : Dialog;
      lwNumFra@1100244001 : Code[20];
      lrPref@1100244002 : Record 7035348;
      lrPref2@1100244003 : Record 7035348;
      lrLinPref@1100244004 : Record 7035349;
      lrLinPref2@1100244005 : Record 7035349;
      lrLinPref3@1100244006 : Record 7035349;
      lrSupPref@1100244007 : Record 7035351;
      lrSupPref2@1100244008 : Record 7035351;
      lrSupPref3@1100244009 : Record 7035351;
      lrZonPref@1100244010 : Record 7035350;
      lrZonPref2@1100244011 : Record 7035350;
      lrZonPref3@1100244012 : Record 7035350;
      lrCI@1100244013 : Record 7010414;
      lrContCmp@1100244014 : Record 7010408;
      GestNoSerie@1100244015 : Codeunit 396;
    BEGIN
      // renumera_facturaCompra
      //

      ERROR(Text50024);

      lwVentana.OPEN(Text137);
      lwVentana.INPUT(1, lwNumFra);
      lwVentana.CLOSE;

      IF lwNumFra = '' THEN
        EXIT;

      IF NOT lrPref.GET(lwNumFra) THEN
        EXIT;

      IF NOT CONFIRM(Text138, FALSE, lwNumFra) THEN
        EXIT;

      IF NOT lrContCmp.GET(lrPref.Garaje, lrPref."Num contrato compra") THEN
        EXIT;

      lrPref2 := lrPref;
      lrPref2."Num prefactura" := GestNoSerie.GetNextNo(lrContCmp."Cod. Serie", lrPref."Fecha Registro factura", TRUE);
      lrPref2.INSERT;

      lrLinPref.RESET;
      lrLinPref.SETRANGE("Num prefactura", lrPref."Num prefactura");
      IF lrLinPref.FINDSET(TRUE) THEN BEGIN
        REPEAT
          lrLinPref2 := lrLinPref;
          lrLinPref2."Num prefactura" := lrPref2."Num prefactura";
          lrLinPref2.INSERT;

          lrLinPref3 := lrLinPref;
          lrLinPref3.DELETE;
        UNTIL lrLinPref.NEXT = 0;
      END;

      lrSupPref.RESET;
      lrSupPref.SETRANGE("Num Prefactura", lrPref."Num prefactura");
      IF lrSupPref.FINDSET(TRUE) THEN BEGIN
        REPEAT
          lrSupPref2 := lrSupPref;
          lrSupPref2."Num Prefactura" := lrPref2."Num prefactura";
          lrSupPref2.INSERT;

          lrSupPref3 := lrSupPref;
          lrSupPref3.DELETE;
        UNTIL lrSupPref.NEXT = 0;
      END;

      lrZonPref.RESET;
      lrZonPref.SETRANGE("Num prefactura", lrPref."Num prefactura");
      IF lrZonPref.FINDSET(TRUE) THEN BEGIN
        REPEAT
          lrZonPref2 := lrZonPref;
          lrZonPref2."Num prefactura" := lrPref2."Num prefactura";
          lrZonPref2.INSERT;

          lrZonPref3 := lrZonPref;
          lrZonPref3.DELETE;
        UNTIL lrZonPref.NEXT = 0;
      END;

      lrCI.RESET;
      lrCI.SETCURRENTKEY("N§ Factura",
                         Concepto);
      lrCI.SETRANGE("N§ Factura", lrPref."Num prefactura");
      lrCI.SETRANGE(Concepto    , lrCI.Concepto::Coste);
      IF lrCI.FINDFIRST THEN
        lrCI.MODIFYALL("N§ Factura", lrPref2."Num prefactura");

      lrPref.DELETE;

      MESSAGE(Text139);
    END;

    PROCEDURE RellenaDiasEnConTCond@18();
    VAR
      lrCont@1100244000 : Record 7010331;
    BEGIN
      // RellenaDiasEnConTCond
      // SE han creado en contratos conductores un campo booleano por d¡a de la semana para
      // indicar en que d¡as tiene validez dicho contrato.
      // Esta macro rellena a True Dichos campos en los registros ya creados


      lrCont.RESET;
      IF lrCont.FINDSET(TRUE) THEN BEGIN
        REPEAT
          lrCont.Lunes     := TRUE;
          lrCont.Martes    := TRUE;
          lrCont.Miercoles := TRUE;
          lrCont.Jueves    := TRUE;
          lrCont.Viernes   := TRUE;
          lrCont.Sabado    := TRUE;
          lrCont.Domingo   := TRUE;
          lrCont.MODIFY;
        UNTIL lrCont.NEXT=0;
      END;
    END;

    PROCEDURE borra_historico_anterior@19();
    VAR
      lrHist@1100244000 : Record 7010361;
      lrHist2@1100244001 : Record 7010361;
      lrSer@1100244002 : Record 7010358;
      lrParte@1100244003 : Record 7010360;
      w_fecha@1100244004 : Date;
    BEGIN
      // borra_historico_anterior
      //
      w_fecha := CALCDATE(Text50025, TODAY);

      lrHist.RESET;

      lrSer.RESET;
      lrSer.SETCURRENTKEY(Fecha);
      lrSer.SETFILTER(Fecha, '<=%1', w_fecha);
      IF lrSer.FINDSET THEN BEGIN
        crea_ventana(Text141);
        wTotal  := lrSer.COUNTAPPROX;
        REPEAT
          actualiza_ventana;

          lrHist.SETFILTER("Tipo Fichero", '%1|%2', lrHist."Tipo Fichero"::Servicio, lrHist."Tipo Fichero"::Linea);
          lrHist.SETRANGE ("N§"          , lrSer."N§ Servicio");
          IF lrHist.FINDFIRST THEN
            lrHist.DELETEALL;

        UNTIL lrSer.NEXT = 0;
        wVentana.CLOSE;
      END;

      lrHist.RESET;

      lrParte.RESET;
      lrParte.SETCURRENTKEY(Fecha);
      lrParte.SETFILTER(Fecha, '<=%1', w_fecha);
      IF lrParte.FINDSET THEN BEGIN
        crea_ventana(Text142);
        wTotal  := lrParte.COUNTAPPROX;
        REPEAT
          actualiza_ventana;

          lrHist.SETRANGE("Tipo Fichero", lrHist."Tipo Fichero"::Parte);
          lrHist.SETRANGE("N§"          , lrParte."N§ Parte");
          IF lrHist.FINDFIRST THEN
            lrHist.DELETEALL;

        UNTIL lrParte.NEXT = 0;
        wVentana.CLOSE;
      END;

      // ----  Borramos aquellas lineas de historico que no tienen un parte asociado, es decir se han quedado colgadas  ----
      // ----  despues de borrar el parte o el servicio                                                                 ----

      lrHist.RESET;
      lrHist.SETFILTER(Fecha, '<=%1', w_fecha);
      IF lrHist.FINDSET(TRUE) THEN BEGIN
        crea_ventana(Text143);
        wTotal := lrHist.COUNTAPPROX;
        REPEAT
          actualiza_ventana;

          lrHist2 := lrHist;
          lrHist2.DELETE;
        UNTIL lrHist.NEXT = 0;
      END;
    END;

    PROCEDURE PurgaInterfaseUEX@20();
    VAR
      lrCab@1100244000 : Record 7035333;
      lrCab2@1100244001 : Record 7035333;
      lrVeh@1100244002 : Record 7035324;
      lrVuelo@1100244003 : Record 7035325;
      lrVehHot@1100244004 : Record 7035327;
      lrVehVue@1100244005 : Record 7035328;
      lwFecha@1100244006 : Date;
    BEGIN
      // PurgaInterfaseUEX
      //
      lwFecha := CALCDATE(Text140, TODAY);

      lrCab.RESET;
      lrCab.SETFILTER(Fecha, '<=%1', lwFecha);
      IF lrCab.FINDSET(TRUE) THEN BEGIN
        crea_ventana(Text144);
        wTotal := lrCab.COUNTAPPROX;
        REPEAT
          actualiza_ventana;

          lrVeh.SETRANGE("N§ Fichero", lrCab."No Importacion");
          IF lrVeh.FINDFIRST THEN
            lrVeh.DELETEALL;

          lrVuelo.SETRANGE("N§Archivo", lrCab."No Importacion");
          IF lrVuelo.FINDFIRST THEN
            lrVuelo.DELETEALL;

          lrVehHot.SETRANGE("N§Fichero", lrCab."No Importacion");
          IF lrVehHot.FINDFIRST THEN
            lrVehHot.DELETEALL;

          lrVehVue.SETRANGE("N§Fichero", lrCab."No Importacion");
          IF lrVehVue.FINDFIRST THEN
            lrVehVue.DELETEALL;

          lrCab2 := lrCab;
          lrCab2.DELETE;
        UNTIL lrCab.NEXT = 0;
      END;
    END;

    PROCEDURE PurgaMensajesError@21();
    VAR
      lrError@1100244000 : Record 7010413;
      lrError2@1100244001 : Record 7010413;
      lwFecha@1100244002 : Date;
    BEGIN
      // PurgaMensajesError
      //
      lwFecha := CALCDATE(Text140, TODAY);


      lrError.RESET;
      lrError.SETCURRENTKEY(Fecha);
      lrError.SETFILTER(Fecha, '<%1', lwFecha);
      IF lrError.FINDSET(TRUE) THEN BEGIN
        crea_ventana(Text145);
        wTotal := lrError.COUNTAPPROX;
        REPEAT
          actualiza_ventana;

          lrError2 := lrError;
          lrError2.DELETE;
        UNTIL lrError.NEXT = 0;
      END;
    END;

    PROCEDURE MarcarAutofacturasTraspasado@22();
    VAR
      lrCab@1100244000 : Record 36;
    BEGIN
      // MarcarAutofacturasTraspasado
      // La funci¢n de esta macro es traspasar todas las cabeceras de factura de venta que provienan de Autofacturas con el
      // Campo "Traspasado" a TRUE. Esto servir  a posteriori para no exportarla en la funci¢nes de exportaci¢n a Oracle
      // Nos servimos que dichas facturas comienzan por "ULMA"


      lrCab.RESET;
      lrCab.SETFILTER("No.",Text146);
      IF lrCab.FINDFIRST THEN
        lrCab.MODIFYALL(Traspasado,TRUE);
    END;

    PROCEDURE MarcarFacturasExportadas@23();
    VAR
      lrCabVent@1100244000 : Record 36;
    BEGIN
      // MarcarFacturasExportadas

      // Marcamos las todas hasta la fecha con el numero de traspaso -1

      lrCabVent.RESET;
      lrCabVent.SETFILTER("Posting Date",'<=31/12/03');
      lrCabVent.SETRANGE("Num Traspaso",0);
      IF lrCabVent.FINDFIRST THEN BEGIN
        lrCabVent.MODIFYALL("Num Traspaso",-1);
      END;
    END;

    PROCEDURE MarcarFacturasExportadas2@24();
    VAR
      lrCabVent@1100244000 : Record 36;
    BEGIN
      // MarcarFacturasExportadas2

      // Marcamos las todas hasta la fecha con el numero de traspaso -1
      // Las remarcamos a partir de la fecha de hoy

      lrCabVent.RESET;
      lrCabVent.SETFILTER("Posting Date",'<=16/01/04');
      lrCabVent.SETRANGE("Num Traspaso",0);
      IF lrCabVent.FINDFIRST THEN BEGIN
        lrCabVent.MODIFYALL("Num Traspaso",-1);
      END;
    END;

    PROCEDURE RellenaNuevosCamposCI@1100244000();
    VAR
      lrCI@1100244000 : Record 7010414;
      lrParte@1100244001 : Record 7010360;
      lwTotal@1100244002 : Integer;
      lwCont@1100244003 : Integer;
    BEGIN
      // RellenaNuevosCamposCI
      // Rellena los nuevos campos Paxes Servicio y Referencia dentro Coste-Ingreso

      lrCI.RESET;
      lrParte.RESET;
      IF lrCI.FINDSET(TRUE) THEN BEGIN
        lwTotal:= lrCI.COUNTAPPROX;
        CLEAR(lwCont);
        wVentana.OPEN('@1@@@@@@@@@@');
        REPEAT
          IF lrParte.GET(lrCI."N§ Parte") THEN BEGIN
            lrParte.CALCFIELDS("Adultos transportados","Ni¤os transportados");
            lrCI."Paxes Servicio" := lrParte."Adultos transportados" + lrParte."Ni¤os transportados";
            lrCI.Referencia := lrParte.Referencia;
            lrCI.MODIFY;
            lwCont +=1;
            wVentana.UPDATE(1,ROUND(lwCont/lwTotal*10000,1));
          END;
        UNTIL lrCI.NEXT=0;
        wVentana.CLOSE;
      END;
    END;

    PROCEDURE RellenaOrdenSubordinado@1100244001();
    VAR
      lrPre1@1100244000 : Record 7010405;
      lrPre2@1100244001 : Record 7010405;
      lwCont@1100244002 : Integer;
      lwTotal@1100244003 : Integer;
    BEGIN
      // RellenaOrdenSubordinado
      // Rellena el nuevo campo introducido en las lineas de contratos de compra para los precios x elemento
      // Ya que se producian borrados accidentales



      lrPre1.RESET;
      lrPre1.SETCURRENTKEY(Garaje,
                         "N§ Contrato",
                         "Tipo precio",
                         "Codigo servicio",
                         "Zona desde",
                         "Zona hasta",
                         "Fecha desde",
                         "Fecha hasta",
                         "Tipo Vehiculo",
                         "Rango desde",
                         "Rango hasta");

      lrPre2.COPY(lrPre1);

      lrPre1.SETFILTER("Tipo elemento"  , '<>%1', '');
      lrPre1.SETRANGE("Tipo precio"     , lrPre1."Tipo precio"::"Precio Base");
      lrPre1.SETRANGE("Tipo aplicacion" , lrPre1."Tipo aplicacion"::Pax);
      lrPre1.SETFILTER("Tipo elemento"  , '%1', '');
      IF lrPre1.FINDSET THEN BEGIN
        lwTotal:= lrPre1.COUNTAPPROX;
        CLEAR(lwCont);
        wVentana.OPEN('@1@@@@@@@@@');
        REPEAT
          lrPre2.SETRANGE (Garaje            , lrPre1.Garaje);
          lrPre2.SETRANGE ("N§ Contrato"     , lrPre1."N§ Contrato");
          lrPre2.SETRANGE ("Tipo precio"     , lrPre1."Tipo precio");
          lrPre2.SETFILTER ("Codigo servicio", '%1', lrPre1."Codigo servicio");
          lrPre2.SETFILTER ("Zona desde"     , '%1', lrPre1."Zona desde");
          lrPre2.SETFILTER ("Zona hasta"     , '%1', lrPre1."Zona hasta");
          lrPre2.SETFILTER ("Fecha desde"    , '%1', lrPre1."Fecha desde");
          lrPre2.SETFILTER ("Fecha hasta"    , '%1', lrPre1."Fecha hasta");
          lrPre2.SETFILTER ("Tipo Vehiculo"  , '%1', lrPre1."Tipo Vehiculo");
          lrPre2.SETFILTER ("Rango desde"    , '%1', lrPre1."Rango desde");
          lrPre2.SETFILTER ("Rango hasta"    , '%1', lrPre1."Rango hasta");
          lrPre2.SETFILTER("Tipo elemento"  , '<>%1', '');
          IF lrPre2.FINDFIRST THEN
            lrPre2.MODIFYALL("Orden Subordinado", lrPre1.Orden);
          lwCont +=1;
          wVentana.UPDATE(1,ROUND(lwCont/lwTotal*10000,1));
        UNTIL lrPre1.NEXT=0;
        wVentana.CLOSE;
      END;
    END;

    PROCEDURE BorraFacturaVenta@1100244002();
    VAR
      lwNumFra@1100244004 : Code[20];
      lrCabVenta@1100244003 : Record 36;
      lrLinVenta@1100244002 : Record 37;
      rCI@1100244001 : Record 7010414;
      rPref@1100244000 : Record 7010415;
    BEGIN
      // BorraFacturaVenta
      //

      ERROR(Text50024);

      lwNumFra := Text50026;

      IF NOT CONFIRM(Text50027, FALSE, lwNumFra) THEN
        EXIT;

      IF lrCabVenta.GET(lrCabVenta."Document Type"::Invoice, lwNumFra) THEN BEGIN
        lrLinVenta.SETRANGE("Document Type", lrCabVenta."Document Type");
        lrLinVenta.SETRANGE("Document No."  , lrCabVenta."No.");
        IF lrLinVenta.FINDFIRST THEN
          lrLinVenta.DELETEALL;

        rCI.RESET;
        rCI.SETCURRENTKEY("N§ Factura");
        rCI.SETRANGE("N§ Factura", lrCabVenta."No.");
        IF rCI.FINDFIRST THEN BEGIN
          rCI.MODIFYALL("N§ Prefactura", '');
          rCI.MODIFYALL("N§ Factura"   , '');
        END;

        rPref.RESET;
        rPref.SETRANGE("N§ Factura", lrCabVenta."No.");
        IF rPref.FINDFIRST THEN BEGIN
          rPref.Desactivada           := TRUE;
          rPref."Fecha Desactivada"   := TODAY;
          rPref."Hora Desactivada"    := TIME;
          rPref."Usuario Desactivada" := USERID;
          rPref.MODIFY;
        END;

        lrCabVenta.DELETE;
      END
      ELSE
        ERROR(Text50028);
    END;

    PROCEDURE CambiarCtaVta@1100244003();
    VAR
      lrCab@1100244001 : Record 36;
      lrLin@1100244000 : Record 37;
      lrCli@1100244002 : Record 18;
      lrGrupContCli@1100244003 : Record 92;
      lwTotal@1100244004 : Integer;
      lwCont@1100244005 : Integer;
    BEGIN
      // CambiarCtaVta

      IF NOT CONFIRM(Text50029) THEN
        ERROR(Text157);

      lrCab.RESET;
      IF lrCab.FINDSET THEN BEGIN
        wVentana.OPEN(Text50030);
        lwTotal := lrCab.COUNTAPPROX;
        CLEAR(lwCont);
        REPEAT
          IF lrCli.GET(lrCab."Sell-to Customer No.") THEN BEGIN
            IF lrGrupContCli.GET(lrCli."Customer Posting Group") THEN BEGIN
              lrGrupContCli.TESTFIELD("Service Charge Acc.");
              lrLin.RESET;
              lrLin.SETRANGE("Document Type", lrCab."Document Type");
              lrLin.SETRANGE("Document No." , lrCab."No.");
              lrLin.SETRANGE(Type , lrLin.Type::"G/L Account");
              IF lrLin.FINDSET(TRUE) THEN
                REPEAT
                  lrLin."No.":= lrGrupContCli."Service Charge Acc.";
                  lrLin.MODIFY;
                UNTIL lrLin.NEXT=0;
              lwCont +=1;
              wVentana.UPDATE(1,ROUND(lwCont/lwTotal*10000,1));
            END;
          END;
        UNTIL lrCab.NEXT=0;
        wVentana.CLOSE;
      END;
    END;

    PROCEDURE BorraFact@1100244011();
    VAR
      lrPref@1100244000 : Record 7010415;
      lrLinPref@1100244004 : Record 7010417;
      lrCab@1100244001 : Record 36;
      lrLin@1100244002 : Record 37;
      lwNoFact@1100244003 : Code[10];
      DimMgt@1100244005 : Codeunit 408;
      lwTotal@1100244007 : Integer;
      lwCont@1100244006 : Integer;
    BEGIN
      // BorraFact
      // Borramos todas las facturas y prefacturas con una numeracion igual o inferior a lwNoFact

      lwNoFact:=Text50031;


      IF NOT CONFIRM(Text50032,FALSE,lwNoFact) THEN
        ERROR(Text157);

      lrPref.RESET;
      lrPref.SETCURRENTKEY("N§ Factura","Tipo Documento");
      lrPref.SETFILTER("N§ Factura",'<=%1',lwNoFact);
      IF lrPref.FINDLAST THEN BEGIN
        wVentana.OPEN(Text50033);
        lwTotal := lrPref.COUNTAPPROX;
        CLEAR(lwCont);
        REPEAT
          lrLinPref.SETRANGE("N§ Prefactura", lrPref."N§ Prefactura");
          IF lrLinPref.FINDFIRST THEN
            lrLinPref.DELETEALL(TRUE);
          lrPref.DELETE;
          lwCont +=1;
          wVentana.UPDATE(1,ROUND(lwCont/lwTotal*10000,1));
        UNTIL lrPref.NEXT(-1)=0;
        wVentana.CLOSE;
      END;

      lrCab.RESET;
      lrCab.SETRANGE("Document Type", lrCab."Document Type"::Invoice);
      lrCab.SETFILTER("No." ,'<=%1', lwNoFact);
      IF lrCab.FINDLAST THEN BEGIN
        wVentana.OPEN(Text50034);
        lwTotal := lrCab.COUNTAPPROX;
        CLEAR(lwCont);
        REPEAT
          lrLin.SETRANGE("Document Type" , lrCab."Document Type");
          lrLin.SETRANGE("Document No."  , lrCab."No.");
          IF lrLin.FINDLAST THEN BEGIN
            REPEAT
              DimMgt.DeleteDocDim(DATABASE::"Sales Line",lrLin."Document Type",lrLin."Document No.",lrLin."Line No.");
              lrLin.DELETE;
            UNTIL lrLin.NEXT(-1)=0;
          END;
          DimMgt.DeleteDocDim(DATABASE::"Sales Header",lrCab."Document Type",lrCab."No.",0);
          lrCab.DELETE;
          lwCont +=1;
          wVentana.UPDATE(1,ROUND(lwCont/lwTotal*10000,1));
        UNTIL lrCab.NEXT(-1)=0;
        wVentana.CLOSE;
      END;

      MESSAGE(Text0002);
    END;

    PROCEDURE RellenaFechaFactTTOOxParte@1100244004();
    VAR
      lrTTOOParte@1100244000 : Record 7010365;
      lrCab@1100244001 : Record 36;
      lwCont@1100244002 : Integer;
      lwTotal@1100244003 : Integer;
    BEGIN
      // RellenaFechaFactTTOOxParte

      IF NOT CONFIRM(Text50035,FALSE) THEN
        EXIT;


      lrTTOOParte.RESET;
      lrCab.RESET;
      lrTTOOParte.SETCURRENTKEY("N§ Factura");
      lrTTOOParte.SETFILTER("N§ Factura",'<>%1','');
      IF lrTTOOParte.FINDSET(TRUE) THEN BEGIN
        lwTotal := lrTTOOParte.COUNTAPPROX;
        wVentana.OPEN('@1@@@@@@@@');
        CLEAR(lwCont);
        REPEAT
          lrCab.SETRANGE("No.",lrTTOOParte."N§ Factura");
          IF lrCab.FINDFIRST THEN BEGIN
            lrTTOOParte.VALIDATE("Fecha Registro Factura", lrCab."Posting Date");
            lrTTOOParte.MODIFY;
          END;
          lwCont +=1;
          wVentana.UPDATE(1,ROUND(lwCont/lwTotal*10000,1));
        UNTIL lrTTOOParte.NEXT=0;
        wVentana.CLOSE;
      END;
    END;

    PROCEDURE RecalculaPaxesFacturados@1100244005();
    VAR
      lrCI@1100244000 : Record 7010414;
      lrVeh@1100244001 : Record 7010346;
    BEGIN
      // RecalculaPaxesFacturados
      //
      lrCI.RESET;
      lrCI.SETCURRENTKEY(Vehiculo,
                         Fecha,
                         "Tipo linea",
                         "Tipo elemento",
                         "Tipo servicio",
                         "Codigo servicio",
                         Garaje);
      lrCI.SETRANGE("Tipo linea"   , lrCI."Tipo linea"::Base);
      lrCI.SETRANGE("Tipo elemento", Text50036);
      IF lrCI.FINDSET(TRUE) THEN BEGIN
        crea_ventana(Text161);

        wTotal := lrCI.COUNT;
        REPEAT
          actualiza_ventana;

          IF lrVeh.GET(lrCI.Vehiculo) THEN BEGIN
            IF lrVeh.Plazas < lrCI."Pax Facturados" THEN BEGIN
              lrCI."Pax Facturados" := lrVeh.Plazas;
              lrCI.MODIFY;
            END;
          END;
        UNTIL lrCI.NEXT = 0;
        wVentana.CLOSE;
      END;
    END;

    PROCEDURE EliminarIOP@1100244006();
    VAR
      lrServ@1100244000 : Record 7010358;
      lrParte2@1103350000 : Record 7010360;
      lrParte@1100244001 : Record 7010360;
      lrServPar@1100244002 : Record 7010359;
      lrZonaFisica@1100244003 : Record 7010366;
      lrZonaPrecio@1100244004 : Record 7010364;
      lrExtra@1100244005 : Record 7010362;
      lrElemPto@1100244006 : Record 7010363;
      lrHistServ@1100244007 : Record 7010361;
      lrMargen@1100244008 : Record 7010412;
      lrError@1100244009 : Record 7010413;
      lrTTOOxParte@1100244010 : Record 7010365;
      lrCI@1100244011 : Record 7010414;
      lrCond@1100244014 : Record 7010420;
      lrVuelo@1100244016 : Record 7035335;
      lfCond@1100244015 : Form 7010457;
      vFechaDesde@1100244012 : Date;
      vFechaHasta@1100244013 : Date;
    BEGIN
      //BRM 03/06/04 Proceso borrado Informaci¢n Operativa

      // AJF 07/01/09
      // Evito borrar el registro, ya que ahora tiene datos permanentes.
      IF lrCond.GET(USERID) THEN
        lrCond.LimpiaRegistro
      ELSE BEGIN
        lrCond.INIT;
        lrCond.Usuario := USERID;
        lrCond.INSERT;
      END;

      COMMIT;
      lrCond.SETRECFILTER;

      CLEAR(lfCond);
      lfCond.SETTABLEVIEW(lrCond);
      lfCond.SETRECORD(lrCond);
      IF lfCond.RUNMODAL=ACTION::OK THEN BEGIN
        lfCond.GETRECORD(lrCond);

        //BRM 03/06/04 Comprobaciones per¡odo fechas
        IF (lrCond."Fecha desde"=0D) OR (lrCond."Fecha hasta"=0D) THEN
          ERROR(Text162);

        IF (lrCond."Fecha hasta" < lrCond."Fecha desde") THEN
          ERROR(Text163);

        vFechaDesde := lrCond."Fecha desde";
        vFechaHasta := lrCond."Fecha hasta";

        IF NOT CONFIRM(Text164,FALSE,vFechaDesde,vFechaHasta) THEN
          EXIT;

        wVentana.OPEN(Text50037 +
                      '\'                                 +
                      Text50038 +
                      Text50039);


        //BRM 03/06/04 Borramos servicios y tablas asociadas a servicios
        lrServ.RESET;
        lrServ.SETCURRENTKEY(Fecha);
        lrServ.SETRANGE(Fecha,vFechaDesde,vFechaHasta);
        IF lrServ.FINDSET(TRUE) THEN BEGIN
          wActual := 0;
          wTotal := lrServ.COUNTAPPROX;

          REPEAT

            wActual += 1;
            wVentana.UPDATE(1, ROUND(wActual / wTotal * 10000, 1));

            //Eliminamos registros de l¡neas Servicio - Parte asociados a cada servicio
            lrServPar.RESET;
            lrServPar.SETRANGE("N§ Servicio",lrServ."N§ Servicio");
            lrServPar.DELETEALL;

            //Eliminamos registros de Elementos x Punto asociados a cada servicio
            lrElemPto.RESET;
            lrElemPto.SETRANGE("N§ Servicio",lrServ."N§ Servicio");
            lrElemPto.DELETEALL;

            //Eliminamos registros Historico Servicio-Parte asociados a cada servicio
            lrHistServ.RESET;
            lrHistServ.SETFILTER("Tipo Fichero",'%1|%2',lrHistServ."Tipo Fichero"::Servicio,lrHistServ."Tipo Fichero"::Linea);
            lrHistServ.SETRANGE("N§",lrServ."N§ Servicio");
            lrHistServ.DELETEALL;

            lrServ.DELETE;
          UNTIL lrServ.NEXT=0;
        END;

        //BRM 03/06/04 Borramos partes y tablas asociadas a partes
        lrParte.RESET;
        lrParte.SETCURRENTKEY(Fecha);
        lrParte.SETRANGE(Fecha,vFechaDesde,vFechaHasta);
        IF lrParte.FINDSET(TRUE) THEN BEGIN

          wActual := 0;
          wTotal := lrParte.COUNTAPPROX;

          REPEAT
            wActual += 1;
            wVentana.UPDATE(2, ROUND(wActual / wTotal * 10000, 1));

            //Eliminamos registros de Zonas Fisicas asociados a cada Parte
            lrZonaFisica.RESET;
            lrZonaFisica.SETRANGE("N§ Parte",lrParte."N§ Parte");
            lrZonaFisica.DELETEALL;

            //Eliminamos registros de Zonas Precio asociados a cada Parte
            lrZonaPrecio.RESET;
            lrZonaPrecio.SETRANGE("N§ Parte",lrParte."N§ Parte");
            lrZonaPrecio.DELETEALL;

            //Eliminamos registros de Vuelos x Parte asociados a cada Parte
            lrVuelo.RESET;
            lrVuelo.SETRANGE("N§Parte",lrParte."N§ Parte");
            lrVuelo.DELETEALL;

            //Eliminamos registros de Extras asociados a cada Parte
            lrExtra.RESET;
            lrExtra.SETRANGE("N§ Parte",lrParte."N§ Parte");
            lrExtra.DELETEALL;

            //Eliminamos registros de Historico Servicio-Parte asociados a cada Parte
            lrHistServ.RESET;
            lrHistServ.SETRANGE("Tipo Fichero",lrHistServ."Tipo Fichero"::Parte);
            lrHistServ.SETRANGE("N§",lrParte."N§ Parte");
            lrHistServ.DELETEALL;

            //Eliminamos registros de Margen asociados a cada Parte
            lrMargen.RESET;
            lrMargen.SETRANGE("N§ Parte",lrParte."N§ Parte");
            lrMargen.DELETEALL;

            //Eliminamos registros de Error-Calculo asociados a cada Parte
            lrError.RESET;
            lrError.SETRANGE("N§ Parte",lrParte."N§ Parte");
            lrError.DELETEALL;

            //Eliminamos registros de TTOOxParte asociados a cada Parte
            lrTTOOxParte.RESET;
            lrTTOOxParte.SETRANGE("N§ Parte",lrParte."N§ Parte");
            lrTTOOxParte.DELETEALL;

            //Eliminamos registros de Coste-Ingreso asociados a cada Parte
            lrCI.RESET;
            lrCI.SETRANGE("N§ Parte",lrParte."N§ Parte");
            lrCI.DELETEALL;

            lrParte2 := lrParte;
            lrParte2.DELETE;

          UNTIL lrParte.NEXT=0;

        END;
        wVentana.CLOSE;

      END;
    END;

    PROCEDURE RellenaOrdenSubCompra@1100244007();
    VAR
      lrPre1@1100244000 : Record 7010409;
      lrPre2@1100244001 : Record 7010409;
      lwCont@1100244002 : Integer;
      lwTotal@1100244003 : Integer;
    BEGIN
      // RellenaOrdenSubordinado
      // Rellena el nuevo campo introducido en las lineas de contratos de compra para los precios x elemento
      // Ya que se producian borrados accidentales



      lrPre1.RESET;
      lrPre1.SETCURRENTKEY(Garaje,
                         "N§ Contrato",
                         "Tipo precio",
                         "Codigo servicio",
                         "Zona desde",
                         "Zona hasta",
                         "Fecha desde",
                         "Fecha hasta",
                         "Tipo Vehiculo",
                         "Rango desde",
                         "Rango hasta");

      lrPre2.COPY(lrPre1);

      lrPre1.SETFILTER("Tipo elemento"  , '<>%1', '');
      lrPre1.SETRANGE("Tipo precio"     , lrPre1."Tipo precio"::"Precio Base");
      lrPre1.SETRANGE("Tipo aplicacion" , lrPre1."Tipo aplicacion"::Pax);
      lrPre1.SETFILTER("Tipo elemento"  , '%1', '');
      IF lrPre1.FINDSET THEN BEGIN
        lwTotal:= lrPre1.COUNTAPPROX;
        CLEAR(lwCont);
        wVentana.OPEN('@1@@@@@@@@@');
        REPEAT
          lrPre2.SETRANGE (Garaje            , lrPre1.Garaje);
          lrPre2.SETRANGE ("N§ Contrato"     , lrPre1."N§ Contrato");
          lrPre2.SETRANGE ("Tipo precio"     , lrPre1."Tipo precio");
          lrPre2.SETFILTER ("Codigo servicio", '%1', lrPre1."Codigo servicio");
          lrPre2.SETFILTER ("Zona desde"     , '%1', lrPre1."Zona desde");
          lrPre2.SETFILTER ("Zona hasta"     , '%1', lrPre1."Zona hasta");
          lrPre2.SETFILTER ("Fecha desde"    , '%1', lrPre1."Fecha desde");
          lrPre2.SETFILTER ("Fecha hasta"    , '%1', lrPre1."Fecha hasta");
          lrPre2.SETFILTER ("Tipo Vehiculo"  , '%1', lrPre1."Tipo Vehiculo");
          lrPre2.SETFILTER ("Rango desde"    , '%1', lrPre1."Rango desde");
          lrPre2.SETFILTER ("Rango hasta"    , '%1', lrPre1."Rango hasta");
          lrPre2.SETFILTER("Tipo elemento"  , '<>%1', '');
          IF lrPre2.FINDFIRST THEN
            lrPre2.MODIFYALL("Orden Subordinado", lrPre1.Orden);
          lwCont +=1;
          wVentana.UPDATE(1,ROUND(lwCont/lwTotal*10000,1));
        UNTIL lrPre1.NEXT=0;
        wVentana.CLOSE;
      END;
    END;

    PROCEDURE RellenaHoraInicioDT@1100244008();
    VAR
      lrPartes@1100244000 : Record 7010360;
      lwTotal@1100244001 : Integer;
      lwCont@1100244002 : Integer;
    BEGIN
      // RellenaHoraInicioDT
      // Rellena el nuevo campo Hora Inicio DT en Partes
      // JPT 08/05/04

      lrPartes.RESET;
      IF lrPartes.FINDSET(TRUE) THEN BEGIN
        wVentana.OPEN(Text50040);
        lwTotal:= lrPartes.COUNTAPPROX;
        CLEAR(lwCont);
        REPEAT
          lrPartes.ActualizaHoraDT;
          lrPartes.MODIFY;
          lwCont+=1;
          wVentana.UPDATE(1,ROUND(lwCont/lwTotal*10000,1));
        UNTIL lrPartes.NEXT=0;
        wVentana.CLOSE;
      END;
    END;

    PROCEDURE RellenaTipoFijoCI@1100244009();
    VAR
      lrCI@1100244000 : Record 7010414;
      lwCont@1100244001 : Integer;
      lwTotal@1100244002 : Integer;
    BEGIN
      // RellenaTipoFijoCI
      // Rellena el nuevo campo Tipo servicio fijo en lineas de Coste-Ingreso

      lrCI.RESET;
      IF lrCI.FINDSET(TRUE) THEN BEGIN
        lwTotal:= lrCI.COUNT;
        CLEAR(lwCont);
        wVentana.OPEN('@1@@@@@@');
        REPEAT
          lrCI.VALIDATE("Tipo servicio");
          lrCI.MODIFY;
          lwCont+=1;
          wVentana.UPDATE(1,ROUND(lwCont/lwTotal*10000,1));
        UNTIL lrCI.NEXT=0;
        wVentana.CLOSE;
      END;
    END;

    PROCEDURE RellenarCodMotivo@1100244010();
    VAR
      lrHistIncCond@1100244000 : Record 7010333;
      lrConfInc@1100244001 : Record 7035345;
      lrIncDia@1100244002 : Record 7010342;
      lrRegDiaCierre@1100244003 : Record 7035344;
    BEGIN
      // BRM 17/06/04
      // Rellena Cod Motivo

      lrConfInc.RESET;
      IF lrConfInc.FINDSET THEN BEGIN

        wTotal:= lrConfInc.COUNT;
        CLEAR(wActual);
        wVentana.OPEN('@1@@@@@@');

        REPEAT

          lrHistIncCond.RESET;
          lrHistIncCond.SETRANGE(Motivo,lrConfInc."Motivo incidencia conductor");
          lrHistIncCond.MODIFYALL("Cod Motivo",lrConfInc.Codigo);

          lrHistIncCond.RESET;
          lrHistIncCond.SETRANGE(Motivo,lrConfInc."Motivo incidencia conductor");
          lrHistIncCond.MODIFYALL(Motivo,lrConfInc."Motivo incidencia conductor"::"  ");

          lrIncDia.RESET;
          lrIncDia.SETRANGE(Motivo,lrConfInc."Motivo incidencia conductor");
          lrIncDia.MODIFYALL("Cod Motivo",lrConfInc.Codigo);

          lrIncDia.RESET;
          lrIncDia.SETRANGE(Motivo,lrConfInc."Motivo incidencia conductor");
          lrIncDia.MODIFYALL(Motivo,lrConfInc."Motivo incidencia conductor"::"  ");

          lrRegDiaCierre.RESET;
          lrRegDiaCierre.SETRANGE(Estado,lrConfInc."Motivo incidencia conductor");
          lrRegDiaCierre.MODIFYALL("Cod motivo",lrConfInc.Codigo);

          lrRegDiaCierre.RESET;
          lrRegDiaCierre.SETRANGE(Estado,lrConfInc."Motivo incidencia conductor");
          lrRegDiaCierre.MODIFYALL(Estado,lrConfInc."Motivo incidencia conductor"::"  ");

          wActual +=1;
          wVentana.UPDATE(1,ROUND(wActual/wTotal*10000,1));

        UNTIL lrConfInc.NEXT=0;

        wVentana.CLOSE;

      END;
    END;

    PROCEDURE RellenaFechaFacturaCI@1100244012();
    VAR
      lrCI@1100244000 : Record 7010414;
      lrPrefac@1100244001 : Record 7010415;
    BEGIN
      // RellenaFechaFacturaCI
      //

      ERROR(Text50041);

      lrCI.RESET;
      lrCI.SETCURRENTKEY("N§ Factura");
      lrCI.SETRANGE (Concepto    , lrCI.Concepto::Ingreso);
      lrCI.SETFILTER("N§ Factura", '<>%1');
      IF lrCI.FINDSET(TRUE) THEN BEGIN
        crea_ventana(Text50042);

        wTotal := lrCI.COUNT;

        REPEAT
          actualiza_ventana;

          IF lrPrefac.GET(lrCI."N§ Prefactura") THEN BEGIN
            lrCI."Fecha registro factura" := lrPrefac."Fecha Registro factura";
            lrCI.MODIFY;
          END;
        UNTIL lrCI.NEXT = 0;
        wVentana.CLOSE;
      END;
    END;

    PROCEDURE LimpiarCamposObsoletos@1100244013();
    VAR
      lrSerPar@1100244000 : Record 7010359;
      lrPar@1100244001 : Record 7010360;
      lrZon@1100244002 : Record 7010314;
    BEGIN
      // LimpiarCamposObsoletos
      //
      // Inicializa una serie de campos que no se van a rellenar m s y al final va a ser eliminados

      IF NOT CONFIRM (Text50043) THEN
        EXIT;

      wVentana.OPEN(Text50044);

      // AJF 15/10/08
      // Campo borrado.
      //wVentana.UPDATE(1,Text50045);
      //lrSerPar.RESET;
      //IF lrSerPar.FIND('-') THEN
      //  lrSerPar.MODIFYALL(BorrarVacios,'');

      lrPar.RESET;
      IF lrPar.FINDFIRST THEN BEGIN
        wVentana.UPDATE(1,Text50046);
        // lrPar.MODIFYALL("Tipo Servicio UEX",0);
        wVentana.UPDATE(1,Text50047);
        // lrPar.MODIFYALL("Zona Abreviada",'');
      END;

      wVentana.UPDATE(1,Text50048);
      lrZon.RESET;
      {IF lrZon.FINDFIRST THEN
        lrZon.MODIFYALL("Zona Traslados UEX",'');}

      wVentana.CLOSE;
    END;

    PROCEDURE RepostajeVehiculo201@1103350000();
    VAR
      rRegDia@1103350000 : Record 7035342;
    BEGIN
      // RepostajeVehiculo201
      //
      rRegDia.SETCURRENTKEY(Vehiculo,
                            Dia,
                            "Hora repostaje",
                            Anulado,
                            "Kilometros Reales");
      rRegDia.SETRANGE (Vehiculo, '201');
      rRegDia.SETFILTER(Dia     , '>=%1', 150704D);
      rRegDia.SETRANGE (Anulado , FALSE);
      IF rRegDia.FINDSET(TRUE) THEN BEGIN
        rRegDia."Rotura Tacografo" := FALSE;
        rRegDia.MODIFY(TRUE);
        REPEAT
          rRegDia.MODIFY(TRUE);
        UNTIL rRegDia.NEXT = 0;
      END;
    END;

    PROCEDURE RellenaZonaxCondici¢n@1103350001();
    VAR
      lrCond@1103350000 : Record 7010330;
      lrZonCond@1103350001 : Record 7010396;
      lwCont@1103350002 : Integer;
      lwTotal@1103350003 : Integer;
    BEGIN
      // RellenaZonaxCondici¢n
      // Se ha creado una nueva tabla de zonas x condicion variable
      // Esta macro la rellena con el campo zona fisica de la condici¢n variable

      CLEAR(lrCond);
      CLEAR(lrZonCond);
      IF lrCond.FINDSET(TRUE) THEN BEGIN
        wVentana.OPEN(Text50049);
        CLEAR(lwCont);
        lwTotal := lrCond.COUNT;
        REPEAT
          IF (lrCond."Zona fisica" <>'') AND (NOT lrZonCond.GET(lrCond."N§",lrCond."Zona fisica")) THEN BEGIN
            lrZonCond.INIT;
            lrZonCond.Condicion     := lrCond."N§";
            lrZonCond."Zona Fisica" := lrCond."Zona fisica";
            lrZonCond.INSERT;
          END;
          lrCond."Zona Independiente" := TRUE;
          lrCond."Zona fisica" :='';
          lrCond.MODIFY;
          lwCont +=1;
          wVentana.UPDATE(1,ROUND(lwCont/lwTotal*10000,1));
        UNTIL lrCond.NEXT=0;
        wVentana.CLOSE;
      END;
    END;

    PROCEDURE RellenaGratuitoenCI@1103350002();
    VAR
      lwCont@1103350001 : Integer;
      lwTotal@1103350000 : Integer;
      lrCI@1103350002 : Record 7010414;
      lrParte@1103350003 : Record 7010360;
    BEGIN
      // RellenaGratuitoenCI
      // Pues que va a ser... rellena el nuevo campo gratuito en la tabla Coste-Ingreso

      CLEAR(lrParte);
      CLEAR(lrCI);

      wVentana.OPEN(Text50050);
      lrParte.SETRANGE(Gratuito,TRUE);
      IF lrParte.FINDSET THEN BEGIN
        CLEAR(lwCont);
        lwTotal := lrParte.COUNT;
        REPEAT
          lrCI.SETRANGE("N§ Parte",lrParte."N§ Parte");
          IF lrCI.FINDFIRST THEN
            lrCI.MODIFYALL(Gratuito,lrParte.Gratuito);
          lwCont +=1;
          wVentana.UPDATE(1,ROUND(lwCont/lwTotal*10000,1));
        UNTIL lrParte.NEXT=0;
      END;

      wVentana.CLOSE;
    END;

    PROCEDURE LimpiaPrefDesactivada@1103350003();
    VAR
      lrPref@1103350000 : Record 7010415;
      lrLin@1103350001 : Record 7010417;
      lwFecha@1103350002 : Date;
      lwTotal@1103350003 : Integer;
      lwCont@1103350004 : Integer;
    BEGIN
      // LimpiaPrefDesactivada

      CLEAR(lrPref);
      CLEAR(lrLin);

      lwFecha:= CALCDATE(Text50051,TODAY);

      IF NOT CONFIRM(Text174) THEN
        EXIT;

      lrPref.SETCURRENTKEY(Fecha,Desactivada);
      lrPref.SETRANGE(Desactivada,TRUE);
      lrPref.SETFILTER(Fecha, '<=%1',lwFecha);

      IF lrPref.FINDSET THEN BEGIN
        lwTotal := lrPref.COUNT;
        CLEAR(lwCont);
        wVentana.OPEN('@1@@@@@@@@@@@@@@@@@');
        REPEAT
          lrLin.SETRANGE("N§ Prefactura", lrPref."N§ Prefactura");
          IF lrLin.FINDFIRST THEN BEGIN
            lrLin.DELETEALL;
          END;
          lwCont +=1;
          wVentana.UPDATE(1,ROUND(lwCont/lwTotal*10000,1));
        UNTIL lrPref.NEXT=0;
        wVentana.CLOSE;
      END;
    END;

    PROCEDURE RellenaFechaConfirmacion@1103350004();
    VAR
      lrParte@1103350000 : Record 7010360;
      lrCI@1103350001 : Record 7010414;
      lwFechaConfirmacion@1103350002 : DateTime;
    BEGIN
      // RellenaFechaConfirmacion

      // Rellena el nuevo campo Fecha Confirmacion tanto en los partes como en las lineas de coste ingreso

      IF NOT CONFIRM(Text50052) THEN
        EXIT;

      lwFechaConfirmacion := CREATEDATETIME(TODAY,TIME);

      CLEAR(lrParte);
      lrParte.SETCURRENTKEY(Confirmado,Fecha);
      lrParte.SETRANGE(Confirmado,TRUE);
      IF lrParte.FINDFIRST THEN
        lrParte.MODIFYALL("Fecha Confirmacion", lwFechaConfirmacion);

      CLEAR(lrCI);
      IF lrCI.FINDFIRST THEN
        lrCI.MODIFYALL("Fecha Confirmacion", lwFechaConfirmacion);

      MESSAGE(Text50053);
    END;

    PROCEDURE RevisarValoresDimension@1103350005();
    VAR
      rGLSetup@1103350000 : Record 98;
      rGaraje@1103350001 : Record 7010310;
      rTTOO@1103350002 : Record 7010312;
      rDimVal@1103350003 : Record 349;
    BEGIN
      // RevisarValoresDimension
      //

      // Revisaremos que cada valor de garaje se corresponda con un valor de la dimension 1 y cada touroperador se corresponda
      // con un valor de la dimension 2

      rGLSetup.FINDFIRST;

      IF (rGLSetup."Global Dimension 1 Code" = '') OR (rGLSetup."Global Dimension 2 Code" = '') THEN
        ERROR(Text50054);

      rGaraje.RESET;
      IF rGaraje.FINDSET THEN BEGIN
        REPEAT

          IF NOT rDimVal.GET(rGLSetup."Global Dimension 1 Code", rGaraje.Garaje) THEN BEGIN
            CLEAR(rDimVal);
            rDimVal."Dimension Code"       := rGLSetup."Global Dimension 1 Code";
            rDimVal.Code                   := rGaraje.Garaje;
            rDimVal.Name                   := rGaraje.Nombre;
            rDimVal.INSERT(TRUE);
          END;

        UNTIL rGaraje.NEXT = 0;
      END;

      rTTOO.RESET;
      IF rTTOO.FINDSET THEN BEGIN
        REPEAT

          IF NOT rDimVal.GET(rGLSetup."Global Dimension 2 Code", rTTOO.Codigo) THEN BEGIN
            CLEAR(rDimVal);
            rDimVal."Dimension Code"       := rGLSetup."Global Dimension 2 Code";
            rDimVal.Code                   := rTTOO.Codigo;
            rDimVal.Name                   := rTTOO.Nombre;
            rDimVal.INSERT(TRUE);
          END;

        UNTIL rTTOO.NEXT = 0;
      END;

      MESSAGE(Text50055);
    END;

    PROCEDURE CreaFechaParteTTOOXPARTE@1103350006();
    VAR
      lrTTOOParte@1103350000 : Record 7010365;
      lrParte@1103350003 : Record 7010360;
      lwCont@1103350001 : Integer;
      lwTotal@1103350002 : Integer;
      lwFecha@1103350004 : Date;
    BEGIN
      // CreaFechaParteTTOOXPARTE

      IF NOT CONFIRM(Text50056) THEN
        EXIT;

      CLEAR(lwFecha);
      wVentana.OPEN(Text50057);
      wVentana.INPUT(1,lwFecha);
      wVentana.CLOSE;

      IF lwFecha=0D THEN
        ERROR(Text50058);

      CLEAR(lrParte);
      lrParte.SETFILTER(Fecha,'>=%1',lwFecha);
      IF lrParte.FINDSET THEN BEGIN
        lwTotal := lrParte.COUNT;
        CLEAR(lwCont);
        wVentana.OPEN(Text50059);
        REPEAT
          lrTTOOParte.SETRANGE("N§ Parte",lrParte."N§ Parte");
          IF lrTTOOParte.FINDFIRST THEN
            lrTTOOParte.MODIFYALL("Fecha Servicio Parte",lrParte.Fecha);
          lwCont +=1;
          wVentana.UPDATE(1,ROUND(lwCont/lwTotal*10000,1));
        UNTIL lrParte.NEXT=0;
        wVentana.CLOSE;
      END;

      { JPT 13/01/05 Modifico para poder filtrar por fechas
      CLEAR(lrTTOOParte);
      IF lrTTOOParte.FINDSET(TRUE) THEN BEGIN
        lwTotal := lrTTOOParte.COUNT;
        CLEAR(lwCont);
        wVentana.OPEN(Text50059);
        REPEAT
          lrTTOOParte.CALCFIELDS("Fecha parte");
          lrTTOOParte."Fecha Servicio Parte" := lrTTOOParte."Fecha parte";
          lrTTOOParte.MODIFY;
          lwCont +=1;
          wVentana.UPDATE(1,ROUND(lwCont/lwTotal*10000,1));
        UNTIL lrTTOOParte.NEXT=0;
        wVentana.CLOSE;
      END;
      }
    END;

    PROCEDURE RellenaZonaTrabajo@1103350007();
    VAR
      lrParte@1103350000 : Record 7010360;
      lrZonFis@1103350001 : Record 7010314;
      lwCont@1103350002 : Integer;
      lwTotal@1103350003 : Integer;
    BEGIN
      // RellenaZonaTrabajo

      IF NOT CONFIRM(Text50060) THEN
        EXIT;

      CLEAR(lrParte);
      IF lrParte.FINDSET(TRUE) THEN BEGIN
        CLEAR(lwCont);
        lwTotal := lrParte.COUNT;
        wVentana.OPEN(Text50061);
        REPEAT
          IF lrParte."Zona trabajo" = '' THEN BEGIN
            lrParte.VALIDATE("Zona trabajo", lrZonFis.GetZonaTrabajo(lrParte."Zona parte",'',''));
            lrParte.MODIFY;
          END;
          lwCont +=1;
          wVentana.UPDATE(1,ROUND(lwCont/lwTotal*10000,1));
        UNTIL lrParte.NEXT=0;
        wVentana.CLOSE;
      END;
    END;

    PROCEDURE MarcaServicREpetitivoFActurado@1103350008();
    VAR
      lrCI@1103350000 : Record 7010414;
      lrCI2@1103350004 : Record 7010414;
      lrCI3@1103350005 : Record 7010414;
      lrSerRep@1103350001 : Record 7010379;
      lrCond@1103350003 : Record 7010420;
      lfSelF@1103350002 : Form 7010457;
    BEGIN
      // MarcaServicREpetitivoFActurado
      //
      // JPT- 04/01/05 Marca las lineas C/I de un servicio repetitivo entre fechas con el primer numero de factura de ese perido.

      CLEAR(lrSerRep);
      IF NOT (FORM.RUNMODAL(0,lrSerRep)=ACTION::LookupOK) THEN BEGIN
        MESSAGE(Text157);
        EXIT;
      END;

      // AJF 07/01/09
      // Evito borrar el registro, ya que ahora tiene datos permanentes.
      IF lrCond.GET(USERID) THEN
        lrCond.LimpiaRegistro
      ELSE BEGIN
        lrCond.INIT;
        lrCond.Usuario := USERID;
        lrCond.INSERT;
      END;

      lrCond.FILTERGROUP(2);
      lrCond.SETRECFILTER;
      lrCond.FILTERGROUP(0);
      lfSelF.SETTABLEVIEW(lrCond);
      COMMIT;

      IF lfSelF.RUNMODAL <> ACTION::OK THEN BEGIN
        MESSAGE(Text157);
        EXIT;
      END;

      lfSelF.GETRECORD(lrCond);
      IF lrCond."Fecha desde" =0D THEN
        ERROR(Text176,lrCond.FIELDCAPTION("Fecha desde"));
      IF lrCond."Fecha hasta" = 0D THEN
        ERROR(Text176,lrCond.FIELDCAPTION("Fecha hasta"));


      CLEAR(lrCI);
      lrCI.SETCURRENTKEY("Servicio Regular",Fecha);
      lrCI.SETRANGE("Servicio Regular", lrSerRep."No.");
      lrCI.SETRANGE(Fecha, lrCond."Fecha desde", lrCond."Fecha hasta");

      lrCI2.COPY(lrCI);
      // Miramos primero si hay alguna linea CI pendiente de facturar
      lrCI.SETFILTER("N§ Factura",'=%1','');
      IF NOT lrCI.FINDFIRST THEN BEGIN
        ERROR(Text177);
      END;

      // Buscamo el numero de factura a introducir
      lrCI2.SETFILTER("N§ Factura",'<>%1','');
      IF NOT lrCI2.FINDFIRST THEN BEGIN
        ERROR(Text178);
      END;

      IF NOT CONFIRM(Text179,FALSE,lrSerRep."No.", lrCI2."N§ Factura", lrCond."Fecha desde", lrCond."Fecha hasta") THEN BEGIN
        MESSAGE(Text157);
        EXIT;
      END;

      IF lrCI.FINDSET(TRUE) THEN BEGIN
        REPEAT
          lrCI3 := lrCI;
          lrCI3."N§ Prefactura" := '';
          lrCI3.VALIDATE("N§ Factura", lrCI2."N§ Factura");
          lrCI3.MODIFY;
        UNTIL lrCI.NEXT=0;
      END;

      MESSAGE(Text0002);
    END;

    PROCEDURE RellenaFacturable@1103350009();
    VAR
      lrParte@1103350000 : Record 7010360;
      lrTTOOParte@1103350001 : Record 7010365;
      lwCont@1103350002 : Integer;
      lwTotal@1103350003 : Integer;
    BEGIN
      // RellenaFacturable
      // JPT 01/02/05 Rellena el nuevo campo facturable en TTOO x Parte

      CLEAR(lrParte);
      CLEAR(lrTTOOParte);
      IF lrParte.FINDSET THEN BEGIN
        lwTotal := lrParte.COUNT;
        CLEAR(lwCont);
        wVentana.OPEN(Text50062);
        REPEAT
          lrTTOOParte.SETRANGE("N§ Parte",lrParte."N§ Parte");
          IF lrTTOOParte.FINDFIRST THEN
            lrTTOOParte.MODIFYALL(Facturable,lrParte.Facturable);
          lwCont +=1;
          wVentana.UPDATE(1,ROUND(lwCont/lwTotal*10000,1));
        UNTIL lrParte.NEXT=0;
        wVentana.CLOSE;
      END;
    END;

    PROCEDURE RellenaDatosZonaPrecioParte@1103350010();
    VAR
      lrParte@1103350000 : Record 7010360;
      lrZon@1103350001 : Record 7010364;
      lrContC@1103350002 : Record 7010408;
      lrContV@1103350003 : Record 7010403;
      lwTotal@1103350004 : Integer;
      lwCont@1103350005 : Integer;
      lwCasos@1103350006 : Integer;
    BEGIN
      // RellenaDatosZonaPrecioParte
      // IBZ
      // A Partir de los partes rellena determinados campos que habia quedado vacios por la migracion

      CLEAR(lrParte);
      CLEAR(lrZon);
      CLEAR(lwCasos);
      IF lrParte.FINDSET THEN BEGIN
        CLEAR(lwCont);
        lwTotal := lrParte.COUNT;
        wVentana.OPEN(Text50063);
        REPEAT
          lrZon.SETRANGE("N§ Parte",lrParte."N§ Parte");
          IF lrZon.FINDSET(TRUE) THEN BEGIN
            REPEAT
              IF lrZon.Cliente = '' THEN BEGIN // Si hay un campo vacio lo estan todos
                CASE lrZon."Tipo contrato" OF
                  lrZon."Tipo contrato"::Compra: BEGIN
                    IF lrContC.GET(lrParte.Garaje, lrZon."N§ Contrato") THEN
                      lrZon.TTOO := lrContC.Touroperador;
                  END;
                  lrZon."Tipo contrato"::Venta: BEGIN
                    IF lrContV.GET(lrParte.Garaje, lrZon."N§ Contrato") THEN
                      lrZon.TTOO := lrContV.Touroperador;
                  END;
                END;
                lrZon."N§ viajes"       := lrParte."N§ viajes";
                lrZon.Cliente           := lrParte.Cliente;
                lrZon.Fecha             := lrParte.Fecha;
                lrZon."Tipo servicio"   := lrParte."Tipo Servicio";
                lrZon."Codigo servicio" := lrParte."Codigo Servicio";
                lrZon.Garaje            := lrParte.Garaje;
                lrZon.MODIFY;
                lwCasos +=1;
              END;
            UNTIL lrZon.NEXT=0;
          END;
          lwCont +=1;
          wVentana.UPDATE(1,ROUND(lwCont/lwTotal*10000,1));
        UNTIL lrParte.NEXT=0;
        wVentana.CLOSE;
      END;

      MESSAGE(Text50064,lwCasos);
    END;

    PROCEDURE RellenaCostePreciosPor@1103350011();
    VAR
      lrPartes@1103350000 : Record 7010360;
      lwCont@1103350001 : Integer;
      lwTotal@1103350002 : Integer;
    BEGIN
      // RellenaCostePreciosPor

      IF NOT CONFIRM (Text50065) THEN
        EXIT;

      rPar.FINDFIRST;

      lrPartes.SETCURRENTKEY(Vehiculo,Fecha,Confirmado,Proveedor);
      lrPartes.SETRANGE(Confirmado,FALSE);
      lrPartes.SETFILTER(Proveedor,'<>%1','');
      IF lrPartes.FINDSET(TRUE) THEN BEGIN
        CLEAR(lwCont);
        lwTotal:= lrPartes.COUNT;
        wVentana.OPEN('@1@@@@@@@@@');
        REPEAT
          lrPartes.VALIDATE("Coste Precios por",rPar."Partes (Coste) Precios Por");
          lrPartes.MODIFY;
          lwCont+=1;
          wVentana.UPDATE(1,ROUND(lwCont/lwTotal*10000,1));
        UNTIL lrPartes.NEXT=0;
        wVentana.CLOSE;
      END;
      MESSAGE(Text0002);
    END;

    PROCEDURE MarcarPartesComoFacturado@1103350012();
    VAR
      lwFecha@1103350000 : Date;
      lrParte@1103350001 : Record 7010360;
      lrCI@1103350002 : Record 7010414;
      lwCont@1103350003 : Integer;
      lwTotal@1103350004 : Integer;
      lwTotalMarc@1103350005 : Integer;
    BEGIN
      // MarcarPartesComoFacturado
      // Se va a marcar los partes seleccionados como facturados

      REPORT.RUNMODAL(7010390);

      { JPT 04/11/05  Sustituyo el codigo por llamada a report que hace el trabajo
      wVentana.OPEN(Text194);
      wVentana.INPUT(1, lwFecha);
      wVentana.CLOSE;

      IF lwFecha= 0D THEN
        ERROR(Text192);

      IF NOT CONFIRM (Text193,FALSE, lwFecha) THEN
        EXIT;

      CLEAR(lwTotalMarc);
      CLEAR(lrParte);
      lrParte.SETFILTER(Fecha,'<=%1',lwFecha);
      lrParte.SETRANGE(Facturado,FALSE);
      IF lrParte.FINDSET THEN BEGIN
        lwTotal:= lrParte.COUNT;
        wVentana.OPEN('@1@@@@@@@@@@');
        CLEAR(lwCont);
        REPEAT
          lrCI.RESET;
          lrCI.SETRANGE("N§ Parte",lrParte."N§ Parte");
          lrCI.SETFILTER("N§ Factura",'=%1','');
          IF lrCI.FINDSET(TRUE) THEN BEGIN
            lwTotalMarc +=1;
            REPEAT
              lrCI.VALIDATE("N§ Factura",Text191);
              lrCI.MODIFY;
            UNTIL lrCI.NEXT=0;
          END;
          lwCont +=1;
          wVentana.UPDATE(1,ROUND(lwCont/lwTotal*10000,1));
        UNTIL lrParte.NEXT=0;
        wVentana.CLOSE;
      END ELSE
        ERROR(Text196);

      MESSAGE(Text195,lwTotalMarc);
      }
    END;

    PROCEDURE BorrarExportacionesProv@1103350013();
    VAR
      lrExp@1103350000 : Record 7035353;
      lwFecha@1103350001 : Date;
    BEGIN
      // BorrarExportacionesProv
      // Borra registros de exportaci¢n de proveedores hasta los ultimos 3 mese
      // Es importante NO borrar el ultimo registro ya que si no la numeraci¢n volveria a empezar y
      //  se descuadraria la relaci¢n con los partes ya exportados


      lwFecha := CALCDATE(Text50066,TODAY);
      IF NOT CONFIRM(Text197,FALSE,lwFecha) THEN
        EXIT;
      CLEAR(lrExp);
      lrExp.SETRANGE("Tipo Exportacion", lrExp."Tipo Exportacion"::"Servicios Proveedor");
      IF lrExp.FINDLAST THEN BEGIN
        lrExp.SETFILTER("N§",'<>%1',lrExp."N§");
        lrExp.SETFILTER(Fecha,'<=%1',lwFecha);
        IF lrExp.FINDLAST THEN
          lrExp.DELETEALL
        ELSE
         ERROR(Text196);
      END
      ELSE
        ERROR(Text196);

      MESSAGE(Text0002);
    END;

    PROCEDURE RellenaPreciosPaxContratos@1103350014();
    VAR
      lrLinVta@1103350000 : Record 7010405;
      lrLinVta2@1103350001 : Record 7010405;
      lrLinComp@1103350004 : Record 7010409;
      lrLinComp2@1103350005 : Record 7010409;
      lwCont@1103350002 : Integer;
      lwTotal@1103350003 : Integer;
    BEGIN
      // RellenaPreciosPaxContratos
      // JPT 15/06/05 Esta funci¢n se encarga de rellenar los precios por Pax en los registros de lineas de contrato
      // De paso se carga las lineas de elementos que ya no nos hacen falta

      rPar.FINDFIRST;
      rPar.TESTFIELD(rPar."Codigo Adulto");
      rPar.TESTFIELD(rPar."Codigo Ni¤o");

      // Contrato Venta
      CLEAR(lrLinVta);
      CLEAR(lrLinVta2);
      lrLinVta2.SETCURRENTKEY(Garaje,"N§ Contrato","Tipo precio","Orden Subordinado");
      lrLinVta.SETRANGE("Tipo precio"    , lrLinVta."Tipo precio"::"Precio Base");
      lrLinVta.SETRANGE("Tipo aplicacion", lrLinVta."Tipo aplicacion"::Pax);
      lrLinVta.SETFILTER("Tipo elemento" ,'=%1','');
      IF lrLinVta.FINDSET(TRUE) THEN BEGIN
        lwTotal := lrLinVta.COUNT;
        CLEAR(lwCont);
        wVentana.OPEN(Text50067);
        REPEAT
          // Adulto
          lrLinVta2.SETRANGE("Tipo precio"       , lrLinVta2."Tipo precio"::"Precio Base");
          lrLinVta2.SETRANGE(Garaje              , lrLinVta.Garaje);
          lrLinVta2.SETRANGE("N§ Contrato"       , lrLinVta."N§ Contrato");
          lrLinVta2.SETRANGE("Orden Subordinado" , lrLinVta.Orden);
          lrLinVta2.SETRANGE("Tipo elemento"     , rPar."Codigo Adulto");
          IF lrLinVta2.FINDFIRST THEN BEGIN
            lrLinVta.VALIDATE("Precio Adulto",lrLinVta2."Precio Vehiculo");
            lrLinVta2.DELETE;
          END;
          // Ni¤o
          lrLinVta2.SETRANGE(Garaje              , lrLinVta.Garaje);
          lrLinVta2.SETRANGE("N§ Contrato"       , lrLinVta."N§ Contrato");
          lrLinVta2.SETRANGE("Orden Subordinado" , lrLinVta.Orden);
          lrLinVta2.SETRANGE("Tipo elemento",rPar."Codigo Ni¤o");
          IF lrLinVta2.FINDFIRST THEN BEGIN
            lrLinVta.VALIDATE("Precio Ni¤o",lrLinVta2."Precio Vehiculo");
            lrLinVta2.DELETE;
          END;
          lrLinVta.MODIFY;
          lwCont +=1;
          wVentana.UPDATE(1,ROUND(lwCont/lwTotal*10000,1));
        UNTIL lrLinVta.NEXT=0;
        wVentana.CLOSE;
      END;


      // Contrato Compra
      CLEAR(lrLinComp);
      CLEAR(lrLinComp2);
      lrLinComp2.SETCURRENTKEY(Garaje,"N§ Contrato","Tipo precio","Orden Subordinado");
      lrLinComp.SETRANGE("Tipo precio"    , lrLinComp."Tipo precio"::"Precio Base");
      lrLinComp.SETRANGE("Tipo aplicacion", lrLinComp."Tipo aplicacion"::Pax);
      lrLinComp.SETFILTER("Tipo elemento" ,'=%1','');
      IF lrLinComp.FINDSET(TRUE) THEN BEGIN
        lwTotal := lrLinComp.COUNT;
        CLEAR(lwCont);
        wVentana.OPEN(Text50068);
        REPEAT
          // Adulto
          lrLinComp2.SETRANGE("Tipo precio"       , lrLinComp2."Tipo precio"::"Precio Base");
          lrLinComp2.SETRANGE(Garaje              , lrLinComp.Garaje);
          lrLinComp2.SETRANGE("N§ Contrato"       , lrLinComp."N§ Contrato");
          lrLinComp2.SETRANGE("Orden Subordinado" , lrLinComp.Orden);
          lrLinComp2.SETRANGE("Tipo elemento"     , rPar."Codigo Adulto");
          IF lrLinComp2.FINDFIRST THEN BEGIN
            lrLinComp.VALIDATE("Precio Adulto",lrLinComp2."Precio Vehiculo");
            lrLinComp2.DELETE;
          END;
          // Ni¤o
          lrLinComp2.SETRANGE(Garaje              , lrLinComp.Garaje);
          lrLinComp2.SETRANGE("N§ Contrato"       , lrLinComp."N§ Contrato");
          lrLinComp2.SETRANGE("Orden Subordinado" , lrLinComp.Orden);
          lrLinComp2.SETRANGE("Tipo elemento",rPar."Codigo Ni¤o");
          IF lrLinComp2.FINDFIRST THEN BEGIN
            lrLinComp.VALIDATE("Precio Ni¤o",lrLinComp2."Precio Vehiculo");
            lrLinComp2.DELETE;
          END;
          lrLinComp.MODIFY;
          lwCont +=1;
          wVentana.UPDATE(1,ROUND(lwCont/lwTotal*10000,1));
        UNTIL lrLinComp.NEXT=0;
        wVentana.CLOSE;
      END;
    END;

    PROCEDURE UnificaciondeCodigosServicio@1103350015();
    VAR
      lrCodSer@1103350000 : Record 7010320;
      lrTempCS@1103350001 : TEMPORARY Record 7010320;
      lrSer@1103350002 : Record 7010358;
      lwCont@1103350003 : Integer;
      lwTotal@1103350004 : Integer;
      lwCont2@1103350021 : Integer;
      lwTotal2@1103350020 : Integer;
      lwNT@1103350024 : ARRAY [2] OF Integer;
      lrParte@1103350005 : Record 7010360;
      lrSerPar@1103350006 : Record 7010359;
      lrTTOOParte@1103350007 : Record 7010365;
      lrZonPre@1103350008 : Record 7010364;
      lrSerRep@1103350009 : Record 7010379;
      lrCI@1103350010 : Record 7010414;
      lrRegActParte@1103350011 : Record 7035336;
      lrPrefacCoste@1103350012 : Record 7035348;
      lrLinPrefacCoste@1103350013 : Record 7035349;
      lrInfExc@1103350014 : Record 7035371;
      lrItiGRp@1103350015 : Record 7035381;
      lrPrecioCV@1103350016 : Record 7010405;
      lrPrecioCV2@1103350017 : Record 7010405;
      lrPrecioCC@1103350018 : Record 7010409;
      lrPrecioCC2@1103350019 : Record 7010409;
      lrConvImp@1103350022 : Record 7010434;
      lrConvImp2@1103350023 : Record 7010434;
      lText001@1103350025 : TextConst 'ESP=%1 de %2';
    BEGIN
      // UnificaciondeCodigosServicio
      // Se da el caso en TRN en que tienen varios Codigos de Servicio que se refieren al mismo
      // Esta macro los unifica a traves del campo "Codigo Unificado" de la tabla Codigo Servicio
      // Los que tengan dicho campo en blanco no se modificaran, los otros, depues de modificicarse todas sus
      // referencias ser n eliminados.
      // Para agilizar (o al menos intentarlo) se crea un temporal a la tabla codigos de servicio

      IF NOT CONFIRM(Text50069) THEN
        EXIT;

      IF NOT (FORM.RUNMODAL(50100,lrCodSer)= ACTION::LookupOK) THEN
        EXIT;

      CLEAR(lrCodSer);
      lrCodSer.SETFILTER("Codigo Unificado",'<>%1','');
      IF lrCodSer.FINDSET THEN BEGIN
        CLEAR(lrTempCS);
        IF lrTempCS.FINDFIRST THEN
          lrTempCS.DELETEALL;
        REPEAT
          lrTempCS:= lrCodSer;
          IF lrTempCS.Codigo <> lrTempCS."Codigo Unificado" THEN
            lrTempCS.INSERT;
        UNTIL lrCodSer.NEXT=0;
      END ELSE
        ERROR(Text50070);

      // Se comprueba que no haya recursividad es decir que un codigo unificado no tenga a su vez otro codigo unificado
      IF lrCodSer.FINDSET THEN BEGIN
        REPEAT
          IF lrTempCS.GET(lrCodSer."Codigo Unificado") THEN
            ERROR(Text50071,
                  lrCodSer.Codigo, lrCodSer."Codigo Unificado", lrTempCS."Codigo Unificado");
        UNTIL lrCodSer.NEXT=0;
      END;


      // Ahora ya vamos a por las tablas
      lrCodSer.RESET;
      IF lrTempCS.FINDSET THEN BEGIN
        CLEAR(lwCont);
        lwTotal := lrTempCS.COUNT;
        IF NOT CONFIRM(Text50072, TRUE, lwTotal) THEN
          EXIT;
        wVentana.OPEN(Text50073 +
                      Text50074);

        lwNT[1]:= 14; //Total de tablas
        REPEAT
          lwNT[2]:= 0;
          wVentana.UPDATE(1 , lrTempCS.Codigo);
          wVentana.UPDATE(2 , lrTempCS."Codigo Unificado");

          // Servicios
          lwNT[2]+=1;
          wVentana.UPDATE(6, STRSUBSTNO(lText001,lwNT[2],lwNT[1]));
          wVentana.UPDATE(3, lrSer.TABLECAPTION);
          CLEAR(lrSer);
          lrSer.SETCURRENTKEY("Codigo Servicio");
          lrSer.SETRANGE("Codigo Servicio", lrTempCS.Codigo);
          IF lrSer.FINDFIRST THEN BEGIN
            lrSer.MODIFYALL("Codigo Servicio", lrTempCS."Codigo Unificado");
          END;

          // Partes
          lwNT[2]+=1;
          wVentana.UPDATE(6, STRSUBSTNO(lText001,lwNT[2],lwNT[1]));
          wVentana.UPDATE(3, lrParte.TABLECAPTION);
          CLEAR(lrParte);
          lrParte.SETCURRENTKEY(Fecha,"Codigo Servicio");
          lrParte.SETRANGE("Codigo Servicio", lrTempCS.Codigo);
          IF lrParte.FINDFIRST THEN BEGIN
            lrParte.MODIFYALL("Codigo Servicio", lrTempCS."Codigo Unificado");
          END;

          // Servicios - Partes
          lwNT[2]+=1;
          wVentana.UPDATE(6, STRSUBSTNO(lText001,lwNT[2],lwNT[1]));
          wVentana.UPDATE(3, lrSerPar.TABLECAPTION);
          CLEAR(lrSerPar);
          lrSerPar.SETCURRENTKEY(Fecha,Touroperador,"Tipo Servicio","Codigo Servicio","N§ Parte");
          lrSerPar.SETRANGE("Codigo Servicio", lrTempCS.Codigo);
          IF lrSerPar.FINDFIRST THEN BEGIN
            lrSerPar.MODIFYALL("Codigo Servicio", lrTempCS."Codigo Unificado");
          END;

          // Touroperador x Parte
          lwNT[2]+=1;
          wVentana.UPDATE(6, STRSUBSTNO(lText001,lwNT[2],lwNT[1]));
          wVentana.UPDATE(3, lrTTOOParte.TABLECAPTION);
          CLEAR(lrTTOOParte);
          lrTTOOParte.SETCURRENTKEY(Confirmado,"Cliente estadistico",Touroperador,"Tipo Servicio","Codigo Servicio","Fecha Facturacion");
          lrTTOOParte.SETRANGE("Codigo Servicio", lrTempCS.Codigo);
          IF lrTTOOParte.FINDFIRST THEN BEGIN
            lrTTOOParte.MODIFYALL("Codigo Servicio", lrTempCS."Codigo Unificado");
          END;

          // Zona Precio Parte
          lwNT[2]+=1;
          wVentana.UPDATE(6, STRSUBSTNO(lText001,lwNT[2],lwNT[1]));
          wVentana.UPDATE(3, lrZonPre.TABLECAPTION);
          CLEAR(lrZonPre);
          lrZonPre.SETCURRENTKEY(Cliente,TTOO,Fecha,Garaje,"Tipo servicio","Codigo servicio","Zona Precio","Servicio propio");
          lrZonPre.SETRANGE("Codigo servicio", lrTempCS.Codigo);
          IF lrZonPre.FINDFIRST THEN BEGIN
            lrZonPre.MODIFYALL("Codigo servicio", lrTempCS."Codigo Unificado");
          END;

          // Servicios Repetitivos
          lwNT[2]+=1;
          wVentana.UPDATE(6, STRSUBSTNO(lText001,lwNT[2],lwNT[1]));
          wVentana.UPDATE(3, lrSerRep.TABLECAPTION);
          CLEAR(lrSerRep);
          lrSerRep.SETRANGE("Codigo Servicio", lrTempCS.Codigo);
          IF lrSerRep.FINDFIRST THEN BEGIN
            lrSerRep.MODIFYALL("Codigo Servicio", lrTempCS."Codigo Unificado");
          END;

          // Coste - Ingreso
          lwNT[2]+=1;
          wVentana.UPDATE(6, STRSUBSTNO(lText001,lwNT[2],lwNT[1]));
          wVentana.UPDATE(3, lrCI.TABLECAPTION);
          CLEAR(lrCI);
          lrCI.SETCURRENTKEY(Garaje, Fecha, "Tipo servicio", "Codigo servicio");
          lrCI.SETRANGE("Codigo servicio", lrTempCS.Codigo);
          IF lrCI.FINDFIRST THEN BEGIN
            lrCI.MODIFYALL("Codigo servicio", lrTempCS."Codigo Unificado");
          END;

          //  Registro Actividad x Parte
          lwNT[2]+=1;
          wVentana.UPDATE(6, STRSUBSTNO(lText001,lwNT[2],lwNT[1]));
          wVentana.UPDATE(3, lrRegActParte.TABLECAPTION);
          CLEAR(lrRegActParte);
          lrRegActParte.SETRANGE("C¢digo Servicio", lrTempCS.Codigo);
          IF lrRegActParte.FINDFIRST THEN BEGIN
            lrRegActParte.MODIFYALL("C¢digo Servicio", lrTempCS."Codigo Unificado");
          END;

          // Prefactura Coste
          lwNT[2]+=1;
          wVentana.UPDATE(6, STRSUBSTNO(lText001,lwNT[2],lwNT[1]));
          wVentana.UPDATE(3, lrPrefacCoste.TABLECAPTION);
          CLEAR(lrPrefacCoste);
          lrPrefacCoste.SETRANGE("Codigos Servicio", lrTempCS.Codigo);
          IF lrPrefacCoste.FINDFIRST THEN BEGIN
            lrPrefacCoste.MODIFYALL("Codigos Servicio", lrTempCS."Codigo Unificado");
          END;

          // Linea Prefactura Coste
          wVentana.UPDATE(3, lrLinPrefacCoste.TABLECAPTION);
          CLEAR(lrLinPrefacCoste);
          lrLinPrefacCoste.SETRANGE("Codigo servicio", lrTempCS.Codigo);
          IF lrLinPrefacCoste.FINDFIRST THEN BEGIN
            lrLinPrefacCoste.MODIFYALL("Codigo servicio", lrTempCS."Codigo Unificado");
          END;

          // Informacion Excursion
          lwNT[2]+=1;
          wVentana.UPDATE(6, STRSUBSTNO(lText001,lwNT[2],lwNT[1]));
          wVentana.UPDATE(3, lrInfExc.TABLECAPTION);
          CLEAR(lrInfExc);
          lrInfExc.SETCURRENTKEY("Codigo Servicio","Zona fisica","Fecha Desde");
          lrInfExc.SETRANGE("Codigo Servicio", lrTempCS.Codigo);
          IF lrInfExc.FINDFIRST THEN BEGIN
            lrInfExc.MODIFYALL("Codigo Servicio", lrTempCS."Codigo Unificado");
          END;

          // Informacion Excursion
          lwNT[2]+=1;
          wVentana.UPDATE(6, STRSUBSTNO(lText001,lwNT[2],lwNT[1]));
          wVentana.UPDATE(3, lrItiGRp.TABLECAPTION);
          CLEAR(lrItiGRp);
          lrItiGRp.SETRANGE("Codigo Servicio", lrTempCS.Codigo);
          IF lrItiGRp.FINDFIRST THEN BEGIN
            lrItiGRp.MODIFYALL("Codigo Servicio", lrTempCS."Codigo Unificado");
          END;

          // Las siguiente tablas requieren de un poco m s de tratamiento

          // Precio Contrato Venta
          lwNT[2]+=1;
          wVentana.UPDATE(6, STRSUBSTNO(lText001,lwNT[2],lwNT[1]));
          wVentana.UPDATE(3, lrPrecioCV.TABLECAPTION);
          CLEAR(lrPrecioCV);
          CLEAR(lrPrecioCV2);
          lrPrecioCV.SETCURRENTKEY( Garaje,
                             "N§ Contrato",
                             "Tipo precio",
                         "Codigo servicio",
                              "Zona desde",
                              "Zona hasta",
                             "Fecha desde",
                             "Fecha hasta",
                           "Tipo Vehiculo",
                             "Rango desde",
                             "Rango hasta");

          lrPrecioCV2.COPY(lrPrecioCV);
          lrPrecioCV.SETRANGE("Codigo servicio", lrTempCS.Codigo);
          IF lrPrecioCV.FINDSET(TRUE) THEN BEGIN
            CLEAR(lwCont2);
            lwTotal2:= lrPrecioCV.COUNT;
            REPEAT
              lrPrecioCV2.SETRANGE(Garaje           , lrPrecioCV.Garaje);
              lrPrecioCV2.SETRANGE("N§ Contrato"    , lrPrecioCV."N§ Contrato");
              lrPrecioCV2.SETRANGE("Tipo precio"    , lrPrecioCV."Tipo precio");
              lrPrecioCV2.SETRANGE("Codigo servicio", lrTempCS."Codigo Unificado");
              lrPrecioCV2.SETRANGE("Zona desde"     , lrPrecioCV."Zona desde");
              lrPrecioCV2.SETRANGE("Zona hasta"     , lrPrecioCV."Zona hasta");
              lrPrecioCV2.SETRANGE("Fecha desde"    , lrPrecioCV."Fecha desde");
              lrPrecioCV2.SETRANGE("Fecha hasta"    , lrPrecioCV."Fecha hasta");
              lrPrecioCV2.SETRANGE("Tipo Vehiculo"  , lrPrecioCV."Tipo Vehiculo");
              lrPrecioCV2.SETRANGE("Rango desde"    , lrPrecioCV."Rango desde");
              lrPrecioCV2.SETRANGE("Rango hasta"    , lrPrecioCV."Rango hasta");
              IF lrPrecioCV2.FINDFIRST THEN BEGIN
                lrPrecioCV2.RESET; // Si ya existe el precio para Codigo Unificado, lo borra
                lrPrecioCV2 := lrPrecioCV;
                lrPrecioCV2.DELETE;
              END         // Si no lo modifica
              ELSE BEGIN
                lrPrecioCV2.RESET;
                lrPrecioCV2 := lrPrecioCV;
                lrPrecioCV2."Codigo servicio" := lrTempCS."Codigo Unificado";
                lrPrecioCV2.MODIFY;
              END;
              lwCont2 +=1;
              wVentana.UPDATE(5, ROUND(lwCont2/lwTotal2*10000,1));
            UNTIL lrPrecioCV.NEXT=0;
          END;

          // Precio Contrato Conpra
          lwNT[2]+=1;
          wVentana.UPDATE(6, STRSUBSTNO(lText001,lwNT[2],lwNT[1]));
          wVentana.UPDATE(3, lrPrecioCC.TABLECAPTION);
          CLEAR(lrPrecioCC);
          CLEAR(lrPrecioCC2);
          lrPrecioCC.SETCURRENTKEY( Garaje,
                             "N§ Contrato",
                             "Tipo precio",
                         "Codigo servicio",
                              "Zona desde",
                              "Zona hasta",
                             "Fecha desde",
                             "Fecha hasta",
                           "Tipo Vehiculo",
                             "Rango desde",
                             "Rango hasta");

          lrPrecioCC2.COPY(lrPrecioCC);
          lrPrecioCC.SETRANGE("Codigo servicio", lrTempCS.Codigo);
          IF lrPrecioCC.FINDSET(TRUE) THEN BEGIN
            CLEAR(lwCont2);
            lwTotal2:= lrPrecioCC.COUNT;
            REPEAT
              lrPrecioCC2.SETRANGE(Garaje           , lrPrecioCC.Garaje);
              lrPrecioCC2.SETRANGE("N§ Contrato"    , lrPrecioCC."N§ Contrato");
              lrPrecioCC2.SETRANGE("Tipo precio"    , lrPrecioCC."Tipo precio");
              lrPrecioCC2.SETRANGE("Codigo servicio", lrTempCS."Codigo Unificado");
              lrPrecioCC2.SETRANGE("Zona desde"     , lrPrecioCC."Zona desde");
              lrPrecioCC2.SETRANGE("Zona hasta"     , lrPrecioCC."Zona hasta");
              lrPrecioCC2.SETRANGE("Fecha desde"    , lrPrecioCC."Fecha desde");
              lrPrecioCC2.SETRANGE("Fecha hasta"    , lrPrecioCC."Fecha hasta");
              lrPrecioCC2.SETRANGE("Tipo Vehiculo"  , lrPrecioCC."Tipo Vehiculo");
              lrPrecioCC2.SETRANGE("Rango desde"    , lrPrecioCC."Rango desde");
              lrPrecioCC2.SETRANGE("Rango hasta"    , lrPrecioCC."Rango hasta");
              IF lrPrecioCC2.FINDFIRST THEN BEGIN
                lrPrecioCC2.RESET; // Si ya existe el precio para Codigo Unificado, lo borra
                lrPrecioCC2 := lrPrecioCC;
                lrPrecioCC2.DELETE;
              END         // Si no lo modifica
              ELSE BEGIN
                lrPrecioCC2.RESET;
                lrPrecioCC2 := lrPrecioCC;
                lrPrecioCC2."Codigo servicio" := lrTempCS."Codigo Unificado";
                lrPrecioCC2.MODIFY;
              END;
              lwCont2 +=1;
              wVentana.UPDATE(5, ROUND(lwCont2/lwTotal2*10000,1));
            UNTIL lrPrecioCC.NEXT=0;
          END;

          wVentana.UPDATE(5,0);

          // Conversiones Imporacion
          lwNT[2]+=1;
          wVentana.UPDATE(6, STRSUBSTNO(lText001,lwNT[2],lwNT[1]));
          wVentana.UPDATE(3, lrConvImp.TABLECAPTION);
          CLEAR(lrConvImp);
          lrConvImp.RESET;
          lrConvImp.SETRANGE(Tipo, lrConvImp.Tipo::"Codigo Servicio");
          lrConvImp.SETRANGE("Codigo FinBus", lrTempCS.Codigo);
          IF lrConvImp.FINDFIRST THEN BEGIN
            lrConvImp.MODIFYALL("Codigo FinBus", lrTempCS."Codigo Unificado");
          END;

          // Eliminamos el codigo de  servicio
          IF lrCodSer.GET(lrTempCS.Codigo) THEN
            lrCodSer.DELETE;

          lwCont +=1;
          wVentana.UPDATE(4, ROUND(lwCont/lwTotal*10000,1));
        UNTIL lrTempCS.NEXT=0;

        wVentana.CLOSE;
      END;
    END;

    PROCEDURE NombreInforme@1103350018(pwNum@1103350000 : Integer) : Text[30];
    VAR
      lrRep@1103350001 : Record 2000000001;
    BEGIN
      // NombreInforme
      // Devuelve el nombre del informe

      CLEAR(lrRep);
      lrRep.SETRANGE(Type , lrRep.Type::Report);
      lrRep.SETRANGE(ID, pwNum);
      IF lrRep.FINDFIRST THEN
        EXIT(lrRep.Caption);
    END;

    PROCEDURE RellenaVehiculoTTOOParte@1100253000();
    VAR
      lrTTOOOParte@1100253000 : Record 7010365;
      lrParte@1100253001 : Record 7010360;
      lwCont@1100253002 : Integer;
      lwTotal@1100253003 : Integer;
    BEGIN
      // RellenaVehiculoTTOOParte
      // JPT 28/09/05 Esta funci¢n rellena el campo Vehiculo en Touroperador x parte

      IF NOT CONFIRM(Text50075) THEN
        EXIT;

      lrParte.SETRANGE("N§ Parte",'500586556');
      lrParte.MODIFYALL("Hora inicio",0T);

      lrTTOOOParte.RESET;
      lrTTOOOParte.SETCURRENTKEY(Confirmado,"Cliente estadistico",Touroperador,Bono);
      lrTTOOOParte.SETRANGE(Confirmado,TRUE);
      IF lrTTOOOParte.FINDSET(TRUE) THEN BEGIN
        lwTotal:= lrTTOOOParte.COUNT;
        CLEAR(lwCont);
        wVentana.OPEN(Text50076);
        REPEAT
          IF lrTTOOOParte.Vehiculo='' THEN BEGIN
            IF lrParte.GET(lrTTOOOParte."N§ Parte") THEN BEGIN
              lrTTOOOParte.Vehiculo :=lrParte.Vehiculo;
              lrTTOOOParte.MODIFY;
            END;
          END;
          lwCont +=1;
          wVentana.UPDATE(1,ROUND(lwCont/lwTotal*10000,1));
        UNTIL lrTTOOOParte.NEXT=0;
        wVentana.CLOSE;
      END;
    END;

    PROCEDURE RecalculaSalidasAllsun@1100253001();
    VAR
      lrParte@1100253000 : Record 7010360;
      lrTTOO@1100253006 : Record 7010312;
      lwCont@1100253002 : Integer;
      lwTotal@1100253001 : Integer;
      lwCalc@1100253003 : Codeunit 7010318;
      lwFiltroFecha@1100253004 : Text[250];
      lwTTOO@1100253005 : Code[20];
    BEGIN
      // RecalculaSalidasAllsun
      // La finalidad de la siguiente funci¢n es recalcular todas las SALIDAS  de Allsun de los meses de Julio-Agosto-Septiembre
      // DE 2005

      rPar.FINDFIRST;

      wVentana.OPEN(Text50077);
      lwFiltroFecha:= '01/07/05..30/09/05';
      wVentana.UPDATE(2,lwFiltroFecha);
      wVentana.INPUT(1,lwTTOO);
      wVentana.INPUT(2,lwFiltroFecha);
      IF lwTTOO='' THEN
        ERROR(Text50078);
      IF lwFiltroFecha='' THEN
        ERROR(Text50079);
      lrTTOO.GET(lwTTOO);

      CLEAR(lrParte);
      lrParte.SETCURRENTKEY(Fecha,"Codigo Servicio",Vuelos,"Hora 1er Vuelo",Touroperadores);
      lrParte.SETFILTER(Touroperadores   , '*' + lwTTOO + '*');
      lrParte.SETFILTER(Fecha            , lwFiltroFecha);
      lrParte.SETRANGE("Codigo Servicio", rPar."Codigo Salidas");
      lrParte.SETRANGE(Confirmado       , TRUE);

      IF NOT CONFIRM(Text50080,
         TRUE,lrParte.GETFILTERS,lwTTOO) THEN
        EXIT;


      IF lrParte.FINDSET THEN BEGIN
        lwTotal:= lrParte.COUNT;
        CLEAR(lwCont);
        wVentana.OPEN(Text50081);
        REPEAT
          lwCalc.confirmar_partes(lrParte,FALSE,'',3);
          lwCont +=1;
          wVentana.UPDATE(1,ROUND(lwCont/lwTotal*10000,1));
        UNTIL lrParte.NEXT=0;
        wVentana.CLOSE;
      END;
    END;

    PROCEDURE RellenaCamposDescripcionPuntoR@1100253002();
    VAR
      lrPunt@1100253000 : Record 7010315;
      lrSerPar@1100253001 : Record 7010359;
      lrHoGrp@1100253004 : Record 7010374;
      lrRecSerReg@1100253005 : Record 7010394;
      lwTotal@1100253002 : Integer;
      lwCont@1100253003 : Integer;
    BEGIN
      // RellenaCamposDescripcionPuntoR
      // Rellenamos el campo descripci¢n Punto Recogida en las distintas tablas

      CLEAR(lrPunt);
      wVentana.OPEN(Text50082);

      CLEAR(lrSerPar); // Servicios-Partes
      IF lrSerPar.FINDSET(TRUE) THEN BEGIN
        lwTotal := lrSerPar.COUNT;
        CLEAR(lwCont);
        wVentana.UPDATE(1,lrSerPar.TABLECAPTION);
        REPEAT
          lrSerPar."Descripcion Punto Recogida" := lrPunt.GetDescripcion(lrSerPar."Punto recogida");
          lrSerPar.MODIFY;
          lwCont +=1;
          IF lwCont MOD 100 = 0 THEN // Solo actulizamos cada 100 registros
            wVentana.UPDATE(2, ROUND(lwCont/lwTotal*10000,1));
        UNTIL lrSerPar.NEXT=0;
      END;

      CLEAR(lrHoGrp);  // Hoteles x Grupo
      IF lrHoGrp.FINDSET(TRUE) THEN BEGIN
        lwTotal := lrHoGrp.COUNT;
        CLEAR(lwCont);
        wVentana.UPDATE(1,lrHoGrp.TABLECAPTION);
        REPEAT
          lrHoGrp."Descripcion Punto Recogida" := lrPunt.GetDescripcion(lrHoGrp."Punto Recogida");
          lrHoGrp.MODIFY;
          lwCont +=1;
          IF lwCont MOD 100 = 0 THEN // Solo actulizamos cada 100 registros
            wVentana.UPDATE(2, ROUND(lwCont/lwTotal*10000,1));
        UNTIL lrHoGrp.NEXT=0;
      END;

      CLEAR(lrRecSerReg); // Servicios-Partes
      IF lrRecSerReg.FINDSET(TRUE) THEN BEGIN
        lwTotal := lrRecSerReg.COUNT;
        CLEAR(lwCont);
        wVentana.UPDATE(1,lrRecSerReg.TABLECAPTION);
        REPEAT
          lrRecSerReg."Descripcion Punto Recogida" := lrPunt.GetDescripcion(lrRecSerReg."Punto Recogida");
          lrRecSerReg.MODIFY;
          lwCont +=1;
          IF lwCont MOD 100 = 0 THEN // Solo actulizamos cada 100 registros
            wVentana.UPDATE(2, ROUND(lwCont/lwTotal*10000,1));
        UNTIL lrRecSerReg.NEXT=0;
      END;

      wVentana.CLOSE;
    END;

    PROCEDURE ArreglaServiciosRegulares@1100253003();
    VAR
      lrSerR@1100253000 : Record 7010379;
      lrRuta@1100253001 : Record 7035387;
      lrTPuntos@1100253003 : ARRAY [3] OF TEMPORARY Record 7010394;
      lrPuntoR@1100253006 : Record 7010394;
      lwOrd@1100253002 : Integer;
      lwRuta@1100253004 : Integer;
      lwVehAnt@1100253005 : Code[10];
      lwTotal@1100253007 : Integer;
      lwCont@1100253008 : Integer;
    BEGIN
      // ArreglaServiciosRegulares
      // Modifica los servicios Regulares para convertirlos a la nueva configuraci¢n

      rPar.FINDFIRST;
      CLEAR(lrSerR);
      IF lrSerR.FINDSET(TRUE) THEN BEGIN
        CLEAR(lwCont);
        lwTotal := lrSerR.COUNT;
        wVentana.OPEN(Text50083);
        REPEAT
          CLEAR(lrTPuntos);
          lrTPuntos[1].DELETEALL;

          CLEAR(lrRuta);
          lrRuta.SETRANGE("No. Servicio regular", lrSerR."No.");
          IF lrRuta.FINDFIRST THEN
            lrRuta.DELETEALL;

          CLEAR(lrPuntoR); // Creamos el temporal
          lrPuntoR.SETRANGE("No Servicio", lrSerR."No.");
          IF lrPuntoR.FINDSET THEN BEGIN
            REPEAT
              lrTPuntos[1] := lrPuntoR;
              lrTPuntos[1].INSERT;
            UNTIL lrPuntoR.NEXT=0;
          END;

          // Ahora repartimos el orden
          IF lrTPuntos[1].FINDSET(TRUE) THEN BEGIN
            lwOrd:=0;
            lrTPuntos[1].MODIFYALL(Orden,0);
            lrTPuntos[1].SETRANGE(Orden,0);
            REPEAT
              IF lrTPuntos[1].Orden =0 THEN BEGIN
                lrTPuntos[2].SETRANGE(Vehiculo, lrTPuntos[1].Vehiculo);
                IF lrTPuntos[2].FINDFIRST THEN BEGIN
                  lwOrd+=1;
                  lrTPuntos[2].MODIFYALL(Orden,lwOrd);
                END;
              END;
            UNTIL lrTPuntos[1].NEXT=0;
          END;

          CLEAR(lrTPuntos);
          lrTPuntos[1].SETCURRENTKEY(Orden);
          IF lrTPuntos[1].FINDSET THEN BEGIN
            CLEAR(lwRuta);
            CLEAR(lwVehAnt);
            REPEAT
              IF (lwVehAnt <> lrTPuntos[1].Vehiculo) OR (lwRuta=0) THEN BEGIN
                lwRuta +=1;
                CLEAR(lrRuta);
                lrRuta."No. Servicio regular"        := lrSerR."No.";
                lrRuta."No. Ruta"         := lwRuta;
                lrRuta.Observaciones     := lrTPuntos[1].Observaciones;
                lrRuta."Origen/Destino"  := lrTPuntos[1]."Origen/Destino";
                lrRuta.Presentacion      := lrTPuntos[1].Presentacion;
                lrRuta."Codigo Servicio" := lrSerR."Codigo Servicio";
                lrRuta."Precio Medio"    := lrSerR."Precio Medio";

                CASE rPar."Empresa Real" OF
                rPar."Empresa Real"::TRN:
                  lrRuta."Id Ruta" := '(' + FORMAT(lrSerR."No.") + ') ' + STRSUBSTNO(Text50084, lrTPuntos[1].Vehiculo);
                ELSE
                  lrRuta."Id Ruta" := FORMAT(lrSerR."No.");
                END;

                lrRuta."Servicios Creados" := lrSerR."Servicios Creados";
                lrRuta.INSERT(TRUE);
                lwVehAnt := lrTPuntos[1].Vehiculo;
              END;
              // Borramos y volvemos a crea ya que el campo ruta est  en la clave primaria
              CLEAR(lrPuntoR);
              lrPuntoR:= lrTPuntos[1];
              lrPuntoR.DELETE;
              lrPuntoR."No Ruta" := lrRuta."No. Ruta";
              lrPuntoR."Id Ruta" := lrRuta."Id Ruta";
              lrPuntoR.INSERT;
            UNTIL lrTPuntos[1].NEXT=0;
          END;
          lwCont +=1;
          wVentana.UPDATE(1, ROUND(lwCont/lwTotal*10000,1));
          lrSerR."Tipo factura" := lrSerR."Tipo factura"::"Texto alternativo";
          lrSerR.MODIFY;
        UNTIL lrSerR.NEXT=0;
        wVentana.CLOSE;
      END;
    END;

    PROCEDURE OrigenEnPartes@1100253004();
    VAR
      lrParte@1100253000 : Record 7010360;
      lwTotal@1100253001 : Integer;
      lrImpTR@1100253003 : Record 7010431;
      lrImpUEX@1100253004 : Record 7035324;
      lwCont@1100253002 : Integer;
    BEGIN
      // OrigenEnPartes
      // Inicializa el Nuevo campo Origen en los Partes
      // El unico que no tiene en cuenta es Importaci¢n que quedar  como manual

      rPar.FINDFIRST;

      wVentana.OPEN('#1##############\@2@@@@@@@@@@@@@@');

      wVentana.UPDATE(1,Text50085);
      CLEAR(lrParte); // Grupos
      lrParte.SETCURRENTKEY("Cod Grupo");
      lrParte.SETFILTER("Cod Grupo", '<>%1', '');
      IF lrParte.FINDSET(TRUE) THEN BEGIN
        lwTotal := lrParte.COUNT;
        CLEAR(lwCont);
        REPEAT
          lrParte."Origen creacion" := lrParte."Origen creacion"::Grupos;
          lrParte.MODIFY;
          lwCont +=1;
          wVentana.UPDATE(2, ROUND(lwCont/lwTotal*10000,1));
        UNTIL lrParte.NEXT =0;
      END;

      wVentana.UPDATE(1,Text50086);
      CLEAR(lrParte); // Servicios Regulares
      lrParte.SETCURRENTKEY("No Servicio Regular");
      lrParte.SETFILTER("No Servicio Regular", '<>%1', 0);
      IF lrParte.FINDSET(TRUE) THEN BEGIN
        lwTotal := lrParte.COUNT;
        CLEAR(lwCont);
        REPEAT
          lrParte."Origen creacion" := lrParte."Origen creacion"::"Servicios Regulares";
          lrParte.MODIFY;
          lwCont +=1;
          wVentana.UPDATE(2, ROUND(lwCont/lwTotal*10000,1));
        UNTIL lrParte.NEXT =0;
      END;

      // Importaciones
      wVentana.UPDATE(1,Text50017);
      CLEAR(lrParte);
      CASE rPar."Empresa Real" OF
        rPar."Empresa Real"::TRN, rPar."Empresa Real"::TER : BEGIN
          CLEAR(lrImpTR);
          lrImpTR.SETCURRENTKEY(Traspasada,Anulada);
          lrImpTR.SETRANGE(Anulada,FALSE);
          IF lrImpTR.FINDSET THEN BEGIN
           lwTotal := lrImpTR.COUNT;
           CLEAR(lwCont);
            REPEAT
              IF lrParte.GET(lrImpTR."No. Parte") THEN BEGIN
                lrParte."Origen creacion" := lrParte."Origen creacion"::Importacion;
                lrParte.MODIFY;
              END;
              lwCont +=1;
              wVentana.UPDATE(2, ROUND(lwCont/lwTotal*10000,1));
            UNTIL lrImpTR.NEXT=0;
          END;
        END;
        rPar."Empresa Real"::UEX, rPar."Empresa Real"::IBZ: BEGIN
          CLEAR(lrImpUEX);
          lrImpUEX.SETCURRENTKEY("N§ Fichero","Codigo de Vehiculo",Estado);
          lrImpUEX.SETRANGE(Estado, lrImpUEX.Estado::Incorporado);
          IF lrImpUEX.FINDSET THEN BEGIN
            lwTotal := lrImpUEX.COUNT;
            CLEAR(lwCont);
            REPEAT
              IF lrParte.GET(lrImpUEX."Codigo de Vehiculo") THEN BEGIN
                lrParte."Origen creacion" := lrParte."Origen creacion"::Importacion;
                lrParte.MODIFY;
              END;
              lwCont +=1;
              wVentana.UPDATE(2, ROUND(lwCont/lwTotal*10000,1));
            UNTIL lrImpUEX.NEXT=0;
          END;
        END;
      END;

      wVentana.CLOSE;
    END;

    PROCEDURE RellenaCodMotivoEnIncidConduct@1100253005();
    VAR
      lrInc@1100253000 : Record 7010333;
      lrConf@1100253001 : Record 7035345;
      lwTotal@1100253005 : Integer;
      lwCont@1100253002 : Integer;
    BEGIN
      //RellenaCodMotivoEnIncidConduct

      // Rellena el motivo del registro historico incidencia conductor a partir del maestro


      CLEAR(lrInc);
      CLEAR(lrConf);
      IF lrInc.FINDSET(TRUE) THEN BEGIN
        lwTotal := lrInc.COUNT;
        CLEAR(lwCont);
        wVentana.OPEN(Text50087);
        REPEAT
          IF lrConf.GET(lrInc."Cod Motivo")  THEN BEGIN
            lrInc.Motivo := lrConf."Motivo incidencia conductor";
            lrInc.MODIFY;
          END;
          lwCont +=1;
          wVentana.UPDATE(1, ROUND(lwCont/lwTotal*10000,1));
        UNTIL lrInc.NEXT=0;
        wVentana.CLOSE;
      END;
    END;

    PROCEDURE RellenaSuplementosRapidos@1100253006();
    VAR
      lrSupl@1100253000 : Record 7010363;
      lwCont@1100253001 : Integer;
      lwCod@1100253002 : Code[10];
      lwTotal@1100253003 : Integer;
      lwCont2@1100253004 : Integer;
    BEGIN
      // RellenaSuplementosRapidos

      CLEAR(rPar);
      rPar.FINDFIRST;
      wVentana.OPEN(Text50088);
      FOR lwCont:= 1 TO 2 DO BEGIN
        CASE lwCont OF
          1: lwCod := rPar."Cod. Suplemento Rapido 1";
          2: lwCod := rPar."Cod. Suplemento Rapido 2";
        END;

        IF lwCod <> '' THEN BEGIN
          lrSupl.RESET;
          lrSupl.SETRANGE("Cod. Suplemento", lwCod);
          IF lrSupl.FINDSET(TRUE) THEN BEGIN
            lwTotal := lrSupl.COUNT;
            lwCont2 :=0;
            wVentana.UPDATE(1,lwCod);
            REPEAT
              lrSupl.MantenSuplRapidos(FALSE);
              lwCont2 +=1;
              wVentana.UPDATE(2,ROUND(lwCont2/lwTotal*10000,1));
            UNTIL lrSupl.NEXT=0;
          END;
        END;
      END;
      wVentana.CLOSE;
    END;

    PROCEDURE CambiarCodigoTTOO@1103355000();
    VAR
      lwCod1@1103355000 : Code[10];
      lwCod2@1103355001 : Code[10];
      lwTexto@1103355028 : Text[1024];
      lwTotal@1103355029 : Integer;
      lwCont@1103355030 : Integer;
      lwNoTablas@1103355067 : ARRAY [2] OF Integer;
      lrTTOO@1103355002 : Record 7010312;
      lrCliTo@1103355003 : Record 7010313;
      lrCliTo2@1103355004 : Record 7010313;
      lrSelCliTo@1103355005 : Record 7010324;
      lrSerlToUsu@1103355006 : Record 7010325;
      lrVeh@1103355007 : Record 7010346;
      lrZonPre@1103355008 : Record 7010364;
      lrCondRappel@1103355009 : Record 7010375;
      lrCliEcofin@1103355010 : Record 7010380;
      lrCliEcofin2@1103355011 : Record 7010380;
      lrMovCostes@1103355012 : Record 7010397;
      lrCI@1103355014 : Record 7010414;
      lrCI2@1103355045 : Record 7010414;
      lrPref@1103355015 : Record 7010415;
      lrPref2@1103355046 : Record 7010415;
      lrLinPref@1103355065 : Record 7010417;
      lrLinPref2@1103355066 : Record 7010417;
      lrCond@1103355016 : Record 7010416;
      lrCond2@1103355017 : Record 7010416;
      lrCondTemp@1103355018 : Record 7010420;
      lrOpcTR@1103355019 : Record 7010428;
      lrOpcTR2@1103355020 : Record 7010428;
      lrRangPlz@1103355021 : Record 7010430;
      lrRangPlz2@1103355022 : Record 7010430;
      lrCovImp@1103355023 : Record 7010434;
      lrZonTraTTOO@1103355024 : Record 7010436;
      lrTTOOSubzona@1103355025 : Record 7035321;
      lrParUEX@1103355031 : Record 7035332;
      lrVuelos@1103355032 : Record 7035335;
      lrVuelos2@1103355033 : Record 7035335;
      lrPrefC@1103355034 : Record 7035348;
      lrPrefC2@1103355035 : Record 7035348;
      lrRestCondTTOO@1103355036 : Record 7035362;
      lrRestCondTTOO2@1103355037 : Record 7035362;
      lrRestTTOOVeh@1103355038 : Record 7035365;
      lrRestTTOOIMa@1103355039 : Record 7035374;
      lrRestTTOOIMa2@1103355040 : Record 7035374;
      lrTipoCalcITTOO@1103355041 : Record 7035379;
      lrTipoCalcITTOO2@1103355042 : Record 7035379;
      lrServHab@1103355043 : Record 7035386;
      lrServHab2@1103355044 : Record 7035386;
      lrValDim@1103355047 : Record 349;
      lrValDim2@1103355048 : Record 349;
      lrDocDim@1103355049 : Record 357;
      lrDocDim2@1103355050 : Record 357;
      lrSer@1103355051 : Record 7010358;
      lrSer2@1103355052 : Record 7010358;
      lrSerPar@1103355053 : Record 7010359;
      lrSerPar2@1103355054 : Record 7010359;
      lrParte@1103355055 : Record 7010360;
      lrParte2@1103355056 : Record 7010360;
      lrTTOOParte@1103355057 : Record 7010365;
      lrTTOOParte2@1103355058 : Record 7010365;
      lrExtras@1103355059 : Record 7010362;
      lrConf@1103355060 : Record 7010371;
      lrGrupos@1103355061 : Record 7010373;
      lrServReg@1103355062 : Record 7010379;
      lrContV@1103355063 : Record 7010403;
      lrContC@1103355064 : Record 7010408;
      lrPI@1103355068 : Record 7035392;
      lrPI2@1103355069 : Record 7035392;
      lrPC@1103355070 : Record 7035393;
      lrPC2@1103355071 : Record 7035393;
    BEGIN
      // CambiarCodigoTTOO

      // Cambia el codigo Touroperador en todas las referencias

      wVentana.OPEN(Text50089);
      wVentana.INPUT(1,lwCod1);
      wVentana.INPUT(2,lwCod2);

      IF lwCod1='' THEN
        ERROR(Text50090);

      IF lwCod2='' THEN
        ERROR(Text50091);

      lrTTOO.GET(lwCod1); // Se comprueba que exista el TTOO Origen

      IF lrTTOO.GET(lwCod2) THEN
        ERROR(Text50092,lwCod2);

      IF NOT CONFIRM (Text50093,FALSE,lwCod1,lwCod2) THEN
        EXIT;

      lwTexto := STRSUBSTNO(Text50094,lwCod1,lwCod2);
      lwTexto += '#1###################\@2@@@@@@@@@@@@@@@@@@@\#3######';

      lwNoTablas[1]:=0;
      lwNoTablas[2]:=41; // Es el total de tablas

      wVentana.OPEN(lwTexto);

      // Touroperador
      lwNoTablas[1] +=1;
      wVentana.UPDATE(3, STRSUBSTNO(Text50095,lwNoTablas[1],lwNoTablas[2]));
      wVentana.UPDATE(1, lrTTOO.TABLECAPTION);
      CLEAR(lrTTOO);
      IF lrTTOO.GET(lwCod1) THEN BEGIN
        lrTTOO.DELETE;
        lrTTOO.Codigo := lwCod2;
        lrTTOO.INSERT;
      END;


      // Cliente/ Touroperador
      lwNoTablas[1] +=1;
      wVentana.UPDATE(3, STRSUBSTNO(Text50095,lwNoTablas[1],lwNoTablas[2]));
      wVentana.UPDATE(1, lrCliTo.TABLECAPTION);
      CLEAR(lrCliTo);
      lrCliTo.SETRANGE(TTOO ,lwCod1);
      IF lrCliTo.FINDSET(TRUE) THEN BEGIN
        REPEAT
          lrCliTo2 := lrCliTo;
          lrCliTo2.DELETE;
          lrCliTo2.TTOO := lwCod2;
          lrCliTo2.INSERT;
        UNTIL lrCliTo.NEXT =0;
      END;
      CLEAR(lrCliTo); // Tambin miramos en grupo facturacion
      lrCliTo.SETCURRENTKEY("Grupo Facturacion");
      lrCliTo.SETRANGE("Grupo Facturacion", lwCod1);
      IF lrCliTo.FINDFIRST THEN
        lrCliTo.MODIFYALL("Grupo Facturacion", lwCod2);

      // Servicio
      lwNoTablas[1] +=1;
      wVentana.UPDATE(3, STRSUBSTNO(Text50095,lwNoTablas[1],lwNoTablas[2]));
      wVentana.UPDATE(1, lrSer.TABLECAPTION);
      CLEAR(lrSer);
      lrSer.SETRANGE(Touroperador ,lwCod1);
      IF lrSer.FINDSET(TRUE) THEN BEGIN
        lwTotal := lrSer.COUNT;
        lwCont  :=0;
        REPEAT
          lrSer2 := lrSer;
          lrSer2.Touroperador := lwCod2;
          lrSer2.MODIFY;
          lwCont +=1;
          IF lwCont MOD 100 =0 THEN  // Solo dibujamos uno de cada 100
            wVentana.UPDATE(2,ROUND(lwCont/lwTotal *10000,1));
        UNTIL lrSer.NEXT =0;
      END;
      wVentana.UPDATE(2,0);

      // Servicios-Partes
      lwNoTablas[1] +=1;
      wVentana.UPDATE(3, STRSUBSTNO(Text50095,lwNoTablas[1],lwNoTablas[2]));
      wVentana.UPDATE(1, lrSerPar.TABLECAPTION);
      CLEAR(lrSerPar);
      lrSerPar.SETCURRENTKEY("N§ Parte",Touroperador,"Hora Vuelo");
      lrSerPar.SETRANGE(Touroperador ,lwCod1);
      IF lrSerPar.FINDSET(TRUE) THEN BEGIN
        lwTotal := lrSerPar.COUNT;
        lwCont  :=0;
        REPEAT
          lrSerPar2 := lrSerPar;
          lrSerPar2.Touroperador := lwCod2;
          lrSerPar2.MODIFY;
          lwCont +=1;
          IF lwCont MOD 100 =0 THEN  // Solo dibujamos uno de cada 100
            wVentana.UPDATE(2,ROUND(lwCont/lwTotal *10000,1));
        UNTIL lrSerPar.NEXT =0;
      END;
      wVentana.UPDATE(2,0);

      // Parte
      lwNoTablas[1] +=1;
      wVentana.UPDATE(3, STRSUBSTNO(Text50095,lwNoTablas[1],lwNoTablas[2]));
      wVentana.UPDATE(1, lrParte.TABLECAPTION);
      CLEAR(lrParte);
      lrParte.SETCURRENTKEY("Tipo Servicio","Touroperador principal",Fecha);
      lrParte.SETRANGE("Touroperador principal" ,lwCod1);
      IF lrParte.FINDSET(TRUE) THEN BEGIN
        lwTotal := lrParte.COUNT;
        lwCont  :=0;
        REPEAT
          lrParte2 := lrParte;
          lrParte2."Touroperador principal" := lwCod2;
          lrParte2.MODIFY;
          lwCont +=1;
          IF lwCont MOD 100 =0 THEN  // Solo dibujamos uno de cada 100
            wVentana.UPDATE(2,ROUND(lwCont/lwTotal *10000,1));
        UNTIL lrParte.NEXT =0;
      END;
      wVentana.UPDATE(2,0);

      // Touroperador x Parte
      lwNoTablas[1] +=1;
      wVentana.UPDATE(3, STRSUBSTNO(Text50095,lwNoTablas[1],lwNoTablas[2]));
      wVentana.UPDATE(1, lrTTOOParte.TABLECAPTION);
      CLEAR(lrTTOOParte);
      lrTTOOParte.SETRANGE(Touroperador ,lwCod1);
      IF lrTTOOParte.FINDSET(TRUE) THEN BEGIN
        lwTotal := lrTTOOParte.COUNT;
        lwCont  :=0;
        REPEAT
          lrTTOOParte2 := lrTTOOParte;
          lrTTOOParte2.DELETE;
          lrTTOOParte2.Touroperador := lwCod2;
          lrTTOOParte2.INSERT;
          lwCont +=1;
          IF lwCont MOD 100 =0 THEN  // Solo dibujamos uno de cada 100
            wVentana.UPDATE(2,ROUND(lwCont/lwTotal *10000,1));
        UNTIL lrTTOOParte.NEXT =0;
      END;
      wVentana.UPDATE(2,0);

      // Extras Parte
      lwNoTablas[1] +=1;
      wVentana.UPDATE(3, STRSUBSTNO(Text50095,lwNoTablas[1],lwNoTablas[2]));
      wVentana.UPDATE(1, lrExtras.TABLECAPTION);
      CLEAR(lrExtras);
      lrExtras.SETRANGE(Touroperador, lwCod1);
      IF lrExtras.FINDFIRST THEN
        lrExtras.MODIFYALL(Touroperador, lwCod2);

      // Seleccion Cliente TTOO
      // Al ser un temporal simplemente lo eliminamos
      lwNoTablas[1] +=1;
      wVentana.UPDATE(3, STRSUBSTNO(Text50095,lwNoTablas[1],lwNoTablas[2]));
      wVentana.UPDATE(1, lrSelCliTo.TABLECAPTION);
      CLEAR(lrSelCliTo);
      lrSelCliTo.SETRANGE(TTOO, lwCod1);
      IF lrSelCliTo.FINDFIRST THEN
        lrSelCliTo.DELETEALL;

      // Selecci¢n ttoo X Usuario
      lwNoTablas[1] +=1;
      wVentana.UPDATE(3, STRSUBSTNO(Text50095,lwNoTablas[1],lwNoTablas[2]));
      wVentana.UPDATE(1, lrSerlToUsu.TABLECAPTION);
      CLEAR(lrSerlToUsu);
      // Al ser un temporal simplemente lo eliminamos
      lrSerlToUsu.SETRANGE(TTOO, lwCod1);
      IF lrSerlToUsu.FINDFIRST THEN
        lrSerlToUsu.DELETEALL;

      // Vehiculo
      wVentana.UPDATE(1, lrVeh.TABLECAPTION);
      lwNoTablas[1] +=1;
      wVentana.UPDATE(3, STRSUBSTNO(Text50095,lwNoTablas[1],lwNoTablas[2]));
      CLEAR(lrVeh);
      lrVeh.SETRANGE("Pintura agencia", lwCod1);
      IF lrVeh.FINDFIRST THEN
        lrVeh.MODIFYALL("Pintura agencia", lwCod2);

      // Zona Precio Parte
      lwNoTablas[1] +=1;
      wVentana.UPDATE(3, STRSUBSTNO(Text50095,lwNoTablas[1],lwNoTablas[2]));
      wVentana.UPDATE(1, lrZonPre.TABLECAPTION);
      CLEAR(lrZonPre);
      lrZonPre.SETCURRENTKEY(Cliente,TTOO);
      lrZonPre.SETRANGE(TTOO, lwCod1);
      IF lrZonPre.FINDFIRST THEN
        lrZonPre.MODIFYALL(TTOO, lwCod2);

      // Condiciones Rappel
      lwNoTablas[1] +=1;
      wVentana.UPDATE(3, STRSUBSTNO(Text50095,lwNoTablas[1],lwNoTablas[2]));
      wVentana.UPDATE(1, lrCondRappel.TABLECAPTION);
      CLEAR(lrCondRappel);
      lrCondRappel.SETCURRENTKEY(Cliente,TTOO);
      lrCondRappel.SETRANGE(TTOO, lwCod1);
      IF lrZonPre.FINDFIRST THEN
        lrCondRappel.MODIFYALL(TTOO, lwCod2);

      // Clientes Ecofin
      lwNoTablas[1] +=1;
      wVentana.UPDATE(3, STRSUBSTNO(Text50095,lwNoTablas[1],lwNoTablas[2]));
      wVentana.UPDATE(1, lrCliEcofin.TABLECAPTION);
      CLEAR(lrCliEcofin);
      lrCliEcofin.SETRANGE(Touroperador ,lwCod1);
      IF lrCliEcofin.FINDSET(TRUE) THEN BEGIN
        REPEAT
          lrCliEcofin2 := lrCliEcofin;
          lrCliEcofin2.DELETE;
          lrCliEcofin2.Touroperador := lwCod2;
          lrCliEcofin2.INSERT;
        UNTIL lrCliEcofin.NEXT =0;
      END;

      // Movimientos otros costes
      lwNoTablas[1] +=1;
      wVentana.UPDATE(3, STRSUBSTNO(Text50095,lwNoTablas[1],lwNoTablas[2]));
      wVentana.UPDATE(1, lrMovCostes.TABLECAPTION);
      CLEAR(lrMovCostes);
      lrMovCostes.SETCURRENTKEY(Concepto,"No Parte",TTOO);
      lrMovCostes.SETRANGE(TTOO, lwCod1);
      IF lrMovCostes.FINDFIRST THEN
        lrMovCostes.MODIFYALL(TTOO, lwCod2);

      // AJF 08/07/08
      // Esta tabla ya no existe.
      // Facturas TREX
      {-----------------------------------
      lwNoTablas[1] +=1;
      wVentana.UPDATE(3, STRSUBSTNO(Text50095,lwNoTablas[1],lwNoTablas[2]));
      wVentana.UPDATE(1, lrFactTrex.TABLECAPTION);
      CLEAR(lrFactTrex);
      lrFactTrex.SETCURRENTKEY("Num Importacion",Anulada,Conciliada,"Num Vehiculo Asignado",TTOO,"Fecha Servicio");
      lrFactTrex.SETRANGE(TTOO, lwCod1);
      IF lrFactTrex.FINDFIRST THEN
        lrFactTrex.MODIFYALL(TTOO, lwCod2);
      ------------------------------------}

      // Coste/Ingreso
      lwNoTablas[1] +=1;
      wVentana.UPDATE(3, STRSUBSTNO(Text50095,lwNoTablas[1],lwNoTablas[2]));
      wVentana.UPDATE(1, lrCI.TABLECAPTION);
      CLEAR(lrCI);
      lrCI.SETCURRENTKEY("N§ Parte",Touroperador,"N§ Factura");
      lrCI.SETRANGE(Touroperador ,lwCod1);
      IF lrCI.FINDSET(TRUE) THEN BEGIN
        lwTotal := lrCI.COUNT;
        lwCont  :=0;
        REPEAT
          lrCI2 := lrCI;
          lrCI2.Touroperador := lwCod2;
          lrCI2.MODIFY;
          lwCont +=1;
          IF lwCont MOD 100 =0 THEN  // Solo dibujamos uno de cada 100
            wVentana.UPDATE(2,ROUND(lwCont/lwTotal *10000,1));
        UNTIL lrCI.NEXT =0;
      END;
      wVentana.UPDATE(2,0);

      // Produccion Ingreso
      lwNoTablas[1] +=1;
      wVentana.UPDATE(3, STRSUBSTNO(Text50095,lwNoTablas[1],lwNoTablas[2]));
      wVentana.UPDATE(1, lrPI.TABLECAPTION);
      CLEAR(lrPI);
      lrPI.SETCURRENTKEY("N§ Parte",Touroperador,"Tipo linea","Linea abono","Tipo elemento");
      lrPI.SETRANGE(Touroperador ,lwCod1);
      IF lrPI.FINDSET(TRUE) THEN BEGIN
        lwTotal := lrPI.COUNT;
        lwCont  :=0;
        REPEAT
          lrPI2 := lrPI;
          lrPI2.Touroperador := lwCod2;
          lrPI2.MODIFY;
          lwCont +=1;
          IF lwCont MOD 100 =0 THEN  // Solo dibujamos uno de cada 100
            wVentana.UPDATE(2,ROUND(lwCont/lwTotal *10000,1));
        UNTIL lrPI.NEXT =0;
      END;
      wVentana.UPDATE(2,0);

      // Produccion Coste
      lwNoTablas[1] +=1;
      wVentana.UPDATE(3, STRSUBSTNO(Text50095,lwNoTablas[1],lwNoTablas[2]));
      wVentana.UPDATE(1, lrPC.TABLECAPTION);
      CLEAR(lrPC);
      lrPC.SETCURRENTKEY("N§ Parte",Touroperador,"Tipo linea","Linea abono","Tipo elemento");
      lrPC.SETRANGE(Touroperador ,lwCod1);
      IF lrPC.FINDSET(TRUE) THEN BEGIN
        lwTotal := lrPC.COUNT;
        lwCont  :=0;
        REPEAT
          lrPC2 := lrPC;
          lrPC2.Touroperador := lwCod2;
          lrPC2.MODIFY;
          lwCont +=1;
          IF lwCont MOD 100 =0 THEN  // Solo dibujamos uno de cada 100
            wVentana.UPDATE(2,ROUND(lwCont/lwTotal *10000,1));
        UNTIL lrPC.NEXT =0;
      END;
      wVentana.UPDATE(2,0);



      // Prefactura Ingreso
      lwNoTablas[1] +=1;
      wVentana.UPDATE(3, STRSUBSTNO(Text50095,lwNoTablas[1],lwNoTablas[2]));
      wVentana.UPDATE(1, lrPref.TABLECAPTION);
      CLEAR(lrPref);
      lrPref.SETCURRENTKEY(Fecha,Cliente,Touroperador,Facturada);
      lrPref.SETRANGE(Touroperador ,lwCod1);
      IF lrPref.FINDSET(TRUE) THEN BEGIN
        lwTotal := lrPref.COUNT;
        lwCont  :=0;
        REPEAT
          lrPref2 := lrPref;
          lrPref2.Touroperador := lwCod2;
          lrPref2.MODIFY;
          lwCont +=1;
          IF lwCont MOD 100 =0 THEN  // Solo dibujamos uno de cada 100
            wVentana.UPDATE(2,ROUND(lwCont/lwTotal *10000,1));
        UNTIL lrPref.NEXT =0;
      END;
      wVentana.UPDATE(2,0);


      // Condiciones Facturacion
      lwNoTablas[1] +=1;
      wVentana.UPDATE(3, STRSUBSTNO(Text50095,lwNoTablas[1],lwNoTablas[2]));
      wVentana.UPDATE(1, lrCond.TABLECAPTION);
      CLEAR(lrCond);
      lrCond.SETRANGE(TTOO ,lwCod1);
      IF lrCond.FINDSET(TRUE) THEN BEGIN
        REPEAT
          lrCond2 := lrCond;
          lrCond2.DELETE;
          lrCond2.TTOO := lwCod2;
          lrCond2.INSERT;
        UNTIL lrCond.NEXT =0;
      END;

      // Condiciones Temporales
      lwNoTablas[1] +=1;
      wVentana.UPDATE(3, STRSUBSTNO(Text50095,lwNoTablas[1],lwNoTablas[2]));
      wVentana.UPDATE(1, lrCondTemp.TABLECAPTION);
      CLEAR(lrCondTemp);
      lrCondTemp.SETRANGE(Touroperador, lwCod1);
      IF lrCondTemp.FINDFIRST THEN
        lrCondTemp.MODIFYALL(Touroperador, lwCod2);

      // Opciones Texto de Registros
      lwNoTablas[1] +=1;
      wVentana.UPDATE(3, STRSUBSTNO(Text50095,lwNoTablas[1],lwNoTablas[2]));
      wVentana.UPDATE(1, lrOpcTR.TABLECAPTION);
      CLEAR(lrOpcTR);
      lrOpcTR.SETRANGE(TTOO ,lwCod1);
      IF lrOpcTR.FINDSET(TRUE) THEN BEGIN
        REPEAT
          lrOpcTR2 := lrOpcTR;
          lrOpcTR2.DELETE;
          lrOpcTR2.TTOO := lwCod2;
          lrOpcTR2.INSERT;
        UNTIL lrOpcTR.NEXT =0;
      END;

      // Rango Plazas Factura
      lwNoTablas[1] +=1;
      wVentana.UPDATE(3, STRSUBSTNO(Text50095,lwNoTablas[1],lwNoTablas[2]));
      wVentana.UPDATE(1, lrRangPlz.TABLECAPTION);
      CLEAR(lrRangPlz);
      lrRangPlz.SETRANGE(TTOO ,lwCod1);
      IF lrRangPlz.FINDSET(TRUE) THEN BEGIN
        REPEAT
          lrRangPlz2 := lrRangPlz;
          lrRangPlz2.DELETE;
          lrRangPlz2.TTOO := lwCod2;
          lrRangPlz2.INSERT;
        UNTIL lrRangPlz.NEXT =0;
      END;

      // Conversiones Importacion
      lwNoTablas[1] +=1;
      wVentana.UPDATE(3, STRSUBSTNO(Text50095,lwNoTablas[1],lwNoTablas[2]));
      wVentana.UPDATE(1, lrCovImp.TABLECAPTION);
      CLEAR(lrCovImp);
      lrCovImp.SETCURRENTKEY(Codigo,Tipo,No,Cliente,Touroperador);
      lrCovImp.SETRANGE(Touroperador, lwCod1);
      IF lrCovImp.FINDFIRST THEN
        lrCovImp.MODIFYALL(Touroperador, lwCod2);

      // Zona de Trabajo x TTOO
      lwNoTablas[1] +=1;
      wVentana.UPDATE(3, STRSUBSTNO(Text50095,lwNoTablas[1],lwNoTablas[2]));
      wVentana.UPDATE(1, lrZonTraTTOO.TABLECAPTION);
      //CLEAR(lrZonTraTTOO);
      //lrZonTraTTOO.SETCURRENTKEY(Touroperador);
      //lrZonTraTTOO.SETRANGE(Touroperador, lwCod1);
      //IF lrZonTraTTOO.FINDFIRST THEN
      //  lrZonTraTTOO.MODIFYALL(Touroperador, lwCod2);

      // Touroperador en Subzona
      lwNoTablas[1] +=1;
      wVentana.UPDATE(3, STRSUBSTNO(Text50095,lwNoTablas[1],lwNoTablas[2]));
      wVentana.UPDATE(1, lrTTOOSubzona.TABLECAPTION);
      CLEAR(lrTTOOSubzona);
      lrTTOOSubzona.SETRANGE("Codigo FinBus", lwCod1);
      IF lrTTOOSubzona.FINDFIRST THEN
        lrTTOOSubzona.MODIFYALL("Codigo FinBus", lwCod2);

      // Parametros Ultramar
      lwNoTablas[1] +=1;
      wVentana.UPDATE(3, STRSUBSTNO(Text50095,lwNoTablas[1],lwNoTablas[2]));
      wVentana.UPDATE(1, lrParUEX.TABLECAPTION);
      CLEAR(lrParUEX);
      IF lrParUEX.FINDFIRST THEN BEGIN
        IF lrParUEX."TTOO Importaci¢n" = lwCod1 THEN
          lrParUEX."TTOO Importaci¢n" := lwCod2;

        IF lrParUEX."Touroperador Thomson" = lwCod1 THEN
          lrParUEX."Touroperador Thomson" := lwCod2;

        IF lrParUEX."TTOO TUI Exportacion Proveedor" = lwCod1 THEN
          lrParUEX."TTOO TUI Exportacion Proveedor" := lwCod2;

        IF lrParUEX."TTOO THOMSON Export. Proveedor" = lwCod1 THEN
          lrParUEX."TTOO THOMSON Export. Proveedor" := lwCod2;

        IF lrParUEX."TTOO TREX blanco" = lwCod1 THEN
          lrParUEX."TTOO TREX blanco" := lwCod2;
        lrParUEX.MODIFY;
      END;

      // Vuelos x Parte
      lwNoTablas[1] +=1;
      wVentana.UPDATE(3, STRSUBSTNO(Text50095,lwNoTablas[1],lwNoTablas[2]));
      wVentana.UPDATE(1, lrVuelos.TABLECAPTION);
      CLEAR(lrVuelos);
      lrVuelos.SETCURRENTKEY("Codigo Touroperador");
      lrVuelos.SETRANGE("Codigo Touroperador" ,lwCod1);
      IF lrVuelos.FINDSET(TRUE) THEN BEGIN
        lwTotal := lrVuelos.COUNT;
        lwCont  :=0;
        REPEAT
          lrVuelos2 := lrVuelos;
          lrVuelos2.DELETE;
          lrVuelos2."Codigo Touroperador" := lwCod2;
          lrVuelos2.INSERT;
          lwCont +=1;
          IF lwCont MOD 100 =0 THEN  // Solo dibujamos uno de cada 100
            wVentana.UPDATE(2,ROUND(lwCont/lwTotal *10000,1));
        UNTIL lrVuelos.NEXT =0;
      END;
      wVentana.UPDATE(2,0);

      // Prefactura Coste
      lwNoTablas[1] +=1;
      wVentana.UPDATE(3, STRSUBSTNO(Text50095,lwNoTablas[1],lwNoTablas[2]));
      wVentana.UPDATE(1, lrPrefC.TABLECAPTION);
      CLEAR(lrPrefC);
      lrPrefC.SETRANGE(Touroperador ,lwCod1);
      IF lrPrefC.FINDSET(TRUE) THEN BEGIN
        lwTotal := lrPrefC.COUNT;
        lwCont  :=0;
        REPEAT
          lrPrefC2 := lrPrefC;
          lrPrefC2.Touroperador := lwCod2;
          lrPrefC2.MODIFY;
          lwCont +=1;
          IF lwCont MOD 100 =0 THEN  // Solo dibujamos uno de cada 100
            wVentana.UPDATE(2,ROUND(lwCont/lwTotal *10000,1));
        UNTIL lrPrefC.NEXT =0;
      END;
      wVentana.UPDATE(2,0);

      // Restricciones Conductor X TTOO
      lwNoTablas[1] +=1;
      wVentana.UPDATE(3, STRSUBSTNO(Text50095,lwNoTablas[1],lwNoTablas[2]));
      wVentana.UPDATE(1, lrRestCondTTOO.TABLECAPTION);
      CLEAR(lrRestCondTTOO);
      lrRestCondTTOO.SETRANGE(Touroperador ,lwCod1);
      IF lrRestCondTTOO.FINDSET(TRUE) THEN BEGIN
        REPEAT
          lrRestCondTTOO2 := lrRestCondTTOO;
          lrRestCondTTOO2.DELETE;
          lrRestCondTTOO2.Touroperador := lwCod2;
          lrRestCondTTOO2.INSERT;
        UNTIL lrRestCondTTOO.NEXT =0;
      END;

      // Restricciones TTOO-Vehiculo
      lwNoTablas[1] +=1;
      wVentana.UPDATE(3, STRSUBSTNO(Text50095,lwNoTablas[1],lwNoTablas[2]));
      wVentana.UPDATE(1, lrRestTTOOVeh.TABLECAPTION);
      CLEAR(lrRestTTOOVeh);
      IF lrRestTTOOVeh.GET(lwCod1) THEN BEGIN
        lrRestTTOOVeh.DELETE;
        lrRestTTOOVeh.Touroperador := lwCod2;
        lrRestTTOOVeh.INSERT;
      END;

      // Restriccion TTOO-Imagen
      lwNoTablas[1] +=1;
      wVentana.UPDATE(3, STRSUBSTNO(Text50095,lwNoTablas[1],lwNoTablas[2]));
      wVentana.UPDATE(1, lrRestTTOOIMa.TABLECAPTION);
      CLEAR(lrRestTTOOIMa);
      lrRestTTOOIMa.SETRANGE("Codigo TTOO" ,lwCod1);
      IF lrRestTTOOIMa.FINDSET(TRUE) THEN BEGIN
        REPEAT
          lrRestTTOOIMa2 := lrRestTTOOIMa;
          lrRestTTOOIMa2.DELETE;
          lrRestTTOOIMa2."Codigo TTOO" := lwCod2;
          lrRestTTOOIMa2.INSERT;
        UNTIL lrRestTTOOIMa.NEXT =0;
      END;

      // Tipo Calculo ingreso x TTOO
      lwNoTablas[1] +=1;
      wVentana.UPDATE(3, STRSUBSTNO(Text50095,lwNoTablas[1],lwNoTablas[2]));
      wVentana.UPDATE(1, lrTipoCalcITTOO.TABLECAPTION);
      CLEAR(lrTipoCalcITTOO);
      lrTipoCalcITTOO.SETRANGE(TTOO ,lwCod1);
      IF lrTipoCalcITTOO.FINDSET(TRUE) THEN BEGIN
        REPEAT
          lrTipoCalcITTOO2 := lrTipoCalcITTOO;
          lrTipoCalcITTOO2.DELETE(TRUE);
          lrTipoCalcITTOO2.TTOO := lwCod2;
          lrTipoCalcITTOO2.INSERT(TRUE);
        UNTIL lrTipoCalcITTOO.NEXT =0;
      END;

      // Servio Habitual Cliente/TTOO
      lwNoTablas[1] +=1;
      wVentana.UPDATE(3, STRSUBSTNO(Text50095,lwNoTablas[1],lwNoTablas[2]));
      wVentana.UPDATE(1, lrServHab.TABLECAPTION);
      CLEAR(lrServHab);
      lrServHab.SETRANGE(Touroperador ,lwCod1);
      IF lrServHab.FINDSET(TRUE) THEN BEGIN
        REPEAT
          lrServHab2 := lrServHab;
          lrServHab2.DELETE;
          lrServHab2.Touroperador := lwCod2;
          lrServHab2.INSERT;
        UNTIL lrServHab.NEXT =0;
      END;

      // Valor Dimension
      lwNoTablas[1] +=1;
      wVentana.UPDATE(3, STRSUBSTNO(Text50095,lwNoTablas[1],lwNoTablas[2]));
      wVentana.UPDATE(1, lrValDim.TABLECAPTION);
      CLEAR(lrValDim);
      lrValDim.SETRANGE(Code ,lwCod1);
      IF lrValDim.FINDSET(TRUE) THEN BEGIN
        REPEAT
          lrValDim2 := lrValDim;
          lrValDim2.DELETE;
          lrValDim2.Code := lwCod2;
          lrValDim2.INSERT;
        UNTIL lrValDim.NEXT =0;
      END;

      // Dimension Documento
      lwNoTablas[1] +=1;
      wVentana.UPDATE(3, STRSUBSTNO(Text50095,lwNoTablas[1],lwNoTablas[2]));
      wVentana.UPDATE(1, lrDocDim.TABLECAPTION);
      CLEAR(lrDocDim);
      lrDocDim.SETCURRENTKEY("Dimension Code","Dimension Value Code");
      lrDocDim.SETRANGE("Dimension Value Code" ,lwCod1);
      IF lrDocDim.FINDSET(TRUE) THEN BEGIN
        lwTotal := lrDocDim.COUNT;
        lwCont  :=0;
        REPEAT
          lrDocDim2 := lrDocDim;
          lrDocDim2."Dimension Value Code" := lwCod2;
          lrDocDim2.MODIFY;
          lwCont +=1;
          IF lwCont MOD 100 =0 THEN  // Solo dibujamos uno de cada 100
            wVentana.UPDATE(2,ROUND(lwCont/lwTotal *10000,1));
        UNTIL lrDocDim.NEXT =0;
      END;
      wVentana.UPDATE(2,0);

      // Conf. Exportacion proveedor
      lwNoTablas[1] +=1;
      wVentana.UPDATE(3, STRSUBSTNO(Text50095,lwNoTablas[1],lwNoTablas[2]));
      wVentana.UPDATE(1, lrConf.TABLECAPTION);
      CLEAR(lrConf);
      lrConf.SETCURRENTKEY("Tipo Busqueda",Cliente,TTOO,"Zona Trabajo",Garaje,"Rango Desde","Rango Hasta");
      lrConf.SETRANGE(TTOO, lwCod1);
      IF lrConf.FINDFIRST THEN
        lrConf.MODIFYALL(TTOO, lwCod2);

      // Grupos
      lwNoTablas[1] +=1;
      wVentana.UPDATE(3, STRSUBSTNO(Text50095,lwNoTablas[1],lwNoTablas[2]));
      wVentana.UPDATE(1, lrGrupos.TABLECAPTION);
      CLEAR(lrGrupos);
      lrGrupos.SETCURRENTKEY(Cliente,TTOO);
      lrGrupos.SETRANGE(TTOO, lwCod1);
      IF lrGrupos.FINDFIRST THEN
        lrGrupos.MODIFYALL(TTOO, lwCod2);

      // Servicios Regulares
      lwNoTablas[1] +=1;
      wVentana.UPDATE(3, STRSUBSTNO(Text50095,lwNoTablas[1],lwNoTablas[2]));
      wVentana.UPDATE(1, lrServReg.TABLECAPTION);
      CLEAR(lrServReg);
      lrServReg.SETRANGE(TTOO, lwCod1);
      IF lrServReg.FINDFIRST THEN
        lrServReg.MODIFYALL(TTOO, lwCod2);

      // Contrato Venta
      lwNoTablas[1] +=1;
      wVentana.UPDATE(3, STRSUBSTNO(Text50095,lwNoTablas[1],lwNoTablas[2]));
      wVentana.UPDATE(1, lrContV.TABLECAPTION);
      CLEAR(lrContV);
      lrContV.SETCURRENTKEY(Cliente,Touroperador);
      lrContV.SETRANGE(Touroperador, lwCod1);
      IF lrContV.FINDFIRST THEN
        lrContV.MODIFYALL(Touroperador, lwCod2);

      // Contrato Compra
      lwNoTablas[1] +=1;
      wVentana.UPDATE(3, STRSUBSTNO(Text50095,lwNoTablas[1],lwNoTablas[2]));
      wVentana.UPDATE(1, lrContC.TABLECAPTION);
      CLEAR(lrContC);
      lrContC.SETCURRENTKEY(Proveedor,Cliente,Touroperador);
      lrContC.SETRANGE(Touroperador, lwCod1);
      IF lrContC.FINDFIRST THEN
        lrContC.MODIFYALL(Touroperador, lwCod2);

      // Lineas Prefactura
      lwNoTablas[1] +=1;
      wVentana.UPDATE(3, STRSUBSTNO(Text50095,lwNoTablas[1],lwNoTablas[2]));
      wVentana.UPDATE(1, lrLinPref.TABLECAPTION);
      CLEAR(lrLinPref);
      lrLinPref.SETRANGE(Touroperador, lwCod1);
      IF lrLinPref.FINDSET(TRUE) THEN BEGIN
        lwTotal := lrLinPref.COUNT;
        lwCont  :=0;
        REPEAT
          lrLinPref2 := lrLinPref;
          lrLinPref2.Touroperador := lwCod2;
          lrLinPref2.MODIFY;
          lwCont +=1;
          IF lwCont MOD 100 =0 THEN  // Solo dibujamos uno de cada 100
            wVentana.UPDATE(2,ROUND(lwCont/lwTotal *10000,1));
        UNTIL lrLinPref.NEXT =0;
      END;
      wVentana.UPDATE(2,0);

      wVentana.CLOSE;
      MESSAGE(Text50096);
    END;

    PROCEDURE RegeneraCalculoConcepto@1103355001();
    VAR
      lwFecha@1103355000 : ARRAY [2] OF Date;
      lrConcV@1103355001 : Record 7010329;
      lwConcVar@1103355002 : Code[10];
      lrTipoAc@1103355007 : Record 7010334;
      lwTipoAc@1103355006 : Code[10];
      lrReg@1103355003 : Record 7010332;
      lrReg2@1103355004 : Record 7010332;
      rHist@1103355009 : Record 7010331;
      lrIng@1103355015 : Record 7010336;
      rRxC@1103355021 : Record 7035336;
      lrCond@1103355020 : Record 7010327;
      rParte@1103355023 : Record 7010360;
      rParte2@1103355024 : Record 7010360;
      rTEMPParte@1103355025 : TEMPORARY Record 7010360;
      cGen@1103355005 : Codeunit 7010314;
      cCalcIng@1103355011 : Codeunit 7010315;
      cActCond@1103355012 : Codeunit 7010316;
      lwOk@1103355008 : Boolean;
      lwOk2@1103355026 : Boolean;
      lwTipoConc@1103355010 : 'Maletas,Viajes,Dietas,Horas';
      lwTotal@1103355013 : Integer;
      lwCont@1103355014 : Integer;
      lwPrecio@1103355016 : Decimal;
      lwDivisa@1103355017 : Code[10];
      lwPredioDL@1103355018 : Decimal;
      lwNumCond@1103355019 : Code[10];
      lwCantidad@1103355022 : Decimal;
    BEGIN
      // RegeneraCalculoConcepto

      // Hacemos dos cosas: Por una parte regeneramos el registro de actividad, y por otra
      // recalculamos el ingreso del conductor  para un concepto determinado

      rPar.FINDFIRST;
      CLEAR(lwFecha);
      wVentana.OPEN(Text50097);
      wVentana.INPUT(1, lwFecha[1]);
      wVentana.UPDATE(1, lwFecha[1]);
      wVentana.INPUT(2, lwFecha[2]);
      wVentana.CLOSE;

      IF (lwFecha[1]=0D) OR (lwFecha[2]=0D) THEN
        ERROR(Text50098);

      IF lwFecha[1] > lwFecha[2] THEN
        ERROR(Text50099);


      // Tambien pedimos el concepto variable
      CLEAR(lwConcVar);
      CLEAR(lrConcV);
      IF FORM.RUNMODAL(0,lrConcV) = ACTION::LookupOK THEN
        lwConcVar := lrConcV.Concepto;

      IF lwConcVar='' THEN
        ERROR(Text50100);

      IF NOT (lwConcVar IN [rPar."Codigo Hora Extra",rPar."Codigo Dieta",rPar."Codigo Viajes",rPar."Codigo Maletas"]) THEN
        ERROR(Text50101);

      CASE lwConcVar OF
        rPar."Codigo Maletas"    : lwTipoConc:=lwTipoConc::Maletas;
        rPar."Codigo Viajes"     : lwTipoConc:=lwTipoConc::Viajes;
        rPar."Codigo Hora Extra" : lwTipoConc:=lwTipoConc::Horas;
        rPar."Codigo Dieta"      : lwTipoConc:=lwTipoConc::Dietas;
      END;

      // Pedimos el tipo de acuerdo
      CLEAR(lrTipoAc);
      CLEAR(lwTipoAc);
      IF FORM.RUNMODAL(0,lrTipoAc) = ACTION::LookupOK THEN
        lwTipoAc := lrTipoAc."Tipo Acuerdo";

      IF NOT CONFIRM(Text50102 +
                     Text50103,FALSE,
                      lwFecha[1],lwFecha[2],lwConcVar,lwTipoAc) THEN

        EXIT;

      CLEAR(lrReg);
      lrReg.SETRANGE(Fecha, lwFecha[1],lwFecha[2]);
      IF lrReg.FINDSET(TRUE) THEN BEGIN
        wVentana.OPEN(Text50104);
        lwTotal := lrReg.COUNT;
        CLEAR(lwCont);
        REPEAT
          lwOk := lrReg.Validado; // Solo recalculamos los validados

          // Comprobamos que el conductor tenga el tipo de acuerdo
          IF lwOk AND  (lwTipoAc <> '') THEN BEGIN
            rHist.RESET;
            rHist.SETCURRENTKEY(Conductor);
            rHist.SETRANGE(Conductor, lrReg.Conductor);
            rHist.SETRANGE(Confirmado,TRUE);
            rHist.SETFILTER("Fecha Alta", '<=%1', lrReg.Fecha);
            rHist.SETFILTER("Fecha Baja", '%1|>=%2', 0D, lrReg.Fecha);
            rHist.SETRANGE("Tipo Acuerdo", lwTipoAc);
            lwOk := rHist.FINDFIRST;
           END;
          IF lwOk THEN BEGIN // Si el valor anterior <> 0 no recalculamos la actividad
            lrReg2:= lrReg;
            lrReg2.CALCFIELDS(Maletas,"N§ Viajes","N§ Partes");
            CASE lwTipoConc OF
              lwTipoConc::Maletas : lwOk2 := lrReg2.Maletas      = 0;
              lwTipoConc::Viajes  : lwOk2 := lrReg2."N§ Viajes"  = 0;
              lwTipoConc::Dietas  : lwOk2 := lrReg2.Dietas       = 0;
              lwTipoConc::Horas   : lwOk2 := lrReg2."Horas Extra"= 0;
            END;
            lwOk2 := lwOk2 AND (lrReg2."N§ Partes" <>0 );
          END;

          IF lwOk THEN BEGIN
            IF lwOk2 THEN BEGIN // Si hay que rehacer el registro de actividad
              cGen.Generar(lrReg.Garaje,lrReg.Conductor,lrReg.Fecha,lrReg.Fecha,FALSE,lwTipoAc);
              lrReg.CALCFIELDS(Maletas,"N§ Viajes");

              // Maletas
              IF lwTipoConc <> lwTipoConc::Maletas THEN
                cCalcIng.InsertaRegActParteManual(lrReg,lrReg2.Maletas,0);

              IF lwTipoConc <> lwTipoConc::Viajes THEN
                cCalcIng.InsertaRegActParteManual(lrReg,lrReg2."N§ Viajes",1);

              // Dietas
              IF lwTipoConc <> lwTipoConc::Dietas THEN
                lrReg.Dietas := lrReg2.Dietas;

              // Horas Extas
              IF lwTipoConc <> lwTipoConc::Horas THEN
                lrReg."Horas Extra" := lrReg2."Horas Extra";

              lrReg.Validado := FALSE;
              lrReg.MODIFY;

              // Resulta que si hay partes no asignados para ese conducto y dia pide confirmacion
              // y eso no puede ser. Los marcamos todos y los desmarcamos al final
              // para eso me creo un temporary a Partes
              {
              rParte.RESET;
              rParte.SETCURRENTKEY("Cod Conductor",Fecha);
              rParte.SETRANGE(rParte."Cod Conductor", lrReg.Conductor);
              rParte.SETRANGE(Fecha, lrReg.Fecha);
              rParte.SETRANGE("Fecha conductor",0D);
              IF rParte.FINDSET(TRUE) THEN BEGIN
                REPEAT
                  rTEMPParte := rParte; // Guardamos la referencia para desmarcarla a lo ultimo
                  rTEMPParte.INSERT;

                  rParte2 := rParte;
                  rParte2."Fecha conductor":= lrReg.Fecha;
                  rParte2.MODIFY;
                UNTIL rParte.NEXT=0;
              END;
              }
              cActCond.SetSaltarControlPartes(TRUE);
              cActCond.Actualizacion(lrReg.Conductor, lrReg.Fecha);
            END;


            // Calculo de INGRESO
            { Permitimos recalcular aunque este calculado
            CLEAR(lrIng);
            lrReg.CALCFIELDS(Maletas,"N§ Viajes");
            lrIng.SETRANGE(Conductor, lrReg.Conductor);
            lrIng.SETRANGE(Fecha    , lrReg.Fecha);
            lrIng.SETRANGE("Concepto Variable", lwConcVar);
            lwOk2 := NOT lrIng.FINDFIRST;
            }

            lwOk2:= TRUE;

            IF lwOk2 THEN BEGIN

               // Hemos de eliminar primero las lineas de ingreso
              CLEAR(lrIng);
              lrReg.CALCFIELDS(Maletas,"N§ Viajes");
              lrIng.SETRANGE(Conductor, lrReg.Conductor);
              lrIng.SETRANGE(Fecha    , lrReg.Fecha);
              lrIng.SETRANGE("Concepto Variable", lwConcVar);
              IF lrIng.FINDFIRST THEN
                lrIng.DELETEALL;


              lrCond.GET(lrReg.Conductor);

              CLEAR(rRxC);
              IF lwTipoConc IN [lwTipoConc::Maletas, lwTipoConc::Viajes] THEN BEGIN
                rRxC.SETCURRENTKEY(Conductor,Fecha,"Indicador Maletas");
                rRxC.SETRANGE(Conductor, lrReg.Conductor);
                rRxC.SETRANGE(Fecha    , lrReg.Fecha);
                IF lwTipoConc = lwTipoConc::Viajes THEN
                  rRxC.SETRANGE("Indicador Viajes",TRUE);
                IF lwTipoConc = lwTipoConc::Maletas THEN
                  rRxC.SETRANGE("Indicador Maletas",TRUE);
                IF NOT rRxC.FINDFIRST THEN
                  CLEAR(rRxC);
              END;

              CASE lwTipoConc OF
                lwTipoConc::Maletas : lwCantidad := lrReg.Maletas;
                lwTipoConc::Viajes  : lwCantidad := lrReg."N§ Viajes";
                lwTipoConc::Dietas  : lwCantidad := lrReg.Dietas;
                lwTipoConc::Horas   : lwCantidad := lrReg."Horas Extra";
              END;

              cCalcIng.TestConcepto(lwConcVar,lrReg.Fecha,lrReg,lrCond,rRxC,lwPrecio,lwDivisa,lwPredioDL,lwNumCond);
              IF (lwPrecio <> 0) AND (lwCantidad <> 0) THEN
                cCalcIng.GrabarRegistro(lwConcVar,lrCond,lrReg,lrReg.Fecha, lwCantidad,lwPrecio,lwPredioDL,lwDivisa,lwNumCond,rRxC);
            END;
          END;

          lwCont +=1;
          wVentana.UPDATE(1,ROUND(lwCont/lwTotal*10000,1));
        UNTIL lrReg.NEXT=0;
        wVentana.CLOSE;
      END
      ELSE
        ERROR(Text50105);

      {
      // Volvemos a dejar los partes como estaban
      rTEMPParte.RESET;
      IF rTEMPParte.FINDSET THEN BEGIN
        wVentana.OPEN (Text50106);
        CLEAR(lwCont);
        lwTotal := rTEMPParte.COUNT;
        REPEAT
          rParte2 := rTEMPParte;
          IF rParte2.FIND THEN BEGIN
            rParte2."Fecha conductor":= 0D;
            rParte2.MODIFY;
          END;
          lwCont +=1;
          wVentana.UPDATE(1,ROUND(lwCont/lwTotal*10000,1));

        UNTIL rTEMPParte.NEXT=0;
        wVentana.CLOSE;
      END;
      }
    END;

    PROCEDURE PasarTablasProduccion@1103355002();
    VAR
      lrCI@1103355000 : Record 7010414;
      lrCI2@1103355003 : Record 7010414;
      lrPC@1103355001 : Record 7035393;
      lrPI@1103355002 : Record 7035392;
      lrCom@1103355007 : Record 7010411;
      lrCom2@1103355006 : Record 7010411;
      lwTotal@1103355004 : Integer;
      lwCont@1103355005 : Integer;
    BEGIN
      // PasarTablasProduccion
      // Esta macro pasa la informaci¢n de las lineas Coste -Ingreso a las de producci¢n
      // Todas las de coste a la de producci¢n coste (facturadas o no)
      // Todas las facturadas de ingreso.

      // Primero pasamos las lineas de coste

      CLEAR(lrCI);
      lrCI.SETCURRENTKEY(Concepto);
      lrCI.SETRANGE(Concepto, lrCI.Concepto::Coste);
      IF lrCI.FINDSET(TRUE) THEN BEGIN
        lwTotal := lrCI.COUNT;
        lwCont  :=0;
        wVentana.OPEN(Text50107);
        REPEAT
          lrPC.INIT;
          lrPC.TRANSFERFIELDS(lrCI);
          lrPC.INSERT(TRUE);
          lrCI2 := lrCI;
          lrCI2.DELETE;

          // Movemos tambien los comentarios
          CLEAR(lrCom);
          lrCom.SETRANGE("N§ Parte", lrCI."N§ Parte");
          lrCom.SETRANGE(Tipo, lrCom.Tipo::"Facturacion Ingreso");
          lrCom.SETRANGE("N§ Linea" , lrCI."N§ Linea");
          IF lrCom.FINDSET(TRUE) THEN BEGIN
            REPEAT
              lrCom2 := lrCom;
              lrCom2.DELETE;
              lrCom2.Tipo       := lrCom2.Tipo::"Produccion Coste ";
              lrCom2."N§ Linea" := lrPC."N§ Linea";
              lrCom2.INSERT;
            UNTIL lrCom.NEXT=0;
          END;

          lwCont +=1;
          IF lwCont MOD 100 = 0 THEN
            wVentana.UPDATE(1, ROUND(lwCont/lwTotal *10000,1));
        UNTIL lrCI.NEXT=0;
        wVentana.CLOSE;
      END;

      // Luego las de ingreso

      CLEAR(lrCI);
      lrCI.SETCURRENTKEY(Concepto, "N§ Factura");
      lrCI.SETRANGE(Concepto, lrCI.Concepto::Ingreso);
      lrCI.SETRANGE("N§ Factura", '');
      IF lrCI.FINDSET(TRUE) THEN BEGIN
        lwTotal := lrCI.COUNT;
        lwCont  :=0;
        wVentana.OPEN(Text50108);
        REPEAT
          lrPI.INIT;
          lrPI.TRANSFERFIELDS(lrCI);
          lrPI.INSERT(TRUE);
          lrCI2 := lrCI;
          lrCI2.DELETE;

          // Movemos tambien los comenarios
          CLEAR(lrCom);
          lrCom.SETRANGE("N§ Parte", lrCI."N§ Parte");
          lrCom.SETRANGE(Tipo, lrCom.Tipo::"Facturacion Ingreso");
          lrCom.SETRANGE("N§ Linea" , lrCI."N§ Linea");
          IF lrCom.FINDSET(TRUE) THEN BEGIN
            REPEAT
              lrCom2 := lrCom;
              lrCom2.DELETE;
              lrCom2.Tipo       := lrCom2.Tipo::"Produccion Ingreso";
              lrCom2."N§ Linea" := lrPI."N§ Linea";
              lrCom2.INSERT;
            UNTIL lrCom.NEXT=0;
          END;

          lwCont +=1;
          IF lwCont MOD 100 = 0 THEN
            wVentana.UPDATE(1, ROUND(lwCont/lwTotal *10000,1));
        UNTIL lrCI.NEXT=0;
        wVentana.CLOSE;
      END;
    END;

    PROCEDURE RellenaDatosClienteFacturas@1103355003();
    VAR
      lrPref@1103355000 : Record 7010415;
      lwFact@1103355001 : Boolean;
      lrCabVta@1103355002 : Record 36;
      lrCabFra@1103355003 : Record 112;
      lrCabAbn@1103355004 : Record 114;
      lrCliTo@1103355005 : Record 7010313;
      lwTotal@1103355007 : Integer;
      lwCont@1103355006 : Integer;
    BEGIN
      // RellenaDatosClienteFacturas

      // Rellenamos los datos Cliente en la Prefactura ingreso

      CLEAR(lrPref);
      IF lrPref.FINDSET(TRUE) THEN BEGIN
        lwTotal := lrPref.COUNT;
        CLEAR(lwCont);
        wVentana.OPEN(Text50109);
        REPEAT
          lwFact := lrPref.Facturada;
          IF lwFact THEN BEGIN
            IF lrCabVta.GET(lrPref."Tipo Documento", lrPref."N§ Factura") THEN BEGIN
              lrPref."Cliente Facturacion"  := lrCabVta."Sell-to Customer No.";
              lrPref."Nombre Cliente"       := lrCabVta."Sell-to Customer Name";
              lrPref."Direccion Cliente"    := lrCabVta."Sell-to Address";
              lrPref."Direccion Cliente 2"  := lrCabVta."Sell-to Address 2";
              lrPref."C.P."                 := lrCabVta."Sell-to Post Code";
              lrPref.Poblacion              := lrCabVta."Sell-to City";
              lrPref.Provincia              := lrCabVta."Sell-to County";
              lrPref.Pais                   := lrCabVta."Sell-to Country/Region Code";
              lrPref."CIF/NIF"              := lrCabVta."VAT Registration No.";
            END
            ELSE BEGIN
              CASE lrPref."Tipo Documento" OF
                lrPref."Tipo Documento"::Invoice: BEGIN
                  IF lrCabFra.GET(lrPref."N§ Factura") THEN BEGIN
                    lrPref."Cliente Facturacion"  := lrCabFra."Sell-to Customer No.";
                    lrPref."Nombre Cliente"       := lrCabFra."Sell-to Customer Name";
                    lrPref."Direccion Cliente"    := lrCabFra."Sell-to Address";
                    lrPref."Direccion Cliente 2"  := lrCabFra."Sell-to Address 2";
                    lrPref."C.P."                 := lrCabFra."Sell-to Post Code";
                    lrPref.Poblacion              := lrCabFra."Sell-to City";
                    lrPref.Provincia              := lrCabFra."Sell-to County";
                    lrPref.Pais                   := lrCabFra."Sell-to Country/Region Code";
                    lrPref."CIF/NIF"              := lrCabFra."VAT Registration No.";
                  END
                  ELSE
                    lwFact := FALSE;
                END;
                lrPref."Tipo Documento"::"Credit Memo": BEGIN
                  IF lrCabAbn.GET(lrPref."N§ Factura") THEN BEGIN
                    lrPref."Cliente Facturacion"  := lrCabAbn."Sell-to Customer No.";
                    lrPref."Nombre Cliente"       := lrCabAbn."Sell-to Customer Name";
                    lrPref."Direccion Cliente"    := lrCabAbn."Sell-to Address";
                    lrPref."Direccion Cliente 2"  := lrCabAbn."Sell-to Address 2";
                    lrPref."C.P."                 := lrCabAbn."Sell-to Post Code";
                    lrPref.Poblacion              := lrCabAbn."Sell-to City";
                    lrPref.Provincia              := lrCabAbn."Sell-to County";
                    lrPref.Pais                   := lrCabAbn."Sell-to Country/Region Code";
                    lrPref."CIF/NIF"              := lrCabAbn."VAT Registration No.";
                  END
                  ELSE
                    lwFact := FALSE;
                END;
                ELSE lwFact := FALSE;
              END;
            END;
          END;

          // Si no est  facturado cojemos los datos de la configuraci¢n Cliente/TTOO
          IF NOT lwFact THEN BEGIN
            IF lrCliTo.GET(lrPref.Cliente, lrPref.Touroperador) THEN BEGIN
              IF lrCliTo."Cliente facturacion" = '' THEN
                lrCliTo."Cliente facturacion" := lrCliTo.Cliente;
              lrPref."Cliente Facturacion" := lrCliTo."Cliente facturacion";
              lrPref.GetDatosCliente(lrPref."Cliente Facturacion");
            END;
          END;

          lrPref.MODIFY;

          lwCont +=1;
          IF lwCont MOD 10 = 0 THEN
            wVentana.UPDATE(1, ROUND(lwCont/lwTotal *10000,1));

        UNTIL lrPref.NEXT=0;
        wVentana.CLOSE;
      END;
    END;

    PROCEDURE RevisarVehiculoPropio@1103355004();
    VAR
      rParte@1103355005 : Record 7010360;
      rCI@1103355004 : Record 7010414;
      rVeh@1103355003 : Record 7010346;
      lrTOOParte@1103355006 : Record 7010365;
      wVentana@1103355002 : Dialog;
      lwOk@1103355007 : Boolean;
      lwFechaDesde@1103355000 : Date;
      lwFechaHasta@1103355001 : Date;
      lText0001@1103355008 : TextConst 'ESP=Revisar Marca Vehiculo Propio\Fecha desde #1###########\Fecha hasta #2###########';
      lText0002@1103355009 : TextConst 'ESP=Debe de Insetar un rango de fechas';
      lText0003@1103355010 : TextConst 'ESP=¨Desea Realmente iniciar el proceso de comprobar el campo Vehiculo propio para el rango %1 %2?';
      lText0004@1103355011 : TextConst 'ESP=No se ha encontrado ning£n Parte';
      lText0005@1103355012 : TextConst 'ESP=No se ha encontrado ning£n Caso';
      lText0006@1103355013 : TextConst 'ESP=Se han encontrado %1 Casos';
      lwCasos@1103355014 : Integer;
      lwCont@1103355015 : Integer;
      lwTotal@1103355016 : Integer;
    BEGIN
      // RevisarVehiculoPropio
      // Si se cambia el campo "Vehiculo propio" a un vehiculo nos encontramos con que hay informaci¢n ya marcada con el valor
      // anterior en los partes ya creados.
      // Esta macro arregla esta situaci¢n

      wVentana.OPEN(lText0001);
      wVentana.INPUT(1,lwFechaDesde);
      wVentana.INPUT(2,lwFechaHasta);
      IF (lwFechaDesde=0D) OR (lwFechaHasta=0D) THEN
        ERROR(lText0002);

      IF lwFechaDesde > lwFechaHasta THEN
        ERROR(Text163);

      IF NOT CONFIRM(lText0003,FALSE, lwFechaDesde, lwFechaHasta) THEN
        EXIT;

      rParte.RESET;
      rParte.SETCURRENTKEY(Fecha);
      rParte.SETRANGE(Fecha, lwFechaDesde, lwFechaHasta);
      IF rParte.FINDSET THEN BEGIN
        wVentana.OPEN(Text50110);
        CLEAR(lwCasos);
        CLEAR(lwCont);
        lwTotal := rParte.COUNT;
        REPEAT
          wVentana.UPDATE(1, rParte."N§ Parte");
          wVentana.UPDATE(2, rParte.Fecha);
          IF rVeh.GET(rParte.Vehiculo) THEN BEGIN
            CLEAR(lrTOOParte);
            lrTOOParte.SETRANGE("N§ Parte", rParte."N§ Parte");
            IF lrTOOParte.FINDFIRST THEN BEGIN
              // Tengase en cuenta que son valores contrapuestos
              lwOk := lrTOOParte."Servicio arrendado" XOR rVeh."Vehiculo propio";
              IF NOT lwOk THEN BEGIN
                rCI.SETRANGE("N§ Parte", rParte."N§ Parte");
                IF rCI.FINDFIRST THEN
                  rCI.MODIFYALL("Servicio propio", rVeh."Vehiculo propio");
                lrTOOParte.MODIFYALL("Servicio arrendado" , NOT rVeh."Vehiculo propio");
                lwCasos +=1;
              END;
            END;
          END;
          lwCont +=1;
          wVentana.UPDATE(3, ROUND(lwCont/lwTotal*10000,1));
        UNTIL rParte.NEXT = 0;
      END
      ELSE ERROR (lText0004);


      IF lwCasos=0 THEN
        MESSAGE(lText0005)
      ELSE
        MESSAGE(lText0006,lwCasos);
    END;

    PROCEDURE RellenaOrigenCreacionLinsParte@1103355005();
    VAR
      lrPartes@1103355000 : Record 7010360;
      lrLinsParte@1103355001 : Record 7010359;
    BEGIN

      lrPartes.SETFILTER (lrPartes.Fecha, '>=%1', 010108D);

      IF lrPartes.FINDSET THEN BEGIN
        REPEAT
          lrLinsParte.SETRANGE("N§ Parte", lrPartes."N§ Parte");
          IF lrLinsParte.FINDFIRST THEN BEGIN
            lrLinsParte.MODIFYALL("Origen creacion", lrPartes."Origen creacion");
          END;
        UNTIL lrPartes.NEXT = 0;
      END;
    END;

    PROCEDURE InicializaBuscaPrecioIngreso@1103355006();
    VAR
      lrClientes@1103355000 : Record 18;
      wVentana@1103355001 : Dialog;
      lText0001@1103355002 : TextConst 'ESP=Inicializando nuevo campo en Clientes: @3@@@@@@@@@@@@@@@@.';
      lwCont@1103355004 : Integer;
      lwTotal@1103355003 : Integer;
    BEGIN
      // InicializaBuscaPrecioIngreso

      IF lrClientes.FINDSET(TRUE) THEN BEGIN

        wVentana.OPEN(lText0001);
        lwCont   := 0;
        lwTotal := lrClientes.COUNTAPPROX;

        REPEAT

          lrClientes."Busca precio ingreso" := lrClientes."Busca precio ingreso"::"Pasaje conjunto";
          lrClientes.MODIFY;

          lwCont +=1;
          wVentana.UPDATE(3, ROUND(lwCont/lwTotal*10000,1));

        UNTIL lrClientes.NEXT = 0;
      END;

      wVentana.CLOSE;
    END;

    PROCEDURE RellenaZonaFacturacionContrato@1103355007();
    VAR
      lrCont@1103355000 : Record 7010403;
      lrZon@1103355001 : Record 7010404;
      lrZonTTOO@1103355003 : Record 7010436;
      lrZonFis@1103355004 : Record 7010314;
      lrZonTrab@1103355005 : Record 7010429;
      lwTieneZonas@1103355002 : Boolean;
    BEGIN
      // RellenaZonaFacturacionContrato

      // AJS 24.06.2008
      // La zona de facturacion de los contratos se rellena en funcion de la zona de trabajo
      // de las zonas fisicas menos en aquellos TTOO que tengan definicion propia

      // Solo los contratos que finalicen a partir del 2007

      lrCont.RESET;
      lrCont.SETFILTER("Fecha final contrato", '>=%1', 311205D);
      lrCont.SETRANGE (Confirmado            , TRUE);
      IF lrCont.FINDSET THEN BEGIN
        crea_ventana(Text201);
        wTotal := lrCont.COUNT;
        REPEAT
          actualiza_ventana;

          lrZon.SETRANGE(Garaje         , lrCont.Garaje);
          lrZon.SETRANGE("N§ Contrato"  , lrCont."N§ Contrato");
          lrZon.SETRANGE("Tipo contrato", lrZon."Tipo contrato"::Venta);
          IF lrZon.FINDSET(TRUE) THEN BEGIN
            REPEAT
              // Comprobamos si el touroperador del contrato tiene su propia definicion de zonas

              //lrZonTTOO.SETRANGE(Touroperador        , lrCont.Touroperador);
              //lrZonTTOO.SETRANGE("Tipo linea", lrZon."Tipo Servicio fijo");
              //lrZonTTOO.SETRANGE("Zona Fisica"       , lrZon."Codigo Origen");
              //IF lrZonTTOO.FINDFIRST THEN
              //  lrZon."Zona facturacion" := lrZonTTOO."Linea diario"
              //ELSE
              //  lrZon."Zona facturacion" := lrZonFis.GetZonaTrabajo(lrZon."Codigo Origen", '', '');

              //IF lrZonTrab.GET(lrZon."Zona facturacion") THEN
              //  lrZon."Descripcion Zona facturacion" := lrZonTrab.Descripcion;

              //lrZon.MODIFY;
            UNTIL lrZon.NEXT = 0;
          END;
        UNTIL lrCont.NEXT = 0;
      END;
    END;

    PROCEDURE DuplicaZonasPrecio@1103355008();
    VAR
      lrZon@1103355000 : Record 7010404;
      lrZon2@1103355001 : Record 7010404;
    BEGIN
      // DuplicaZonasPrecio

      // AJS 30.06.2008, TNU08002
      // Como he incluido un nuevo campo Tipo Servicio fijo en la clave primaria
      // de las zonas de contrato hay que duplicar los registros

      lrZon.RESET;
      lrZon.SETRANGE("Tipo Servicio fijo", lrZon."Tipo Servicio fijo"::Excursion);
      IF lrZon.FINDSET THEN BEGIN
        crea_ventana(Text202);
        wTotal := lrZon.COUNT;
        REPEAT
          actualiza_ventana;

          lrZon2 := lrZon;
          lrZon2."Tipo Servicio fijo" := lrZon2."Tipo Servicio fijo"::Traslado;
          lrZon2.INSERT;
        UNTIL lrZon.NEXT = 0;
      END;
    END;

    PROCEDURE ActualizaCamposRegistroDiario@1103355009();
    VAR
      lrRegDiario@1103355000 : Record 7035342;
      lrVehiculo@1103355001 : Record 7010346;
      lwCont@1103355002 : Integer;
      lwTotal@1103355003 : Integer;
    BEGIN
      // ActualizaCamposRegistroDiario

      // AJF 08/07/08
      // Actualizamos los campos pasados de calculados a campos regulares.

      lrRegDiario.RESET;
      IF lrRegDiario.FINDSET(TRUE) THEN BEGIN

        wVentana.OPEN(Text203);
        lwCont   := 0;
        lwTotal := lrRegDiario.COUNTAPPROX;

        REPEAT
          IF lrVehiculo.GET(lrRegDiario.Matricula) THEN BEGIN
            lrRegDiario.Marca  := lrVehiculo.Marca;
            lrRegDiario.Plazas := lrVehiculo.Plazas;
            lrRegDiario.MODIFY
          END;

          lwCont +=1;
          wVentana.UPDATE(3, ROUND(lwCont/lwTotal*10000,1));

        UNTIL lrRegDiario.NEXT = 0;
        wVentana.CLOSE;
      END;
    END;

    PROCEDURE ActualizacionGarajeTTOOxParte@1103355010();
    VAR
      lfSelFechas@1103355000 : Form 7010457;
      lrPartes@1103355001 : Record 7010360;
      lrTTOOParte@1103355002 : Record 7010365;
      lrCond@1103355003 : Record 7010420;
      lwCont@1103355004 : Integer;
      lwTotal@1103355005 : Integer;
      lwVentana@1103355006 : Dialog;
    BEGIN
      // ActualizacionGarajeTTOOxParte

      // AJF 21/08/08
      // Actualizamos el campo de Garaje de las l¡neas de TTOOxParte con el Garaje del parte.

      lrCond.Inicializa;
      lrCond.MODIFY;
      lrCond.SETRECFILTER;
      COMMIT;

      lfSelFechas.SETTABLEVIEW(lrCond);
      lfSelFechas.SETRECORD   (lrCond);

      IF NOT(lfSelFechas.RUNMODAL IN [ACTION::LookupOK,ACTION::OK]) THEN
        EXIT;

      COMMIT;
      lrCond.GET(USERID);

      lrPartes.SETCURRENTKEY(Confirmado, Vehiculo, "Fecha facturacion", "Tipo Servicio", "Codigo Servicio", Garaje);

      lrPartes.SETRANGE("Fecha facturacion", lrCond."Fecha desde", lrCond."Fecha hasta");

      IF lrPartes.FINDSET THEN BEGIN

        wVentana.OPEN(Text204);
        lwCont   := 0;
        lwTotal := lrPartes.COUNTAPPROX;

        REPEAT

          lrTTOOParte.RESET;
          lrTTOOParte.SETRANGE("N§ Parte", lrPartes."N§ Parte");

          lrTTOOParte.MODIFYALL(Garaje, lrPartes.Garaje);

          lwCont +=1;
          IF (lwCont MOD 10) = 0 THEN
            wVentana.UPDATE(3, ROUND(lwCont/lwTotal*10000,1));

        UNTIL lrPartes.NEXT = 0;

        wVentana.CLOSE;
      END;

      MESSAGE(Text205, lwCont);
    END;

    PROCEDURE NuevoCampoCarroceria@1103355011();
    VAR
      lrReg@1103355000 : Record 7035342;
      lrVeh@1103355003 : Record 7010346;
      lwCont@1103355001 : Integer;
      lwTotal@1103355002 : Integer;
    BEGIN
      // NuevoCampoCarroceria
      // Rellena el nuevo campo Carroceria en Registro Diario

      CLEAR(lrReg);
      IF lrReg.FINDSET(TRUE) THEN BEGIN
        lwCont  := 0;
        lwTotal := lrReg.COUNT;
        wVentana.OPEN(Text50111);
        REPEAT
          IF lrVeh.GET(lrReg.Matricula) THEN
            lrReg.Carroceria := lrVeh.Carroceria;
          lrReg.MODIFY;
          lwCont +=1;
          wVentana.UPDATE(1,ROUND(lwCont/lwTotal*10000,1));
        UNTIL lrReg.NEXT=0;
        wVentana.CLOSE;
      END;
    END;

    PROCEDURE MueveInfoCamposUsuario@1103355012();
    VAR
      lrUsuario@1103355000 : Record 2000000002;
      lrUsuTransfer@1103355001 : Record 7010420;
      lrCampo@1103355002 : Record 2000000041;
      lrEmpresa@1103355003 : Record 2000000006;
    BEGIN
      // MueveInfoCamposUsuario

      // movemos la informaci¢n a usuario transfer.
      IF lrUsuario.FINDSET(TRUE) THEN BEGIN
        REPEAT

          lrEmpresa.RESET;
          IF lrEmpresa.FINDSET THEN BEGIN
            REPEAT
              IF NOT lrUsuTransfer.GET(lrUsuario."User ID") THEN BEGIN
                lrUsuTransfer.INIT;
                lrUsuTransfer.Usuario := lrUsuario."User ID";
                lrUsuTransfer.INSERT;
              END;
              { para que compile el objeto
              lrUsuTransfer."Garaje de trabajo"    := lrUsuario."Garaje de trabajo";
              lrUsuTransfer."Perfil Transfer"      := lrUsuario."Perfil Finbus";
              lrUsuTransfer."Garaje por defecto"   := lrUsuario."Garaje por defecto";
              lrUsuTransfer."Orden en Conductores" := lrUsuario."Orden en Conductores";
              lrUsuTransfer."Garaje Automatico"    := lrUsuario."Garaje Automatico";
              lrUsuTransfer.MODIFY;
              }
            UNTIL lrEmpresa.NEXT = 0;
          END;
          { para que compile el objeto
          CLEAR(lrUsuario."Garaje de trabajo");
          CLEAR(lrUsuario."Perfil Finbus");
          CLEAR(lrUsuario."Garaje por defecto");
          CLEAR(lrUsuario."Orden en Conductores");
          CLEAR(lrUsuario."Garaje Automatico");
          }
          lrUsuario.MODIFY;
        UNTIL lrUsuario.NEXT = 0;
      END;

      // Borramos los campos de la tabla user.
      IF lrCampo.GET(2000000002, 50000) THEN
        lrCampo.DELETE;
      IF lrCampo.GET(2000000002, 50005) THEN
        lrCampo.DELETE;
      IF lrCampo.GET(2000000002, 50006) THEN
        lrCampo.DELETE;
      IF lrCampo.GET(2000000002, 50007) THEN
        lrCampo.DELETE;
      IF lrCampo.GET(2000000002, 50010) THEN
        lrCampo.DELETE;

      MESSAGE(Text50112);
    END;

    PROCEDURE RellenaFechaReal@1103355013();
    VAR
      lrParte@1103355000 : Record 7010360;
      lwTotal@1103355001 : Integer;
      lwCont@1103355002 : Integer;
      lwFecha@1103355003 : Date;
    BEGIN
      // RellenaFechaReal

      lwFecha := TODAY;
      wVentana.OPEN(Text50113 +
                    Text50114);

      wVentana.UPDATE(1, lwFecha);
      wVentana.INPUT(1, lwFecha);
      IF lwFecha=0D THEN
        ERROR(Text50115);

      CLEAR(lrParte);
      lrParte.SETCURRENTKEY(Fecha);
      lrParte.SETFILTER(Fecha, '>=%1', lwFecha);
      IF lrParte.FINDSET(TRUE) THEN BEGIN
        wVentana.OPEN(Text50116);
        lwTotal := lrParte.COUNT;
        lwCont  := 0;
        REPEAT
          IF lrParte."Fecha Real" = 0D THEN BEGIN
            lrParte.ActualizaHoraDT;
            lrParte.MODIFY;
          END;
          lwCont +=1;
          wVentana.UPDATE(1, ROUND(lwCont/lwTotal*10000,1));
        UNTIL lrParte.NEXT=0;
        wVentana.CLOSE;
      END;
    END;

    PROCEDURE ListarCodServicioNoUsados@1103355014();
    VAR
      lrCodSer@1103355000 : Record 7010320;
      lrParGen@1103355001 : Record 7010311;
      lrServicio@1103355002 : Record 7010358;
      lrParte@1103355003 : Record 7010360;
      lrSerReg@1103355004 : Record 7010379;
      lrPreCompra@1103355005 : Record 7010409;
      lrPreVenta@1103355006 : Record 7010405;
      lwUsado@1103355007 : Boolean;
      lwFin@1103355009 : Boolean;
      lwCont@1103355008 : Integer;
      lwFile@1103355010 : File;
      lfDirs@1103355011 : Form 7035279;
      lrDirs@1103355012 : Record 2000000022;
      lwCreado@1103355013 : Boolean;
      lwDialog@1103355014 : Dialog;
      lwCount@1103355015 : Integer;
      lwTot@1103355016 : Integer;
    BEGIN
      // ListarCodServicioNoUsados
      //: Saca una lista de c¢digos de servicio no usados nunca en la aplicaci¢n.

      IF NOT CONFIRM(Text50117 +
                     Text50118) THEN
        EXIT;

      lfDirs.MostrarSoloDirectorios(TRUE);
      lfDirs.LOOKUPMODE := TRUE;
      lfDirs.RUNMODAL;

      IF NOT lfDirs.OK THEN
        EXIT;

      lfDirs.GETRECORD(lrDirs);

      lrCodSer.RESET;

      lwTot := lrCodSer.COUNT;

      IF lrCodSer.FINDSET THEN BEGIN

        lrParGen.FINDFIRST;

        lwDialog.OPEN(Text50119);

        REPEAT

          lwUsado := FALSE;
          lwFin   := FALSE;
          lwCont  := 0;
          lwCount += 1;

          lwDialog.UPDATE(1, ROUND(lwCount / lwTot * 10000, 1));

          WHILE NOT lwUsado AND NOT lwFin DO BEGIN

            lwCont += 1;

            CASE lwCont OF
              1: lwUsado := lrCodSer.Codigo IN [lrParGen."Codigo Salidas",
                                                lrParGen."Codigo Entradas",
                                                lrParGen."Codigo Recogidas"];
              2: BEGIN
                lrServicio.SETCURRENTKEY("Codigo Servicio");
                lrServicio.SETRANGE ("Codigo Servicio", lrCodSer.Codigo);
                lwUsado := NOT lrServicio.ISEMPTY;
              END;

              3: BEGIN
                lrParte.SETCURRENTKEY(Facturado, "Codigo Servicio");
                lrParte.SETRANGE ("Codigo Servicio", lrCodSer.Codigo);
                lwUsado := NOT lrParte.ISEMPTY;
              END;

              4: BEGIN
                lrSerReg.SETRANGE("Codigo Servicio", lrCodSer.Codigo);
                lwUsado := NOT lrSerReg.ISEMPTY;
              END;

              5: BEGIN
                lrPreCompra.SETCURRENTKEY(Garaje, "N§ Contrato", "Tipo precio", "Codigo servicio");
                lrPreCompra.SETRANGE ("Codigo servicio", lrCodSer.Codigo);
                lwUsado := NOT lrPreCompra.ISEMPTY;
              END;

              6: BEGIN
                lrPreVenta.SETCURRENTKEY(Garaje, "N§ Contrato", "Tipo precio", "Codigo servicio");
                lrPreVenta.SETRANGE ("Codigo servicio", lrCodSer.Codigo);
                lwUsado := NOT lrPreVenta.ISEMPTY;
              END;

              7: BEGIN
                lwFin := TRUE;
              END;

            END;

          END;

          IF NOT lwUsado THEN BEGIN

            IF NOT lwCreado THEN BEGIN
              lwFile.WRITEMODE := TRUE;
              lwFile.TEXTMODE  := TRUE;
              lwFile.CREATE(lrDirs.Path + '\' + Text50120);
              lwCreado := TRUE;
              lwFile.WRITE(Text50121);
            END;

            lwFile.WRITE(lrCodSer.Codigo + ';' + lrCodSer.Descripcion + ';' + lrCodSer."Tipo servicio");

          END;

        UNTIL lrCodSer.NEXT = 0;

        lwDialog.CLOSE;

        IF lwCreado THEN BEGIN
          lwFile.CLOSE;
          MESSAGE(Text50122 + Text50120);
        END;

      END;
    END;

    PROCEDURE DateTimeToBigInteger@1103355015();
    VAR
      lrParte@1103355000 : Record 7010360;
      lrSerPar@1103355001 : Record 7010359;
      lrVue@1103355002 : Record 7035335;
      lwTotal@1103355003 : Integer;
      lwCont@1103355004 : Integer;
    BEGIN
      // DateTimeToBigInteger

      // JPT 02/02/10 Datetime a Biginteger
      // Rellena los campos Biginteger que sustituyen a los Datetimes
      // Para evitar el desfase en los cambios horarios

      wVentana.OPEN('Rellenando Campos Auxiliars Datetime\#1##################\#2##################\@3@@@@@@@@@@@@@@@@@@@');

      // Por empresa
      CLEAR(rEmp);
      IF rEmp.FINDSET THEN BEGIN
        REPEAT
          wVentana.UPDATE(1, rEmp.Name);

          CLEAR(lrParte);
          lrParte.CHANGECOMPANY(rEmp.Name);
          IF lrParte.FINDSET THEN BEGIN
            wVentana.UPDATE(2, lrParte.TABLECAPTION);
            lwTotal := lrParte.COUNT;
            CLEAR(lwCont);
            REPEAT
              IF lrParte."Hora Inicio DT" <> 0DT THEN BEGIN
                lrParte.VALIDATE("Hora Inicio DT");
                lrParte.MODIFY;
              END;
              lwCont +=1;
              IF lwCont MOD 100 =0 THEN
                wVentana.UPDATE(3, ROUND(lwCont/lwTotal*10000,1));
            UNTIL lrParte.NEXT=0;
          END;

          CLEAR(lrSerPar);
          lrSerPar.CHANGECOMPANY(rEmp.Name);
          IF lrSerPar.FINDSET THEN BEGIN
            wVentana.UPDATE(2, lrSerPar.TABLECAPTION);
            lwTotal := lrSerPar.COUNT;
            CLEAR(lwCont);
            REPEAT
              IF (lrSerPar."FechaHora Vuelo"<>0DT) OR (lrSerPar."FechaHora Parte" <> 0DT) THEN BEGIN
                lrSerPar.VALIDATE("FechaHora Parte");
                lrSerPar.ConvDTBIV;
                lrSerPar.MODIFY;
              END;
              lwCont +=1;
              IF lwCont MOD 100 =0 THEN
                wVentana.UPDATE(3, ROUND(lwCont/lwTotal*10000,1));
            UNTIL lrSerPar.NEXT=0;
          END;

          CLEAR(lrVue);
          lrVue.CHANGECOMPANY(rEmp.Name);
          IF lrVue.FINDSET THEN BEGIN
            wVentana.UPDATE(2, lrVue.TABLECAPTION);
            lwTotal := lrVue.COUNT;
            CLEAR(lwCont);
            REPEAT
              IF lrVue."FechaHora Vuelo" <> 0DT THEN BEGIN
                lrVue.VALIDATE("FechaHora Vuelo");
                lrVue.MODIFY;
              END;
              lwCont +=1;
              IF lwCont MOD 100 =0 THEN
                wVentana.UPDATE(3, ROUND(lwCont/lwTotal*10000,1));
            UNTIL lrVue.NEXT=0;
          END;
        UNTIL rEmp.NEXT=0;
      END;
      wVentana.CLOSE;
    END;

    PROCEDURE ActualizarClienteOperativo@1100253007();
    VAR
      lrCI@1100253000 : Record 7010414;
      lrToPar@1100253001 : Record 7010365;
      lrCust@1100253002 : Record 18;
      lrSelCT@1100253003 : Record 7010324;
      lrPI@1100253004 : Record 7035392;
    BEGIN
      // ActualizarClienteOperativo.

      CLEAR(lrCust);
      IF lrCust.FINDSET THEN BEGIN
        REPEAT

          CLEAR(lrCI);
          lrCI.SETCURRENTKEY("Cliente estadistico", Touroperador);
          lrCI.SETRANGE ("Cliente estadistico", lrCust."No.");
          lrCI.MODIFYALL("Cliente Operativo"  , lrCust."No.");

          CLEAR(lrToPar);
          lrToPar.SETCURRENTKEY(Confirmado, "Cliente estadistico", Touroperador);
          lrToPar.SETRANGE ("Cliente estadistico", lrCust."No.");
          lrToPar.MODIFYALL("Cliente operativo"  , lrCust."No.");

          CLEAR(lrPI);
          lrPI.SETCURRENTKEY("Cliente estadistico", Touroperador);
          lrPI.SETRANGE ("Cliente estadistico", lrCust."No.");
          lrPI.MODIFYALL("Cliente Operativo"  , lrCust."No.");

        UNTIL lrCust.NEXT = 0;
      END;

      // Eliminamos tambin el temporal selecci¢n cliente-ttoo ya que se ha a¤adido
      // un campo extra de cliente operativo para gestionar la selecci¢n correctamente.

      CLEAR(lrSelCT);
      lrSelCT.DELETEALL;
    END;

    PROCEDURE ActualizarViajesPartes@1100253008();
    VAR
      lrParte@1100253000 : Record 7010360;
      lrCI@1100253001 : Record 7010414;
      lrToPar@1100253002 : Record 7010365;
      lrPI@1100253003 : Record 7035392;
    BEGIN
      // ActualizarViajesPartes.

      CLEAR(lrParte);
      IF lrParte.FIND('-') THEN BEGIN
        REPEAT
          lrParte.ProratearViajes;

          IF lrParte."Origen creacion" = lrParte."Origen creacion"::"Recogida Automatica" THEN BEGIN

            CLEAR(lrCI);
            lrCI.SETRANGE("N§ Parte", lrParte."N§ Parte");
            lrCI.MODIFYALL("Pax Facturados"   , 0);
            lrCI.MODIFYALL("Pax Transportados", 0);

            CLEAR(lrToPar);
            lrToPar.SETRANGE("N§ Parte", lrParte."N§ Parte");
            lrToPar.MODIFYALL("Adultos transportados", 0);
            lrToPar.MODIFYALL("Ni¤os transportados"  , 0);
            lrToPar.MODIFYALL("Pax Transportados"    , 0);
            lrToPar.MODIFYALL("Adultos facturados"   , 0);
            lrToPar.MODIFYALL("Ni¤os facturados"     , 0);

            CLEAR(lrPI);
            lrPI.SETRANGE("N§ Parte", lrParte."N§ Parte");
            lrPI.MODIFYALL("Pax Facturados"   , 0);
            lrPI.MODIFYALL("Pax Transportados", 0);

          END;
        UNTIL lrParte.NEXT = 0;
      END;
    END;

    PROCEDURE PurgarHistoricoContrato@1000000000();
    VAR
      lwFecha@1000000002 : Date;
      lrHistCont@1000000001 : Record 7010316;
      lrHistPre@1000000000 : Record 7010317;
    BEGIN
      // PurgarHistoricoContrato

      lwFecha := CALCDATE('<-1Y>', TODAY);
      IF NOT CONFIRM('Se van a borrar los registros del historico de modificaciones de contratos anteriores a %1', FALSE, lwFecha) THEN
        EXIT;

      lrHistCont.RESET;
      lrHistCont.SETFILTER(Fecha, '<%1', lwFecha);
      IF lrHistCont.FIND('-') THEN
        lrHistCont.DELETEALL;

      lrHistPre.RESET;
      lrHistPre.SETFILTER(Fecha, '<%1', lwFecha);
      IF lrHistPre.FIND('-') THEN
        lrHistPre.DELETEALL;
    END;

    PROCEDURE EliminaInfoContable@1000000001();
    VAR
      lwFecha@1000000023 : Date;
      lwFechaAux@1000000022 : Date;
      lrItemLE@1000000021 : Record 32;
      lrItemRe@1000000020 : Record 46;
      lrItemApp@1000000019 : Record 339;
      lrCabVenta@1000000018 : Record 36;
      lrLinVenta@1000000017 : Record 37;
      lrComVenta@1000000016 : Record 44;
      lrDimDoc@1000000015 : Record 357;
      lrLinDia@1000000014 : Record 81;
      lrDimDia@1000000013 : Record 356;
      lrPref@1000000012 : Record 7010415;
      lrLinPref@1000000011 : Record 7010417;
      lrZonPref@1000000010 : Record 7010418;
      lrDtoPref@1000000009 : Record 19;
      lrECOCont@1000000008 : Record 7010381;
      lrECOCont2@1000000007 : Record 7010381;
      lrECOIva@1000000006 : Record 7010384;
      lrECOIva2@1000000005 : Record 7010384;
      lrECOAux@1000000004 : Record 7010382;
      lrECOAux2@1000000003 : Record 7010382;
      lwAny@1000000002 : Integer;
      lwMes@1000000001 : Integer;
      lwDia@1000000000 : Integer;
    BEGIN
      // EliminaInfoContable

      wVentana.OPEN('INTRODUZCA FECHA: #1########');
      wVentana.INPUT(1, lwFecha);
      wVentana.CLOSE;

      IF lwFecha = 0D THEN
        EXIT;

      IF NOT CONFIRM('Desea borrar toda la informacion contable anterior a dia %1', FALSE, lwFecha) THEN
        EXIT;

      wVentana.OPEN('Borrando registros...');

      //. Eliminar informacion de movimientos de producto

      lrItemLE.RESET;
      lrItemLE.SETCURRENTKEY("Document No.", "Posting Date");
      lrItemLE.SETFILTER("Posting Date", '<%1', lwFecha);
      IF lrItemLE.FIND('-') THEN
      BEGIN
        lrItemApp.RESET;
        lrItemApp.SETCURRENTKEY("Item Ledger Entry No.");
        REPEAT
          lrItemApp.SETRANGE("Item Ledger Entry No.", lrItemLE."Entry No.");
          IF lrItemApp.FIND('-') THEN
            lrItemApp.DELETEALL;
        UNTIL lrItemLE.NEXT = 0;
        lrItemLE.DELETEALL;
      END;

      lrItemRe.RESET;
      lrItemRe.SETFILTER("Creation Date", '<%1', lwFecha);
      IF lrItemRe.FIND('-') THEN
        lrItemRe.DELETEALL;

      //. Eliminar facturas

      lrCabVenta.RESET;
      lrCabVenta.SETFILTER("Posting Date", '<%1', lwFecha);
      IF lrCabVenta.FIND('-') THEN
      BEGIN
        REPEAT
          lrLinVenta.SETRANGE("Document Type", lrCabVenta."Document Type");
          lrLinVenta.SETRANGE("Document No." , lrCabVenta."No.");
          IF lrLinVenta.FIND('-') THEN
            lrLinVenta.DELETEALL;

          lrComVenta.SETRANGE("Document Type", lrCabVenta."Document Type");
          lrComVenta.SETRANGE("No."          , lrCabVenta."No.");
          IF lrComVenta.FIND('-') THEN
            lrComVenta.DELETEALL;

          lrDimDoc.SETRANGE("Table ID"     , 36, 37);
          lrDimDoc.SETRANGE("Document Type", lrCabVenta."Document Type");
          lrDimDoc.SETRANGE("Document No." , lrCabVenta."No.");
          IF lrDimDoc.FIND('-') THEN
            lrDimDoc.DELETEALL;
        UNTIL lrCabVenta.NEXT = 0;

        lrCabVenta.DELETEALL;
      END;

      //. Eliminar lineas de diario

      lrLinDia.RESET;
      lrLinDia.SETCURRENTKEY("Journal Template Name", "Journal Batch Name", "Posting Date", "Document No.");
      lrLinDia.SETFILTER("Posting Date", '<%1', lwFecha);
      IF lrLinDia.FIND('-') THEN
      BEGIN
        REPEAT
          lrDimDia.SETRANGE("Table ID"             , 81);
          lrDimDia.SETRANGE("Journal Template Name", lrLinDia."Journal Template Name");
          lrDimDia.SETRANGE("Journal Batch Name"   , lrLinDia."Journal Batch Name");
          lrDimDia.SETRANGE("Journal Line No."     , lrLinDia."Line No.");
          IF lrDimDia.FIND('-') THEN
            lrDimDia.DELETEALL;
        UNTIL lrLinDia.NEXT = 0;

        lrLinDia.DELETEALL;
      END;

      //. Eliminar prefacturas

      lrPref.RESET;
      lrPref.SETCURRENTKEY(Fecha, Cliente, Touroperador, Facturada);
      lrPref.SETFILTER(Fecha, '<%1', lwFecha);
      IF lrPref.FIND('-') THEN
      BEGIN
        REPEAT
          lrLinPref.SETRANGE("N§ Prefactura", lrPref."N§ Prefactura");
          IF lrLinPref.FIND('-') THEN
            lrPref.DELETEALL;

          lrZonPref.SETRANGE("N§ Prefactura", lrPref."N§ Prefactura");
          IF lrZonPref.FIND('-') THEN
            lrZonPref.DELETEALL;

          lrDtoPref.SETRANGE(Code, lrPref."N§ Prefactura");
          IF lrDtoPref.FIND('-') THEN
            lrDtoPref.DELETEALL;
        UNTIL lrPref.NEXT = 0;

        lrPref.DELETEALL;
      END;

      //. Eliminar informacion interface ECOFIN

      lrECOCont.RESET;
      IF lrECOCont.FIND('-') THEN
      BEGIN
        REPEAT
          EVALUATE(lwAny, lrECOCont.Anyapu);
          EVALUATE(lwMes, lrECOCont.Mesapu);
          EVALUATE(lwDia, lrECOCont.Diaapu);
          IF (lwAny = 0) OR
             (lwMes = 0) OR
             (lwDia = 0) THEN
            lwFechaAux := DMY2DATE(1, 1, 1990)
          ELSE
            lwFechaAux := DMY2DATE(lwDia, lwMes, lwAny);

          IF lwFechaAux < lwFecha THEN
          BEGIN
            lrECOCont2 := lrECOCont;
            lrECOCont2.DELETE;
          END;
        UNTIL lrECOCont.NEXT = 0;
      END;

      lrECOIva.RESET;
      IF lrECOIva.FIND('-') THEN
      BEGIN
        REPEAT
          EVALUATE(lwAny, lrECOIva.Anyval);
          EVALUATE(lwMes, lrECOIva.Mesval);
          EVALUATE(lwDia, lrECOIva.Diaval);
          IF (lwAny = 0) OR
             (lwMes = 0) OR
             (lwDia = 0) THEN
            lwFechaAux := DMY2DATE(1, 1, 1990)
          ELSE
            lwFechaAux := DMY2DATE(lwDia, lwMes, lwAny);

          IF lwFechaAux < lwFecha THEN
          BEGIN
            lrECOIva2 := lrECOIva;
            lrECOIva2.DELETE;
          END;
        UNTIL lrECOIva.NEXT = 0;
      END;

      lrECOAux.RESET;
      IF lrECOAux.FIND('-') THEN
      BEGIN
        REPEAT
          EVALUATE(lwAny, lrECOAux.AnyApu);
          EVALUATE(lwMes, lrECOAux.MesApu);
          IF (lwAny = 0) OR
             (lwMes = 0) THEN
            lwFechaAux := DMY2DATE(1, 1, 1990)
          ELSE
            lwFechaAux := DMY2DATE(1, lwMes, lwAny);

          IF lwFechaAux < lwFecha THEN
          BEGIN
            lrECOAux2 := lrECOAux;
            lrECOAux2.DELETE;
          END;
        UNTIL lrECOAux.NEXT = 0;
      END;

      wVentana.CLOSE;
    END;

    PROCEDURE PurgarContratosVenta@1000000002();
    VAR
      lrContVenta@1000000003 : Record 7010403;
      lrZonCont@1000000002 : Record 7010404;
      lrPreCont@1000000001 : Record 7010405;
      lwFecha@1000000000 : Date;
    BEGIN
      // PurgarContratosVenta

      wVentana.OPEN('INTRODUZCA FECHA: #1########');
      wVentana.INPUT(1, lwFecha);
      wVentana.CLOSE;

      IF lwFecha = 0D THEN
        EXIT;

      IF NOT CONFIRM('Desea borrar toda la informacion de contratos anterior a dia %1', FALSE, lwFecha) THEN
        EXIT;

      wVentana.OPEN('Borrando registros...');

      lrContVenta.RESET;
      lrContVenta.SETFILTER("Fecha final contrato", '<%1', lwFecha);
      IF lrContVenta.FIND('-') THEN
      BEGIN
        REPEAT
          lrZonCont.SETRANGE(Garaje         , lrContVenta.Garaje);
          lrZonCont.SETRANGE("N§ Contrato"  , lrContVenta."N§ Contrato");
          lrZonCont.SETRANGE("Tipo contrato", lrZonCont."Tipo contrato"::Venta);
          IF lrZonCont.FIND('-') THEN
            lrZonCont.DELETEALL;

          lrPreCont.SETRANGE(Garaje       , lrContVenta.Garaje);
          lrPreCont.SETRANGE("N§ Contrato", lrContVenta."N§ Contrato");
          IF lrPreCont.FIND('-') THEN
            lrPreCont.DELETEALL;
        UNTIL lrContVenta.NEXT = 0;

        lrContVenta.DELETEALL;
      END;

      wVentana.CLOSE;
    END;

    PROCEDURE PurgarImportacionXML@1000000003();
    VAR
      lwFecha@1000000004 : Date;
      lrCabIfs@1000000003 : Record 7010431;
      lrLinIfs@1000000002 : Record 7010432;
      lrVueIfs@1000000001 : Record 7035391;
      lrErrIfs@1000000000 : Record 7035334;
    BEGIN
      // PurgarImportacionXML

      lwFecha := CALCDATE('<-1Y>', TODAY);
      IF NOT CONFIRM('Desea eliminar la informacion del interface XML de servicios con fecha anterior a dia %1', FALSE, lwFecha) THEN
        EXIT;

      lrCabIfs.RESET;
      lrCabIfs.SETFILTER(Fecha, '<%1', lwFecha);
      IF lrCabIfs.FIND('-') THEN
      BEGIN
        REPEAT
          lrLinIfs.SETRANGE(Importacion  , lrCabIfs.Importacion);
          lrLinIfs.SETRANGE("No Cabecera", lrCabIfs."No.");
          IF lrLinIfs.FIND('-') THEN
            lrLinIfs.DELETEALL;

          lrVueIfs.SETRANGE(Importacion   , lrCabIfs.Importacion);
          lrVueIfs.SETRANGE("No. Cabecera", lrCabIfs."No.");
          IF lrVueIfs.FIND('-') THEN
            lrVueIfs.DELETEALL;

          lrErrIfs.SETRANGE("No Importacion", lrCabIfs.Importacion);
          lrErrIfs.SETRANGE(NoCab           , lrCabIfs."No.");
          IF lrErrIfs.FIND('-') THEN
            lrErrIfs.DELETEALL;
        UNTIL lrCabIfs.NEXT = 0;

        lrCabIfs.DELETEALL;
      END;
    END;

    PROCEDURE NuevasTablasCalendario@1000000004();
    VAR
      rCalendar@1000000000 : Record 7600;
      rCalendario@1000000001 : Record 7035359;
      rChangesCal@1000000002 : Record 7601;
      rCamCalendario@1000000003 : Record 7035376;
    BEGIN
      // NuevasTablasCalendario

      rCalendar.RESET;
      IF rCalendar.FINDSET(TRUE) THEN
      BEGIN
        REPEAT
          rCalendario.TRANSFERFIELDS(rCalendar);
          rCalendario.INSERT;
        UNTIL rCalendar.NEXT = 0;

        rCalendar.DELETEALL;
      END;

      rChangesCal.RESET;
      IF rChangesCal.FINDSET THEN
      BEGIN
        REPEAT
          rCamCalendario.TRANSFERFIELDS(rChangesCal);
          rCamCalendario.INSERT;
        UNTIL rChangesCal.NEXT = 0;

        rChangesCal.DELETEALL;
      END;
    END;

    BEGIN
    {
      Existe 2 rutinas crea_ventana y actualiza_ventana que se encargan de mantener bonitas ventanas con contador

      $001 AJS 19122012 Nuevas funciones PurgarHistoricoContrato, EliminaInfoContable, PurgarContratosVenta y PurgarImportacionXML
    }
    END.
  }
}
