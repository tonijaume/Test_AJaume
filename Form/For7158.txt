OBJECT Form 7158 Sales Analysis by Dimensions
{
  OBJECT-PROPERTIES
  {
    Date=14/08/09;
    Time=12:00:00;
    Version List=NAVW16.00.01;
  }
  PROPERTIES
  {
    Width=18590;
    Height=10010;
    CaptionML=[ENU=Sales Analysis by Dimensions;
               ESP=An lisis de ventas por dimensiones];
    SaveValues=Yes;
    InsertAllowed=No;
    DeleteAllowed=No;
    ModifyAllowed=No;
    LinksAllowed=No;
    SourceTable=Table367;
    DataCaptionExpr=CurrentItemAnalysisViewCode;
    OnOpenForm=BEGIN
                 CurrentAnalysisArea := CurrentAnalysisArea::Sales;

                 GLSetup.GET;
                 NormalFormatString := Text001 + GLSetup."Amount Decimal Places" + Text002;

                 ItemAnalysisMgt.AnalysisViewSelection(
                   CurrentAnalysisArea,CurrentItemAnalysisViewCode,ItemAnalysisView,ItemStatisticsBuffer,
                   Dim1Filter,Dim2Filter,Dim3Filter);
                 ItemAnalysisMgt.SetLineAndColDim(
                   ItemAnalysisView,LineDimCode,LineDimOption,ColumnDimCode,ColumnDimOption);
                 UpdateFilterFields;

                 FindPeriod('');
                 CurrForm.UPDATECONTROLS;
               END;

    OnFindRecord=BEGIN
                   EXIT(
                     ItemAnalysisMgt.FindRec(
                       ItemAnalysisView,LineDimOption,Rec,Which,
                       ItemFilter,LocationFilter,PeriodType,DateFilter,PeriodInitialized,InternalDateFilter,
                       Dim1Filter,Dim2Filter,Dim3Filter));
                 END;

    OnNextRecord=BEGIN
                   EXIT(
                     ItemAnalysisMgt.NextRec(
                       ItemAnalysisView,LineDimOption,Rec,Steps,
                       ItemFilter,LocationFilter,PeriodType,DateFilter,
                       Dim1Filter,Dim2Filter,Dim3Filter));
                 END;

    OnAfterGetRecord=BEGIN
                       IF CurrForm.TotalQuantity.VISIBLE THEN
                         Quantity := CalcAmt(2,FALSE);
                       IF CurrForm.TotalSalesAmount.VISIBLE THEN
                         Amount := CalcAmt(0,FALSE);
                     END;

    OnAfterGetCurrRecord=BEGIN
                           IF CurrForm.TotalQuantity.VISIBLE THEN
                             Quantity := CalcAmt(2,FALSE);
                           IF CurrForm.TotalSalesAmount.VISIBLE THEN
                             Amount := CalcAmt(0,FALSE);
                         END;

  }
  CONTROLS
  {
    { 1   ;TabControl   ;220  ;220  ;18150;3080 ;HorzGlue=Both;
                                                 VertGlue=Top;
                                                 PageNamesML=[ENU=General,Filters,Options;
                                                              ESP=General,Filtros,Opciones] }
    { 5   ;TextBox      ;3850 ;990  ;2750 ;440  ;ParentControl=1;
                                                 InPage=0;
                                                 CaptionML=[ENU=Analysis View Code;
                                                            ESP=C¢d. vista an lisis];
                                                 SourceExpr=CurrentItemAnalysisViewCode;
                                                 OnValidate=BEGIN
                                                              AVBreakdownBuffer.DELETEALL;
                                                              ItemAnalysisMgt.CheckAnalysisView(CurrentAnalysisArea,CurrentItemAnalysisViewCode,ItemAnalysisView)
                                                            END;

                                                 OnLookup=BEGIN
                                                            ItemAnalysisMgt.LookupItemAnalysisView(
                                                              CurrentAnalysisArea,CurrentItemAnalysisViewCode,ItemAnalysisView,ItemStatisticsBuffer,
                                                              Dim1Filter,Dim2Filter,Dim3Filter);
                                                            ItemAnalysisMgt.SetLineAndColDim(
                                                              ItemAnalysisView,LineDimCode,LineDimOption,ColumnDimCode,ColumnDimOption);
                                                            UpdateFilterFields;
                                                            CurrForm.UPDATE(FALSE);
                                                            CurrForm.UPDATECONTROLS;
                                                          END;

                                                 OnAfterValidate=BEGIN
                                                                   ItemAnalysisMgt.SetItemAnalysisView(
                                                                     CurrentAnalysisArea,CurrentItemAnalysisViewCode,ItemAnalysisView,ItemStatisticsBuffer,
                                                                     Dim1Filter,Dim2Filter,Dim3Filter);
                                                                   ItemAnalysisMgt.SetLineAndColDim(
                                                                     ItemAnalysisView,LineDimCode,LineDimOption,ColumnDimCode,ColumnDimOption);
                                                                   UpdateFilterFields;
                                                                   CurrForm.UPDATE(FALSE);
                                                                   CurrForm.UPDATECONTROLS;
                                                                 END;
                                                                  }
    { 7   ;Label        ;440  ;990  ;3300 ;440  ;ParentControl=5 }
    { 6   ;TextBox      ;3850 ;1650 ;2750 ;440  ;ParentControl=1;
                                                 InPage=0;
                                                 CaptionML=[ENU=Show as Lines;
                                                            ESP=Muestra como l¡neas];
                                                 SourceExpr=LineDimCode;
                                                 OnValidate=BEGIN
                                                              AVBreakdownBuffer.DELETEALL;
                                                              IF (UPPERCASE(LineDimCode) = UPPERCASE(ColumnDimCode)) AND (LineDimCode <> '') THEN BEGIN
                                                                ColumnDimCode := '';
                                                                ItemAnalysisMgt.ValidateColumnDimCode(
                                                                  ItemAnalysisView,ColumnDimCode,ColumnDimOption,LineDimOption,
                                                                  InternalDateFilter,DateFilter,ItemStatisticsBuffer,PeriodInitialized);
                                                              END;
                                                              ItemAnalysisMgt.ValidateLineDimCode(
                                                                ItemAnalysisView,LineDimCode,LineDimOption,ColumnDimOption,
                                                                InternalDateFilter,DateFilter,ItemStatisticsBuffer,PeriodInitialized);
                                                              IF LineDimOption = LineDimOption::Period THEN
                                                                SETCURRENTKEY("Period Start")
                                                              ELSE
                                                                SETCURRENTKEY(Code);
                                                            END;

                                                 OnLookup=VAR
                                                            NewCode@1002 : Text[30];
                                                          BEGIN
                                                            NewCode := ItemAnalysisMgt.GetDimSelection(LineDimCode,ItemAnalysisView);
                                                            IF NewCode <> LineDimCode THEN BEGIN
                                                              Text := NewCode;
                                                              EXIT(TRUE);
                                                            END;
                                                          END;

                                                 OnAfterValidate=BEGIN
                                                                   CurrForm.UPDATE(FALSE);
                                                                 END;
                                                                  }
    { 8   ;Label        ;440  ;1650 ;3300 ;440  ;ParentControl=6 }
    { 9   ;TextBox      ;3850 ;2200 ;2750 ;440  ;ParentControl=1;
                                                 InPage=0;
                                                 CaptionML=[ENU=Show as Columns;
                                                            ESP=Muestra como columnas];
                                                 SourceExpr=ColumnDimCode;
                                                 OnValidate=BEGIN
                                                              AVBreakdownBuffer.DELETEALL;
                                                              IF (UPPERCASE(LineDimCode) = UPPERCASE(ColumnDimCode)) AND (LineDimCode <> '') THEN BEGIN
                                                                LineDimCode := '';
                                                                ItemAnalysisMgt.ValidateLineDimCode(
                                                                  ItemAnalysisView,LineDimCode,LineDimOption,ColumnDimOption,
                                                                  InternalDateFilter,DateFilter,ItemStatisticsBuffer,PeriodInitialized);
                                                              END;
                                                              ItemAnalysisMgt.ValidateColumnDimCode(
                                                                ItemAnalysisView,ColumnDimCode,ColumnDimOption,LineDimOption,
                                                                InternalDateFilter,DateFilter,ItemStatisticsBuffer,PeriodInitialized);
                                                            END;

                                                 OnLookup=VAR
                                                            NewCode@1002 : Text[30];
                                                          BEGIN
                                                            NewCode := ItemAnalysisMgt.GetDimSelection(ColumnDimCode,ItemAnalysisView);
                                                            IF NewCode <> ColumnDimCode THEN BEGIN
                                                              Text := NewCode;
                                                              EXIT(TRUE);
                                                            END;
                                                          END;

                                                 OnAfterValidate=BEGIN
                                                                   CurrForm.UPDATE(FALSE);
                                                                 END;
                                                                  }
    { 10  ;Label        ;440  ;2200 ;3300 ;440  ;ParentControl=9 }
    { 47  ;TextBox      ;12980;990  ;2750 ;440  ;ParentControl=1;
                                                 InPage=0;
                                                 CaptionML=[ENU=Show Value As;
                                                            ESP=Mostrar valor como];
                                                 OptionCaptionML=[ENU=Sales Amount,COGS Amount,Quantity;
                                                                  ESP=Importe venta,Coste ventas,Cantidad];
                                                 SourceExpr=ValueType;
                                                 OnValidate=BEGIN
                                                              AVBreakdownBuffer.DELETEALL;
                                                            END;
                                                             }
    { 48  ;Label        ;9570 ;990  ;3300 ;440  ;ParentControl=47 }
    { 36  ;TextBox      ;3850 ;990  ;2750 ;440  ;ParentControl=1;
                                                 InPage=1;
                                                 CaptionML=[ENU=Date Filter;
                                                            ESP=Filtro fecha];
                                                 SourceExpr=DateFilter;
                                                 OnValidate=VAR
                                                              ApplicationManagement@1002 : Codeunit 1;
                                                            BEGIN
                                                              IF ApplicationManagement.MakeDateFilter(DateFilter) = 0 THEN;
                                                              ItemStatisticsBuffer.SETFILTER("Date Filter",DateFilter);
                                                              DateFilter := ItemStatisticsBuffer.GETFILTER("Date Filter");
                                                              InternalDateFilter := DateFilter;
                                                            END;

                                                 OnAfterValidate=BEGIN
                                                                   AVBreakdownBuffer.DELETEALL;
                                                                   CurrForm.UPDATE;
                                                                 END;
                                                                  }
    { 37  ;Label        ;440  ;990  ;3300 ;440  ;ParentControl=36 }
    { 30  ;TextBox      ;12980;1540 ;2750 ;440  ;Name=Dim2Filter;
                                                 ParentControl=1;
                                                 InPage=1;
                                                 CaptionML=[ENU=Dimension 2 Filter;
                                                            ESP=Filtro dimensi¢n 2];
                                                 ClearOnLookup=No;
                                                 SourceExpr=Dim2Filter;
                                                 CaptionClass=ItemAnalysisMgt.GetCaptionClass(2,ItemAnalysisView);
                                                 OnLookup=BEGIN
                                                            EXIT(ItemAnalysisMgt.LookUpDimFilter(ItemAnalysisView."Dimension 2 Code",Text));
                                                          END;

                                                 OnAfterValidate=BEGIN
                                                                   AVBreakdownBuffer.DELETEALL;
                                                                   CurrForm.UPDATE;
                                                                 END;
                                                                  }
    { 34  ;TextBox      ;12980;990  ;2750 ;440  ;Name=Dim1Filter;
                                                 ParentControl=1;
                                                 InPage=1;
                                                 CaptionML=[ENU=Dimension 1 Filter;
                                                            ESP=Filtro dimensi¢n 1];
                                                 ClearOnLookup=No;
                                                 SourceExpr=Dim1Filter;
                                                 CaptionClass=ItemAnalysisMgt.GetCaptionClass(1,ItemAnalysisView);
                                                 OnLookup=BEGIN
                                                            EXIT(ItemAnalysisMgt.LookUpDimFilter(ItemAnalysisView."Dimension 1 Code",Text));
                                                          END;

                                                 OnAfterValidate=BEGIN
                                                                   AVBreakdownBuffer.DELETEALL;
                                                                   CurrForm.UPDATE;
                                                                 END;
                                                                  }
    { 46  ;TextBox      ;12980;2090 ;2750 ;440  ;Name=Dim3Filter;
                                                 ParentControl=1;
                                                 InPage=1;
                                                 CaptionML=[ENU=Dimension 3 Filter;
                                                            ESP=Filtro dimensi¢n 3];
                                                 ClearOnLookup=No;
                                                 SourceExpr=Dim3Filter;
                                                 CaptionClass=ItemAnalysisMgt.GetCaptionClass(3,ItemAnalysisView);
                                                 OnLookup=BEGIN
                                                            EXIT(ItemAnalysisMgt.LookUpDimFilter(ItemAnalysisView."Dimension 3 Code",Text));
                                                          END;

                                                 OnAfterValidate=BEGIN
                                                                   AVBreakdownBuffer.DELETEALL;
                                                                   CurrForm.UPDATE;
                                                                 END;
                                                                  }
    { 38  ;TextBox      ;3850 ;1540 ;2750 ;440  ;ParentControl=1;
                                                 InPage=1;
                                                 CaptionML=[ENU=Item Filter;
                                                            ESP=Filtro producto];
                                                 ClearOnLookup=No;
                                                 SourceExpr=ItemFilter;
                                                 OnLookup=VAR
                                                            ItemList@1002 : Form 31;
                                                          BEGIN
                                                            ItemList.LOOKUPMODE(TRUE);
                                                            IF ItemList.RUNMODAL = ACTION::LookupOK THEN BEGIN
                                                              Text := ItemList.GetSelectionFilter;
                                                              EXIT(TRUE);
                                                            END;
                                                          END;

                                                 OnAfterValidate=BEGIN
                                                                   AVBreakdownBuffer.DELETEALL;
                                                                   ItemStatisticsBuffer.SETFILTER("Item Filter",ItemFilter);
                                                                   CurrForm.UPDATE(FALSE);
                                                                 END;
                                                                  }
    { 39  ;Label        ;440  ;1540 ;3300 ;440  ;ParentControl=38 }
    { 31  ;Label        ;9570 ;990  ;3300 ;440  ;ParentControl=34;
                                                 InPage=1 }
    { 33  ;Label        ;9570 ;1540 ;3300 ;440  ;ParentControl=30;
                                                 InPage=1 }
    { 44  ;Label        ;9570 ;2090 ;3300 ;440  ;ParentControl=46;
                                                 InPage=1 }
    { 13  ;TextBox      ;3850 ;2090 ;2750 ;440  ;ParentControl=1;
                                                 InPage=1;
                                                 CaptionML=[ENU=Location Filter;
                                                            ESP=Filtro almac‚n];
                                                 ClearOnLookup=No;
                                                 SourceExpr=LocationFilter;
                                                 OnLookup=VAR
                                                            LocationList@1002 : Form 15;
                                                          BEGIN
                                                            LocationList.LOOKUPMODE(TRUE);
                                                            IF LocationList.RUNMODAL = ACTION::LookupOK THEN BEGIN
                                                              Text := LocationList.GetSelectionFilter;
                                                              EXIT(TRUE);
                                                            END;
                                                          END;

                                                 OnAfterValidate=BEGIN
                                                                   AVBreakdownBuffer.DELETEALL;
                                                                   ItemStatisticsBuffer.SETFILTER("Location Filter",LocationFilter);
                                                                   CurrForm.UPDATE(FALSE);
                                                                 END;
                                                                  }
    { 14  ;Label        ;440  ;2090 ;3300 ;440  ;ParentControl=13 }
    { 17  ;TextBox      ;3850 ;2640 ;2750 ;440  ;ParentControl=1;
                                                 InPage=1;
                                                 CaptionML=[ENU=Budget Filter;
                                                            ESP=Filtro presupuesto];
                                                 SourceExpr=BudgetFilter;
                                                 OnLookup=VAR
                                                            ItemBudgetName@1000 : Record 7132;
                                                          BEGIN
                                                            ItemBudgetName.FILTERGROUP := 2;
                                                            ItemBudgetName.SETRANGE("Analysis Area",CurrentAnalysisArea);
                                                            ItemBudgetName.FILTERGROUP := 0;
                                                            IF FORM.RUNMODAL(0,ItemBudgetName) = ACTION::LookupOK THEN BEGIN
                                                              Text := ItemBudgetName.Name;
                                                              EXIT(TRUE);
                                                            END;
                                                          END;

                                                 OnAfterValidate=BEGIN
                                                                   AVBreakdownBuffer.DELETEALL;
                                                                   ItemStatisticsBuffer.SETFILTER("Budget Filter",BudgetFilter);
                                                                   CurrForm.UPDATE(FALSE);
                                                                 END;
                                                                  }
    { 29  ;Label        ;440  ;2640 ;3300 ;440  ;ParentControl=17 }
    { 4   ;CheckBox     ;3850 ;2090 ;440  ;440  ;ParentControl=1;
                                                 InPage=2;
                                                 ShowCaption=No;
                                                 CaptionML=[ENU=Show Column Name;
                                                            ESP=Muestra nombre columna];
                                                 SourceExpr=ShowColumnName }
    { 3   ;Label        ;440  ;2090 ;3300 ;440  ;ParentControl=4 }
    { 18  ;TextBox      ;3850 ;1540 ;2750 ;440  ;ParentControl=1;
                                                 InPage=2;
                                                 CaptionML=[ENU=Rounding Factor;
                                                            ESP=Factor redondeo];
                                                 OptionCaptionML=[ENU=None,1,1000,1000000;
                                                                  ESP=No,1,1000,1000000];
                                                 SourceExpr=RoundingFactor }
    { 28  ;Label        ;440  ;1540 ;3300 ;440  ;ParentControl=18 }
    { 32  ;TextBox      ;3850 ;990  ;2750 ;440  ;ParentControl=1;
                                                 InPage=2;
                                                 CaptionML=[ENU=Show;
                                                            ESP=Mostrar];
                                                 OptionCaptionML=[ENU=Actual Amounts,Budgeted Amounts,Variance,Variance%,Index%;
                                                                  ESP=Importes reales,Importes pptados.,Desviaci¢n,% Desviaci¢n,% Öndice];
                                                 SourceExpr=ShowActualBudget;
                                                 OnValidate=BEGIN
                                                              AVBreakdownBuffer.DELETEALL;
                                                            END;
                                                             }
    { 35  ;Label        ;440  ;990  ;3300 ;440  ;ParentControl=32 }
    { 50  ;CheckBox     ;3850 ;2640 ;440  ;440  ;ParentControl=1;
                                                 InPage=2;
                                                 ShowCaption=No;
                                                 CaptionML=[ENU=Show Opposite Sign;
                                                            ESP=Muestra signo opuesto];
                                                 SourceExpr=ShowOppositeSign;
                                                 OnValidate=BEGIN
                                                              AVBreakdownBuffer.DELETEALL;
                                                            END;
                                                             }
    { 51  ;Label        ;440  ;2640 ;3300 ;440  ;ParentControl=50;
                                                 MultiLine=Yes }
    { 2   ;CommandButton;16170;9240 ;2200 ;550  ;HorzGlue=Right;
                                                 VertGlue=Bottom;
                                                 PushAction=FormHelp }
    { 19  ;MatrixBox    ;220  ;3520 ;18150;5500 ;Name=Matrix;
                                                 HorzGlue=Both;
                                                 VertGlue=Both;
                                                 Editable=No;
                                                 MatrixSourceTable=Table367;
                                                 OnFindRecord=BEGIN
                                                                EXIT(
                                                                  ItemAnalysisMgt.FindRec(
                                                                    ItemAnalysisView,ColumnDimOption,CurrForm.Matrix.MatrixRec,Which,
                                                                    ItemFilter,LocationFilter,PeriodType,DateFilter,PeriodInitialized,InternalDateFilter,
                                                                    Dim1Filter,Dim2Filter,Dim3Filter));
                                                              END;

                                                 OnNextRecord=BEGIN
                                                                EXIT(
                                                                  ItemAnalysisMgt.NextRec(
                                                                    ItemAnalysisView,ColumnDimOption,CurrForm.Matrix.MatrixRec,Steps,
                                                                    ItemFilter,LocationFilter,PeriodType,DateFilter,
                                                                    Dim1Filter,Dim2Filter,Dim3Filter));
                                                              END;

                                                 OnAfterGetRecord=BEGIN
                                                                    IF ShowColumnName THEN
                                                                      MatrixHeader := CurrForm.Matrix.MatrixRec.Name
                                                                    ELSE
                                                                      MatrixHeader := CurrForm.Matrix.MatrixRec.Code;

                                                                    AnalysisValue := CalcAmt(ValueType,TRUE);
                                                                  END;

                                                 OnAfterGetCurrRecord=BEGIN
                                                                        AnalysisValue := CalcAmt(ValueType,TRUE);
                                                                      END;
                                                                       }
    { 20  ;TextBox      ;397  ;3740 ;1650 ;440  ;ParentControl=19;
                                                 InColumn=Yes;
                                                 SourceExpr=Code;
                                                 OnFormat=BEGIN
                                                            CurrForm.Code.UPDATEFONTBOLD("Show in Bold");
                                                          END;

                                                 OnLookup=BEGIN
                                                            ItemAnalysisMgt.LookUpCode(LineDimOption,LineDimCode,Code);
                                                          END;
                                                           }
    { 21  ;Label        ;0    ;0    ;0    ;0    ;ParentControl=20;
                                                 InColumnHeading=Yes }
    { 22  ;TextBox      ;2047 ;3740 ;4400 ;440  ;HorzGlue=Both;
                                                 ParentControl=19;
                                                 InColumn=Yes;
                                                 SourceExpr=Name;
                                                 OnFormat=BEGIN
                                                            CurrForm.Name.UPDATEFONTBOLD("Show in Bold");
                                                            CurrForm.Name.UPDATEINDENT(220 * Indentation);
                                                          END;
                                                           }
    { 23  ;Label        ;0    ;0    ;0    ;0    ;ParentControl=22;
                                                 InColumnHeading=Yes }
    { 45  ;TextBox      ;5742 ;5280 ;1650 ;440  ;Name=TotalQuantity;
                                                 ParentControl=19;
                                                 InColumn=Yes;
                                                 CaptionML=[ENU=Total Quantity;
                                                            ESP=Cantidad total];
                                                 BlankZero=Yes;
                                                 SourceExpr=Quantity;
                                                 OnActivate=BEGIN
                                                              Quantity := CalcAmt(2,FALSE);
                                                            END;

                                                 OnFormat=BEGIN
                                                            ItemAnalysisMgt.FormatAmount(Text,RoundingFactor);
                                                            CurrForm.TotalQuantity.UPDATEFONTBOLD("Show in Bold");
                                                          END;

                                                 OnDrillDown=BEGIN
                                                               ItemAnalysisMgt.DrillDown(
                                                                 CurrentAnalysisArea,ItemStatisticsBuffer,CurrentItemAnalysisViewCode,
                                                                 ItemFilter,LocationFilter,DateFilter,
                                                                 Dim1Filter,Dim2Filter,Dim3Filter,BudgetFilter,
                                                                 LineDimOption,Rec,
                                                                 ColumnDimOption,CurrForm.Matrix.MatrixRec,
                                                                 FALSE,2,ShowActualBudget);
                                                             END;
                                                              }
    { 49  ;Label        ;0    ;0    ;0    ;0    ;ParentControl=45;
                                                 InColumnHeading=Yes }
    { 24  ;TextBox      ;6377 ;3740 ;2200 ;440  ;Name=TotalSalesAmount;
                                                 ParentControl=19;
                                                 InColumn=Yes;
                                                 CaptionML=[ENU=Total Sales Amount;
                                                            ESP=Importe total de las ventas];
                                                 BlankZero=Yes;
                                                 SourceExpr=Amount;
                                                 AutoFormatType=1;
                                                 OnActivate=BEGIN
                                                              Amount := CalcAmt(0,FALSE);
                                                            END;

                                                 OnFormat=BEGIN
                                                            ItemAnalysisMgt.FormatAmount(Text,RoundingFactor);
                                                            CurrForm.TotalSalesAmount.UPDATEFONTBOLD("Show in Bold");
                                                          END;

                                                 OnDrillDown=BEGIN
                                                               ItemAnalysisMgt.DrillDown(
                                                                 CurrentAnalysisArea,ItemStatisticsBuffer,CurrentItemAnalysisViewCode,
                                                                 ItemFilter,LocationFilter,DateFilter,
                                                                 Dim1Filter,Dim2Filter,Dim3Filter,BudgetFilter,
                                                                 LineDimOption,Rec,
                                                                 ColumnDimOption,CurrForm.Matrix.MatrixRec,
                                                                 FALSE,0,ShowActualBudget);
                                                             END;
                                                              }
    { 25  ;Label        ;0    ;0    ;0    ;0    ;ParentControl=24;
                                                 InColumnHeading=Yes }
    { 26  ;TextBox      ;13200;4400 ;6930 ;440  ;Name=CellValue;
                                                 ParentControl=19;
                                                 InMatrix=Yes;
                                                 BlankZero=Yes;
                                                 SourceExpr=AnalysisValue;
                                                 AutoFormatType=1;
                                                 OnFormat=BEGIN
                                                            AnalysisValue := CalcAmt(ValueType,TRUE);
                                                            IF AnalysisValue = 0 THEN
                                                              Text := ''
                                                            ELSE
                                                              Text := FORMAT(AnalysisValue,0,NormalFormatString);
                                                            ItemAnalysisMgt.FormatAmount(Text,RoundingFactor);
                                                            CurrForm.CellValue.UPDATEFONTBOLD("Show in Bold" OR CurrForm.Matrix.MatrixRec."Show in Bold");
                                                          END;

                                                 OnDrillDown=BEGIN
                                                               ItemAnalysisMgt.DrillDown(
                                                                 CurrentAnalysisArea,ItemStatisticsBuffer,CurrentItemAnalysisViewCode,
                                                                 ItemFilter,LocationFilter,DateFilter,
                                                                 Dim1Filter,Dim2Filter,Dim3Filter,BudgetFilter,
                                                                 LineDimOption,Rec,
                                                                 ColumnDimOption,CurrForm.Matrix.MatrixRec,
                                                                 TRUE,ValueType,ShowActualBudget);
                                                             END;
                                                              }
    { 27  ;TextBox      ;14300;2530 ;1650 ;440  ;Name=MatrixHeader;
                                                 ParentControl=26;
                                                 InMatrixHeading=Yes;
                                                 SourceExpr=MatrixHeader;
                                                 OnFormat=BEGIN
                                                            CurrForm.MatrixHeader.UPDATEFONTBOLD(CurrForm.Matrix.MatrixRec."Show in Bold");
                                                          END;

                                                 OnLookup=BEGIN
                                                            //LookUpCode(ColumnDimOption,ColumnDimCode,CurrForm.Matrix.MatrixRec.Code);
                                                          END;
                                                           }
    { 11  ;CommandButton;4290 ;9240 ;550  ;550  ;VertGlue=Bottom;
                                                 FocusOnClick=No;
                                                 ShowCaption=No;
                                                 BitmapPos=Center;
                                                 AutoRepeat=Yes;
                                                 Bitmap=16;
                                                 ToolTipML=[ENU=Next Period;
                                                            ESP=Periodo siguiente];
                                                 OnPush=BEGIN
                                                          FindPeriod('>=');
                                                        END;
                                                         }
    { 12  ;CommandButton;3740 ;9240 ;550  ;550  ;VertGlue=Bottom;
                                                 FocusOnClick=No;
                                                 ShowCaption=No;
                                                 BitmapPos=Center;
                                                 AutoRepeat=Yes;
                                                 Bitmap=15;
                                                 ToolTipML=[ENU=Previous Period;
                                                            ESP=Periodo anterior];
                                                 OnPush=BEGIN
                                                          FindPeriod('<=');
                                                        END;
                                                         }
    { 15  ;OptionButton ;2970 ;9240 ;550  ;550  ;VertGlue=Bottom;
                                                 FocusOnClick=No;
                                                 ShowCaption=No;
                                                 Border=Yes;
                                                 BitmapPos=Center;
                                                 Bitmap=14;
                                                 ToolTipML=[ENU=Accounting Period;
                                                            ESP=Periodo contable];
                                                 SourceExpr=PeriodType;
                                                 OptionValue=Accounting Period;
                                                 OnPush=BEGIN
                                                          FindPeriod('');
                                                        END;
                                                         }
    { 16  ;OptionButton ;2420 ;9240 ;550  ;550  ;VertGlue=Bottom;
                                                 FocusOnClick=No;
                                                 ShowCaption=No;
                                                 Border=Yes;
                                                 BitmapPos=Center;
                                                 Bitmap=13;
                                                 ToolTipML=[ENU=Year;
                                                            ESP=A¤o];
                                                 SourceExpr=PeriodType;
                                                 OptionValue=Year;
                                                 OnPush=BEGIN
                                                          FindPeriod('');
                                                        END;
                                                         }
    { 40  ;OptionButton ;1870 ;9240 ;550  ;550  ;VertGlue=Bottom;
                                                 FocusOnClick=No;
                                                 ShowCaption=No;
                                                 Border=Yes;
                                                 BitmapPos=Center;
                                                 Bitmap=12;
                                                 ToolTipML=[ENU=Quarter;
                                                            ESP=Trimestre];
                                                 SourceExpr=PeriodType;
                                                 OptionValue=Quarter;
                                                 OnPush=BEGIN
                                                          FindPeriod('');
                                                        END;
                                                         }
    { 41  ;OptionButton ;1320 ;9240 ;550  ;550  ;VertGlue=Bottom;
                                                 FocusOnClick=No;
                                                 ShowCaption=No;
                                                 Border=Yes;
                                                 BitmapPos=Center;
                                                 Bitmap=11;
                                                 ToolTipML=[ENU=Month;
                                                            ESP=Mes];
                                                 SourceExpr=PeriodType;
                                                 OptionValue=Month;
                                                 OnPush=BEGIN
                                                          FindPeriod('');
                                                        END;
                                                         }
    { 42  ;OptionButton ;770  ;9240 ;550  ;550  ;VertGlue=Bottom;
                                                 FocusOnClick=No;
                                                 ShowCaption=No;
                                                 Border=Yes;
                                                 BitmapPos=Center;
                                                 Bitmap=10;
                                                 ToolTipML=[ENU=Week;
                                                            ESP=Semana];
                                                 SourceExpr=PeriodType;
                                                 OptionValue=Week;
                                                 OnPush=BEGIN
                                                          FindPeriod('');
                                                        END;
                                                         }
    { 43  ;OptionButton ;220  ;9240 ;550  ;550  ;VertGlue=Bottom;
                                                 FocusOnClick=No;
                                                 ShowCaption=No;
                                                 Border=Yes;
                                                 BitmapPos=Center;
                                                 Bitmap=9;
                                                 ToolTipML=[ENU=Day;
                                                            ESP=D¡a];
                                                 SourceExpr=PeriodType;
                                                 OptionValue=Day;
                                                 OnPush=BEGIN
                                                          FindPeriod('');
                                                        END;
                                                         }
    { 58  ;MenuButton   ;13750;9240 ;2200 ;550  ;HorzGlue=Right;
                                                 VertGlue=Bottom;
                                                 CaptionML=[ENU=F&unctions;
                                                            ESP=Acci&ones];
                                                 Menu=MENUITEMS
                                                 {
                                                   { ID=59;
                                                     CaptionML=[ENU=Reverse Lines and Columns;
                                                                ESP=Invertir l¡neas y columnas];
                                                     OnPush=VAR
                                                              TempDimCode@1001 : Text[30];
                                                            BEGIN
                                                              TempDimCode := ColumnDimCode;
                                                              ColumnDimCode := LineDimCode;
                                                              LineDimCode := TempDimCode;
                                                              ItemAnalysisMgt.ValidateLineDimCode(
                                                                ItemAnalysisView,LineDimCode,LineDimOption,ColumnDimOption,
                                                                InternalDateFilter,DateFilter,ItemStatisticsBuffer,PeriodInitialized);
                                                              ItemAnalysisMgt.ValidateColumnDimCode(
                                                                ItemAnalysisView,ColumnDimCode,ColumnDimOption,LineDimOption,
                                                                InternalDateFilter,DateFilter,ItemStatisticsBuffer,PeriodInitialized);
                                                            END;
                                                             }
                                                   { ID=56;
                                                     CaptionML=[ENU=Export to Excel;
                                                                ESP=Exportar a Excel];
                                                     OnPush=VAR
                                                              ItemAnalysisViewEntry@1000 : Record 7154;
                                                              ItemAnalysisViewToExcel@1001 : Codeunit 7152;
                                                            BEGIN
                                                              ItemAnalysisViewToExcel.SetCommonFilters(
                                                                CurrentAnalysisArea,CurrentItemAnalysisViewCode,
                                                                ItemAnalysisViewEntry,DateFilter,ItemFilter,Dim1Filter,Dim2Filter,Dim3Filter,LocationFilter);
                                                              ItemAnalysisViewEntry.FIND('-');
                                                              ItemAnalysisViewToExcel.ExportData(
                                                                ItemAnalysisViewEntry,LineDimCode,ColumnDimCode,ValueType,
                                                                PeriodType,ShowColumnName,DateFilter,ItemFilter,BudgetFilter,
                                                                Dim1Filter,Dim2Filter,Dim3Filter,ShowActualBudget,LocationFilter,ShowOppositeSign);
                                                            END;
                                                             }
                                                 }
                                                  }
  }
  CODE
  {
    VAR
      GLSetup@1025 : Record 98;
      ItemAnalysisView@1011 : Record 7152;
      ItemStatisticsBuffer@1002 : Record 5821;
      AVBreakdownBuffer@1028 : TEMPORARY Record 375;
      ItemAnalysisMgt@1038 : Codeunit 7153;
      CurrentAnalysisArea@1001 : 'Sales,Purchase,Inventory';
      CurrentItemAnalysisViewCode@1016 : Code[10];
      ItemFilter@1003 : Code[250];
      LocationFilter@1021 : Code[250];
      BudgetFilter@1026 : Code[250];
      ValueType@1004 : 'Sales Amount,COGS Amount,Sales Quantity';
      ShowActualBudget@1027 : 'Actual Amounts,Budgeted Amounts,Variance,Variance%,Index%';
      RoundingFactor@1005 : 'None,1,1000,1000000';
      LineDimOption@1007 : 'Item,Period,Location,Dimension 1,Dimension 2,Dimension 3';
      ColumnDimOption@1006 : 'Item,Period,Location,Dimension 1,Dimension 2,Dimension 3';
      PeriodType@1008 : 'Day,Week,Month,Quarter,Year,Accounting Period';
      Dim1Filter@1012 : Code[250];
      Dim2Filter@1010 : Code[250];
      Dim3Filter@1009 : Code[250];
      LineDimCode@1020 : Text[30];
      ColumnDimCode@1019 : Text[30];
      DateFilter@1013 : Text[30];
      InternalDateFilter@1014 : Text[30];
      PeriodInitialized@1015 : Boolean;
      AnalysisValue@1017 : Decimal;
      MatrixHeader@1018 : Text[50];
      ShowColumnName@1029 : Boolean;
      ShowOppositeSign@1030 : Boolean;
      NormalFormatString@1022 : Text[80];
      Text001@1024 : TextConst 'ENU=<Precision,;ESP=<Precision,';
      Text002@1023 : TextConst 'ENU=><Standard Format,0>;ESP=><Standard Format,0>';

    LOCAL PROCEDURE FindPeriod@2(SearchText@1000 : Code[10]);
    VAR
      Item@1003 : Record 27;
      Calendar@1001 : Record 2000000007;
      PeriodFormMgt@1002 : Codeunit 359;
    BEGIN
      IF DateFilter <> '' THEN BEGIN
        Calendar.SETFILTER("Period Start",DateFilter);
        IF NOT PeriodFormMgt.FindDate('+',Calendar,PeriodType) THEN
          PeriodFormMgt.FindDate('+',Calendar,PeriodType::Day);
        Calendar.SETRANGE("Period Start");
      END;
      PeriodFormMgt.FindDate(SearchText,Calendar,PeriodType);
      Item.SETRANGE("Date Filter",Calendar."Period Start",Calendar."Period End");
      IF Item.GETRANGEMIN("Date Filter") = Item.GETRANGEMAX("Date Filter") THEN
        Item.SETRANGE("Date Filter",Item.GETRANGEMIN("Date Filter"));
      InternalDateFilter := Item.GETFILTER("Date Filter");
      IF (LineDimOption <> LineDimOption::Period) AND (ColumnDimOption <> ColumnDimOption::Period) THEN
        DateFilter := InternalDateFilter;
      AVBreakdownBuffer.DELETEALL;
    END;

    LOCAL PROCEDURE CalcAmt@3(ValueType@1001 : Integer;SetColFilter@1000 : Boolean) : Decimal;
    VAR
      Amt@1002 : Decimal;
      AmtFromBuffer@1003 : Boolean;
    BEGIN
      IF SetColFilter THEN
        IF AVBreakdownBuffer.GET(Code,CurrForm.Matrix.MatrixRec.Code) THEN BEGIN
          Amt := AVBreakdownBuffer.Amount;
          AmtFromBuffer := TRUE;
        END;

      IF NOT AmtFromBuffer THEN BEGIN
        Amt := ItemAnalysisMgt.CalcAmount(
          ValueType,SetColFilter,
          CurrentAnalysisArea,ItemStatisticsBuffer,CurrentItemAnalysisViewCode,
          ItemFilter,LocationFilter,DateFilter,BudgetFilter,
          Dim1Filter,Dim2Filter,Dim3Filter,
          LineDimOption,Rec,
          ColumnDimOption,CurrForm.Matrix.MatrixRec,
          ShowActualBudget);

        IF SetColFilter THEN BEGIN
          AVBreakdownBuffer."Line Code" := Code;
          AVBreakdownBuffer."Column Code" := CurrForm.Matrix.MatrixRec.Code;
          AVBreakdownBuffer.Amount := Amt;
          AVBreakdownBuffer.INSERT;
        END;
      END;

      IF ShowOppositeSign THEN
        Amt := -Amt;

      EXIT(Amt);
    END;

    LOCAL PROCEDURE UpdateFilterFields@4();
    VAR
      ItemAnalysisViewFilter@1000 : Record 7153;
    BEGIN
      ItemFilter := ItemAnalysisView."Item Filter";
      Dim1Filter := '';
      Dim2Filter := '';
      Dim3Filter := '';

      CurrForm.Dim1Filter.ENABLED := ItemAnalysisView."Dimension 1 Code" <> '';
      CurrForm.Dim2Filter.ENABLED := ItemAnalysisView."Dimension 2 Code" <> '';
      CurrForm.Dim3Filter.ENABLED := ItemAnalysisView."Dimension 3 Code" <> '';

      IF CurrForm.Dim1Filter.ENABLED THEN
        IF ItemAnalysisViewFilter.GET(
          ItemAnalysisView."Analysis Area",ItemAnalysisView.Code,ItemAnalysisView."Dimension 1 Code")
        THEN
          Dim1Filter := ItemAnalysisViewFilter."Dimension Value Filter";

      IF CurrForm.Dim2Filter.ENABLED THEN
        IF ItemAnalysisViewFilter.GET(
          ItemAnalysisView."Analysis Area",ItemAnalysisView.Code,ItemAnalysisView."Dimension 2 Code")
        THEN
          Dim2Filter := ItemAnalysisViewFilter."Dimension Value Filter";

      IF CurrForm.Dim3Filter.ENABLED THEN
        IF ItemAnalysisViewFilter.GET(
          ItemAnalysisView."Analysis Area",ItemAnalysisView.Code,ItemAnalysisView."Dimension 3 Code")
        THEN
          Dim3Filter := ItemAnalysisViewFilter."Dimension Value Filter";
    END;

    PROCEDURE SetCurrentAnalysisViewCode@7(NewAnalysisViewCode@1000 : Code[10]);
    BEGIN
      //Dummy function to make form 9358 compile
    END;

    BEGIN
    END.
  }
}
