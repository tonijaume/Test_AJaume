OBJECT Form 408 G/L Balance by Dimension
{
  OBJECT-PROPERTIES
  {
    Date=14/08/09;
    Time=12:00:00;
    Version List=NAVW16.00.01;
  }
  PROPERTIES
  {
    Width=16500;
    Height=10010;
    CaptionML=[ENU=G/L Balance by Dimension;
               ESP=Saldo cuenta por dimensi¢n];
    SaveValues=Yes;
    InsertAllowed=No;
    DeleteAllowed=No;
    ModifyAllowed=No;
    LinksAllowed=No;
    SourceTable=Table367;
    OnInit=VAR
             Field@1000 : Record 2000000041;
           BEGIN
             Field.GET(DATABASE::"G/L Account",42);
             BusUnitFilterCaption := Field."Field Caption";
           END;

    OnOpenForm=BEGIN
                 GLAcc.SETPERMISSIONFILTER;
                 GlobalDim1Filter := GLAcc.GETFILTER("Global Dimension 1 Filter");
                 GlobalDim2Filter := GLAcc.GETFILTER("Global Dimension 2 Filter");

                 GLSetup.GET;
                 CurrForm.Dim1Filter.ENABLED :=
                   (GLSetup."Global Dimension 1 Code" <> '') AND
                   (GLAcc.GETFILTER("Global Dimension 1 Filter") = '');
                 CurrForm.Dim2Filter.ENABLED :=
                   (GLSetup."Global Dimension 2 Code" <> '') AND
                   (GLAcc.GETFILTER("Global Dimension 2 Filter") = '');

                 IF GLSetup."Additional Reporting Currency" = '' THEN
                   ShowInAddCurr := FALSE;

                 IF (LineDimCode = '') AND (ColumnDimCode = '') THEN BEGIN
                   LineDimCode := GLAcc.TABLECAPTION;
                   ColumnDimCode := Text001;
                 END;
                 LineDimOption := DimCodeToOption(LineDimCode);
                 ColumnDimOption := DimCodeToOption(ColumnDimCode);


                 CalculateClosingDateFilter;
                 FindPeriod('');
               END;

    OnFindRecord=BEGIN
                   EXIT(FindRec(LineDimOption,Rec,Which));
                 END;

    OnNextRecord=BEGIN
                   EXIT(NextRec(LineDimOption,Rec,Steps));
                 END;

    OnAfterGetRecord=BEGIN
                       IF CurrForm.TotalAmount.VISIBLE THEN
                         Amount := CalcAmount(FALSE);
                     END;

  }
  CONTROLS
  {
    { 1   ;TabControl   ;220  ;220  ;16060;3080 ;HorzGlue=Both;
                                                 VertGlue=Top;
                                                 PageNamesML=[ENU=General,Filters,Options;
                                                              ESP=General,Filtros,Opciones] }
    { 6   ;TextBox      ;3850 ;990  ;2750 ;440  ;ParentControl=1;
                                                 InPage=0;
                                                 CaptionML=[ENU=Show as Lines;
                                                            ESP=Muestra como l¡neas];
                                                 SourceExpr=LineDimCode;
                                                 OnValidate=BEGIN
                                                              IF (UPPERCASE(LineDimCode) = UPPERCASE(ColumnDimCode)) AND (LineDimCode <> '') THEN BEGIN
                                                                ColumnDimCode := '';
                                                                ValidateColumnDimCode;
                                                              END;
                                                              DimCodAmtBuf.DELETEALL;
                                                              ValidateLineDimCode;
                                                            END;

                                                 OnLookup=VAR
                                                            NewCode@1002 : Text[30];
                                                          BEGIN
                                                            NewCode := GetDimSelection(LineDimCode);
                                                            IF NewCode = LineDimCode THEN
                                                              EXIT(FALSE)
                                                            ELSE BEGIN
                                                              Text := NewCode;
                                                              LineDimCode := NewCode;
                                                              ValidateLineDimCode;
                                                              CurrForm.UPDATE;
                                                              EXIT(TRUE);
                                                            END
                                                          END;

                                                 OnAfterValidate=BEGIN
                                                                   CurrForm.UPDATE;
                                                                 END;
                                                                  }
    { 108 ;Label        ;440  ;990  ;3300 ;440  ;ParentControl=6 }
    { 9   ;TextBox      ;3850 ;1540 ;2750 ;440  ;ParentControl=1;
                                                 InPage=0;
                                                 CaptionML=[ENU=Show as Columns;
                                                            ESP=Muestra como columnas];
                                                 SourceExpr=ColumnDimCode;
                                                 OnValidate=BEGIN
                                                              IF (UPPERCASE(LineDimCode) = UPPERCASE(ColumnDimCode)) AND (LineDimCode <> '') THEN BEGIN
                                                                LineDimCode := '';
                                                                ValidateLineDimCode;
                                                              END;
                                                              DimCodAmtBuf.DELETEALL;
                                                              ValidateColumnDimCode;
                                                            END;

                                                 OnLookup=VAR
                                                            NewCode@1002 : Text[30];
                                                          BEGIN
                                                            NewCode := GetDimSelection(ColumnDimCode);
                                                            IF NewCode = ColumnDimCode THEN
                                                              EXIT(FALSE)
                                                            ELSE BEGIN
                                                              Text := NewCode;
                                                              ColumnDimCode := NewCode;
                                                              ValidateColumnDimCode;
                                                              CurrForm.UPDATE;
                                                              EXIT(TRUE);
                                                            END
                                                          END;

                                                 OnAfterValidate=BEGIN
                                                                   CurrForm.UPDATE;
                                                                 END;
                                                                  }
    { 10  ;Label        ;440  ;1540 ;3300 ;440  ;ParentControl=9 }
    { 36  ;TextBox      ;3850 ;990  ;2750 ;440  ;ParentControl=1;
                                                 InPage=1;
                                                 CaptionML=[ENU=Date Filter;
                                                            ESP=Filtro fecha];
                                                 SourceExpr=DateFilter;
                                                 OnValidate=VAR
                                                              ApplicationManagement@1001 : Codeunit 1;
                                                            BEGIN
                                                              IF ApplicationManagement.MakeDateFilter(DateFilter) = 0 THEN;
                                                              GLAcc.SETFILTER("Date Filter",DateFilter);
                                                              DateFilter := GLAcc.GETFILTER("Date Filter");
                                                              InternalDateFilter := DateFilter;
                                                            END;

                                                 OnAfterValidate=BEGIN
                                                                   DimCodAmtBuf.DELETEALL;
                                                                   CurrForm.UPDATE;
                                                                 END;
                                                                  }
    { 37  ;Label        ;440  ;990  ;3300 ;440  ;ParentControl=36 }
    { 38  ;TextBox      ;3850 ;1540 ;2750 ;440  ;ParentControl=1;
                                                 InPage=1;
                                                 CaptionML=[ENU=G/L Account Filter;
                                                            ESP=Filtro cuenta];
                                                 ClearOnLookup=No;
                                                 SourceExpr=GLAccFilter;
                                                 OnLookup=VAR
                                                            GLAccList@1002 : Form 18;
                                                          BEGIN
                                                            GLAccList.LOOKUPMODE(TRUE);
                                                            IF NOT (GLAccList.RUNMODAL = ACTION::LookupOK) THEN
                                                              EXIT(FALSE)
                                                            ELSE
                                                              Text := GLAccList.GetSelectionFilter;
                                                            EXIT(TRUE);
                                                          END;

                                                 OnAfterValidate=BEGIN
                                                                   DimCodAmtBuf.DELETEALL;
                                                                   CurrForm.UPDATE;
                                                                 END;
                                                                  }
    { 39  ;Label        ;440  ;1540 ;3300 ;440  ;ParentControl=38 }
    { 30  ;TextBox      ;12980;2090 ;2750 ;440  ;Name=Dim2Filter;
                                                 ParentControl=1;
                                                 InPage=1;
                                                 ClearOnLookup=No;
                                                 SourceExpr=GlobalDim2Filter;
                                                 CaptionClass='1,3,2';
                                                 OnLookup=BEGIN
                                                            EXIT(LookUpDimFilter(GLSetup."Global Dimension 2 Code",Text));
                                                          END;

                                                 OnAfterValidate=BEGIN
                                                                   DimCodAmtBuf.DELETEALL;
                                                                   CurrForm.UPDATE;
                                                                 END;
                                                                  }
    { 34  ;TextBox      ;12980;1540 ;2750 ;440  ;Name=Dim1Filter;
                                                 ParentControl=1;
                                                 InPage=1;
                                                 ClearOnLookup=No;
                                                 SourceExpr=GlobalDim1Filter;
                                                 CaptionClass='1,3,1';
                                                 OnLookup=BEGIN
                                                            EXIT(LookUpDimFilter(GLSetup."Global Dimension 1 Code",Text));
                                                          END;

                                                 OnAfterValidate=BEGIN
                                                                   DimCodAmtBuf.DELETEALL;
                                                                   CurrForm.UPDATE;
                                                                 END;
                                                                  }
    { 53  ;TextBox      ;3850 ;2090 ;2750 ;440  ;ValidateTableRelation=No;
                                                 ParentControl=1;
                                                 InPage=1;
                                                 CaptionML=[ENU=Budget Filter;
                                                            ESP=Filtro presupuesto];
                                                 ClearOnLookup=No;
                                                 SourceExpr=BudgetFilter;
                                                 TableRelation="G/L Budget Name".Name;
                                                 LookupFormID=G/L Budget Names;
                                                 OnAfterValidate=BEGIN
                                                                   IF ShowActualBudg <> ShowActualBudg::"Actual Amounts" THEN
                                                                     DimCodAmtBuf.DELETEALL;
                                                                   CurrForm.UPDATE;
                                                                 END;
                                                                  }
    { 117 ;Label        ;440  ;2090 ;3300 ;440  ;ParentControl=53 }
    { 5   ;Label        ;9570 ;1540 ;3300 ;440  ;ParentControl=34;
                                                 InPage=1 }
    { 7   ;Label        ;9570 ;2090 ;3300 ;440  ;ParentControl=30;
                                                 InPage=1 }
    { 14  ;TextBox      ;12980;990  ;2750 ;440  ;ParentControl=1;
                                                 InPage=1;
                                                 ClearOnLookup=No;
                                                 SourceExpr=BusUnitFilter;
                                                 CaptionClass='3,' + BusUnitFilterCaption;
                                                 OnLookup=VAR
                                                            BusUnitList@1002 : Form 240;
                                                          BEGIN
                                                            BusUnitList.LOOKUPMODE(TRUE);
                                                            IF NOT (BusUnitList.RUNMODAL = ACTION::LookupOK) THEN
                                                              EXIT(FALSE);
                                                            Text := BusUnitList.GetSelectionFilter;
                                                            EXIT(TRUE);
                                                          END;

                                                 OnAfterValidate=BEGIN
                                                                   DimCodAmtBuf.DELETEALL;
                                                                   CurrForm.UPDATE;
                                                                 END;
                                                                  }
    { 18  ;Label        ;9570 ;990  ;3300 ;440  ;ParentControl=14 }
    { 4   ;CheckBox     ;12980;2090 ;440  ;440  ;ParentControl=1;
                                                 InPage=2;
                                                 ShowCaption=No;
                                                 CaptionML=[ENU=Show Column Name;
                                                            ESP=Muestra nombre columna];
                                                 SourceExpr=ShowColumnName }
    { 3   ;Label        ;9570 ;2090 ;3300 ;440  ;ParentControl=4 }
    { 19  ;TextBox      ;3850 ;2640 ;2750 ;440  ;ParentControl=1;
                                                 InPage=2;
                                                 CaptionML=[ENU=Rounding Factor;
                                                            ESP=Factor redondeo];
                                                 OptionCaptionML=[ENU=None,1,1000,1000000;
                                                                  ESP=No,1,1000,1000000];
                                                 SourceExpr=RoundingFactor }
    { 28  ;Label        ;440  ;2640 ;3300 ;440  ;ParentControl=19 }
    { 29  ;TextBox      ;3850 ;990  ;2750 ;440  ;ParentControl=1;
                                                 InPage=2;
                                                 CaptionML=[ENU=Show;
                                                            ESP=Muestra];
                                                 OptionCaptionML=[ENU=Actual Amounts,Budgeted Amounts,Variance,Variance%,Index%;
                                                                  ESP=Importes reales,Importes pptados.,Desviaci¢n,% Desviaci¢n,% Öndice];
                                                 SourceExpr=ShowActualBudg;
                                                 OnValidate=BEGIN
                                                              DimCodAmtBuf.DELETEALL;
                                                              Amount := CalcAmount(FALSE);
                                                            END;
                                                             }
    { 32  ;Label        ;440  ;990  ;3300 ;440  ;ParentControl=29 }
    { 47  ;TextBox      ;3850 ;1540 ;2750 ;440  ;ParentControl=1;
                                                 InPage=2;
                                                 CaptionML=[ENU=Show Amount Field;
                                                            ESP=Muestra Importe];
                                                 OptionCaptionML=[ENU=Amount,Debit Amount,Credit Amount;
                                                                  ESP=Importe,Importe deudor,Importe acreedor];
                                                 SourceExpr=AmountField;
                                                 OnValidate=BEGIN
                                                              DimCodAmtBuf.DELETEALL;
                                                              Amount := CalcAmount(FALSE);
                                                            END;
                                                             }
    { 48  ;Label        ;440  ;1540 ;3300 ;440  ;ParentControl=47 }
    { 49  ;CheckBox     ;12980;1430 ;440  ;440  ;ParentControl=1;
                                                 InPage=2;
                                                 ShowCaption=No;
                                                 CaptionML=[ENU=Show Amounts in Add. Reporting Currency;
                                                            ESP=Muestra importes en div.-adic.];
                                                 SourceExpr=ShowInAddCurr;
                                                 OnValidate=BEGIN
                                                              DimCodAmtBuf.DELETEALL;
                                                              Amount := CalcAmount(FALSE);
                                                            END;
                                                             }
    { 50  ;Label        ;9570 ;990  ;3300 ;880  ;ParentControl=49;
                                                 MultiLine=Yes }
    { 20  ;TextBox      ;3850 ;2090 ;2750 ;440  ;ParentControl=1;
                                                 InPage=2;
                                                 CaptionML=[ENU=Closing Entries;
                                                            ESP=Movs. regularizaci¢n];
                                                 OptionCaptionML=[ENU=Include,Exclude;
                                                                  ESP=Incluir,Excluir];
                                                 SourceExpr=ClosingEntryFilter;
                                                 OnValidate=BEGIN
                                                              DimCodAmtBuf.DELETEALL;
                                                              CalculateClosingDateFilter;
                                                              FindPeriod('=');
                                                              Amount := CalcAmount(FALSE);
                                                            END;
                                                             }
    { 51  ;Label        ;440  ;2090 ;3300 ;440  ;ParentControl=20 }
    { 2   ;CommandButton;14080;9240 ;2200 ;550  ;HorzGlue=Right;
                                                 VertGlue=Bottom;
                                                 PushAction=FormHelp }
    { 119 ;MatrixBox    ;220  ;3520 ;16060;5500 ;Name=Matrix;
                                                 HorzGlue=Both;
                                                 VertGlue=Both;
                                                 Editable=No;
                                                 MatrixSourceTable=Table367;
                                                 OnFindRecord=BEGIN
                                                                EXIT(FindRec(ColumnDimOption,CurrForm.Matrix.MatrixRec,Which));
                                                              END;

                                                 OnNextRecord=BEGIN
                                                                EXIT(NextRec(ColumnDimOption,CurrForm.Matrix.MatrixRec,Steps));
                                                              END;

                                                 OnAfterGetRecord=BEGIN
                                                                    IF ShowColumnName THEN
                                                                      MatrixHeader := CurrForm.Matrix.MatrixRec.Name
                                                                    ELSE
                                                                      MatrixHeader := CurrForm.Matrix.MatrixRec.Code;

                                                                    MatrixAmount := CalcAmount(TRUE);
                                                                  END;
                                                                   }
    { 120 ;TextBox      ;397  ;3740 ;1650 ;440  ;ParentControl=119;
                                                 InColumn=Yes;
                                                 SourceExpr=Code;
                                                 OnFormat=BEGIN
                                                            CurrForm.Code.UPDATEFONTBOLD("Show in Bold");
                                                          END;

                                                 OnLookup=BEGIN
                                                            LookUpCode(LineDimOption,LineDimCode,Code);
                                                          END;
                                                           }
    { 121 ;Label        ;0    ;0    ;0    ;0    ;ParentControl=120;
                                                 InColumnHeading=Yes }
    { 22  ;TextBox      ;2047 ;3740 ;4400 ;440  ;HorzGlue=Both;
                                                 ParentControl=119;
                                                 InColumn=Yes;
                                                 SourceExpr=Name;
                                                 OnFormat=BEGIN
                                                            CurrForm.Name.UPDATEFONTBOLD("Show in Bold");
                                                            CurrForm.Name.UPDATEINDENT(220 * Indentation);
                                                          END;
                                                           }
    { 23  ;Label        ;0    ;0    ;0    ;0    ;ParentControl=22;
                                                 InColumnHeading=Yes }
    { 24  ;TextBox      ;6377 ;3740 ;2200 ;440  ;Name=TotalAmount;
                                                 ParentControl=119;
                                                 InColumn=Yes;
                                                 CaptionML=[ENU=Total Amount;
                                                            ESP=Importe total];
                                                 BlankZero=Yes;
                                                 SourceExpr=Amount;
                                                 AutoFormatType=1;
                                                 OnActivate=BEGIN
                                                              Amount := CalcAmount(FALSE);
                                                            END;

                                                 OnFormat=BEGIN
                                                            FormatAmount(Text);
                                                            CurrForm.TotalAmount.UPDATEFONTBOLD("Show in Bold");
                                                          END;

                                                 OnDrillDown=BEGIN
                                                               DrillDown(FALSE);
                                                             END;
                                                              }
    { 25  ;Label        ;0    ;0    ;0    ;0    ;ParentControl=24;
                                                 InColumnHeading=Yes }
    { 26  ;TextBox      ;13200;4400 ;6600 ;440  ;Name=CellAmount;
                                                 ParentControl=119;
                                                 InMatrix=Yes;
                                                 BlankZero=Yes;
                                                 SourceExpr=MatrixAmount;
                                                 AutoFormatType=1;
                                                 OnFormat=BEGIN
                                                            FormatAmount(Text);
                                                            CurrForm.CellAmount.UPDATEFONTBOLD("Show in Bold" OR CurrForm.Matrix.MatrixRec."Show in Bold");
                                                          END;

                                                 OnDrillDown=BEGIN
                                                               DrillDown(TRUE);
                                                             END;
                                                              }
    { 27  ;TextBox      ;14300;2530 ;1650 ;440  ;Name=MatrixHeader;
                                                 ParentControl=26;
                                                 InMatrixHeading=Yes;
                                                 SourceExpr=MatrixHeader;
                                                 OnFormat=BEGIN
                                                            CurrForm.MatrixHeader.UPDATEFONTBOLD(CurrForm.Matrix.MatrixRec."Show in Bold");
                                                          END;

                                                 OnLookup=BEGIN
                                                            LookUpCode(ColumnDimOption,ColumnDimCode,CurrForm.Matrix.MatrixRec.Code);
                                                          END;
                                                           }
    { 11  ;CommandButton;5610 ;9240 ;550  ;550  ;VertGlue=Bottom;
                                                 FocusOnClick=No;
                                                 ShowCaption=No;
                                                 BitmapPos=Center;
                                                 AutoRepeat=Yes;
                                                 Bitmap=16;
                                                 ToolTipML=[ENU=Next Period;
                                                            ESP=Periodo siguiente];
                                                 OnPush=BEGIN
                                                          FindPeriod('>=');
                                                        END;
                                                         }
    { 12  ;CommandButton;5060 ;9240 ;550  ;550  ;VertGlue=Bottom;
                                                 FocusOnClick=No;
                                                 ShowCaption=No;
                                                 BitmapPos=Center;
                                                 AutoRepeat=Yes;
                                                 Bitmap=15;
                                                 ToolTipML=[ENU=Previous Period;
                                                            ESP=Periodo anterior];
                                                 OnPush=BEGIN
                                                          FindPeriod('<=');
                                                        END;
                                                         }
    { 21  ;OptionButton ;4290 ;9240 ;550  ;550  ;VertGlue=Bottom;
                                                 FocusOnClick=No;
                                                 ShowCaption=No;
                                                 Border=Yes;
                                                 BitmapPos=Center;
                                                 Bitmap=19;
                                                 ToolTipML=[ENU=Balance at Date;
                                                            ESP=Saldo a la fecha];
                                                 SourceExpr=AmountType;
                                                 OptionValue=Balance at Date;
                                                 OnPush=BEGIN
                                                          FindPeriod('');
                                                        END;
                                                         }
    { 17  ;OptionButton ;3740 ;9240 ;550  ;550  ;VertGlue=Bottom;
                                                 FocusOnClick=No;
                                                 ShowCaption=No;
                                                 Border=Yes;
                                                 BitmapPos=Center;
                                                 Bitmap=18;
                                                 ToolTipML=[ENU=Net Change;
                                                            ESP=Saldo periodo];
                                                 SourceExpr=AmountType;
                                                 OptionValue=Net Change;
                                                 OnPush=BEGIN
                                                          FindPeriod('');
                                                        END;
                                                         }
    { 15  ;OptionButton ;2970 ;9240 ;550  ;550  ;VertGlue=Bottom;
                                                 FocusOnClick=No;
                                                 ShowCaption=No;
                                                 Border=Yes;
                                                 BitmapPos=Center;
                                                 Bitmap=14;
                                                 ToolTipML=[ENU=Accounting Period;
                                                            ESP=Periodo contable];
                                                 SourceExpr=PeriodType;
                                                 OptionValue=Accounting Period;
                                                 OnPush=BEGIN
                                                          FindPeriod('');
                                                        END;
                                                         }
    { 16  ;OptionButton ;2420 ;9240 ;550  ;550  ;VertGlue=Bottom;
                                                 FocusOnClick=No;
                                                 ShowCaption=No;
                                                 Border=Yes;
                                                 BitmapPos=Center;
                                                 Bitmap=13;
                                                 ToolTipML=[ENU=Year;
                                                            ESP=A¤o];
                                                 SourceExpr=PeriodType;
                                                 OptionValue=Year;
                                                 OnPush=BEGIN
                                                          FindPeriod('');
                                                        END;
                                                         }
    { 40  ;OptionButton ;1870 ;9240 ;550  ;550  ;VertGlue=Bottom;
                                                 FocusOnClick=No;
                                                 ShowCaption=No;
                                                 Border=Yes;
                                                 BitmapPos=Center;
                                                 Bitmap=12;
                                                 ToolTipML=[ENU=Quarter;
                                                            ESP=Trimestre];
                                                 SourceExpr=PeriodType;
                                                 OptionValue=Quarter;
                                                 OnPush=BEGIN
                                                          FindPeriod('');
                                                        END;
                                                         }
    { 41  ;OptionButton ;1320 ;9240 ;550  ;550  ;VertGlue=Bottom;
                                                 FocusOnClick=No;
                                                 ShowCaption=No;
                                                 Border=Yes;
                                                 BitmapPos=Center;
                                                 Bitmap=11;
                                                 ToolTipML=[ENU=Month;
                                                            ESP=Mes];
                                                 SourceExpr=PeriodType;
                                                 OptionValue=Month;
                                                 OnPush=BEGIN
                                                          FindPeriod('');
                                                        END;
                                                         }
    { 42  ;OptionButton ;770  ;9240 ;550  ;550  ;VertGlue=Bottom;
                                                 FocusOnClick=No;
                                                 ShowCaption=No;
                                                 Border=Yes;
                                                 BitmapPos=Center;
                                                 Bitmap=10;
                                                 ToolTipML=[ENU=Week;
                                                            ESP=Semana];
                                                 SourceExpr=PeriodType;
                                                 OptionValue=Week;
                                                 OnPush=BEGIN
                                                          FindPeriod('');
                                                        END;
                                                         }
    { 43  ;OptionButton ;220  ;9240 ;550  ;550  ;VertGlue=Bottom;
                                                 FocusOnClick=No;
                                                 ShowCaption=No;
                                                 Border=Yes;
                                                 BitmapPos=Center;
                                                 Bitmap=9;
                                                 ToolTipML=[ENU=Day;
                                                            ESP=D¡a];
                                                 SourceExpr=PeriodType;
                                                 OptionValue=Day;
                                                 OnPush=BEGIN
                                                          FindPeriod('');
                                                        END;
                                                         }
    { 8   ;MenuButton   ;11660;9240 ;2200 ;550  ;HorzGlue=Right;
                                                 VertGlue=Bottom;
                                                 CaptionML=[ENU=F&unctions;
                                                            ESP=Acci&ones];
                                                 Menu=MENUITEMS
                                                 {
                                                   { ID=13;
                                                     CaptionML=[ENU=Reverse Lines and Columns;
                                                                ESP=Invertir l¡neas y columnas];
                                                     OnPush=VAR
                                                              TempDimCode@1001 : Text[30];
                                                            BEGIN
                                                              TempDimCode := ColumnDimCode;
                                                              ColumnDimCode := LineDimCode;
                                                              LineDimCode := TempDimCode;
                                                              ValidateLineDimCode;
                                                              ValidateColumnDimCode;
                                                            END;
                                                             }
                                                 }
                                                  }
  }
  CODE
  {
    VAR
      Text000@1000 : TextConst 'ENU=<Sign><Integer Thousand><Decimals,2>;ESP=<Sign><Integer Thousand><Decimals,2>';
      Text001@1001 : TextConst 'ENU=Period;ESP=Periodo';
      Text002@1002 : TextConst 'ENU=%1 is not a valid line definition.;ESP=%1 no es una def. de l¡nea v lida.';
      Text003@1003 : TextConst 'ENU=%1 is not a valid column definition.;ESP=%1 no es una def. de columna v lida.';
      GLSetup@1004 : Record 98;
      GLAcc@1005 : Record 15;
      BusUnit@1032 : Record 220;
      DimCodAmtBuf@1006 : TEMPORARY Record 375;
      CurrExchRate@1007 : Record 330;
      LineDimOption@1008 : 'G/L Account,Period,Business Unit,Dimension 1,Dimension 2,Dimension 3,Dimension 4';
      ColumnDimOption@1009 : 'G/L Account,Period,Business Unit,Dimension 1,Dimension 2,Dimension 3,Dimension 4';
      LineDimCode@1010 : Text[30];
      ColumnDimCode@1011 : Text[30];
      PeriodType@1012 : 'Day,Week,Month,Quarter,Year,Accounting Period';
      AmountType@1013 : 'Net Change,Balance at Date';
      RoundingFactor@1014 : 'None,1,1000,1000000';
      AmountField@1015 : 'Amount,Debit Amount,Credit Amount';
      ShowActualBudg@1016 : 'Actual Amounts,Budgeted Amounts,Variance,Variance%,Index%';
      ShowInAddCurr@1017 : Boolean;
      ClosingEntryFilter@1018 : 'Include,Exclude';
      ShowColumnName@1019 : Boolean;
      DateFilter@1020 : Text[250];
      InternalDateFilter@1021 : Text[250];
      ExcludeClosingDateFilter@1022 : Text[250];
      GLAccFilter@1023 : Code[250];
      BudgetFilter@1024 : Code[250];
      BusUnitFilter@1025 : Code[250];
      GlobalDim1Filter@1026 : Code[250];
      GlobalDim2Filter@1027 : Code[250];
      MatrixHeader@1028 : Text[50];
      MatrixAmount@1029 : Decimal;
      PeriodInitialized@1030 : Boolean;
      CurrExchDate@1031 : Date;
      BusUnitFilterCaption@1033 : Text[80];

    LOCAL PROCEDURE DimCodeToOption@21(DimCode@1000 : Text[30]) : Integer;
    VAR
      BusUnit@1001 : Record 220;
    BEGIN
      CASE DimCode OF
        '' :
          EXIT(-1);
        GLAcc.TABLECAPTION :
          EXIT(0);
        Text001 :
          EXIT(1);
        BusUnit.TABLECAPTION :
          EXIT(2);
        GLSetup."Global Dimension 1 Code" :
          EXIT(3);
        GLSetup."Global Dimension 2 Code" :
          EXIT(4);
        ELSE
          EXIT(-1);
      END;
    END;

    LOCAL PROCEDURE FindRec@59(DimOption@1000 : 'G/L Account,Period,Business Unit,Dimension 1,Dimension 2';VAR DimCodeBuf@1001 : Record 367;Which@1002 : Text[250]) : Boolean;
    VAR
      GLAcc@1008 : Record 15;
      BusUnit@1003 : Record 220;
      Period@1004 : Record 2000000007;
      DimVal@1005 : Record 349;
      PeriodFormMgt@1006 : Codeunit 359;
      Found@1007 : Boolean;
    BEGIN
      GLAcc.SETPERMISSIONFILTER;
      CASE DimOption OF
        DimOption::"G/L Account" :
          BEGIN
            GLAcc."No." := DimCodeBuf.Code;
            IF GLAccFilter <> '' THEN
              GLAcc.SETFILTER("No.",GLAccFilter);
            Found := GLAcc.FIND(Which);
            IF Found THEN
              CopyGLAccToBuf(GLAcc,DimCodeBuf);
          END;
        DimOption::Period :
          BEGIN
            IF NOT PeriodInitialized THEN
              DateFilter := '';
            PeriodInitialized := TRUE;
            Period."Period Start" := DimCodeBuf."Period Start";
            IF DateFilter <> '' THEN
              Period.SETFILTER("Period Start",DateFilter)
            ELSE
              IF NOT PeriodInitialized AND (InternalDateFilter <> '') THEN
                Period.SETFILTER("Period Start",InternalDateFilter);
            Found := PeriodFormMgt.FindDate(Which,Period,PeriodType);
            IF Found THEN
              CopyPeriodToBuf(Period,DimCodeBuf);
          END;
        DimOption::"Business Unit" :
          BEGIN
            BusUnit.Code := DimCodeBuf.Code;
            IF BusUnitFilter <> '' THEN
              BusUnit.SETFILTER(Code,BusUnitFilter);
            Found := BusUnit.FIND(Which);
            IF Found THEN
              CopyBusUnitToBuf(BusUnit,DimCodeBuf);
          END;
        DimOption::"Dimension 1" :
          BEGIN
            IF GlobalDim1Filter <> '' THEN
              DimVal.SETFILTER(Code,GlobalDim1Filter);
            DimVal."Dimension Code" := GLSetup."Global Dimension 1 Code";
            DimVal.SETRANGE("Dimension Code",DimVal."Dimension Code");
            DimVal.Code := DimCodeBuf.Code;
            Found := DimVal.FIND(Which);
            IF Found THEN
              CopyDimValueToBuf(DimVal,DimCodeBuf);
          END;
        DimOption::"Dimension 2" :
          BEGIN
            IF GlobalDim2Filter <> '' THEN
              DimVal.SETFILTER(Code,GlobalDim2Filter);
            DimVal."Dimension Code" := GLSetup."Global Dimension 2 Code";
            DimVal.SETRANGE("Dimension Code",DimVal."Dimension Code");
            DimVal.Code := DimCodeBuf.Code;
            Found := DimVal.FIND(Which);
            IF Found THEN
              CopyDimValueToBuf(DimVal,DimCodeBuf);
          END;
      END;
      EXIT(Found);
    END;

    LOCAL PROCEDURE NextRec@60(DimOption@1000 : 'G/L Account,Period,Business Unit,Dimension 1,Dimension 2';VAR DimCodeBuf@1001 : Record 367;Steps@1002 : Integer) : Integer;
    VAR
      GLAcc@1008 : Record 15;
      BusUnit@1003 : Record 220;
      Period@1004 : Record 2000000007;
      DimVal@1005 : Record 349;
      PeriodFormMgt@1006 : Codeunit 359;
      ResultSteps@1007 : Integer;
    BEGIN
      GLAcc.SETPERMISSIONFILTER;
      CASE DimOption OF
        DimOption::"G/L Account" :
          BEGIN
            GLAcc."No." := DimCodeBuf.Code;
            IF GLAccFilter <> '' THEN
              GLAcc.SETFILTER("No.",GLAccFilter);
            ResultSteps := GLAcc.NEXT(Steps);
            IF ResultSteps <> 0 THEN
              CopyGLAccToBuf(GLAcc,DimCodeBuf);
          END;
        DimOption::Period :
          BEGIN
            IF DateFilter <> '' THEN
              Period.SETFILTER("Period Start",DateFilter);
            Period."Period Start" := DimCodeBuf."Period Start";
            ResultSteps := PeriodFormMgt.NextDate(Steps,Period,PeriodType);
            IF ResultSteps <> 0 THEN
              CopyPeriodToBuf(Period,DimCodeBuf);
          END;
        DimOption::"Business Unit" :
          BEGIN
            BusUnit.Code := DimCodeBuf.Code;
            IF BusUnitFilter <> '' THEN
              BusUnit.SETFILTER(Code,BusUnitFilter);
            ResultSteps := BusUnit.NEXT(Steps);
            IF ResultSteps <> 0 THEN
              CopyBusUnitToBuf(BusUnit,DimCodeBuf);
          END;
        DimOption::"Dimension 1" :
          BEGIN
            IF GlobalDim1Filter <> '' THEN
              DimVal.SETFILTER(Code,GlobalDim1Filter);
            DimVal."Dimension Code" := GLSetup."Global Dimension 1 Code";
            DimVal.SETRANGE("Dimension Code",DimVal."Dimension Code");
            DimVal.Code := DimCodeBuf.Code;
            ResultSteps := DimVal.NEXT(Steps);
            IF ResultSteps <> 0 THEN
              CopyDimValueToBuf(DimVal,DimCodeBuf);
          END;
        DimOption::"Dimension 2" :
          BEGIN
            IF GlobalDim2Filter <> '' THEN
              DimVal.SETFILTER(Code,GlobalDim2Filter);
            DimVal."Dimension Code" := GLSetup."Global Dimension 2 Code";
            DimVal.SETRANGE("Dimension Code",DimVal."Dimension Code");
            DimVal.Code := DimCodeBuf.Code;
            ResultSteps := DimVal.NEXT(Steps);
            IF ResultSteps <> 0 THEN
              CopyDimValueToBuf(DimVal,DimCodeBuf);
          END;
      END;
      EXIT(ResultSteps);
    END;

    LOCAL PROCEDURE CopyGLAccToBuf@1(VAR TheGLAcc@1000 : Record 15;VAR TheDimCodeBuf@1001 : Record 367);
    BEGIN
      WITH TheDimCodeBuf DO BEGIN
        INIT;
        Code := TheGLAcc."No.";
        Name := TheGLAcc.Name;
        Totaling := TheGLAcc.Totaling;
        Indentation := TheGLAcc.Indentation;
        "Show in Bold" := TheGLAcc."Account Type" <> TheGLAcc."Account Type"::Posting;
      END;
    END;

    LOCAL PROCEDURE CopyPeriodToBuf@8(VAR ThePeriod@1000 : Record 2000000007;VAR TheDimCodeBuf@1001 : Record 367);
    VAR
      Period2@1002 : Record 2000000007;
    BEGIN
      WITH TheDimCodeBuf DO BEGIN
        INIT;
        Code := FORMAT(ThePeriod."Period Start");
        "Period Start" := ThePeriod."Period Start";
        IF ClosingEntryFilter = ClosingEntryFilter::Include THEN
          "Period End" := CLOSINGDATE(ThePeriod."Period End")
        ELSE
          "Period End" := ThePeriod."Period End";
        IF DateFilter <> '' THEN BEGIN
          Period2.SETFILTER("Period End",DateFilter);
          IF Period2.GETRANGEMAX("Period End") < "Period End" THEN
            "Period End" := Period2.GETRANGEMAX("Period End");
        END;
        Name := ThePeriod."Period Name";
      END;
    END;

    LOCAL PROCEDURE CopyBusUnitToBuf@5(VAR TheBusUnit@1000 : Record 220;VAR TheDimCodeBuf@1001 : Record 367);
    BEGIN
      WITH TheDimCodeBuf DO BEGIN
        INIT;
        Code := TheBusUnit.Code;
        Name := TheBusUnit.Name;
      END;
    END;

    LOCAL PROCEDURE CopyDimValueToBuf@9(VAR TheDimVal@1000 : Record 349;VAR TheDimCodeBuf@1001 : Record 367);
    BEGIN
      WITH TheDimCodeBuf DO BEGIN
        INIT;
        Code := TheDimVal.Code;
        Name := TheDimVal.Name;
        Totaling := TheDimVal.Totaling;
        Indentation := TheDimVal.Indentation;
        "Show in Bold" :=
          TheDimVal."Dimension Value Type" <> TheDimVal."Dimension Value Type"::Standard;
      END;
    END;

    LOCAL PROCEDURE FindPeriod@2(SearchText@1000 : Code[10]);
    VAR
      Period@1001 : Record 2000000007;
      PeriodFormMgt@1002 : Codeunit 359;
    BEGIN
      IF DateFilter <> '' THEN BEGIN
        Period.SETFILTER("Period Start",DateFilter);
        IF NOT PeriodFormMgt.FindDate('+',Period,PeriodType) THEN
          PeriodFormMgt.FindDate('+',Period,PeriodType::Day);
        Period.SETRANGE("Period Start");
      END;
      IF PeriodFormMgt.FindDate(SearchText,Period,PeriodType) THEN
        IF ClosingEntryFilter = ClosingEntryFilter::Include THEN
          Period."Period End" := CLOSINGDATE(Period."Period End");
      IF AmountType = AmountType::"Net Change" THEN BEGIN
        GLAcc.SETRANGE("Date Filter",Period."Period Start",Period."Period End");
        IF GLAcc.GETRANGEMIN("Date Filter") = GLAcc.GETRANGEMAX("Date Filter") THEN
          GLAcc.SETRANGE("Date Filter",GLAcc.GETRANGEMIN("Date Filter"));
      END ELSE
        GLAcc.SETRANGE("Date Filter",0D,Period."Period End");

      InternalDateFilter := GLAcc.GETFILTER("Date Filter");
      IF (LineDimOption <> LineDimOption::Period) AND (ColumnDimOption <> ColumnDimOption::Period) THEN
        DateFilter := InternalDateFilter;
      DimCodAmtBuf.DELETEALL;
    END;

    LOCAL PROCEDURE CalculateClosingDateFilter@45();
    VAR
      AccountingPeriod@1000 : Record 50;
      FirstRec@1001 : Boolean;
    BEGIN
      IF ClosingEntryFilter = ClosingEntryFilter::Include THEN
        ExcludeClosingDateFilter := ''
      ELSE BEGIN
        AccountingPeriod.SETCURRENTKEY("New Fiscal Year");
        AccountingPeriod.SETRANGE("New Fiscal Year",TRUE);
        FirstRec := TRUE;
        IF AccountingPeriod.FIND('-') THEN
          REPEAT
            IF FirstRec THEN
              ExcludeClosingDateFilter :=
                STRSUBSTNO('<>%1',CLOSINGDATE(AccountingPeriod."Starting Date" - 1))
            ELSE
              ExcludeClosingDateFilter :=
                ExcludeClosingDateFilter + STRSUBSTNO('&<>%1',CLOSINGDATE(AccountingPeriod."Starting Date" - 1));
            FirstRec := FALSE;
          UNTIL AccountingPeriod.NEXT = 0;
      END;
    END;

    LOCAL PROCEDURE FormatAmount@6(VAR Text@1000 : Text[250]);
    VAR
      Amount@1001 : Decimal;
    BEGIN
      IF Text = '' THEN
        EXIT;

      EVALUATE(Amount,Text);

      IF ShowActualBudg IN [ShowActualBudg::"Variance%",ShowActualBudg::"Index%"] THEN BEGIN
        IF Amount = 0 THEN
          Text := ''
        ELSE
          Text := FORMAT(ROUND(Amount,0.1),0,Text000);
        EXIT;
      END;

      IF RoundingFactor = RoundingFactor::None THEN
        EXIT;

      CASE RoundingFactor OF
        RoundingFactor::"1":
          Amount := ROUND(Amount,1);
        RoundingFactor::"1000":
          Amount := ROUND(Amount / 1000,0.1);
        RoundingFactor::"1000000":
          Amount := ROUND(Amount / 1000000,0.1);
      END;
      IF Amount = 0 THEN
        Text := ''
      ELSE
        CASE RoundingFactor OF
          RoundingFactor::"1":
            Text := FORMAT(Amount);
          RoundingFactor::"1000",RoundingFactor::"1000000":
            Text := FORMAT(Amount,0,Text000);
        END;
    END;

    LOCAL PROCEDURE GetDimSelection@3(OldDimSelCode@1000 : Text[30]) : Text[30];
    VAR
      DimSelection@1001 : Form 568;
    BEGIN
      DimSelection.InsertDimSelBuf(FALSE,GLAcc.TABLECAPTION,GLAcc.TABLECAPTION);
      DimSelection.InsertDimSelBuf(FALSE,BusUnit.TABLECAPTION,BusUnit.TABLECAPTION);
      DimSelection.InsertDimSelBuf(FALSE,Text001,Text001);
      IF GLSetup."Global Dimension 1 Code" <> '' THEN
        DimSelection.InsertDimSelBuf(FALSE,GLSetup."Global Dimension 1 Code",'');
      IF GLSetup."Global Dimension 2 Code" <> '' THEN
        DimSelection.InsertDimSelBuf(FALSE,GLSetup."Global Dimension 2 Code",'');

      DimSelection.LOOKUPMODE := TRUE;
      IF DimSelection.RUNMODAL = ACTION::LookupOK THEN
        EXIT(DimSelection.GetDimSelCode)
      ELSE
        EXIT(OldDimSelCode);
    END;

    LOCAL PROCEDURE LookUpCode@4(DimOption@1000 : 'G/L Account,Period,Business Unit,Dimension 1,Dimension 2';DimCode@1001 : Text[30];Code@1002 : Text[30]);
    VAR
      GLAcc@1003 : Record 15;
      BusUnit@1004 : Record 220;
      DimVal@1005 : Record 349;
      DimValList@1006 : Form 560;
    BEGIN
      CASE DimOption OF
        DimOption::"G/L Account" :
          BEGIN
            GLAcc.GET(Code);
            FORM.RUNMODAL(FORM::"G/L Account List",GLAcc);
          END;
        DimOption::Period : ;
        DimOption::"Business Unit" :
          BEGIN
            BusUnit.GET(Code);
            FORM.RUNMODAL(FORM::"Business Unit List",BusUnit);
          END;
        DimOption::"Dimension 1",DimOption::"Dimension 2" :
          BEGIN
            DimVal.SETRANGE("Dimension Code",DimCode);
            DimVal.GET(DimCode,Code);
            DimValList.SETTABLEVIEW(DimVal);
            DimValList.SETRECORD(DimVal);
            DimValList.RUNMODAL;
          END;
      END;
    END;

    LOCAL PROCEDURE LookUpDimFilter@57(Dim@1000 : Code[20];VAR Text@1001 : Text[250]) : Boolean;
    VAR
      DimVal@1002 : Record 349;
      DimValList@1003 : Form 560;
    BEGIN
      IF Dim = '' THEN
        EXIT(FALSE);
      DimValList.LOOKUPMODE(TRUE);
      DimVal.SETRANGE("Dimension Code",Dim);
      DimValList.SETTABLEVIEW(DimVal);
      IF DimValList.RUNMODAL = ACTION::LookupOK THEN BEGIN
        DimValList.GETRECORD(DimVal);
        Text := DimValList.GetSelectionFilter;
        EXIT(TRUE);
      END ELSE
        EXIT(FALSE)
    END;

    LOCAL PROCEDURE SetCommonFilters@15(VAR TheGLAcc@1000 : Record 15);
    VAR
      DateFilter2@1001 : Text[1024];
    BEGIN
      CLEAR(TheGLAcc);
      WITH TheGLAcc DO BEGIN
        IF DateFilter = '' THEN
          DateFilter2 := ExcludeClosingDateFilter
        ELSE BEGIN
          IF AmountType = AmountType::"Net Change" THEN BEGIN
            DateFilter2 := DateFilter;
          END ELSE BEGIN
            SETFILTER("Date Filter",DateFilter);
            DateFilter2 := STRSUBSTNO('..%1',GETRANGEMAX("Date Filter"));
          END;
          IF ExcludeClosingDateFilter <> '' THEN
            DateFilter2 := DateFilter2 + '&' + ExcludeClosingDateFilter;
        END;
        RESET;
        IF GLAccFilter <> '' THEN
          SETFILTER("No.",GLAccFilter)
        ELSE
          SETRANGE("No.");
        IF GLAccFilter <> '' THEN
          Totaling := GLAccFilter
        ELSE
          IF "No." = '' THEN
            Totaling := STRSUBSTNO('>%1','''''');
        SETFILTER("Date Filter",DateFilter2);
        IF BusUnitFilter <> '' THEN
          SETFILTER("Business Unit Filter",BusUnitFilter);
        IF GlobalDim1Filter <> '' THEN
          SETFILTER("Global Dimension 1 Filter",GlobalDim1Filter);
        IF GlobalDim2Filter <> '' THEN
          SETFILTER("Global Dimension 2 Filter",GlobalDim2Filter);
        IF BudgetFilter = '' THEN
          SETRANGE("Budget Filter")
        ELSE
          SETFILTER("Budget Filter",BudgetFilter);
      END;
    END;

    LOCAL PROCEDURE SetDimFilters@17(VAR TheGLAcc@1000 : Record 15;LineOrColumn@1001 : 'Line,Column');
    VAR
      DimOption@1002 : 'G/L Account,Period,Business Unit,Dimension 1,Dimension 2,Dimension 3,Dimension 4';
      DimCodeBuf@1003 : Record 367;
    BEGIN
      IF LineOrColumn = LineOrColumn::Line THEN BEGIN
        DimCodeBuf := Rec;
        DimOption := LineDimOption;
      END ELSE BEGIN
        DimCodeBuf := CurrForm.Matrix.MatrixRec;
        DimOption := ColumnDimOption;
      END;
      CASE DimOption OF
        DimOption::"G/L Account" :
          BEGIN
            TheGLAcc."No." := DimCodeBuf.Code;
            TheGLAcc.Totaling := DimCodeBuf.Totaling;
          END;
        DimOption::Period :
          BEGIN
            IF AmountType = AmountType::"Net Change" THEN
              TheGLAcc.SETRANGE(
                "Date Filter",DimCodeBuf."Period Start",DimCodeBuf."Period End")
            ELSE
              TheGLAcc.SETRANGE("Date Filter",0D,DimCodeBuf."Period End");
            IF (ClosingEntryFilter = ClosingEntryFilter::Exclude) AND (ExcludeClosingDateFilter <> '') THEN
              TheGLAcc.SETFILTER(
                "Date Filter",TheGLAcc.GETFILTER("Date Filter") +
                '&' + ExcludeClosingDateFilter);
          END;
        DimOption::"Business Unit" :
          TheGLAcc.SETRANGE("Business Unit Filter",DimCodeBuf.Code);
        DimOption::"Dimension 1" :
          IF DimCodeBuf.Totaling = '' THEN
            TheGLAcc.SETRANGE("Global Dimension 1 Filter",DimCodeBuf.Code)
          ELSE
            TheGLAcc.SETFILTER("Global Dimension 1 Filter",DimCodeBuf.Totaling);
        DimOption::"Dimension 2" :
          IF DimCodeBuf.Totaling = '' THEN
            TheGLAcc.SETRANGE("Global Dimension 2 Filter",DimCodeBuf.Code)
          ELSE
            TheGLAcc.SETFILTER("Global Dimension 2 Filter",DimCodeBuf.Totaling);
      END;
    END;

    LOCAL PROCEDURE DrillDown@30(SetColFilter@1000 : Boolean);
    VAR
      GLEntry@1001 : Record 17;
      GLBudgetEntry@1002 : Record 96;
    BEGIN
      SetCommonFilters(GLAcc);
      SetDimFilters(GLAcc,0);
      IF SetColFilter THEN
        SetDimFilters(GLAcc,1);
      IF ShowActualBudg = ShowActualBudg::"Actual Amounts" THEN BEGIN
        WITH GLEntry DO BEGIN
          IF GLAcc."No." <> '' THEN
            SETRANGE("G/L Account No.",GLAcc."No.");
          IF GLAcc.Totaling <> '' THEN
            SETFILTER("G/L Account No.",GLAcc.Totaling);
          GLAcc.COPYFILTER("Date Filter","Posting Date");
          GLAcc.COPYFILTER("Global Dimension 1 Filter","Global Dimension 1 Code");
          GLAcc.COPYFILTER("Global Dimension 2 Filter","Global Dimension 2 Code");
          GLAcc.COPYFILTER("Business Unit Filter","Business Unit Code");
          IF (GETFILTER("Global Dimension 1 Code") <> '') OR (GETFILTER("Global Dimension 2 Code") <> '') OR
             (GETFILTER("Business Unit Code") <> '')
          THEN
            SETCURRENTKEY("G/L Account No.","Business Unit Code","Global Dimension 1 Code")
          ELSE
            SETCURRENTKEY("G/L Account No.","Posting Date");
        END;
        FORM.RUN(FORM::"General Ledger Entries",GLEntry);
      END;
      IF ShowActualBudg = ShowActualBudg::"Budgeted Amounts" THEN BEGIN
        WITH GLBudgetEntry DO BEGIN
          GLAcc.COPYFILTER("Budget Filter","Budget Name");
          IF GLAcc."No." <> '' THEN
            SETRANGE("G/L Account No.",GLAcc."No.");
          IF GLAcc.Totaling <> '' THEN
            SETFILTER("G/L Account No.",GLAcc.Totaling);
          GLAcc.COPYFILTER("Date Filter",Date);
          GLAcc.COPYFILTER("Global Dimension 1 Filter","Global Dimension 1 Code");
          GLAcc.COPYFILTER("Global Dimension 2 Filter","Global Dimension 2 Code");
          GLAcc.COPYFILTER("Business Unit Filter","Business Unit Code");
          IF (GETFILTER("Global Dimension 1 Code") <> '') OR (GETFILTER("Global Dimension 2 Code") <> '') OR
             (GETFILTER("Business Unit Code") <> '')
          THEN
            SETCURRENTKEY("Budget Name","G/L Account No.","Business Unit Code","Global Dimension 1 Code")
          ELSE
            SETCURRENTKEY("Budget Name","G/L Account No.",Date);
        END;
        FORM.RUN(FORM::"G/L Budget Entries",GLBudgetEntry);
      END;
    END;

    LOCAL PROCEDURE ValidateLineDimCode@19();
    VAR
      BusUnit@1000 : Record 220;
    BEGIN
      IF (UPPERCASE(LineDimCode) <> UPPERCASE(GLAcc.TABLECAPTION)) AND
         (UPPERCASE(LineDimCode) <> UPPERCASE(BusUnit.TABLECAPTION)) AND
         (UPPERCASE(LineDimCode) <> UPPERCASE(Text001)) AND
         (UPPERCASE(LineDimCode) <> GLSetup."Global Dimension 1 Code") AND
         (UPPERCASE(LineDimCode) <> GLSetup."Global Dimension 2 Code") AND
         (LineDimCode <> '') THEN BEGIN
        MESSAGE(Text002,LineDimCode);
        LineDimCode := '';
      END;
      LineDimOption := DimCodeToOption(LineDimCode);
      InternalDateFilter := GLAcc.GETFILTER("Date Filter");
      IF (LineDimOption <> LineDimOption::Period) AND (ColumnDimOption <> ColumnDimOption::Period) THEN BEGIN
        DateFilter := InternalDateFilter;
        IF STRPOS(DateFilter,'&') > 1 THEN
          DateFilter := COPYSTR(DateFilter,1,STRPOS(DateFilter,'&') - 1);
      END ELSE
        PeriodInitialized := FALSE;
    END;

    LOCAL PROCEDURE ValidateColumnDimCode@20();
    VAR
      BusUnit@1000 : Record 220;
    BEGIN
      IF (UPPERCASE(ColumnDimCode) <> UPPERCASE(GLAcc.TABLECAPTION)) AND
         (UPPERCASE(ColumnDimCode) <> UPPERCASE(BusUnit.TABLECAPTION)) AND
         (UPPERCASE(ColumnDimCode) <> UPPERCASE(Text001)) AND
         (UPPERCASE(ColumnDimCode) <> GLSetup."Global Dimension 1 Code") AND
         (UPPERCASE(ColumnDimCode) <> GLSetup."Global Dimension 2 Code") AND
         (ColumnDimCode <> '') THEN BEGIN
        MESSAGE(Text003,ColumnDimCode);
        ColumnDimCode := '';
      END;
      ColumnDimOption := DimCodeToOption(ColumnDimCode);
      InternalDateFilter := GLAcc.GETFILTER("Date Filter");
      IF (LineDimOption <> LineDimOption::Period) AND (ColumnDimOption <> ColumnDimOption::Period) THEN BEGIN
        DateFilter := InternalDateFilter;
        IF STRPOS(DateFilter,'&') > 1 THEN
          DateFilter := COPYSTR(DateFilter,1,STRPOS(DateFilter,'&') - 1);
      END ELSE
        PeriodInitialized := FALSE;
    END;

    LOCAL PROCEDURE CalcAmount@27(SetColFilter@1000 : Boolean) : Decimal;
    VAR
      Amount@1001 : Decimal;
      ColumnCode@1002 : Code[20];
    BEGIN
      IF SetColFilter THEN
        ColumnCode := CurrForm.Matrix.MatrixRec.Code
      ELSE
        ColumnCode := '';
      IF DimCodAmtBuf.GET(Code,ColumnCode) THEN
        EXIT(DimCodAmtBuf.Amount);

      GLAcc.RESET;
      SetCommonFilters(GLAcc);
      SetDimFilters(GLAcc,0);
      IF SetColFilter THEN
        SetDimFilters(GLAcc,1);

      CASE ShowActualBudg OF
        ShowActualBudg::"Actual Amounts":
          Amount := CalcActualAmount;
        ShowActualBudg::"Budgeted Amounts":
          Amount := CalcBudgAmount;
        ShowActualBudg::Variance:
          Amount := CalcActualAmount - CalcBudgAmount;
        ShowActualBudg::"Variance%":
          BEGIN
            Amount := CalcBudgAmount;
            IF Amount <> 0 THEN
              Amount := ROUND(100 * (CalcActualAmount - Amount) / Amount);
          END;
        ShowActualBudg::"Index%":
          BEGIN
            Amount := CalcBudgAmount;
            IF Amount <> 0 THEN
              Amount := ROUND(100 * CalcActualAmount / Amount);
          END;
      END;

      DimCodAmtBuf."Line Code" := Code;
      DimCodAmtBuf."Column Code" := ColumnCode;
      DimCodAmtBuf.Amount := Amount;
      DimCodAmtBuf.INSERT;

      EXIT(Amount);
    END;

    LOCAL PROCEDURE CalcActualAmount@7() : Decimal;
    VAR
      Amount@1001 : Decimal;
    BEGIN
      IF ShowInAddCurr THEN
        CASE AmountField OF
          AmountField::Amount:
            BEGIN
              GLAcc.CALCFIELDS("Additional-Currency Net Change");
              Amount := GLAcc."Additional-Currency Net Change";
            END;
          AmountField::"Debit Amount":
            BEGIN
              GLAcc.CALCFIELDS("Add.-Currency Debit Amount");
              Amount := GLAcc."Add.-Currency Debit Amount";
            END;
          AmountField::"Credit Amount":
            BEGIN
              GLAcc.CALCFIELDS("Add.-Currency Credit Amount");
              Amount := GLAcc."Add.-Currency Credit Amount";
            END;
        END
      ELSE
        CASE AmountField OF
          AmountField::Amount:
            BEGIN
              GLAcc.CALCFIELDS("Net Change");
              Amount := GLAcc."Net Change";
            END;
          AmountField::"Debit Amount":
            BEGIN
              GLAcc.CALCFIELDS("Debit Amount");
              Amount := GLAcc."Debit Amount";
            END;
          AmountField::"Credit Amount":
            BEGIN
              GLAcc.CALCFIELDS("Credit Amount");
              Amount := GLAcc."Credit Amount";
            END;
        END;

      EXIT(Amount);
    END;

    LOCAL PROCEDURE CalcBudgAmount@10() : Decimal;
    VAR
      Amount@1001 : Decimal;
    BEGIN
      IF BudgetFilter = '' THEN
        GLAcc.SETRANGE("Budget Filter")
      ELSE
        GLAcc.SETFILTER("Budget Filter",BudgetFilter);

      GLAcc.CALCFIELDS("Budgeted Amount");
      Amount := GLAcc."Budgeted Amount";

      CASE AmountField OF
        AmountField::"Debit Amount":
          IF Amount < 0 THEN
            Amount := 0;
        AmountField::"Credit Amount":
          IF Amount > 0 THEN
            Amount := 0
          ELSE
            Amount := -Amount;
      END;

      IF (Amount <> 0) AND ShowInAddCurr THEN BEGIN
        IF GLAcc.GETFILTER("Date Filter") = '' THEN
          CurrExchDate := WORKDATE
        ELSE
          CurrExchDate := GLAcc.GETRANGEMIN("Date Filter");
        Amount :=
          CurrExchRate.ExchangeAmtLCYToFCY(
            CurrExchDate,GLSetup."Additional Reporting Currency",Amount,
            CurrExchRate.ExchangeRate(CurrExchDate,GLSetup."Additional Reporting Currency"));
      END;

      EXIT(Amount);
    END;

    BEGIN
    END.
  }
}
