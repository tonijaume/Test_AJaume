OBJECT Form 7009790 Ficha Cabecera reserva
{
  OBJECT-PROPERTIES
  {
    Date=23/03/15;
    Time=15:02:24;
    Modified=Yes;
    Version List=AIC2009,OC-14042;
  }
  PROPERTIES
  {
    Width=23760;
    Height=12540;
    CaptionML=[ENU=Reservation header card;
               ESP=Ficha Cabecera reserva];
    ActiveControlOnOpen=4;
    SourceTable=Table7009741;
    UpdateOnActivate=Yes;
    OnOpenForm=BEGIN
                 rPar.FINDFIRST;

                 mostrarCir := rPar."Activar m¢dulo circuitos";

                 //IF cFunSeg.TienePermiso(Text001, FALSE) THEN mostrarCir := FALSE;

                 CurrForm.Circuito.VISIBLE                := mostrarCir;
                 CurrForm."Categoria Circuito".VISIBLE    := mostrarCir;
                 CurrForm."Fecha Inicio Circuito".VISIBLE := mostrarCir;
                 CurrForm."Habitacion Circuito".VISIBLE   := mostrarCir;
                 CurrForm.boton_periodo_circuito.VISIBLE  := mostrarCir;
                 CurrForm.boton_periodo.VISIBLE           := NOT mostrarCir;
               END;

    OnActivateForm=VAR
                     rPer@1103355000 : Record 7009742;
                   BEGIN
                   END;

    OnAfterGetCurrRecord=BEGIN
                           CurrForm.label_confirmacion.VISIBLE := NOT "Confirmacion servicios enviada";

                           nivel_mantenimiento;

                           rPar.FINDFIRST;

                           IF rPar."Acompa¤antes automaticos" THEN
                           BEGIN
                             CurrForm.Adultos.EDITABLE(NOT Generada);
                             CurrForm.Ni¤os.EDITABLE(NOT Generada);
                             CurrForm.Infants.EDITABLE(NOT Generada);
                           END
                           ELSE
                           BEGIN
                             CurrForm.Adultos.VISIBLE(FALSE);
                             CurrForm.Ni¤os.VISIBLE(FALSE);
                             CurrForm.Infants.VISIBLE(FALSE);
                           END;
                         END;

  }
  CONTROLS
  {
    { 93  ;MenuButton   ;15950;11770;2640 ;550  ;Name=boton_periodo;
                                                 HorzGlue=Right;
                                                 VertGlue=Bottom;
                                                 CaptionML=[ENU=Periods;
                                                            ESP=&Periodos];
                                                 Menu=MENUITEMS
                                                 {
                                                   { ID=1103355000;
                                                     Visible=No;
                                                     ShortCutKey=Ctrl+E;
                                                     CaptionML=[ENU=Hotel extras;
                                                                ESP=Extras hotel];
                                                     OnPush=BEGIN
                                                              ShowExtras;
                                                            END;
                                                             }
                                                   { ID=1100217013;
                                                     Visible=No;
                                                     MenuItemType=Separator }
                                                   { ID=95;
                                                     ShortCutKey=Ctrl+F5;
                                                     CaptionML=[ENU=Card;
                                                                ESP=Ficha];
                                                     RunFormLinkType=OnUpdate;
                                                     OnPush=BEGIN
                                                              CurrForm.sub_periodo.FORM.GETRECORD(rPer);
                                                              rPer.SETRECFILTER;
                                                              FORM.RUNMODAL(FORM::"Ficha Periodo reserva", rPer);
                                                            END;
                                                             }
                                                   { ID=96;
                                                     CaptionML=[ENU=Change Log;
                                                                ESP=Log de cambios];
                                                     OnPush=BEGIN
                                                              CurrForm.sub_periodo.FORM.GETRECORD(rPer);
                                                              rHis.SETRANGE(rHis.Delegacion  , rPer.Delegacion);
                                                              rHis.SETRANGE(rHis."N§ Interno", rPer."N§ Interno");
                                                              {* PLB 23/02/99 *
                                                                rHis.SETRANGE(rHis."N§ Periodo", rPer."N§ Periodo");
                                                                rHis.SETRANGE("Tipo Reserva"   , rHis."Tipo Reserva"::Periodo);
                                                              * PLB 23/02/99 *}
                                                              FORM.RUN(7009793, rHis);
                                                              rHis.RESET;
                                                            END;
                                                             }
                                                   { ID=1100217014;
                                                     MenuItemType=Separator }
                                                   { ID=100;
                                                     ShortCutKey=Ctrl+H;
                                                     CaptionML=[ENU=Hotel Reservation;
                                                                ESP=Reserva Hotel];
                                                     OnPush=BEGIN
                                                              CurrForm.sub_periodo.FORM.GETRECORD(rPer);
                                                              rRsvHot.SETCURRENTKEY(Delegacion,
                                                                                    "N§ Interno",
                                                                                    "N§ Periodo");
                                                              rRsvHot.SETRANGE(Delegacion  , Delegacion);
                                                              rRsvHot.SETRANGE("N§ Interno", "N§ Interno");
                                                              rRsvHot.SETRANGE("N§ Periodo", rPer."N§ Periodo");
                                                              rRsvHot.SETRANGE(Bono        , Bono);
                                                              FORM.RUN(7009803, rRsvHot);
                                                            END;
                                                             }
                                                   { ID=101;
                                                     ShortCutKey=Ctrl+T;
                                                     CaptionML=[ENU=Transfer Reservations;
                                                                ESP=Reservas Transfer];
                                                     OnPush=BEGIN
                                                              CurrForm.sub_periodo.FORM.GETRECORD(rPer);
                                                              rRsvTra.SETCURRENTKEY(Delegacion,
                                                                                    "N§ Interno");
                                                              rRsvTra.SETRANGE(Delegacion  , Delegacion);
                                                              rRsvTra.SETRANGE("N§ Interno", "N§ Interno");
                                                              rRsvTra.SETRANGE("N§ Periodo", rPer."N§ Periodo");
                                                              FORM.RUN(7009923, rRsvTra);
                                                              rRsvTra.SETRANGE(Delegacion);
                                                              rRsvTra.SETRANGE("N§ Interno");
                                                              rRsvTra.SETRANGE("N§ Periodo");
                                                            END;
                                                             }
                                                   { ID=1100217015;
                                                     MenuItemType=Separator }
                                                   { ID=103;
                                                     CaptionML=[ENU=Delete Flight information;
                                                                ESP=Borra vuelo reserva];
                                                     OnPush=BEGIN
                                                              IF Rec.Mantenimiento THEN BEGIN
                                                                CLEAR(rRsvHot);
                                                                CurrForm.sub_periodo.FORM.GETRECORD(rPer);
                                                                cRes.plan_vuelo(rPer, rRsvHot);
                                                              END;
                                                            END;
                                                             }
                                                   { ID=104;
                                                     CaptionML=[ENU=Divide period;
                                                                ESP=Dividir Per¡odo];
                                                     OnPush=VAR
                                                              cFunciones@1103355001 : Codeunit 7009726;
                                                            BEGIN
                                                              CurrForm.sub_periodo.FORM.GETRECORD(rPer);
                                                              rPer.SETRECFILTER;
                                                              cFunciones.Dividir_Periodo(rPer);
                                                            END;
                                                             }
                                                   { ID=112;
                                                     CaptionML=[ENU=Change Hotel;
                                                                ESP=Cambia Hotel];
                                                     OnPush=VAR
                                                              rHot@1103355001 : Record 7009743;
                                                              cHot@1103355002 : Codeunit 7009719;
                                                            BEGIN
                                                              CurrForm.sub_periodo.FORM.GETRECORD(rPer);
                                                              rHot.RESET;
                                                              rHot.SETRANGE(Delegacion  , rPer.Delegacion);
                                                              rHot.SETRANGE("N§ Interno", rPer."N§ Interno");
                                                              rHot.SETRANGE("N§ Periodo", rPer."N§ Periodo");
                                                              rHot.SETRANGE(Responsable , TRUE);
                                                              IF rHot.FIND('-') THEN BEGIN
                                                                IF rHot."Pendiente asignar" THEN
                                                                  ERROR(Text003);
                                                              //  cRes.cambiar_booking(rHot, FALSE);
                                                                cHot.cambiar_booking(rHot, FALSE);
                                                              END;
                                                              rHot.RESET;
                                                            END;
                                                             }
                                                   { ID=1100217002;
                                                     CaptionML=[ENU=Add Transfer;
                                                                ESP=Agregar Transfer];
                                                     OnPush=BEGIN
                                                              CurrForm.sub_periodo.FORM.GETRECORD(rPer);
                                                              cRes.AgregarServicioTransfer(rPer);
                                                            END;
                                                             }
                                                   { ID=106;
                                                     MenuItemType=Separator }
                                                   { ID=107;
                                                     CaptionML=[ENU=Hotel Purchase contract;
                                                                ESP=Contrato compra hotel];
                                                     OnPush=VAR
                                                              lrConC@1100253001 : Record 7009723;
                                                            BEGIN
                                                              CurrForm.sub_periodo.FORM.GETRECORD(rPer);

                                                              lrConC.RESET;
                                                              lrConC.SETCURRENTKEY(Delegacion,
                                                                                  TourOperador,
                                                                                  Hotel,
                                                                                  "Fecha inicio contrato",
                                                                                  "Fecha final contrato");
                                                              lrConC.SETRANGE(Delegacion, rPer.Delegacion);
                                                              IF rPer."Contrato compra" = '' THEN BEGIN
                                                                lrConC.SETRANGE(TourOperador, TourOperador);
                                                                lrConC.SETRANGE(Hotel       , rPer."Hotel origen precios");
                                                              END
                                                              ELSE BEGIN
                                                                lrConC.SETRANGE("N§ Contrato compra", rPer."Contrato compra");
                                                              END;
                                                              IF lrConC.FINDLAST THEN
                                                                FORM.RUN(7009735, lrConC);
                                                            END;
                                                             }
                                                   { ID=108;
                                                     CaptionML=[ENU=Hotel Sale contract;
                                                                ESP=Contrato venta hotel];
                                                     OnPush=BEGIN
                                                              CurrForm.sub_periodo.FORM.GETRECORD(rPer);
                                                              rConV.SETCURRENTKEY(Delegacion,
                                                                                  TourOperador,
                                                                                  Hotel,
                                                                                  "Fecha inicio contrato",
                                                                                  "Fecha final contrato");
                                                              rConV.SETRANGE(Delegacion          , rPer.Delegacion);
                                                              IF rPer."Contrato venta" = '' THEN BEGIN
                                                                rConV.SETRANGE(TourOperador        , "TourOperador Venta");
                                                                rConV.SETRANGE(Hotel               , rPer."Hotel venta");
                                                              END
                                                              ELSE BEGIN
                                                                rConV.SETRANGE("N§ Contrato venta", rPer."Contrato venta");
                                                              END;
                                                              FORM.RUN(7009739, rConV);
                                                              rConV.SETRANGE(Delegacion);
                                                              rConV.SETRANGE(TourOperador);
                                                              rConV.SETRANGE(Hotel);
                                                              rConV.SETRANGE("N§ Contrato venta");
                                                            END;
                                                             }
                                                 }
                                                  }
    { 1   ;TabControl   ;220  ;220  ;23320;6490 ;HorzGlue=Both;
                                                 VertGlue=Top;
                                                 PageNamesML=[ENU=General,Importation;
                                                              ESP=General,Importacion] }
    { 2   ;TextBox      ;3850 ;990  ;1980 ;440  ;ParentControl=1;
                                                 InPage=0;
                                                 SourceExpr="N§ Interno";
                                                 OnFormat=BEGIN
                                                            {
                                                            IF CurrForm.ACTIVE THEN BEGIN
                                                              CurrForm."N§ Interno".UPDATEFORECOLOR := 255;
                                                              CurrForm."N§ Interno".UPDATEFONTBOLD := TRUE;
                                                            END
                                                            ELSE BEGIN
                                                              CurrForm."N§ Interno".UPDATEFORECOLOR := 0;
                                                              CurrForm."N§ Interno".UPDATEFONTBOLD := TRUE;
                                                            END;
                                                            }
                                                          END;
                                                           }
    { 3   ;Label        ;440  ;990  ;3300 ;440  ;ParentControl=2 }
    { 4   ;TextBox      ;3850 ;1650 ;2750 ;440  ;ParentControl=1;
                                                 InPage=0;
                                                 SourceExpr=TourOperador }
    { 5   ;Label        ;440  ;1650 ;3300 ;440  ;ParentControl=4 }
    { 6   ;TextBox      ;3850 ;2750 ;2750 ;440  ;ParentControl=1;
                                                 InPage=0;
                                                 SourceExpr=Bono }
    { 7   ;Label        ;440  ;2750 ;3300 ;440  ;ParentControl=6 }
    { 8   ;TextBox      ;3850 ;3300 ;6930 ;440  ;ParentControl=1;
                                                 InPage=0;
                                                 SourceExpr=Nombre }
    { 9   ;Label        ;440  ;3300 ;3300 ;440  ;ParentControl=8 }
    { 16  ;TextBox      ;3850 ;5500 ;2750 ;440  ;ParentControl=1;
                                                 InPage=0;
                                                 SourceExpr=Idioma }
    { 17  ;Label        ;440  ;5500 ;3300 ;440  ;ParentControl=16 }
    { 20  ;TextBox      ;3850 ;6050 ;880  ;440  ;ParentControl=1;
                                                 InPage=0;
                                                 NextControl=19;
                                                 SourceExpr=Paxes }
    { 21  ;Label        ;440  ;6050 ;3300 ;440  ;ParentControl=20 }
    { 24  ;CheckBox     ;20790;1540 ;440  ;440  ;HorzGlue=Right;
                                                 ParentControl=1;
                                                 InPage=0;
                                                 ShowCaption=No;
                                                 SourceExpr=Mantenimiento;
                                                 OnValidate=BEGIN
                                                              nivel_mantenimiento;
                                                            END;
                                                             }
    { 25  ;Label        ;17600;1540 ;3080 ;440  ;HorzGlue=Right;
                                                 ParentControl=24 }
    { 33  ;TextBox      ;6710 ;1650 ;4070 ;440  ;Focusable=No;
                                                 ParentControl=1;
                                                 InPage=0;
                                                 SourceExpr=cNom.nom_touroperador(TourOperador) }
    { 34  ;TextBox      ;6710 ;5500 ;4070 ;440  ;Focusable=No;
                                                 ParentControl=1;
                                                 InPage=0;
                                                 SourceExpr=cNom.nom_idioma(Idioma) }
    { 51  ;CheckBox     ;20790;990  ;440  ;440  ;HorzGlue=Right;
                                                 ParentControl=1;
                                                 InPage=0;
                                                 ShowCaption=No;
                                                 SourceExpr=Generada }
    { 52  ;Label        ;17600;990  ;3080 ;440  ;HorzGlue=Right;
                                                 ParentControl=51 }
    { 53  ;TextBox      ;20790;3850 ;2530 ;440  ;HorzGlue=Right;
                                                 ParentControl=1;
                                                 InPage=0;
                                                 SourceExpr="Codigo Grupo" }
    { 59  ;Label        ;17600;3850 ;3080 ;440  ;HorzGlue=Right;
                                                 ParentControl=53 }
    { 14  ;TextBox      ;3850 ;3850 ;1870 ;440  ;ParentControl=1;
                                                 InPage=0;
                                                 SourceExpr="Fecha venta" }
    { 15  ;Label        ;440  ;3850 ;3300 ;440  ;ParentControl=14 }
    { 19  ;TextBox      ;20790;2090 ;1210 ;440  ;HorzGlue=Right;
                                                 ParentControl=1;
                                                 InPage=0;
                                                 SourceExpr=Adultos }
    { 62  ;Label        ;17600;2090 ;3080 ;440  ;HorzGlue=Right;
                                                 ParentControl=19;
                                                 CaptionML=[ENU=Adult companions;
                                                            ESP=Adul. Acompa¤antes] }
    { 63  ;TextBox      ;20790;2640 ;1210 ;440  ;HorzGlue=Right;
                                                 ParentControl=1;
                                                 InPage=0;
                                                 SourceExpr=Ni¤os }
    { 64  ;Label        ;17600;2640 ;3080 ;440  ;HorzGlue=Right;
                                                 ParentControl=63 }
    { 65  ;TextBox      ;20790;3190 ;1210 ;440  ;HorzGlue=Right;
                                                 ParentControl=1;
                                                 InPage=0;
                                                 SourceExpr=Infants }
    { 66  ;Label        ;17600;3190 ;3080 ;440  ;HorzGlue=Right;
                                                 ParentControl=65 }
    { 69  ;TextBox      ;6710 ;2200 ;4070 ;440  ;Focusable=No;
                                                 ParentControl=1;
                                                 InPage=0;
                                                 SourceExpr=cNom.nom_touroperador("TourOperador Venta") }
    { 70  ;TextBox      ;3850 ;2200 ;2750 ;440  ;ParentControl=1;
                                                 InPage=0;
                                                 SourceExpr="TourOperador Venta" }
    { 71  ;Label        ;440  ;2200 ;3300 ;440  ;ParentControl=70 }
    { 72  ;TextBox      ;20790;4400 ;2530 ;440  ;HorzGlue=Right;
                                                 ParentControl=1;
                                                 InPage=0;
                                                 SourceExpr=Circuito }
    { 73  ;Label        ;17600;4400 ;3080 ;440  ;HorzGlue=Right;
                                                 ParentControl=72 }
    { 86  ;TextBox      ;20790;4950 ;2530 ;440  ;HorzGlue=Right;
                                                 ParentControl=1;
                                                 InPage=0;
                                                 SourceExpr="Categoria Circuito" }
    { 87  ;Label        ;17600;4950 ;3080 ;440  ;HorzGlue=Right;
                                                 ParentControl=86 }
    { 88  ;TextBox      ;20790;5500 ;1870 ;440  ;HorzGlue=Right;
                                                 ParentControl=1;
                                                 InPage=0;
                                                 SourceExpr="Fecha Inicio Circuito" }
    { 89  ;Label        ;17600;5500 ;3080 ;440  ;HorzGlue=Right;
                                                 ParentControl=88 }
    { 90  ;TextBox      ;20790;6050 ;1870 ;440  ;HorzGlue=Right;
                                                 ParentControl=1;
                                                 InPage=0;
                                                 SourceExpr="Habitacion Circuito" }
    { 91  ;Label        ;17600;6050 ;3080 ;440  ;HorzGlue=Right;
                                                 ParentControl=90 }
    { 1103355003;TextBox;8910 ;990  ;1870 ;440  ;ParentControl=1;
                                                 InPage=0;
                                                 SourceExpr=GetNumeroCotizacion;
                                                 OnLookup=BEGIN

                                                            LookUpCotizacion;
                                                          END;
                                                           }
    { 1103355002;Label  ;6820 ;990  ;1980 ;440  ;ParentControl=1103355003;
                                                 CaptionML=[ENU=Quote;
                                                            ESP=Cotizacion] }
    { 1100217004;Label  ;19580;220  ;3900 ;550  ;Name=label_confirmacion;
                                                 HorzGlue=Right;
                                                 ParentControl=1;
                                                 InPage=0;
                                                 HorzAlign=Center;
                                                 FontSize=9;
                                                 FontBold=Yes;
                                                 LeaderDots=No;
                                                 CaptionML=[ENU=Send confirmation;
                                                            ESP=Enviar confirmacion] }
    { 1100217016;TextBox;3850 ;4950 ;2750 ;440  ;ParentControl=1;
                                                 InPage=0;
                                                 SourceExpr="Tipo Operacion" }
    { 1100217017;Label  ;440  ;4950 ;3300 ;440  ;ParentControl=1100217016 }
    { 1000000000;TextBox;3850 ;4400 ;2750 ;440  ;ParentControl=1;
                                                 InPage=0;
                                                 SourceExpr="Canal venta" }
    { 1000000001;Label  ;440  ;4400 ;3300 ;440  ;ParentControl=1000000000 }
    { 61  ;PictureBox   ;5940 ;990  ;440  ;440  ;VertGlue=Bottom;
                                                 Focusable=No;
                                                 ParentControl=1;
                                                 InPage=0;
                                                 ShowCaption=No;
                                                 Border=No;
                                                 BitmapPos=Center;
                                                 BitmapList=7,6;
                                                 SourceExpr=Comentarios }
    { 60  ;CommandButton;5940 ;990  ;440  ;440  ;VertGlue=Bottom;
                                                 FocusOnClick=Yes;
                                                 ParentControl=1;
                                                 InPage=0;
                                                 ShowCaption=No;
                                                 BackTransparent=Yes;
                                                 PushAction=RunObject;
                                                 ToolTipML=[ENU=Comment;
                                                            ESP=Comentario];
                                                 RunObject=Form 7009834;
                                                 RunFormLinkType=OnUpdate;
                                                 RunFormView=SORTING(Delegacion,N§ Interno,N§ Periodo,N§ Reserva,Tipo Reserva,N§ Orden);
                                                 RunFormLink=Delegacion=FIELD(Delegacion),
                                                             N§ Interno=FIELD(N§ Interno) }
    { 28  ;TextBox      ;3850 ;990  ;1650 ;440  ;ParentControl=1;
                                                 InPage=1;
                                                 SourceExpr="N§ Fichero" }
    { 29  ;Label        ;440  ;990  ;3300 ;440  ;ParentControl=28 }
    { 26  ;TextBox      ;3850 ;2090 ;1650 ;440  ;ParentControl=1;
                                                 InPage=1;
                                                 NextControl=4;
                                                 SourceExpr="Fecha recepcion" }
    { 27  ;Label        ;440  ;2090 ;3300 ;440  ;ParentControl=26 }
    { 74  ;TextBox      ;3850 ;3190 ;2750 ;440  ;ParentControl=1;
                                                 InPage=1;
                                                 SourceExpr=Usuario }
    { 75  ;Label        ;440  ;3190 ;3300 ;440  ;ParentControl=74 }
    { 110 ;TextBox      ;3850 ;2640 ;1650 ;440  ;ParentControl=1;
                                                 InPage=1;
                                                 SourceExpr=Temporada }
    { 111 ;Label        ;440  ;2640 ;3300 ;440  ;ParentControl=110 }
    { 32  ;CommandButton;21340;11770;2200 ;550  ;HorzGlue=Right;
                                                 VertGlue=Bottom;
                                                 PushAction=FormHelp }
    { 36  ;MenuButton   ;18810;11770;2310 ;550  ;HorzGlue=Right;
                                                 VertGlue=Bottom;
                                                 CaptionML=[ENU=&Reservations;
                                                            ESP=&Reservas];
                                                 Menu=MENUITEMS
                                                 {
                                                   { ID=37;
                                                     ShortCutKey=F5;
                                                     CaptionML=[ENU=List;
                                                                ESP=Lista];
                                                     OnPush=VAR
                                                              fRelPer@1103355001 : Form 7009869;
                                                            BEGIN
                                                              fRelPer.LOOKUPMODE(TRUE);
                                                              rPer.RESET;
                                                              fRelPer.SETTABLEVIEW(rPer);
                                                              IF fRelPer.RUNMODAL = ACTION::LookupOK THEN BEGIN
                                                                fRelPer.GETRECORD(rPer);
                                                                Rec.GET(rPer.Delegacion, rPer."N§ Interno")

                                                              END;
                                                              CLEAR(fRelPer);
                                                            END;
                                                             }
                                                   { ID=40;
                                                     PushAction=RunObject;
                                                     CaptionML=[ENU=Change Log;
                                                                ESP=Log de cambios];
                                                     RunObject=Form 7009793;
                                                     RunFormLinkType=OnOpen;
                                                     RunFormView=SORTING(Delegacion,N§ Interno,N§ Periodo,N§ Reserva,Tipo Reserva,N§ Historico);
                                                     RunFormLink=Delegacion=FIELD(Delegacion),
                                                                 N§ Interno=FIELD(N§ Interno) }
                                                   { ID=1100217009;
                                                     PushAction=RunObject;
                                                     CaptionML=[ENU=Transfers in destination;
                                                                ESP=Traslados en destino];
                                                     RunObject=Form 7009846;
                                                     RunFormLink=Delegacion=FIELD(Delegacion),
                                                                 Num. Reserva=FIELD(N§ Interno) }
                                                   { ID=1100217007;
                                                     MenuItemType=Separator }
                                                   { ID=49;
                                                     ShortCutKey=F11;
                                                     CaptionML=[ENU=Confirm reservation;
                                                                ESP=Confirmar reserva];
                                                     OnPush=BEGIN
                                                              cRes.generar_cabecera(Rec, TRUE);
                                                            END;
                                                             }
                                                   { ID=58;
                                                     CaptionML=[ENU=Add companion;
                                                                ESP=Agregar acompa¤ante];
                                                     OnPush=BEGIN
                                                              cRes.a¤adir_acompa¤ante(Rec);
                                                            END;
                                                             }
                                                   { ID=1100217005;
                                                     MenuItemType=Separator }
                                                   { ID=1100217006;
                                                     CaptionML=[ENU=Create TTOO confirmation;
                                                                ESP=Crear confirmacion TTOO];
                                                     OnPush=VAR
                                                              lcEnviar@1100217001 : Codeunit 7009746;
                                                            BEGIN
                                                              lcEnviar.GenerarConfTouroperador(Rec, FALSE);
                                                            END;
                                                             }
                                                   { ID=1100217008;
                                                     CaptionML=[ENU=View TTOO confirmation;
                                                                ESP=Ver confirmacion TTOO];
                                                     OnPush=VAR
                                                              lcEnviar@1100217000 : Codeunit 7009746;
                                                            BEGIN
                                                              lcEnviar.VerConfirmacion(Rec);
                                                            END;
                                                             }
                                                 }
                                                  }
    { 38  ;MenuButton   ;15950;11770;2640 ;550  ;Name=boton_periodo_circuito;
                                                 HorzGlue=Right;
                                                 VertGlue=Bottom;
                                                 CaptionML=[ENU=P&eriods;
                                                            ESP=&Periodos];
                                                 Menu=MENUITEMS
                                                 {
                                                   { ID=1103355001;
                                                     Visible=No;
                                                     ShortCutKey=Ctrl+E;
                                                     CaptionML=[ENU=Hotel extras;
                                                                ESP=Extras hotel];
                                                     OnPush=BEGIN
                                                              ShowExtras;
                                                            END;
                                                             }
                                                   { ID=1100217010;
                                                     Visible=No;
                                                     MenuItemType=Separator }
                                                   { ID=39;
                                                     ShortCutKey=Ctrl+F5;
                                                     CaptionML=[ENU=Card;
                                                                ESP=Ficha];
                                                     RunFormLinkType=OnUpdate;
                                                     OnPush=BEGIN
                                                              CurrForm.sub_periodo.FORM.GETRECORD(rPer);
                                                              rPer.SETRECFILTER;
                                                              FORM.RUNMODAL(FORM::"Ficha Periodo reserva", rPer);
                                                            END;
                                                             }
                                                   { ID=41;
                                                     CaptionML=[ENU=Change Log;
                                                                ESP=Log de cambios];
                                                     OnPush=BEGIN
                                                              CurrForm.sub_periodo.FORM.GETRECORD(rPer);
                                                              rHis.SETRANGE(rHis.Delegacion  , rPer.Delegacion);
                                                              rHis.SETRANGE(rHis."N§ Interno", rPer."N§ Interno");
                                                              {* PLB 23/02/99 *
                                                                rHis.SETRANGE(rHis."N§ Periodo", rPer."N§ Periodo");
                                                                rHis.SETRANGE("Tipo Reserva"   , rHis."Tipo Reserva"::Periodo);
                                                              * PLB 23/02/99 *}
                                                              FORM.RUN(7009793, rHis);
                                                              rHis.RESET;
                                                            END;
                                                             }
                                                   { ID=1100217011;
                                                     MenuItemType=Separator }
                                                   { ID=57;
                                                     ShortCutKey=Ctrl+H;
                                                     CaptionML=[ENU=Hotel Reservation;
                                                                ESP=Reserva Hotel];
                                                     OnPush=BEGIN
                                                              CurrForm.sub_periodo.FORM.GETRECORD(rPer);
                                                              rRsvHot.SETCURRENTKEY(Delegacion,
                                                                                    "N§ Interno",
                                                                                    "N§ Periodo");
                                                              rRsvHot.SETRANGE(Delegacion  , Delegacion);
                                                              rRsvHot.SETRANGE("N§ Interno", "N§ Interno");
                                                              rRsvHot.SETRANGE("N§ Periodo", rPer."N§ Periodo");
                                                              rRsvHot.SETRANGE(Bono        , Bono);
                                                              FORM.RUN(7009803, rRsvHot);
                                                            END;
                                                             }
                                                   { ID=18;
                                                     ShortCutKey=Ctrl+T;
                                                     CaptionML=[ENU=Transfer Reservations;
                                                                ESP=Reservas Transfer];
                                                     OnPush=BEGIN
                                                              CurrForm.sub_periodo.FORM.GETRECORD(rPer);
                                                              rRsvTra.SETCURRENTKEY(Delegacion,
                                                                                    "N§ Interno");
                                                              rRsvTra.SETRANGE(Delegacion  , Delegacion);
                                                              rRsvTra.SETRANGE("N§ Interno", "N§ Interno");
                                                              rRsvTra.SETRANGE("N§ Periodo", rPer."N§ Periodo");
                                                              FORM.RUN(7009923, rRsvTra);
                                                              rRsvTra.SETRANGE(Delegacion);
                                                              rRsvTra.SETRANGE("N§ Interno");
                                                              rRsvTra.SETRANGE("N§ Periodo");
                                                            END;
                                                             }
                                                   { ID=105;
                                                     ShortCutKey=Ctrl+I;
                                                     CaptionML=[ENU=Circuit Reservation;
                                                                ESP=Reservas Circuito];
                                                     OnPush=BEGIN
                                                              rRsvCir.SETCURRENTKEY(Delegacion,"N§ Interno");
                                                              rRsvCir.SETRANGE(Delegacion  , Delegacion);
                                                              rRsvCir.SETRANGE("N§ Interno", "N§ Interno");
                                                              FORM.RUN(FORM::"Tabla Reserva Circuito", rRsvCir);

                                                              rRsvCir.RESET;
                                                            END;
                                                             }
                                                   { ID=1100217012;
                                                     MenuItemType=Separator }
                                                   { ID=47;
                                                     CaptionML=[ENU=Delete flight information;
                                                                ESP=Borra vuelo reserva];
                                                     OnPush=BEGIN
                                                              IF Rec.Mantenimiento THEN BEGIN
                                                                CLEAR(rRsvHot);
                                                                CurrForm.sub_periodo.FORM.GETRECORD(rPer);
                                                                cRes.plan_vuelo(rPer, rRsvHot);
                                                              END;
                                                            END;
                                                             }
                                                   { ID=67;
                                                     CaptionML=[ENU=Divide period;
                                                                ESP=Dividir Per¡odo];
                                                     OnPush=VAR
                                                              cFunciones@1103355001 : Codeunit 7009726;
                                                            BEGIN
                                                              CurrForm.sub_periodo.FORM.GETRECORD(rPer);
                                                              rPer.SETRECFILTER;
                                                              cFunciones.Dividir_Periodo(rPer);
                                                            END;
                                                             }
                                                   { ID=109;
                                                     CaptionML=[ENU=Change Hotel;
                                                                ESP=Cambia Hotel];
                                                     OnPush=VAR
                                                              rHot@1103355001 : Record 7009743;
                                                              cRes@1103355002 : Codeunit 7009703;
                                                              cHot@1103355003 : Codeunit 7009719;
                                                            BEGIN
                                                              CurrForm.sub_periodo.FORM.GETRECORD(rPer);
                                                              rHot.RESET;
                                                              rHot.SETRANGE(Delegacion  , rPer.Delegacion);
                                                              rHot.SETRANGE("N§ Interno", rPer."N§ Interno");
                                                              rHot.SETRANGE("N§ Periodo", rPer."N§ Periodo");
                                                              rHot.SETRANGE(Responsable , TRUE);
                                                              IF rHot.FIND('-') THEN BEGIN
                                                                IF rHot."Pendiente asignar" THEN
                                                                  ERROR(Text003);
                                                              //  cRes.cambiar_booking(rHot, FALSE);
                                                                cHot.cambiar_booking(rHot, FALSE);
                                                              END;
                                                              rHot.RESET;
                                                            END;
                                                             }
                                                   { ID=92;
                                                     Name=GenerarPeriodos;
                                                     CaptionML=[ENU=Generate circuit periods;
                                                                ESP=Generar Periodos Circuito];
                                                     OnPush=BEGIN
                                                              cRes.Generar_Periodos_Circuito(Rec);
                                                            END;
                                                             }
                                                   { ID=1100217003;
                                                     CaptionML=[ENU=Add Transfer;
                                                                ESP=Agregar Transfer];
                                                     OnPush=BEGIN
                                                              CurrForm.sub_periodo.FORM.GETRECORD(rPer);
                                                              cRes.AgregarServicioTransfer(rPer);
                                                            END;
                                                             }
                                                   { ID=42;
                                                     MenuItemType=Separator }
                                                   { ID=43;
                                                     CaptionML=[ENU=Hotel Purchase contract;
                                                                ESP=Contrato compra hotel];
                                                     OnPush=VAR
                                                              lrConC@1100253001 : Record 7009723;
                                                            BEGIN
                                                              CurrForm.sub_periodo.FORM.GETRECORD(rPer);
                                                              lrConC.RESET;
                                                              lrConC.SETCURRENTKEY(Delegacion,
                                                                                  TourOperador,
                                                                                  Hotel,
                                                                                  "Fecha inicio contrato",
                                                                                  "Fecha final contrato");
                                                              lrConC.SETRANGE(Delegacion          , rPer.Delegacion);
                                                              IF rPer."Contrato compra" = '' THEN BEGIN
                                                                lrConC.SETRANGE(TourOperador, TourOperador);
                                                                IF rPer."Hotel origen precios" <> '' THEN
                                                                  lrConC.SETRANGE(Hotel, rPer."Hotel origen precios");
                                                              END
                                                              ELSE BEGIN
                                                                lrConC.SETRANGE("N§ Contrato compra", rPer."Contrato compra");
                                                              END;
                                                              IF lrConC.FINDLAST THEN
                                                                FORM.RUN(7009735, lrConC);
                                                            END;
                                                             }
                                                   { ID=44;
                                                     CaptionML=[ENU=Hotel Sale contract;
                                                                ESP=Contrato venta hotel];
                                                     OnPush=BEGIN
                                                              CurrForm.sub_periodo.FORM.GETRECORD(rPer);
                                                              rConV.SETCURRENTKEY(Delegacion,
                                                                                  TourOperador,
                                                                                  Hotel,
                                                                                  "Fecha inicio contrato",
                                                                                  "Fecha final contrato");
                                                              rConV.SETRANGE(Delegacion          , rPer.Delegacion);
                                                              IF rPer."Contrato venta" = '' THEN BEGIN
                                                                rConV.SETRANGE(TourOperador        , "TourOperador Venta");
                                                                IF rPer."Hotel venta" <> '' THEN
                                                                  rConV.SETRANGE(Hotel               , rPer."Hotel venta");
                                                              END
                                                              ELSE BEGIN
                                                                rConV.SETRANGE("N§ Contrato venta", rPer."Contrato venta");
                                                              END;
                                                              FORM.RUN(7009739, rConV);
                                                              rConV.SETRANGE(Delegacion);
                                                              rConV.SETRANGE(TourOperador);
                                                              rConV.SETRANGE(Hotel);
                                                              rConV.SETRANGE("N§ Contrato venta");
                                                            END;
                                                             }
                                                 }
                                                  }
    { 79  ;MenuButton   ;13200;11770;2530 ;550  ;HorzGlue=Right;
                                                 VertGlue=Bottom;
                                                 CaptionML=[ENU=&Persons;
                                                            ESP=Ac&ompa¤antes];
                                                 Menu=MENUITEMS
                                                 {
                                                   { ID=80;
                                                     CaptionML=[ENU=Change &Check-in date;
                                                                ESP=Cambia fecha &entrada];
                                                     OnPush=BEGIN
                                                              CurrForm.sub_periodo.FORM.GETRECORD(rPer);
                                                              CurrForm.sub_acompa¤ante.FORM.GETRECORD(rAco);
                                                              IF rAco."N§ Acompa¤ante" = 1 THEN
                                                                ERROR(Text004);
                                                              cRes.cambios_acompa¤antes(Rec, rAco, rPer, cambio::"Fecha entrada");
                                                            END;
                                                             }
                                                   { ID=81;
                                                     CaptionML=[ENU=Change &Check-out date;
                                                                ESP=Cambia fecha &salida];
                                                     OnPush=BEGIN
                                                              CurrForm.sub_periodo.FORM.GETRECORD(rPer);
                                                              CurrForm.sub_acompa¤ante.FORM.GETRECORD(rAco);
                                                              IF rAco."N§ Acompa¤ante" = 1 THEN
                                                                ERROR(Text004);
                                                              cRes.cambios_acompa¤antes(Rec, rAco, rPer, cambio::"Fecha salida");
                                                            END;
                                                             }
                                                   { ID=23;
                                                     CaptionML=[ENU=&Delete arrival flight;
                                                                ESP=&Borra Vuelo entrada];
                                                     OnPush=BEGIN
                                                              CurrForm.sub_periodo.FORM.GETRECORD(rPer);
                                                              CurrForm.sub_acompa¤ante.FORM.GETRECORD(rAco);
                                                              IF rAco."N§ Acompa¤ante" = 1 THEN
                                                                ERROR(Text004);
                                                              cRes.cambios_acompa¤antes(Rec, rAco, rPer, cambio::"Borra entrada");
                                                            END;
                                                             }
                                                   { ID=82;
                                                     CaptionML=[ENU=Delete departure flight;
                                                                ESP=Borra Vuelo sali&da];
                                                     OnPush=BEGIN
                                                              CurrForm.sub_periodo.FORM.GETRECORD(rPer);
                                                              CurrForm.sub_acompa¤ante.FORM.GETRECORD(rAco);
                                                              IF rAco."N§ Acompa¤ante" = 1 THEN
                                                                ERROR(Text004);
                                                              cRes.cambios_acompa¤antes(Rec, rAco, rPer, cambio::"Borra salida");
                                                            END;
                                                             }
                                                   { ID=83;
                                                     Visible=No;
                                                     CaptionML=[ENU=Change &Sale date;
                                                                ESP=Cambia Fecha &Venta];
                                                     OnPush=BEGIN
                                                              CurrForm.sub_periodo.FORM.GETRECORD(rPer);
                                                              CurrForm.sub_acompa¤ante.FORM.GETRECORD(rAco);
                                                              IF rAco."N§ Acompa¤ante" = 1 THEN
                                                                ERROR(Text004);
                                                              cRes.cambios_acompa¤antes(Rec, rAco, rPer, cambio::"Fecha venta");
                                                            END;
                                                             }
                                                   { ID=84;
                                                     CaptionML=[ENU=Change arrival flight;
                                                                ESP=Cambia vuelo e&ntrada];
                                                     OnPush=BEGIN
                                                              CurrForm.sub_periodo.FORM.GETRECORD(rPer);
                                                              CurrForm.sub_acompa¤ante.FORM.GETRECORD(rAco);
                                                              IF rAco."N§ Acompa¤ante" = 1 THEN
                                                                ERROR(Text004);
                                                              cRes.cambios_acompa¤antes(Rec, rAco, rPer, cambio::"Vuelo entrada");
                                                            END;
                                                             }
                                                   { ID=85;
                                                     CaptionML=[ENU=Change departure flight;
                                                                ESP=Cambia v&uelo salida];
                                                     OnPush=BEGIN
                                                              CurrForm.sub_periodo.FORM.GETRECORD(rPer);
                                                              CurrForm.sub_acompa¤ante.FORM.GETRECORD(rAco);
                                                              IF rAco."N§ Acompa¤ante" = 1 THEN
                                                                ERROR(Text004);
                                                              cRes.cambios_acompa¤antes(Rec, rAco, rPer, cambio::"Vuelo salida");
                                                            END;
                                                             }
                                                   { ID=1100217000;
                                                     MenuItemType=Separator }
                                                   { ID=1100217001;
                                                     CaptionML=ESP=Marcar No Show;
                                                     OnPush=BEGIN
                                                              CLEAR(rAco);
                                                              CurrForm.sub_acompa¤ante.FORM.GETRECORD(rAco);
                                                              cRes.MarcarReservaNoShow(rAco);
                                                            END;
                                                             }
                                                 }
                                                  }
    { 1000000002;TabControl;220;6820;23320;4840 ;HorzGlue=Both;
                                                 VertGlue=Both;
                                                 PageNamesML=[ENU=Operative,Passenger;
                                                              ESP=Operativa,Pasajeros] }
    { 35  ;SubForm      ;440  ;7590 ;22880;3740 ;Name=sub_periodo;
                                                 HorzGlue=Both;
                                                 VertGlue=Both;
                                                 ParentControl=1000000002;
                                                 InPage=0;
                                                 Border=No;
                                                 SubFormID=Form7009791;
                                                 SubFormView=SORTING(Delegacion,N§ Interno,N§ Periodo);
                                                 SubFormLink=Delegacion=FIELD(Delegacion),
                                                             N§ Interno=FIELD(N§ Interno) }
    { 45  ;SubForm      ;440  ;7590 ;22880;3740 ;Name=sub_acompa¤ante;
                                                 HorzGlue=Both;
                                                 VertGlue=Both;
                                                 ParentControl=1000000002;
                                                 InPage=1;
                                                 Border=No;
                                                 SubFormID=Form7009801;
                                                 SubFormView=SORTING(Delegacion,N§ Interno);
                                                 SubFormLink=Delegacion=FIELD(Delegacion),
                                                             N§ Interno=FIELD(N§ Interno) }
  }
  CODE
  {
    VAR
      Text000@1103355016 : TextConst 'ENU=Parameters card does not exist in the Data Base;ESP=No existe la ficha de par metros de la base de datos';
      Text001@1103355017 : TextConst 'ENU=DE-CIR-INT;ESP=DE-CIR-INT';
      Text003@1103355019 : TextConst 'ENU=Hotel booking is remaining to be assigned;ESP=La reserva de hotel esta pendiente de asignar.';
      Text004@1103355020 : TextConst 'ENU=Changes in the main companion of the booking must be done directly on the term;ESP=Los cambios en el acompa¤ante principal de la reserva se deben realizar directamente sobre el periodo.';
      cNom@1103355000 : Codeunit 7009702;
      cRes@1103355001 : Codeunit 7009703;
      rPer@1103355002 : Record 7009742;
      rAco@1103355003 : Record 7009748;
      rHis@1103355004 : Record 7009751;
      rConV@1103355006 : Record 7009727;
      rRsvHot@1103355007 : Record 7009743;
      rRsvTra@1103355008 : Record 7009744;
      rRsvCir@1103355009 : Record 7010186;
      rPar@1103355010 : Record 7009700;
      texto@1103355011 : Text[30];
      cambio@1103355014 : 'Fecha entrada,Fecha salida,Regimen,Borra entrada,Borra salida,Vuelo entrada,Vuelo salida,Fecha venta';
      mostrarCir@1103355015 : Boolean;
      cFunSeg@1100253000 : Codeunit 7009751;

    PROCEDURE nivel_mantenimiento@1();
    BEGIN
      CurrForm.TourOperador.EDITABLE         := Mantenimiento;
      CurrForm."TourOperador Venta".EDITABLE := Mantenimiento;
      CurrForm.Bono.EDITABLE                 := Mantenimiento;
      CurrForm.Nombre.EDITABLE               := Mantenimiento;
      CurrForm."Fecha venta".EDITABLE        := Mantenimiento;
      CurrForm.Idioma.EDITABLE               := Mantenimiento;
      CurrForm."Codigo Grupo".EDITABLE       := Mantenimiento;
      CurrForm.Temporada.EDITABLE            := Mantenimiento;
      CurrForm.sub_periodo.EDITABLE          := Mantenimiento;
      CurrForm.sub_acompa¤ante.EDITABLE      := Mantenimiento;
      CurrForm."Canal venta".EDITABLE        := Mantenimiento;
      CurrForm."Tipo Operacion".EDITABLE     := Mantenimiento;
      IF mostrarCir THEN
      BEGIN
        CurrForm.Circuito.EDITABLE                := Mantenimiento;
        CurrForm."Categoria Circuito".EDITABLE    := Mantenimiento;
        CurrForm."Fecha Inicio Circuito".EDITABLE := Mantenimiento;
        CurrForm."Habitacion Circuito".EDITABLE   := Mantenimiento;
      END;

      rRsvHot.SETRANGE(rRsvHot."N§ Periodo");
    END;

    PROCEDURE ShowExtras@1103355000();
    VAR
      lrExtras@1103355000 : Record 7009864;
    BEGIN
      // ShowExtras

      CurrForm.sub_periodo.FORM.GETRECORD(rPer);
      CLEAR(lrExtras);
      lrExtras.SETCURRENTKEY(Delegacion,"N§ Interno","N§ Periodo");
      lrExtras.FILTERGROUP(2);
      lrExtras.SETRANGE(Delegacion  , rPer.Delegacion);
      lrExtras.SETRANGE("N§ Interno", rPer."N§ Interno");
      lrExtras.SETRANGE("N§ Periodo", rPer."N§ Periodo");
      lrExtras.FILTERGROUP(0);
      FORM.RUN(0, lrExtras);
    END;

    BEGIN
    {
      $001 AJS 12072012 Elimino los campos Edad y Tipo de persona de la cabecera

      $002 AJS 24072012 Nueva funcion Marcar No Show en el boton de acompa¤antes

      $003 AJS 14062013 Nueva funcion en el boton periodos para Agregar Transfer

      $004 AJS 31122013 Cambiar nombre de las acciones del boton Cabeceras

      $005 AJS 04022014 Eliminar el campo N§ Linea porque es obsoleto

      $006 AJS 18032014 CNT-OC-14035, mostrar aviso si esta pendiente de enviar confirmacion touroperador

      $007 AJS 07042014 CNT-OC-14042, Mostrar nueva opcion Traslados en destino en el boton de cabecera de reserva

      $008 AJS 17042014 Cambiar Historico por Log de cambios

      $009 AJS 21052014 Cambiar el nombre de "Enviar confirmacion touroperador" a "Crear confirmacion touroperador"

      $010 AJS 09062014 CNT-OC-14046, Mostrar el campo "Tipo Operacion"

      $011 AJS 22092014 Los campos "Tipo Operacion" y "Canal venta" se hacen editables segun el campo Mantenimiento

      $012 AJS 27092014 Ajustes de traduccion

      $013 AJS 30092014 Traduccion

      $014 AJS 28102014 Ampliar visualizacion del campo Nombre

      $015 AJS 09022015 Cambio de formato, paso los subformularios a tabs en la parte inferior

      $016 AJS 09022015 Oculto la opcion Extras hotel porque no parece que est en uso

      $017 AJS 23032015 Mejoro la navegacion con NextControl
    }
    END.
  }
}
