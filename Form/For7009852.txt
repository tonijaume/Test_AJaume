OBJECT Form 7009852 Booking Trans. Compra
{
  OBJECT-PROPERTIES
  {
    Date=02/10/12;
    Time=12:00:00;
    Modified=Yes;
    Version List=AIC2009;
  }
  PROPERTIES
  {
    Width=17600;
    Height=11000;
    CaptionML=[ENU=Purchase Trans. Booking;
               ESP=Booking Trans. Compra];
    SaveValues=Yes;
    TableBoxID=77;
    SourceTable=Table7009774;
    DataCaptionExpr=NombreHotel();
    OnOpenForm=VAR
                 ok@1103355000 : Boolean;
               BEGIN
                 DiaInicial:= wFechaInicio;
                 IF DiaInicial = 0D THEN
                   DiaInicial := TODAY;
                 CurrForm.Matriz.MatrixRec."Period Start" := DiaInicial;
                 IF (wFechaInicio <> 0D) AND (wFechaFin <> 0D) THEN BEGIN
                   CurrForm.Matriz.MatrixRec.SETRANGE("Period Start",wFechaInicio,wFechaFin);
                 END;

                 IF wDeConsCupos THEN BEGIN
                   CurrForm.CAPTION := Text005;
                   wTexto1 := Text005;
                   TipoPeriodo := TipoPeriodo::D¡a; // JPT 13/08/10 INC-51503
                 END;

                 ok := rHot.GET(Hotel);
                 IF ok THEN
                   FiltTTOO := rHot.Touroperadores;

                 // JPT 12/08/10 Si se le ha pasado por parametro el TTOO este es el que prevalece
                 IF FiltTTOOExt <> '' THEN
                   FiltTTOO := FiltTTOOExt;

                 Init_Hab();

                 SETRANGE("Tipo Habitacion", TipoHab);
                 Habitaciones();
               END;

    OnCloseForm=BEGIN
                  CLEAR(wFechaInicio);
                  CLEAR(wFechaFin);
                  CLEAR(FiltTTOOExt);
                END;

  }
  CONTROLS
  {
    { 14  ;TabControl   ;110  ;220  ;17270;3300 ;HorzGlue=Both }
    { 8   ;TextBox      ;3300 ;1540 ;5060 ;440  ;ValidateTableRelation=No;
                                                 ParentControl=14;
                                                 InPage=0;
                                                 ClearOnLookup=No;
                                                 SourceExpr=FiltTTOO;
                                                 TableRelation=TourOperador.TourOperador }
    { 17  ;Label        ;440  ;1540 ;2750 ;440  ;ParentControl=8;
                                                 InPage=0;
                                                 CaptionML=[ENU=TTOO;
                                                            ESP=TTOO] }
    { 77  ;Label        ;8690 ;1650 ;1430 ;330  ;Visible=No;
                                                 ParentControl=14;
                                                 InPage=0 }
    { 2   ;TextBox      ;14740;1650 ;2420 ;440  ;HorzGlue=Right;
                                                 ParentControl=14;
                                                 InPage=0;
                                                 SourceExpr=DiaInicial;
                                                 OnValidate=BEGIN
                                                              CurrForm.Matriz.MatrixRec."Period Start" := DiaInicial;
                                                            END;
                                                             }
    { 1   ;Label        ;11880;1650 ;2750 ;440  ;HorzGlue=Right;
                                                 ParentControl=2;
                                                 InPage=0;
                                                 CaptionML=[ENU=Day;
                                                            ESP=D¡a] }
    { 37  ;CheckBox     ;7920 ;2310 ;440  ;440  ;Name=ch09;
                                                 ParentControl=14;
                                                 InPage=0;
                                                 ShowCaption=No;
                                                 CaptionML=[ENU=ch09;
                                                            ESP=ch09];
                                                 SourceExpr=ch09;
                                                 OnValidate=BEGIN

                                                              Filtros_TipHab();
                                                            END;
                                                             }
    { 35  ;TextBox      ;8470 ;2310 ;1210 ;440  ;Name=tex09;
                                                 Visible=No;
                                                 Editable=No;
                                                 Focusable=No;
                                                 ParentControl=37;
                                                 InPage=0;
                                                 Border=No;
                                                 CaptionML=[ENU=tex09;
                                                            ESP=tex09];
                                                 SourceExpr=tex09 }
    { 25  ;CheckBox     ;6050 ;2310 ;440  ;440  ;Name=ch07;
                                                 ParentControl=14;
                                                 InPage=0;
                                                 ShowCaption=No;
                                                 CaptionML=[ENU=ch07;
                                                            ESP=ch07];
                                                 SourceExpr=ch07;
                                                 OnValidate=BEGIN

                                                              Filtros_TipHab();
                                                            END;
                                                             }
    { 18  ;TextBox      ;6600 ;2310 ;1210 ;440  ;Name=tex07;
                                                 Visible=No;
                                                 Editable=No;
                                                 Focusable=No;
                                                 ParentControl=25;
                                                 InPage=0;
                                                 Border=No;
                                                 CaptionML=[ENU=tex07;
                                                            ESP=tex07];
                                                 SourceExpr=tex07 }
    { 34  ;CheckBox     ;6050 ;2860 ;440  ;440  ;Name=ch08;
                                                 ParentControl=14;
                                                 InPage=0;
                                                 ShowCaption=No;
                                                 CaptionML=[ENU=ch08;
                                                            ESP=ch08];
                                                 SourceExpr=ch08;
                                                 OnValidate=BEGIN

                                                              Filtros_TipHab();
                                                            END;
                                                             }
    { 33  ;TextBox      ;6600 ;2860 ;1210 ;440  ;Name=tex08;
                                                 Visible=No;
                                                 Editable=No;
                                                 Focusable=No;
                                                 ParentControl=34;
                                                 InPage=0;
                                                 Border=No;
                                                 CaptionML=[ENU=tex08;
                                                            ESP=tex08];
                                                 SourceExpr=tex08 }
    { 38  ;CheckBox     ;7920 ;2860 ;440  ;440  ;Name=ch10;
                                                 ParentControl=14;
                                                 InPage=0;
                                                 ShowCaption=No;
                                                 CaptionML=[ENU=ch10;
                                                            ESP=ch10];
                                                 SourceExpr=ch10;
                                                 OnValidate=BEGIN

                                                              Filtros_TipHab();
                                                            END;
                                                             }
    { 36  ;TextBox      ;8470 ;2860 ;1210 ;440  ;Name=tex10;
                                                 Visible=No;
                                                 Editable=No;
                                                 Focusable=No;
                                                 ParentControl=38;
                                                 InPage=0;
                                                 Border=No;
                                                 CaptionML=[ENU=tex10;
                                                            ESP=tex10];
                                                 SourceExpr=tex10 }
    { 28  ;CheckBox     ;4180 ;2310 ;440  ;440  ;Name=ch05;
                                                 ParentControl=14;
                                                 InPage=0;
                                                 ShowCaption=No;
                                                 CaptionML=[ENU=ch05;
                                                            ESP=ch05];
                                                 SourceExpr=ch05;
                                                 OnValidate=BEGIN

                                                              Filtros_TipHab();
                                                            END;
                                                             }
    { 27  ;TextBox      ;4730 ;2310 ;1210 ;440  ;Name=tex05;
                                                 Visible=No;
                                                 Editable=No;
                                                 Focusable=No;
                                                 ParentControl=28;
                                                 InPage=0;
                                                 Border=No;
                                                 CaptionML=[ENU=tex05;
                                                            ESP=tex05];
                                                 SourceExpr=tex05 }
    { 30  ;CheckBox     ;4180 ;2860 ;440  ;440  ;Name=ch06;
                                                 ParentControl=14;
                                                 InPage=0;
                                                 ShowCaption=No;
                                                 CaptionML=[ENU=ch06;
                                                            ESP=ch06];
                                                 SourceExpr=ch06;
                                                 OnValidate=BEGIN

                                                              Filtros_TipHab();
                                                            END;
                                                             }
    { 29  ;TextBox      ;4730 ;2860 ;1210 ;440  ;Name=tex06;
                                                 Visible=No;
                                                 Editable=No;
                                                 Focusable=No;
                                                 ParentControl=30;
                                                 InPage=0;
                                                 Border=No;
                                                 CaptionML=[ENU=tex06;
                                                            ESP=tex06];
                                                 SourceExpr=tex06 }
    { 15  ;CheckBox     ;2310 ;2310 ;440  ;440  ;Name=ch03;
                                                 ParentControl=14;
                                                 InPage=0;
                                                 ShowCaption=No;
                                                 CaptionML=[ENU=ch03;
                                                            ESP=ch03];
                                                 SourceExpr=ch03;
                                                 OnValidate=BEGIN

                                                              Filtros_TipHab();
                                                            END;
                                                             }
    { 12  ;TextBox      ;2860 ;2310 ;1210 ;440  ;Name=Tex03;
                                                 Visible=No;
                                                 Editable=No;
                                                 Focusable=No;
                                                 ParentControl=15;
                                                 InPage=0;
                                                 Border=No;
                                                 CaptionML=[ENU=Tex03;
                                                            ESP=Tex03];
                                                 SourceExpr=tex03 }
    { 16  ;CheckBox     ;2310 ;2860 ;440  ;440  ;Name=ch04;
                                                 ParentControl=14;
                                                 InPage=0;
                                                 ShowCaption=No;
                                                 CaptionML=[ENU=ch04;
                                                            ESP=ch04];
                                                 SourceExpr=ch04;
                                                 OnValidate=BEGIN

                                                              Filtros_TipHab();
                                                            END;
                                                             }
    { 13  ;TextBox      ;2860 ;2860 ;1210 ;440  ;Name=tex04;
                                                 Visible=No;
                                                 Editable=No;
                                                 Focusable=No;
                                                 ParentControl=16;
                                                 InPage=0;
                                                 Border=No;
                                                 CaptionML=[ENU=tex04;
                                                            ESP=tex04];
                                                 SourceExpr=tex04 }
    { 6   ;CheckBox     ;440  ;2310 ;440  ;440  ;Name=ch01;
                                                 ParentControl=14;
                                                 InPage=0;
                                                 ShowCaption=No;
                                                 CaptionML=[ENU=ch01;
                                                            ESP=ch01];
                                                 SourceExpr=ch01;
                                                 OnValidate=BEGIN

                                                              Filtros_TipHab();
                                                            END;
                                                             }
    { 7   ;TextBox      ;990  ;2310 ;1210 ;440  ;Name=tex01;
                                                 Visible=No;
                                                 Editable=No;
                                                 Focusable=No;
                                                 ParentControl=6;
                                                 InPage=0;
                                                 Border=No;
                                                 CaptionML=[ENU=tex01;
                                                            ESP=tex01];
                                                 SourceExpr=tex01 }
    { 11  ;CheckBox     ;440  ;2860 ;440  ;440  ;Name=ch02;
                                                 ParentControl=14;
                                                 InPage=0;
                                                 ShowCaption=No;
                                                 CaptionML=[ENU=ch02;
                                                            ESP=ch02];
                                                 SourceExpr=ch02;
                                                 OnPush=BEGIN

                                                          Filtros_TipHab();
                                                        END;
                                                         }
    { 10  ;TextBox      ;990  ;2860 ;1210 ;440  ;Name=Tex02;
                                                 Visible=No;
                                                 Editable=No;
                                                 Focusable=No;
                                                 ParentControl=11;
                                                 InPage=0;
                                                 Border=No;
                                                 CaptionML=[ENU=Tex02;
                                                            ESP=Tex02];
                                                 SourceExpr=tex02 }
    { 46  ;TextBox      ;3300 ;990  ;5060 ;440  ;Editable=No;
                                                 Focusable=No;
                                                 ParentControl=14;
                                                 InPage=0;
                                                 SourceExpr=Hotel + ' - ' + cNoms.nom_hotel(Hotel) }
    { 47  ;Label        ;440  ;990  ;2750 ;440  ;ParentControl=46;
                                                 CaptionML=[ENU=Hotel;
                                                            ESP=Hotel] }
    { 48  ;CheckBox     ;9790 ;2310 ;440  ;440  ;Name=ch11;
                                                 ParentControl=14;
                                                 InPage=0;
                                                 ShowCaption=No;
                                                 CaptionML=[ENU=ch11;
                                                            ESP=ch11];
                                                 SourceExpr=ch11;
                                                 OnValidate=BEGIN

                                                              Filtros_TipHab();
                                                            END;
                                                             }
    { 49  ;TextBox      ;10340;2310 ;1210 ;440  ;Name=tex11;
                                                 Visible=No;
                                                 Editable=No;
                                                 Focusable=No;
                                                 ParentControl=48;
                                                 Border=No;
                                                 CaptionML=[ENU=tex11;
                                                            ESP=tex11];
                                                 SourceExpr=tex11 }
    { 50  ;CheckBox     ;11660;2310 ;440  ;440  ;Name=ch13;
                                                 ParentControl=14;
                                                 InPage=0;
                                                 ShowCaption=No;
                                                 CaptionML=[ENU=ch13;
                                                            ESP=ch13];
                                                 SourceExpr=ch13;
                                                 OnValidate=BEGIN

                                                              Filtros_TipHab();
                                                            END;
                                                             }
    { 51  ;TextBox      ;12210;2310 ;1210 ;440  ;Name=Tex13;
                                                 Visible=No;
                                                 Editable=No;
                                                 Focusable=No;
                                                 ParentControl=50;
                                                 Border=No;
                                                 CaptionML=[ENU=Tex13;
                                                            ESP=Tex13];
                                                 SourceExpr=tex13 }
    { 52  ;CheckBox     ;13530;2310 ;440  ;440  ;Name=ch15;
                                                 ParentControl=14;
                                                 InPage=0;
                                                 ShowCaption=No;
                                                 CaptionML=[ENU=ch15;
                                                            ESP=ch15];
                                                 SourceExpr=ch15;
                                                 OnValidate=BEGIN

                                                              Filtros_TipHab();
                                                            END;
                                                             }
    { 53  ;TextBox      ;14080;2310 ;1210 ;440  ;Name=tex15;
                                                 Visible=No;
                                                 Editable=No;
                                                 Focusable=No;
                                                 ParentControl=52;
                                                 Border=No;
                                                 CaptionML=[ENU=tex15;
                                                            ESP=tex15];
                                                 SourceExpr=tex15 }
    { 54  ;CheckBox     ;15400;2310 ;440  ;440  ;Name=ch17;
                                                 ParentControl=14;
                                                 InPage=0;
                                                 ShowCaption=No;
                                                 CaptionML=[ENU=ch17;
                                                            ESP=ch17];
                                                 SourceExpr=ch17;
                                                 OnValidate=BEGIN

                                                              Filtros_TipHab();
                                                            END;
                                                             }
    { 55  ;TextBox      ;15950;2310 ;1210 ;440  ;Name=tex17;
                                                 Visible=No;
                                                 Editable=No;
                                                 Focusable=No;
                                                 ParentControl=54;
                                                 Border=No;
                                                 CaptionML=[ENU=tex17;
                                                            ESP=tex17];
                                                 SourceExpr=tex17 }
    { 58  ;CheckBox     ;13530;2860 ;440  ;440  ;Name=ch16;
                                                 ParentControl=14;
                                                 InPage=0;
                                                 ShowCaption=No;
                                                 CaptionML=[ENU=ch16;
                                                            ESP=ch16];
                                                 SourceExpr=ch16;
                                                 OnValidate=BEGIN

                                                              Filtros_TipHab();
                                                            END;
                                                             }
    { 59  ;TextBox      ;14080;2860 ;1210 ;440  ;Name=tex16;
                                                 Visible=No;
                                                 Editable=No;
                                                 Focusable=No;
                                                 ParentControl=58;
                                                 Border=No;
                                                 CaptionML=[ENU=tex16;
                                                            ESP=tex16];
                                                 SourceExpr=tex16 }
    { 60  ;CheckBox     ;11660;2860 ;440  ;440  ;Name=ch14;
                                                 ParentControl=14;
                                                 InPage=0;
                                                 ShowCaption=No;
                                                 CaptionML=[ENU=ch14;
                                                            ESP=ch14];
                                                 SourceExpr=ch14;
                                                 OnValidate=BEGIN

                                                              Filtros_TipHab();
                                                            END;
                                                             }
    { 61  ;TextBox      ;12210;2860 ;1210 ;440  ;Name=tex14;
                                                 Visible=No;
                                                 Editable=No;
                                                 Focusable=No;
                                                 ParentControl=60;
                                                 Border=No;
                                                 CaptionML=[ENU=tex14;
                                                            ESP=tex14];
                                                 SourceExpr=tex14 }
    { 62  ;CheckBox     ;9790 ;2860 ;440  ;440  ;Name=ch12;
                                                 ParentControl=14;
                                                 InPage=0;
                                                 ShowCaption=No;
                                                 CaptionML=[ENU=ch12;
                                                            ESP=ch12];
                                                 SourceExpr=ch12;
                                                 OnPush=BEGIN

                                                          Filtros_TipHab();
                                                        END;
                                                         }
    { 63  ;TextBox      ;10340;2860 ;1210 ;440  ;Name=Tex12;
                                                 Visible=No;
                                                 Editable=No;
                                                 Focusable=No;
                                                 ParentControl=62;
                                                 Border=No;
                                                 CaptionML=[ENU=Tex12;
                                                            ESP=Tex12];
                                                 SourceExpr=tex12 }
    { 1100253001;TextBox;11880;990  ;5330 ;440  ;HorzGlue=Right;
                                                 Focusable=No;
                                                 ParentControl=14;
                                                 InPage=0;
                                                 HorzAlign=Right;
                                                 ForeColor=8388608;
                                                 BackTransparent=Yes;
                                                 Border=No;
                                                 FontBold=Yes;
                                                 SourceExpr=wTexto1 }
    { 9   ;CommandButton;15180;9460 ;2200 ;550  ;HorzGlue=Right;
                                                 VertGlue=Bottom;
                                                 PushAction=FormHelp }
    { 19  ;OptionButton ;2860 ;9460 ;550  ;550  ;VertGlue=Bottom;
                                                 FocusOnClick=No;
                                                 ShowCaption=No;
                                                 Border=Yes;
                                                 BitmapPos=Center;
                                                 Bitmap=14;
                                                 ToolTipML=[ENU=Accounting period;
                                                            ESP=Periodo contable];
                                                 SourceExpr=TipoPeriodo;
                                                 OptionValue=Periodo contable }
    { 20  ;OptionButton ;2310 ;9460 ;550  ;550  ;VertGlue=Bottom;
                                                 FocusOnClick=No;
                                                 ShowCaption=No;
                                                 Border=Yes;
                                                 BitmapPos=Center;
                                                 Bitmap=13;
                                                 ToolTipML=[ENU=Year;
                                                            ESP=A¤o];
                                                 SourceExpr=TipoPeriodo;
                                                 OptionValue=A¤o }
    { 21  ;OptionButton ;1760 ;9460 ;550  ;550  ;VertGlue=Bottom;
                                                 FocusOnClick=No;
                                                 ShowCaption=No;
                                                 Border=Yes;
                                                 BitmapPos=Center;
                                                 Bitmap=12;
                                                 ToolTipML=[ENU=Quarter;
                                                            ESP=Trimestre];
                                                 SourceExpr=TipoPeriodo;
                                                 OptionValue=Trimestre }
    { 22  ;OptionButton ;1210 ;9460 ;550  ;550  ;VertGlue=Bottom;
                                                 FocusOnClick=No;
                                                 ShowCaption=No;
                                                 Border=Yes;
                                                 BitmapPos=Center;
                                                 Bitmap=11;
                                                 ToolTipML=[ENU=Month;
                                                            ESP=Mes];
                                                 SourceExpr=TipoPeriodo;
                                                 OptionValue=Mes }
    { 23  ;OptionButton ;660  ;9460 ;550  ;550  ;VertGlue=Bottom;
                                                 FocusOnClick=No;
                                                 ShowCaption=No;
                                                 Border=Yes;
                                                 BitmapPos=Center;
                                                 Bitmap=10;
                                                 ToolTipML=[ENU=Week;
                                                            ESP=Semana];
                                                 SourceExpr=TipoPeriodo;
                                                 OptionValue=Semana }
    { 24  ;OptionButton ;110  ;9460 ;550  ;550  ;VertGlue=Bottom;
                                                 FocusOnClick=No;
                                                 ShowCaption=No;
                                                 Border=Yes;
                                                 BitmapPos=Center;
                                                 Bitmap=9;
                                                 ToolTipML=[ENU=Day;
                                                            ESP=D¡a];
                                                 SourceExpr=TipoPeriodo;
                                                 OptionValue=D¡a }
    { 26  ;MatrixBox    ;110  ;3740 ;17270;5500 ;Name=Matriz;
                                                 HorzGlue=Both;
                                                 VertGlue=Both;
                                                 Editable=No;
                                                 MatrixSourceTable=Table2000000007;
                                                 OnFindRecord=BEGIN

                                                                IF CurrForm.Matriz.MatrixRec."Period Start" = 0D THEN
                                                                  CurrForm.Matriz.MatrixRec."Period Start" := DiaInicial;

                                                                EXIT(GestionFormPeriodo.FindDate(Which,CurrForm.Matriz.MatrixRec,TipoPeriodo));
                                                              END;

                                                 OnNextRecord=BEGIN

                                                                EXIT(GestionFormPeriodo.NextDate(Steps,CurrForm.Matriz.MatrixRec,TipoPeriodo));
                                                              END;

                                                 OnAfterGetRecord=BEGIN
                                                                    // AsigFiltFecha;
                                                                    //
                                                                    IF TipoHab = TipoHab::Basica THEN
                                                                      Importe := CalculaImporteBas(Rec)
                                                                    ELSE
                                                                      Importe := CalculaImporteCup(Rec);
                                                                  END;
                                                                   }
    { 3   ;TextBox      ;0    ;2090 ;4070 ;440  ;Name=Texto;
                                                 ParentControl=26;
                                                 InColumn=Yes;
                                                 CaptionML=[ENU=Text;
                                                            ESP=Texto];
                                                 SourceExpr=Texto;
                                                 OnFormat=BEGIN

                                                            CurrForm.Texto.UPDATEFONTBOLD := FALSE;
                                                            CurrForm.Texto.UPDATEINDENT(0);

                                                            IF "Tipo de Registro" = "Tipo de Registro"::T¡tulo THEN
                                                              CurrForm.Texto.UPDATEFONTBOLD := TRUE
                                                            ELSE
                                                              CurrForm.Texto.UPDATEINDENT(440);
                                                          END;
                                                           }
    { 4   ;Label        ;0    ;0    ;0    ;0    ;ParentControl=3;
                                                 InColumnHeading=Yes }
    { 31  ;TextBox      ;5684 ;2530 ;11703;440  ;Name=Importe;
                                                 ParentControl=26;
                                                 InMatrix=Yes;
                                                 CaptionML=[ENU=Amount;
                                                            ESP=Importe];
                                                 BlankZero=Yes;
                                                 SourceExpr=Importe;
                                                 OnActivate=BEGIN
                                                              AsigFiltFecha;
                                                            END;

                                                 OnFormat=BEGIN
                                                            IF "Tipo de Registro" = "Tipo de Registro"::SinConfirmar THEN BEGIN
                                                              IF Importe <> 0 THEN
                                                                CurrForm.Importe.UPDATEFORECOLOR(255)
                                                              ELSE
                                                                CurrForm.Importe.UPDATEFORECOLOR(0);
                                                            END
                                                            ELSE BEGIN
                                                              IF Importe > 0 THEN
                                                                CurrForm.Importe.UPDATEFORECOLOR(16711680)
                                                              ELSE
                                                                IF Importe < 0 THEN
                                                                  CurrForm.Importe.UPDATEFORECOLOR(255)
                                                                ELSE
                                                                  CurrForm.Importe.UPDATEFORECOLOR(0);
                                                            END;

                                                            CurrForm.Importe.UPDATEFONTBOLD(TieneProblemas); // JPT 12/08/10
                                                          END;

                                                 OnDrillDown=VAR
                                                               ok@1103355001 : Boolean;
                                                             BEGIN
                                                               IF ("Tipo de Registro" = "Tipo de Registro"::Contrato) THEN BEGIN
                                                                 rCup.RESET;
                                                                 rCup.SETCURRENTKEY(Dia,
                                                                                    Hotel,
                                                                                    TourOperador);
                                                                 rCup.SETRANGE(Hotel, Hotel);
                                                                 rCup.SETRANGE(Dia  , CurrForm.Matriz.MatrixRec."Period Start", CurrForm.Matriz.MatrixRec."Period End");
                                                                 IF Rec."C¢d. habitaci¢n" = '' THEN
                                                                   rCup.SETRANGE(rCup."Habitacion basica")
                                                                 ELSE BEGIN
                                                                   IF "Tipo Habitacion" = "Tipo Habitacion"::Basica THEN
                                                                     rCup.SETRANGE(rCup."Habitacion basica", Rec."C¢d. habitaci¢n")
                                                                   ELSE
                                                                     rCup.SETRANGE(rCup.Habitacion, "C¢d. habitaci¢n");
                                                                 END;
                                                                 FORM.RUN(0, rCup);
                                                               END;

                                                               IF ("Tipo de Registro" = "Tipo de Registro"::Cupo) THEN BEGIN
                                                                 rCup.RESET;
                                                                 rCup.SETCURRENTKEY(Dia,
                                                                                    Hotel,
                                                                                    TourOperador);
                                                                 rCup.SETRANGE(Dia  , CurrForm.Matriz.MatrixRec."Period Start", CurrForm.Matriz.MatrixRec."Period End");
                                                                 rCup.SETRANGE(Hotel, Hotel);
                                                                 IF FiltTTOO = '' THEN
                                                                   rCup.SETRANGE(TourOperador)
                                                                 ELSE
                                                                   rCup.SETFILTER(TourOperador,FiltTTOO);
                                                                 IF Rec."C¢d. habitaci¢n" = '' THEN
                                                                   rCup.SETRANGE(rCup."Habitacion basica")
                                                                 ELSE BEGIN
                                                                   IF "Tipo Habitacion" = "Tipo Habitacion"::Basica THEN
                                                                     rCup.SETRANGE(rCup."Habitacion basica",Rec."C¢d. habitaci¢n")
                                                                   ELSE
                                                                     rCup.SETRANGE(rCup.Habitacion, "C¢d. habitaci¢n");
                                                                 END;
                                                                 FORM.RUN(0, rCup);
                                                               END;

                                                               IF ("Tipo de Registro" = "Tipo de Registro"::AumentoCupo) THEN BEGIN
                                                                 rAumentoCupo.RESET;
                                                                 rAumentoCupo.SETRANGE (Hotel        , Hotel);
                                                                 rAumentoCupo.SETFILTER("Fecha Desde", '<=%1', CurrForm.Matriz.MatrixRec."Period Start");
                                                                 rAumentoCupo.SETFILTER("Fecha Hasta", '>=%1', CurrForm.Matriz.MatrixRec."Period End");
                                                                 IF Rec."C¢d. habitaci¢n" = '' THEN
                                                                   rAumentoCupo.SETRANGE("Cod. Habitacion")
                                                                 ELSE
                                                                   rAumentoCupo.SETRANGE("Cod. Habitacion", Rec."C¢d. habitaci¢n");
                                                                 rAumentoCupo.SETRANGE(Estado, rAumentoCupo.Estado::Confirmado);

                                                                 CLEAR(fAumentoCupo);
                                                                 fAumentoCupo.SETTABLEVIEW(rAumentoCupo);
                                                                 fAumentoCupo.LOOKUPMODE(TRUE);
                                                                 fAumentoCupo.RUNMODAL;

                                                                 //FORM.RUN(0, rAumentoCupo);
                                                               END;

                                                               IF ("Tipo de Registro" = "Tipo de Registro"::Ocupado) OR ("Tipo de Registro" = "Tipo de Registro"::Asignado) OR
                                                                  ("Tipo de Registro" = "Tipo de Registro"::SinConfirmar) THEN BEGIN
                                                                 rRsv.RESET;
                                                                 IF ("Tipo de Registro" = "Tipo de Registro"::Ocupado) AND rHot.NoName THEN BEGIN
                                                                   IF "Tipo Habitacion" = "Tipo Habitacion"::Basica THEN
                                                                     rRsv.SETCURRENTKEY("Hotel reservado", TourOperador, Dia, Habitacion)
                                                                   ELSE
                                                                     rRsv.SETCURRENTKEY("Hotel reservado", TourOperador, Dia, "Habitacion cupo");
                                                                   rRsv.SETRANGE(rRsv."Hotel reservado",Hotel);
                                                                   IF FiltTTOO = '' THEN
                                                                     rRsv.SETRANGE(TourOperador)
                                                                   ELSE
                                                                     rRsv.SETFILTER(TourOperador,FiltTTOO);
                                                                   rRsv.SETRANGE(Dia, CurrForm.Matriz.MatrixRec."Period Start", CurrForm.Matriz.MatrixRec."Period End");
                                                                   IF Rec."C¢d. habitaci¢n" = '' THEN
                                                                     rRsv.SETRANGE(rRsv.Habitacion)
                                                                   ELSE BEGIN
                                                                     IF "Tipo Habitacion" = "Tipo Habitacion"::Basica THEN
                                                                       rRsv.SETRANGE(rRsv.Habitacion, Rec."C¢d. habitaci¢n")
                                                                     ELSE
                                                                       rRsv.SETRANGE("Habitacion cupo", "C¢d. habitaci¢n");
                                                                   END;
                                                                   rRsv.SETRANGE("Cantidad booking");
                                                                   rRsv.SETRANGE(Asignado);
                                                                   rRsv.SETFILTER("Cantidad reservado", '>%1', 0);
                                                                   IF "Tipo de Registro" = "Tipo de Registro"::SinConfirmar THEN
                                                                     rRsv.SETRANGE("Num confirmacion hotel", '')
                                                                   ELSE
                                                                     rRsv.SETRANGE("Num confirmacion hotel");
                                                                   FORM.RUN(0,rRsv);
                                                                 END
                                                                 ELSE BEGIN
                                                                   IF "Tipo Habitacion" = "Tipo Habitacion"::Basica THEN
                                                                     rRsv.SETCURRENTKEY("Hotel booking", TourOperador, Dia, Habitacion)
                                                                   ELSE
                                                                     rRsv.SETCURRENTKEY("Hotel booking", TourOperador, Dia, "Habitacion cupo");
                                                                   rRsv.SETRANGE(rRsv."Hotel booking",Hotel);
                                                                   IF FiltTTOO = '' THEN
                                                                     rRsv.SETRANGE(TourOperador)
                                                                   ELSE
                                                                     rRsv.SETFILTER(TourOperador,FiltTTOO);
                                                                   rRsv.SETRANGE(Dia, CurrForm.Matriz.MatrixRec."Period Start", CurrForm.Matriz.MatrixRec."Period End");
                                                                   IF Rec."C¢d. habitaci¢n" = '' THEN
                                                                     rRsv.SETRANGE(rRsv.Habitacion)
                                                                   ELSE BEGIN
                                                                     IF "Tipo Habitacion" = "Tipo Habitacion"::Basica THEN
                                                                       rRsv.SETRANGE(rRsv.Habitacion, Rec."C¢d. habitaci¢n")
                                                                     ELSE
                                                                       rRsv.SETRANGE("Habitacion cupo", "C¢d. habitaci¢n");
                                                                   END;
                                                                   rRsv.SETRANGE("Cantidad booking");
                                                                   rRsv.SETRANGE(Asignado);
                                                                   IF ("Tipo de Registro" = "Tipo de Registro"::Ocupado) THEN
                                                                     rRsv.SETFILTER("Cantidad booking",'>%1',0);
                                                                   IF ("Tipo de Registro" = "Tipo de Registro"::Asignado) THEN
                                                                     rRsv.SETFILTER(Asignado,'>%1',0);
                                                                   IF "Tipo de Registro" = "Tipo de Registro"::SinConfirmar THEN
                                                                     rRsv.SETRANGE("Num confirmacion hotel", '')
                                                                   ELSE
                                                                     rRsv.SETRANGE("Num confirmacion hotel");
                                                                   FORM.RUN(0,rRsv);
                                                                 END;
                                                               END;
                                                             END;
                                                              }
    { 32  ;TextBox      ;9570 ;3300 ;2200 ;440  ;Name=Cab;
                                                 ParentControl=31;
                                                 InMatrixHeading=Yes;
                                                 CaptionML=[ENU=Term;
                                                            ESP=Periodo];
                                                 SourceExpr=GestionFormPeriodo.CreatePeriodFormat(TipoPeriodo,CurrForm.Matriz.MatrixRec."Period Start");
                                                 OnFormat=BEGIN

                                                            IF Ovbk() = '*' THEN BEGIN
                                                              IF Paro() = '*' THEN BEGIN
                                                                CurrForm.Cab.UPDATEFORECOLOR(65280);  // Verde
                                                                CurrForm.Cab.UPDATEFONTBOLD(TRUE);
                                                              END
                                                              ELSE BEGIN
                                                                CurrForm.Cab.UPDATEFORECOLOR(255);  // Rojo
                                                                CurrForm.Cab.UPDATEFONTBOLD(TRUE);
                                                              END;
                                                            END
                                                            ELSE BEGIN
                                                              IF Paro() = '*' THEN BEGIN
                                                                CurrForm.Cab.UPDATEFORECOLOR(11751320);  // Morado
                                                                CurrForm.Cab.UPDATEFONTBOLD(TRUE);
                                                              END
                                                              ELSE BEGIN
                                                                CurrForm.Cab.UPDATEFORECOLOR(0);  // Negro
                                                                CurrForm.Cab.UPDATEFONTBOLD(TRUE);
                                                              END;
                                                            END;
                                                          END;
                                                           }
    { 5   ;MenuButton   ;12760;9460 ;2200 ;550  ;HorzGlue=Right;
                                                 VertGlue=Bottom;
                                                 CaptionML=[ENU=&Hotel;
                                                            ESP=Hote&l];
                                                 Menu=MENUITEMS
                                                 {
                                                   { ID=56;
                                                     CaptionML=[ENU=Windows;
                                                                ESP=Ventanas] }
                                                   { ID=39;
                                                     PushAction=RunObject;
                                                     ShortCutKey=Ctrl+F5;
                                                     MenuLevel=1;
                                                     CaptionML=[ENU=&Card;
                                                                ESP=&Ficha];
                                                     RunObject=Form 7009730;
                                                     RunFormLink=Hotel=FIELD(Hotel) }
                                                   { ID=57;
                                                     MenuLevel=1;
                                                     CaptionML=[ENU=Contracts;
                                                                ESP=Contratos];
                                                     OnPush=VAR
                                                              rConCom@1103355001 : Record 7009723;
                                                            BEGIN
                                                              rConCom.RESET;
                                                              rConCom.SETCURRENTKEY(Delegacion, TourOperador, Hotel, "Fecha inicio contrato", "Fecha final contrato");
                                                              IF FiltTTOO <> '' THEN
                                                                rConCom.SETFILTER(TourOperador, FiltTTOO);

                                                              rConCom.SETRANGE (Hotel, Hotel);
                                                              rConCom.SETFILTER("Fecha inicio contrato", '<=%1', CurrForm.Matriz.MatrixRec."Period Start");
                                                              rConCom.SETFILTER("Fecha final contrato" , '>=%1', CurrForm.Matriz.MatrixRec."Period Start");
                                                              FORM.RUNMODAL(FORM::"Tabla Contrato compra hotel", rConCom);
                                                              rConCom.RESET;
                                                            END;
                                                             }
                                                   { ID=66;
                                                     MenuLevel=1;
                                                     CaptionML=[ENU=Confirm sendings;
                                                                ESP=Confirmacion envios];
                                                     OnPush=VAR
                                                              lrEnvio@1103355001 : Record 7009761;
                                                              lfTabEnvio@1103355002 : Form 7009826;
                                                            BEGIN
                                                              lrEnvio.SETRANGE(Hotel, Hotel);

                                                              CLEAR(lfTabEnvio);
                                                              lfTabEnvio.SETTABLEVIEW(lrEnvio);
                                                              lfTabEnvio.RUNMODAL;
                                                            END;
                                                             }
                                                   { ID=1100253000;
                                                     MenuLevel=1;
                                                     CaptionML=[ENU=Allotment modification;
                                                                ESP=Modificacion Cupo];
                                                     OnPush=VAR
                                                              lrVar@1100253000 : Record 7009819;
                                                              lfForm@1100253001 : Form 7009831;
                                                            BEGIN

                                                              CLEAR(lrVar);
                                                              lrVar.SETCURRENTKEY(Hotel,Estado,"Fecha Desde","Fecha Hasta","Cod. Habitacion");
                                                              lrVar.SETRANGE(Hotel, Hotel);
                                                              IF "C¢d. habitaci¢n" <> '' THEN BEGIN
                                                                CASE TipoHab OF
                                                                  TipoHab::Cupo   : lrVar.SETRANGE("Cod. Habitacion", "C¢d. habitaci¢n");
                                                                  TipoHab::Basica : lrVar.SETRANGE("Habitacion basica", "C¢d. habitaci¢n");
                                                                END;
                                                              END;
                                                              IF FiltTTOO <> '' THEN
                                                                lrVar.SETFILTER(Touroperador, FiltTTOO);
                                                              FORM.RUN(0,lrVar);
                                                            END;
                                                             }
                                                   { ID=64;
                                                     CaptionML=[ENU=Reports;
                                                                ESP=Listados] }
                                                   { ID=44;
                                                     MenuLevel=1;
                                                     CaptionML=[ENU=Print;
                                                                ESP=Impresion];
                                                     OnPush=VAR
                                                              repBooking@1103355001 : Report 7009722;
                                                            BEGIN
                                                              {
                                                              REPORT.RUNMODAL(7009722, TRUE, FALSE, Rec);
                                                              }
                                                              CLEAR(repBooking);
                                                              repBooking.SETTABLEVIEW(Rec);
                                                              repBooking.Parametros(FiltTTOO,
                                                                                    CurrForm.Matriz.MatrixRec."Period Start",
                                                                                    CurrForm.Matriz.MatrixRec."Period End",
                                                                                    TipoPeriodo,
                                                                                    TipoHab);
                                                              repBooking.RUNMODAL();
                                                              CLEAR(repBooking);
                                                            END;
                                                             }
                                                   { ID=65;
                                                     PushAction=RunObject;
                                                     MenuLevel=1;
                                                     CaptionML=[ENU=Rooming List;
                                                                ESP=Rooming List];
                                                     RunObject=Report 7009701 }
                                                   { ID=40;
                                                     Visible=No;
                                                     CaptionML=[ENU=Caption;
                                                                ESP=Leyenda];
                                                     OnPush=BEGIN
                                                              MESSAGE(Text000 +
                                                                      '\' +
                                                                      Text001 +
                                                                      Text002 +
                                                                      Text003 +
                                                                      Text004);
                                                            END;
                                                             }
                                                   { ID=1100253002;
                                                     MenuItemType=Separator;
                                                     CaptionML=[ENU=_;
                                                                ESP=_] }
                                                   { ID=1100253003;
                                                     ShortCutKey=Ctrl+S;
                                                     CaptionML=[ENU=Next day problem;
                                                                ESP=Siguiente d¡a problema];
                                                     OnPush=BEGIN
                                                              PosSiguDiaPrbl(1);
                                                            END;
                                                             }
                                                   { ID=1100253004;
                                                     ShortCutKey=Ctrl+N;
                                                     CaptionML=[ENU=Previous day problem;
                                                                ESP=Anterior dia problema];
                                                     OnPush=BEGIN
                                                              PosSiguDiaPrbl(2);
                                                            END;
                                                             }
                                                 }
                                                  }
    { 42  ;OptionButton ;4290 ;9460 ;550  ;550  ;VertGlue=Bottom;
                                                 FocusOnClick=No;
                                                 HorzAlign=Center;
                                                 Border=Yes;
                                                 FontBold=Yes;
                                                 BitmapPos=None;
                                                 CaptionML=[ENU=A;
                                                            ESP=C];
                                                 ToolTipML=[ENU=Allotment;
                                                            ESP=Cupo];
                                                 SourceExpr=TipoHab;
                                                 OptionValue=Cupo;
                                                 OnPush=BEGIN

                                                          SETRANGE("Tipo Habitacion",TipoHab);
                                                          Habitaciones();
                                                        END;
                                                         }
    { 43  ;OptionButton ;3740 ;9460 ;550  ;550  ;VertGlue=Bottom;
                                                 FocusOnClick=No;
                                                 HorzAlign=Center;
                                                 Border=Yes;
                                                 FontBold=Yes;
                                                 BitmapPos=None;
                                                 CaptionML=[ENU=B;
                                                            ESP=B];
                                                 ToolTipML=[ENU=Basic;
                                                            ESP=Basica];
                                                 SourceExpr=TipoHab;
                                                 OptionValue=Basica;
                                                 OnPush=BEGIN

                                                          SETRANGE("Tipo Habitacion",TipoHab);
                                                          Habitaciones();
                                                        END;
                                                         }
    { 45  ;TextBox      ;4950 ;9460 ;2420 ;550  ;VertGlue=Bottom;
                                                 Editable=No;
                                                 Focusable=No;
                                                 SourceExpr=TipoHab }
    { 41  ;Shape        ;330  ;10230;440  ;440  ;HorzGlue=Right;
                                                 VertGlue=Bottom;
                                                 BackColor=65280;
                                                 BackTransparent=No }
    { 67  ;Label        ;880  ;10230;4070 ;440  ;HorzGlue=Right;
                                                 VertGlue=Bottom;
                                                 LeaderDots=No;
                                                 CaptionML=[ENU=Sales stop + Overbooking;
                                                            ESP=Paro de ventas + Overbooking] }
    { 68  ;Label        ;6930 ;10230;1760 ;440  ;HorzGlue=Right;
                                                 VertGlue=Bottom;
                                                 LeaderDots=No;
                                                 CaptionML=[ENU=Overbooking;
                                                            ESP=Overbooking] }
    { 69  ;Shape        ;6380 ;10230;440  ;440  ;HorzGlue=Right;
                                                 VertGlue=Bottom;
                                                 BackColor=255;
                                                 BackTransparent=No }
    { 70  ;Label        ;14300;10230;1870 ;440  ;HorzGlue=Right;
                                                 VertGlue=Bottom;
                                                 LeaderDots=No;
                                                 CaptionML=[ENU=Normal date;
                                                            ESP=Fecha normal] }
    { 71  ;Shape        ;13750;10230;440  ;440  ;HorzGlue=Right;
                                                 VertGlue=Bottom;
                                                 BackColor=0;
                                                 BackTransparent=No }
    { 72  ;Label        ;10450;10230;2090 ;440  ;HorzGlue=Right;
                                                 VertGlue=Bottom;
                                                 LeaderDots=No;
                                                 CaptionML=[ENU=Sales stop;
                                                            ESP=Paro de ventas] }
    { 73  ;Shape        ;9900 ;10230;440  ;440  ;HorzGlue=Right;
                                                 VertGlue=Bottom;
                                                 BackColor=11751320;
                                                 BackTransparent=No }
    { 74  ;Shape        ;110  ;10120;17270;660  ;HorzGlue=Both;
                                                 VertGlue=Bottom }
  }
  CODE
  {
    VAR
      Text000@1103355067 : TextConst 'ENU=CAPTION OF COLORS\;ESP=LEYENDA DE COLORES\';
      Text001@1103355068 : TextConst 'ENU=Green    --> Sales Stop + Overbooking\;ESP=Verde    --> Paro Ventas + Overbooking\';
      Text002@1103355069 : TextConst 'ENU=Red     --> Overbooking\;ESP=Rojo     --> Overbooking\';
      Text003@1103355070 : TextConst 'ENU=Yellow --> Sales Stop\;ESP=Amarillo --> Paro ventas\';
      Text004@1103355071 : TextConst 'ENU=Black   --> Normal;ESP=Negro    --> Normal';
      rRsv@1103355000 : Record 7009755;
      rTTOO@1103355001 : Record 7009717;
      PeriodoContable@1103355002 : Record 50;
      rTipHab@1103355003 : Record 7009711;
      GestionFormPeriodo@1103355004 : Codeunit 359;
      rCup@1103355005 : Record 7009757;
      rPre@1103355006 : Record 7009783;
      rTra@1103355007 : Record 7009774;
      rHot@1103355008 : Record 7009724;
      rHotOvk@1103355009 : Record 7009780;
      rAumentoCupo@1103355010 : Record 7009819;
      rTempCupo@1100253001 : TEMPORARY Record 7009757;
      fAumentoCupo@1103355011 : Form 7009831;
      TipoPeriodo@1103355012 : 'D¡a,Semana,Mes,Trimestre,A¤o,Periodo contable';
      TipoImporte@1103355013 : 'Ocupaci¢n,Estancias,Porcentaje,Libres';
      Importe@1103355014 : Decimal;
      FactorRedondeo@1103355015 : 'No,1,1000,1000000';
      FiltTTOO@1103355016 : Code[30];
      FiltTTOOExt@1100253004 : Code[30];
      UltGra@1103355017 : Integer;
      wOrden@1103355018 : Integer;
      wFecha@1103355019 : Date;
      EspacioEntreFechas@1103355020 : Text[10];
      PrimeraFecha@1103355021 : Text[10];
      UltimaFecha@1103355022 : Text[10];
      wTexto1@1100253003 : Text[30];
      wFechaInicio@1103355023 : Date;
      wFechaFin@1103355024 : Date;
      Numhabi@1103355025 : Integer;
      DiaInicial@1103355026 : Date;
      ch01@1103355027 : Boolean;
      ch02@1103355028 : Boolean;
      ch03@1103355029 : Boolean;
      ch04@1103355030 : Boolean;
      ch05@1103355031 : Boolean;
      ch06@1103355032 : Boolean;
      ch07@1103355033 : Boolean;
      ch08@1103355034 : Boolean;
      ch09@1103355035 : Boolean;
      ch10@1103355036 : Boolean;
      ch11@1103355037 : Boolean;
      ch12@1103355038 : Boolean;
      ch13@1103355039 : Boolean;
      ch14@1103355040 : Boolean;
      ch15@1103355041 : Boolean;
      ch16@1103355042 : Boolean;
      ch17@1103355043 : Boolean;
      wDeConsCupos@1100253002 : Boolean;
      tex01@1103355044 : Text[10];
      tex02@1103355045 : Text[10];
      tex03@1103355046 : Text[10];
      tex04@1103355047 : Text[10];
      tex05@1103355048 : Text[10];
      tex06@1103355049 : Text[10];
      tex07@1103355050 : Text[10];
      tex08@1103355051 : Text[10];
      tex09@1103355052 : Text[10];
      tex10@1103355053 : Text[10];
      tex11@1103355054 : Text[10];
      tex12@1103355055 : Text[10];
      tex13@1103355056 : Text[10];
      tex14@1103355057 : Text[10];
      tex15@1103355058 : Text[10];
      tex16@1103355059 : Text[10];
      tex17@1103355060 : Text[10];
      ind@1103355061 : Integer;
      FiltHab@1103355062 : Text[218];
      PrimerFiltro@1103355063 : Boolean;
      TipoHab@1103355064 : 'Basica,Cupo';
      CH@1103355065 : ARRAY [17,2] OF Boolean;
      cNoms@1103355066 : Codeunit 7009702;
      Text005@1100253000 : TextConst 'ENU=It comes from Consult of Allotments;ESP=Viene de Consulta de Cupos';

    LOCAL PROCEDURE AsigFiltFecha@1();
    BEGIN
      // AsigFiltFecha
      //
      Rec.SETRANGE(Hotel, Hotel);
      IF FiltTTOO = '' THEN
        SETRANGE("TourOperador Rango")
      ELSE
        SETFILTER("TourOperador Rango", FiltTTOO);
      SETRANGE("Dia Rango", CurrForm.Matriz.MatrixRec."Period Start", CurrForm.Matriz.MatrixRec."Period End");
    END;

    PROCEDURE CalculaImporteBas@2(Rec@1103355000 : Record 7009774) imp : Decimal;
    BEGIN
      // CalculaImporteBas
      //
      Rec.SETRANGE(Hotel,Hotel);
      IF FiltTTOO = '' THEN
        Rec.SETRANGE("TourOperador Rango")
      ELSE
        Rec.SETFILTER("TourOperador Rango", FiltTTOO);

      Rec.SETRANGE("Dia Rango", CurrForm.Matriz.MatrixRec."Period Start", CurrForm.Matriz.MatrixRec."Period End");
      IF Rec."C¢d. habitaci¢n" = '' THEN
        Rec.SETRANGE("Habitacion Rango")
      ELSE
        Rec.SETRANGE("Habitacion Rango", Rec."C¢d. habitaci¢n");

      IF "Tipo de Registro" = "Tipo de Registro"::T¡tulo THEN BEGIN
        imp := 0;
      END;

      IF "Tipo de Registro" = "Tipo de Registro"::Contrato THEN BEGIN
        Rec.CALCFIELDS("Cupo hotel");
        imp := Rec."Cupo hotel";
      END;

      IF "Tipo de Registro" = "Tipo de Registro"::Cupo THEN BEGIN
        Rec.CALCFIELDS("Cupo contratado");
        imp := Rec."Cupo contratado";
      END;

      IF "Tipo de Registro" = "Tipo de Registro"::AumentoCupo THEN BEGIN
        rAumentoCupo.RESET;
        rAumentoCupo.SETRANGE (Hotel        , Hotel);
        rAumentoCupo.SETFILTER("Fecha Desde", '<=%1', CurrForm.Matriz.MatrixRec."Period Start");
        rAumentoCupo.SETFILTER("Fecha Hasta", '>=%1', CurrForm.Matriz.MatrixRec."Period End");
        IF Rec."C¢d. habitaci¢n" = '' THEN
          rAumentoCupo.SETRANGE("Habitacion basica")
        ELSE
          rAumentoCupo.SETRANGE("Habitacion basica", Rec."C¢d. habitaci¢n");
        rAumentoCupo.SETRANGE(Estado, rAumentoCupo.Estado::Confirmado);
        IF rAumentoCupo.FIND('-') THEN BEGIN
          REPEAT
            imp += rAumentoCupo.Cantidad;
          UNTIL rAumentoCupo.NEXT = 0;
        END
        ELSE
          imp := 0;
      END;

      IF "Tipo de Registro" = "Tipo de Registro"::Ocupado THEN BEGIN
        IF rHot.NoName THEN BEGIN
          Rec.CALCFIELDS(Reservado);
          imp := Rec.Reservado;
        END
        ELSE BEGIN
          Rec.CALCFIELDS(Ocupado);
          imp := Rec.Ocupado;
        END
      END;

      IF "Tipo de Registro" = "Tipo de Registro"::Asignado THEN BEGIN
        Rec.CALCFIELDS(Asignado);
        imp := Rec.Asignado;
      END;

      IF "Tipo de Registro" = "Tipo de Registro"::Libre THEN BEGIN
        IF rHot.NoName THEN BEGIN
          Rec.CALCFIELDS("Cupo contratado");
          Rec.CALCFIELDS(Reservado);
          Rec.CALCFIELDS(Asignado);
          imp := Rec."Cupo contratado" - Rec.Reservado - Rec.Asignado;
        END
        ELSE BEGIN
          Rec.CALCFIELDS("Cupo contratado");
          Rec.CALCFIELDS(Ocupado);
          Rec.CALCFIELDS(Asignado);
          imp := Rec."Cupo contratado" - Rec.Ocupado - Rec.Asignado;
        END;
      END;

      IF "Tipo de Registro" = "Tipo de Registro"::Porcentaje THEN BEGIN
        IF rHot.NoName THEN BEGIN
          Rec.CALCFIELDS("Cupo contratado");
          Rec.CALCFIELDS(Reservado);
          Rec.CALCFIELDS(Asignado);
          IF Rec."Cupo contratado" = 0 THEN
            imp := 0
          ELSE
            imp := ROUND(((Rec.Reservado + Rec.Asignado) * 100) / Rec."Cupo contratado");
        END
        ELSE BEGIN
          Rec.CALCFIELDS("Cupo contratado");
          Rec.CALCFIELDS(Ocupado);
          Rec.CALCFIELDS(Asignado);
          IF Rec."Cupo contratado" = 0 THEN
            imp := 0
          ELSE
            imp := ROUND(((Rec.Ocupado + Rec.Asignado) * 100) / Rec."Cupo contratado");
        END;
      END;

      // AJS 29.03.2004
      // Mostrar las reservas que se han comunicado al hotel pero no tienen numero de confirmacion

      IF "Tipo de Registro" = "Tipo de Registro"::SinConfirmar THEN BEGIN
        rRsv.RESET;
        rRsv.SETCURRENTKEY("Hotel booking",
                           TourOperador,
                           Dia,
                           Habitacion);
        rRsv.SETRANGE("Hotel booking", Hotel);
        rRsv.SETRANGE(Dia            , CurrForm.Matriz.MatrixRec."Period Start", CurrForm.Matriz.MatrixRec."Period End");
        IF FiltTTOO = '' THEN
          rRsv.SETRANGE(TourOperador)
        ELSE
          rRsv.SETFILTER(TourOperador, FiltTTOO);
        IF Rec."C¢d. habitaci¢n" = '' THEN
          rRsv.SETRANGE(Habitacion)
        ELSE
          rRsv.SETRANGE(Habitacion,Rec."C¢d. habitaci¢n");
        rRsv.SETRANGE("Num confirmacion hotel", '');
        IF rRsv.FIND('-') THEN
          imp := rRsv.COUNT
        ELSE
          imp := 0;
      END;
    END;

    PROCEDURE CalculaImporteCup@4(Rec@1103355000 : Record 7009774) imp : Decimal;
    BEGIN
      // CalculaImporteCup
      //
      Rec.SETRANGE(Hotel, Hotel);
      Rec.SETRANGE("Dia Rango", CurrForm.Matriz.MatrixRec."Period Start", CurrForm.Matriz.MatrixRec."Period End");
      IF FiltTTOO = '' THEN
        Rec.SETRANGE("TourOperador Rango")
      ELSE
        Rec.SETFILTER("TourOperador Rango", FiltTTOO);
      IF Rec."C¢d. habitaci¢n" = '' THEN
        Rec.SETRANGE("Habitacion Cupo Rango")
      ELSE
        Rec.SETRANGE("Habitacion Cupo Rango",Rec."C¢d. habitaci¢n");

      IF "Tipo de Registro" = "Tipo de Registro"::T¡tulo THEN BEGIN
        imp := 0;
      END;

      IF "Tipo de Registro" = "Tipo de Registro"::Contrato THEN BEGIN
        Rec.CALCFIELDS("Cupo hotel 2");
        imp := Rec."Cupo hotel 2";
      END;

      IF "Tipo de Registro" = "Tipo de Registro"::Cupo THEN BEGIN
        Rec.CALCFIELDS("Cupo contratado 2");
        imp := Rec."Cupo contratado 2";
      END;

      IF "Tipo de Registro" = "Tipo de Registro"::AumentoCupo THEN BEGIN
        rAumentoCupo.RESET;
        rAumentoCupo.SETRANGE (Hotel        , Hotel);
        rAumentoCupo.SETFILTER("Fecha Desde", '<=%1', CurrForm.Matriz.MatrixRec."Period Start");
        rAumentoCupo.SETFILTER("Fecha Hasta", '>=%1', CurrForm.Matriz.MatrixRec."Period End");
        IF Rec."C¢d. habitaci¢n" = '' THEN
          rAumentoCupo.SETRANGE("Cod. Habitacion")
        ELSE
          rAumentoCupo.SETRANGE("Cod. Habitacion", Rec."C¢d. habitaci¢n");
        rAumentoCupo.SETRANGE(Estado, rAumentoCupo.Estado::Confirmado);
        IF rAumentoCupo.FIND('-') THEN BEGIN
          REPEAT
            imp += rAumentoCupo.Cantidad;
          UNTIL rAumentoCupo.NEXT = 0;
        END
        ELSE
          imp := 0;
      END;

      IF "Tipo de Registro" = "Tipo de Registro"::Ocupado THEN BEGIN
        IF rHot.NoName THEN BEGIN
          Rec.CALCFIELDS("Reservado 2");
          imp := Rec."Reservado 2";
        END
        ELSE BEGIN
          Rec.CALCFIELDS("Ocupado 2");
          imp := Rec."Ocupado 2";
        END
      END;

      IF "Tipo de Registro" = "Tipo de Registro"::Asignado THEN BEGIN
        Rec.CALCFIELDS("Asignado 2");
        imp := Rec."Asignado 2";
      END;

      IF "Tipo de Registro" = "Tipo de Registro"::Libre THEN BEGIN
        IF rHot.NoName THEN BEGIN
          Rec.CALCFIELDS("Cupo contratado 2");
          Rec.CALCFIELDS("Reservado 2");
          Rec.CALCFIELDS("Asignado 2");
          imp := Rec."Cupo contratado 2" - Rec."Reservado 2" - Rec."Asignado 2";
        END
        ELSE BEGIN
          Rec.CALCFIELDS("Cupo contratado 2");
          Rec.CALCFIELDS("Ocupado 2");
          Rec.CALCFIELDS("Asignado 2");
          imp := Rec."Cupo contratado 2" - Rec."Ocupado 2" - Rec."Asignado 2";
        END;
      END;

      IF "Tipo de Registro" = "Tipo de Registro"::Porcentaje THEN BEGIN
        IF rHot.NoName THEN BEGIN
          Rec.CALCFIELDS("Cupo contratado 2");
          Rec.CALCFIELDS("Reservado 2");
          Rec.CALCFIELDS("Asignado 2");
          IF Rec."Cupo contratado 2" = 0 THEN
            imp := 0
          ELSE
            imp := ROUND(((Rec."Reservado 2" + Rec."Asignado 2") * 100) / Rec."Cupo contratado 2");
        END
        ELSE BEGIN
          Rec.CALCFIELDS("Cupo contratado 2");
          Rec.CALCFIELDS("Ocupado 2");
          Rec.CALCFIELDS("Asignado 2");
          IF Rec."Cupo contratado 2" = 0 THEN
            imp := 0
          ELSE
            imp := ROUND(((Rec."Ocupado 2" + Rec."Asignado 2") * 100) / Rec."Cupo contratado 2");
        END;
      END;

      // AJS 29.03.2004
      // Mostrar las reservas que se han comunicado al hotel pero no tienen numero de confirmacion

      IF "Tipo de Registro" = "Tipo de Registro"::SinConfirmar THEN BEGIN
        rRsv.RESET;
        rRsv.SETCURRENTKEY("Hotel booking",
                           TourOperador,
                           Dia,
                           "Habitacion cupo");
        rRsv.SETRANGE("Hotel booking", Hotel);
        rRsv.SETRANGE(Dia            , CurrForm.Matriz.MatrixRec."Period Start", CurrForm.Matriz.MatrixRec."Period End");
        IF FiltTTOO = '' THEN
          rRsv.SETRANGE(TourOperador)
        ELSE
          rRsv.SETFILTER(TourOperador, FiltTTOO);
        IF Rec."C¢d. habitaci¢n" = '' THEN
          rRsv.SETRANGE("Habitacion cupo")
        ELSE
          rRsv.SETRANGE("Habitacion cupo", Rec."C¢d. habitaci¢n");
        rRsv.SETRANGE("Num confirmacion hotel", '');
        IF rRsv.FIND('-') THEN
          imp := rRsv.COUNT
        ELSE
          imp := 0;
      END;
    END;

    PROCEDURE Habitaciones@3();
    BEGIN
      // Habitaciones
      //
      Salva_Hab();

      CurrForm.ch01.VISIBLE := FALSE;
      CurrForm.ch02.VISIBLE := FALSE;
      CurrForm.ch03.VISIBLE := FALSE;
      CurrForm.ch04.VISIBLE := FALSE;
      CurrForm.ch05.VISIBLE := FALSE;
      CurrForm.ch06.VISIBLE := FALSE;
      CurrForm.ch07.VISIBLE := FALSE;
      CurrForm.ch08.VISIBLE := FALSE;
      CurrForm.ch09.VISIBLE := FALSE;
      CurrForm.ch10.VISIBLE := FALSE;
      CurrForm.ch11.VISIBLE := FALSE;
      CurrForm.ch12.VISIBLE := FALSE;
      CurrForm.ch13.VISIBLE := FALSE;
      CurrForm.ch14.VISIBLE := FALSE;
      CurrForm.ch15.VISIBLE := FALSE;
      CurrForm.ch16.VISIBLE := FALSE;
      CurrForm.ch17.VISIBLE := FALSE;

      CurrForm.tex01.VISIBLE := FALSE;
      CurrForm.Tex02.VISIBLE := FALSE;
      CurrForm.Tex03.VISIBLE := FALSE;
      CurrForm.tex04.VISIBLE := FALSE;
      CurrForm.tex05.VISIBLE := FALSE;
      CurrForm.tex06.VISIBLE := FALSE;
      CurrForm.tex07.VISIBLE := FALSE;
      CurrForm.tex08.VISIBLE := FALSE;
      CurrForm.tex09.VISIBLE := FALSE;
      CurrForm.tex10.VISIBLE := FALSE;
      CurrForm.tex11.VISIBLE := FALSE;
      CurrForm.Tex12.VISIBLE := FALSE;
      CurrForm.Tex13.VISIBLE := FALSE;
      CurrForm.tex14.VISIBLE := FALSE;
      CurrForm.tex15.VISIBLE := FALSE;
      CurrForm.tex16.VISIBLE := FALSE;
      CurrForm.tex17.VISIBLE := FALSE;

      ind := 0;
      rTra.RESET;
      rTra.SETRANGE(Usuario           , USERID());
      rTra.SETRANGE(Hotel             , Hotel);
      rTra.SETRANGE("Tipo de Registro", "Tipo de Registro"::T¡tulo);
      rTra.SETRANGE("Tipo Habitacion" , TipoHab);

      IF rTra.FIND('-') THEN REPEAT
        IF rTra."C¢d. habitaci¢n" <> '' THEN BEGIN

          rTra.CALCFIELDS(rTra."Cupo contratado 2");
          IF rTra."Cupo contratado 2" > 0 THEN BEGIN

          ind := ind + 1;
          IF ind = 1 THEN BEGIN
            ch01 := CH[1][TipoHab+1] OR wDeConsCupos;
            tex01 := rTra."C¢d. habitaci¢n";
            CurrForm.ch01.VISIBLE := TRUE;
            CurrForm.tex01.VISIBLE := TRUE;
          END;
          IF ind = 2 THEN BEGIN
            ch02 := CH[2][TipoHab+1] OR wDeConsCupos;
            tex02 := rTra."C¢d. habitaci¢n";
            CurrForm.ch02.VISIBLE := TRUE;
            CurrForm.Tex02.VISIBLE := TRUE;
          END;
          IF ind = 3 THEN BEGIN
            ch03 := CH[3][TipoHab+1] OR wDeConsCupos;
            tex03 := rTra."C¢d. habitaci¢n";
            CurrForm.ch03.VISIBLE := TRUE;
            CurrForm.Tex03.VISIBLE := TRUE;
          END;
          IF ind = 4 THEN BEGIN
            ch04 := CH[4][TipoHab+1] OR wDeConsCupos;
            tex04 := rTra."C¢d. habitaci¢n";
            CurrForm.ch04.VISIBLE := TRUE;
            CurrForm.tex04.VISIBLE := TRUE;
          END;
          IF ind = 5 THEN BEGIN
            ch05 := CH[5][TipoHab+1] OR wDeConsCupos;
            tex05 := rTra."C¢d. habitaci¢n";
            CurrForm.ch05.VISIBLE := TRUE;
            CurrForm.tex05.VISIBLE := TRUE;
          END;
          IF ind = 6 THEN BEGIN
            ch06 := CH[6][TipoHab+1] OR wDeConsCupos;
            tex06 := rTra."C¢d. habitaci¢n";
            CurrForm.ch06.VISIBLE := TRUE;
            CurrForm.tex06.VISIBLE := TRUE;
          END;
          IF ind = 7 THEN BEGIN
            ch07 := CH[7][TipoHab+1] OR wDeConsCupos;
            tex07 := rTra."C¢d. habitaci¢n";
            CurrForm.ch07.VISIBLE := TRUE;
            CurrForm.tex07.VISIBLE := TRUE;
          END;
          IF ind = 8 THEN BEGIN
            ch08 := CH[8][TipoHab+1] OR wDeConsCupos;
            tex08 := rTra."C¢d. habitaci¢n";
            CurrForm.ch08.VISIBLE := TRUE;
            CurrForm.tex08.VISIBLE := TRUE;
          END;
          IF ind = 9 THEN BEGIN
            ch09 := CH[9][TipoHab+1] OR wDeConsCupos;
            tex09 := rTra."C¢d. habitaci¢n";
            CurrForm.ch09.VISIBLE := TRUE;
            CurrForm.tex09.VISIBLE := TRUE;
          END;
          IF ind = 10 THEN BEGIN
            ch10 := CH[10][TipoHab+1] OR wDeConsCupos;
            tex10 := rTra."C¢d. habitaci¢n";
            CurrForm.ch10.VISIBLE := TRUE;
            CurrForm.tex10.VISIBLE := TRUE;
          END;
          IF ind = 11 THEN BEGIN
            ch11 := CH[11][TipoHab+1] OR wDeConsCupos;
            tex11 := rTra."C¢d. habitaci¢n";
            CurrForm.ch11.VISIBLE := TRUE;
            CurrForm.tex11.VISIBLE := TRUE;
          END;
          IF ind = 12 THEN BEGIN
            ch12 := CH[12][TipoHab+1] OR wDeConsCupos;
            tex12 := rTra."C¢d. habitaci¢n";
            CurrForm.ch12.VISIBLE := TRUE;
            CurrForm.Tex12.VISIBLE := TRUE;
          END;
          IF ind = 13 THEN BEGIN
            ch13 := CH[13][TipoHab+1] OR wDeConsCupos;
            tex13 := rTra."C¢d. habitaci¢n";
            CurrForm.ch13.VISIBLE := TRUE;
            CurrForm.Tex13.VISIBLE := TRUE;
          END;
          IF ind = 14 THEN BEGIN
            ch14 := CH[14][TipoHab+1] OR wDeConsCupos;
            tex14 := rTra."C¢d. habitaci¢n";
            CurrForm.ch14.VISIBLE := TRUE;
            CurrForm.tex14.VISIBLE := TRUE;
          END;
          IF ind = 15 THEN BEGIN
            ch15 := CH[15][TipoHab+1] OR wDeConsCupos;
            tex15 := rTra."C¢d. habitaci¢n";
            CurrForm.ch15.VISIBLE := TRUE;
            CurrForm.tex15.VISIBLE := TRUE;
          END;
          IF ind = 16 THEN BEGIN
            ch16 := CH[16][TipoHab+1] OR wDeConsCupos;
            tex16 := rTra."C¢d. habitaci¢n";
            CurrForm.ch16.VISIBLE := TRUE;
            CurrForm.tex16.VISIBLE := TRUE;
          END;
          IF ind = 17 THEN BEGIN
            ch17 := CH[17][TipoHab+1] OR wDeConsCupos;
            tex17 := rTra."C¢d. habitaci¢n";
            CurrForm.ch17.VISIBLE := TRUE;
            CurrForm.tex17.VISIBLE := TRUE;
          END;
        END;
        END;
      UNTIL rTra.NEXT = 0;

      Filtros_TipHab();
    END;

    PROCEDURE Filtros_TipHab@5();
    BEGIN
      // Filtros_TipHab
      //
      FiltHab := '';
      PrimerFiltro := FALSE;

      IF (NOT ch01) AND (tex01 <> '') THEN BEGIN
        PrimerFiltro := TRUE;
        FiltHab := FiltHab + '<>' + tex01;
      END;

      IF (NOT ch02) AND (tex02 <> '') THEN BEGIN
        IF PrimerFiltro THEN
          FiltHab := FiltHab + '&';
        PrimerFiltro := TRUE;
        FiltHab := FiltHab + '<>' + tex02;
      END;

      IF (NOT ch03) AND (tex03 <> '') THEN BEGIN
        IF PrimerFiltro THEN
          FiltHab := FiltHab + '&';
        PrimerFiltro := TRUE;
        FiltHab := FiltHab + '<>' + tex03;
      END;

      IF (NOT ch04) AND (tex04 <> '') THEN BEGIN
        IF PrimerFiltro THEN
          FiltHab := FiltHab + '&';
        PrimerFiltro := TRUE;
        FiltHab := FiltHab + '<>' + tex04;
      END;

      IF (NOT ch05) AND (tex05 <> '') THEN BEGIN
        IF PrimerFiltro THEN
          FiltHab := FiltHab + '&';
        PrimerFiltro := TRUE;
        FiltHab := FiltHab + '<>' + tex05;
      END;

      IF (NOT ch06) AND (tex06 <> '') THEN BEGIN
        IF PrimerFiltro THEN
          FiltHab := FiltHab + '&';
        PrimerFiltro := TRUE;
        FiltHab := FiltHab + '<>' + tex06;
      END;

      IF (NOT ch07) AND (tex07 <> '') THEN BEGIN
        IF PrimerFiltro THEN
          FiltHab := FiltHab + '&';
        PrimerFiltro := TRUE;
        FiltHab := FiltHab + '<>' + tex07;
      END;

      IF (NOT ch08) AND (tex08 <> '') THEN BEGIN
        IF PrimerFiltro THEN
          FiltHab := FiltHab + '&';
        PrimerFiltro := TRUE;
        FiltHab := FiltHab + '<>' + tex08;
      END;

      IF (NOT ch09) AND (tex09 <> '') THEN BEGIN
        IF PrimerFiltro THEN
          FiltHab := FiltHab + '&';
        PrimerFiltro := TRUE;
        FiltHab := FiltHab + '<>' + tex09;
      END;

      IF (NOT ch10) AND (tex10 <> '') THEN BEGIN
        IF PrimerFiltro THEN
          FiltHab := FiltHab + '&';
        PrimerFiltro := TRUE;
        FiltHab := FiltHab + '<>' + tex10;
      END;

      IF (NOT ch11) AND (tex11 <> '') THEN BEGIN
        IF PrimerFiltro THEN
          FiltHab := FiltHab + '&';
        PrimerFiltro := TRUE;
        FiltHab := FiltHab + '<>' + tex11;
      END;

      IF (NOT ch12) AND (tex12 <> '') THEN BEGIN
        IF PrimerFiltro THEN
          FiltHab := FiltHab + '&';
        PrimerFiltro := TRUE;
        FiltHab := FiltHab + '<>' + tex12;
      END;

      IF (NOT ch13) AND (tex13 <> '') THEN BEGIN
        IF PrimerFiltro THEN
          FiltHab := FiltHab + '&';
        PrimerFiltro := TRUE;
        FiltHab := FiltHab + '<>' + tex13;
      END;

      IF (NOT ch14) AND (tex14 <> '') THEN BEGIN
        IF PrimerFiltro THEN
          FiltHab := FiltHab + '&';
        PrimerFiltro := TRUE;
        FiltHab := FiltHab + '<>' + tex14;
      END;

      IF (NOT ch15) AND (tex15 <> '') THEN BEGIN
        IF PrimerFiltro THEN
          FiltHab := FiltHab + '&';
        PrimerFiltro := TRUE;
        FiltHab := FiltHab + '<>' + tex15;
      END;

      IF (NOT ch16) AND (tex16 <> '') THEN BEGIN
        IF PrimerFiltro THEN
          FiltHab := FiltHab + '&';
        PrimerFiltro := TRUE;
        FiltHab := FiltHab + '<>' + tex16;
      END;

      IF (NOT ch17) AND (tex17 <> '') THEN BEGIN
        IF PrimerFiltro THEN
          FiltHab := FiltHab + '&';
        PrimerFiltro := TRUE;
        FiltHab := FiltHab + '<>' + tex17;
      END;

      SETFILTER("C¢d. habitaci¢n",FiltHab);
    END;

    PROCEDURE Salva_Hab@6();
    BEGIN
      // Salva_Hab
      //
      IF TipoHab = TipoHab::Basica THEN BEGIN
        CH[1][2] := ch01;
        CH[2][2] := ch02;
        CH[3][2] := ch03;
        CH[4][2] := ch04;
        CH[5][2] := ch05;
        CH[6][2] := ch06;
        CH[7][2] := ch07;
        CH[8][2] := ch08;
        CH[9][2] := ch09;
        CH[10][2] := ch10;
        CH[11][2] := ch11;
        CH[12][2] := ch12;
        CH[13][2] := ch13;
        CH[14][2] := ch14;
        CH[15][2] := ch15;
        CH[16][2] := ch16;
        CH[17][2] := ch17;
      END
      ELSE BEGIN
        CH[1][1] := ch01;
        CH[2][1] := ch02;
        CH[3][1] := ch03;
        CH[4][1] := ch04;
        CH[5][1] := ch05;
        CH[6][1] := ch06;
        CH[7][1] := ch07;
        CH[8][1] := ch08;
        CH[9][1] := ch09;
        CH[10][1] := ch10;
        CH[11][1] := ch11;
        CH[12][1] := ch12;
        CH[13][1] := ch13;
        CH[14][1] := ch14;
        CH[15][1] := ch15;
        CH[16][1] := ch16;
        CH[17][1] := ch17;
      END;
    END;

    PROCEDURE Init_Hab@9();
    BEGIN
      // Init_Hab
      //
      CH[1][2] := FALSE;
      CH[2][2] := FALSE;
      CH[3][2] := FALSE;
      CH[4][2] := FALSE;
      CH[5][2] := FALSE;
      CH[6][2] := FALSE;
      CH[7][2] := FALSE;
      CH[8][2] := FALSE;
      CH[9][2] := FALSE;
      CH[10][2] := FALSE;
      CH[11][2] := FALSE;
      CH[12][2] := FALSE;
      CH[13][2] := FALSE;
      CH[14][2] := FALSE;
      CH[15][2] := FALSE;
      CH[16][2] := FALSE;
      CH[17][2] := FALSE;
      CH[1][1] := FALSE;
      CH[2][1] := FALSE;
      CH[3][1] := FALSE;
      CH[4][1] := FALSE;
      CH[5][1] := FALSE;
      CH[6][1] := FALSE;
      CH[7][1] := FALSE;
      CH[8][1] := FALSE;
      CH[9][1] := FALSE;
      CH[10][1] := FALSE;
      CH[11][1] := FALSE;
      CH[12][1] := FALSE;
      CH[13][1] := FALSE;
      CH[14][1] := FALSE;
      CH[15][1] := FALSE;
      CH[16][1] := FALSE;
      CH[17][1] := FALSE;

      ch01 := FALSE;
      ch02 := FALSE;
      ch03 := FALSE;
      ch04 := FALSE;
      ch05 := FALSE;
      ch06 := FALSE;
      ch07 := FALSE;
      ch08 := FALSE;
      ch09 := FALSE;
      ch10 := FALSE;
      ch11 := FALSE;
      ch12 := FALSE;
      ch13 := FALSE;
      ch14 := FALSE;
      ch15 := FALSE;
      ch16 := FALSE;
      ch17 := FALSE;
    END;

    PROCEDURE NombreHotel@7() Nombre : Text[50];
    BEGIN
      // NombreHotel
      //
      IF rHot.GET(Hotel) THEN
        EXIT(rHot.Hotel+ '-' +rHot.Nombre)
      ELSE
        EXIT('');
    END;

    PROCEDURE Ovbk@8() O : Text[1];
    BEGIN
      // Ovbk
      //
      rHotOvk.RESET;
      rHotOvk.SETRANGE(Hotel,Hotel);
      IF rHotOvk.FIND('-') THEN REPEAT
        IF  (rHotOvk.Desde <= CurrForm.Matriz.MatrixRec."Period End")
        AND (rHotOvk.Hasta >= CurrForm.Matriz.MatrixRec."Period Start") THEN
          EXIT('*');

      UNTIL rHotOvk.NEXT = 0;

      EXIT('');
    END;

    PROCEDURE Paro@10() : Char;
    VAR
      rParo@1103355000 : Record 7009781;
    BEGIN
      // Paro
      //
      CLEAR(rParo);
      rParo.SETRANGE (Hotel        , Hotel);
      rParo.SETFILTER("Fecha desde", '<=%1', CurrForm.Matriz.MatrixRec."Period End");
      rParo.SETFILTER("Fecha hasta", '>=%1', CurrForm.Matriz.MatrixRec."Period Start");
      IF rParo.FIND('-') THEN
        EXIT('*')
      ELSE
        EXIT(' ');
    END;

    PROCEDURE SetDatos@1100253000(pwFechaIni@1100253000 : Date;pwFechaFin@1100253001 : Date;pwTTOO@1100253002 : Code[10]);
    BEGIN
      // SetDatos

      wFechaInicio := pwFechaIni;
      wFechaFin    := pwFechaFin;
      FiltTTOOExt  := pwTTOO;
    END;

    PROCEDURE SetTempCupos@1100253001(VAR prTempCupo@1100253000 : TEMPORARY Record 7009757);
    BEGIN
      // SetTempCupos
      // JPT 12/08/10
      // rTempCupo es un temporal donde indica los registros de dias problematicos en un periodo,
      // para un TTOO y unos parametros de entrada determinados.
      // Viene del formulario 50168 "Incidencias Cupos" para mas informacion.

      wDeConsCupos := TRUE;

      CLEAR(rTempCupo);
      rTempCupo.DELETEALL;

      IF prTempCupo.FINDSET THEN BEGIN
        REPEAT
          rTempCupo := prTempCupo;
          rTempCupo.INSERT;
        UNTIL prTempCupo.NEXT=0;
      END;
    END;

    PROCEDURE PosSiguDiaPrbl@1100253002(pwModo@1100253000 : ',Siguiente,Anterior');
    VAR
      lwFecha1@1100253002 : Date;
      lwFecha2@1100253001 : Date;
    BEGIN
      // PosSiguDiaPrbl
      // Nos posicionamos en el siguiente dia problematico
      // Solo si viene de la consulta de cupos

      IF NOT wDeConsCupos THEN
        EXIT;

      CLEAR(lwFecha1);
      CLEAR(lwFecha2);
      lwFecha1 := CurrForm.Matriz.MatrixRec."Period Start";
      CLEAR(rTempCupo);
      rTempCupo.SETCURRENTKEY(Dia,Hotel,TourOperador);

      IF pwModo = pwModo::Siguiente THEN BEGIN
        rTempCupo.SETFILTER(Dia, '>%1', lwFecha1);
      END
      ELSE BEGIN
        rTempCupo.ASCENDING(FALSE);
        rTempCupo.SETFILTER(Dia, '<%1', lwFecha1);
      END;

      IF rTempCupo.FINDFIRST THEN
        lwFecha2 := rTempCupo.Dia;

      IF lwFecha2 <> 0D THEN BEGIN
       CurrForm.Matriz.MatrixRec."Period Start":= lwFecha2;
      END;
    END;

    PROCEDURE TieneProblemas@1100253003() : Boolean;
    BEGIN
      // TieneProblemas
      // Indica que el dia en cuestion tiene algun problema para el TTOO
      // Solo si viene de la consulta de cupos
      // JPT 12/08/10

      IF NOT wDeConsCupos THEN
        EXIT;

      CLEAR(rTempCupo);
      rTempCupo.SETCURRENTKEY(Dia,Hotel,TourOperador);
      rTempCupo.SETRANGE(Dia, CurrForm.Matriz.MatrixRec."Period Start");
      EXIT(rTempCupo.FINDFIRST);
    END;

    BEGIN
    {
      $001 JPT 06/08/12 Incluyo una nueva linea para mostrar el release del contrato de compra
    }
    END.
  }
}
