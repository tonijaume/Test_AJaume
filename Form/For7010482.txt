OBJECT Form 7010482 Facturacion TTOO x Parte
{
  OBJECT-PROPERTIES
  {
    Date=04/10/10;
    Time=14:03:54;
    Modified=Yes;
    Version List=TRANSFER;
  }
  PROPERTIES
  {
    Width=22550;
    Height=13640;
    CaptionML=ESP=Facturacion TTOO x Parte;
    TableBoxID=1103355000;
    SourceTable=Table7010365;
    SourceTableView=SORTING(Confirmado,Cliente operativo,Touroperador,Tipo Servicio,Codigo Servicio,Fecha Facturacion)
                    WHERE(Confirmado=CONST(Yes));
    OnOpenForm=BEGIN

                 IF NOT cFunFact.FiltraTTOOParte(Rec) THEN
                   CurrForm.CLOSE;

                 FiltroGestor;
               END;

    OnAfterGetRecord=BEGIN
                       // Calcula el color del texto
                       wEstado := Estado_Facturacion("N§ Parte", Touroperador);
                       //wTextoBold := lwEstado>3;

                       CASE wEstado OF
                         4: wColorTexto:= 255;
                         3: wColorTexto:= 255;
                         2: wColorTexto:= 8421504;
                         1: wColorTexto:= 0;
                         0: wColorTexto:= 0;
                       END;
                     END;

  }
  CONTROLS
  {
    { 1103355000;TableBox;220 ;220  ;22110;6820 ;HorzGlue=Both;
                                                 VertGlue=Top;
                                                 Editable=No;
                                                 HeadingHeight=880 }
    { 1103355001;TextBox;0    ;0    ;1700 ;0    ;ParentControl=1103355000;
                                                 InColumn=Yes;
                                                 SourceExpr=Marca;
                                                 OnFormat=BEGIN
                                                            CurrForm.Marca.UPDATEFORECOLOR(wColorTexto);
                                                          END;
                                                           }
    { 1103355002;Label  ;0    ;0    ;0    ;0    ;ParentControl=1103355001;
                                                 InColumnHeading=Yes }
    { 1103355003;TextBox;0    ;0    ;1880 ;0    ;ParentControl=1103355000;
                                                 InColumn=Yes;
                                                 SourceExpr="N§ Parte";
                                                 OnFormat=BEGIN
                                                            CurrForm."N§ Parte".UPDATEFORECOLOR(wColorTexto);
                                                          END;
                                                           }
    { 1103355004;Label  ;0    ;0    ;0    ;0    ;ParentControl=1103355003;
                                                 InColumnHeading=Yes }
    { 1103355005;TextBox;0    ;0    ;2200 ;0    ;ParentControl=1103355000;
                                                 InColumn=Yes;
                                                 SourceExpr=Touroperador;
                                                 OnFormat=BEGIN
                                                            CurrForm.Touroperador.UPDATEFORECOLOR(wColorTexto);
                                                          END;
                                                           }
    { 1103355006;Label  ;0    ;0    ;0    ;0    ;ParentControl=1103355005;
                                                 InColumnHeading=Yes }
    { 1103355007;TextBox;0    ;0    ;2090 ;0    ;ParentControl=1103355000;
                                                 InColumn=Yes;
                                                 SourceExpr="Cliente estadistico";
                                                 OnFormat=BEGIN
                                                            CurrForm."Cliente estadistico".UPDATEFORECOLOR(wColorTexto);
                                                          END;
                                                           }
    { 1103355008;Label  ;0    ;0    ;0    ;0    ;ParentControl=1103355007;
                                                 InColumnHeading=Yes }
    { 1100253000;TextBox;7647 ;3190 ;1700 ;440  ;ParentControl=1103355000;
                                                 InColumn=Yes;
                                                 SourceExpr="Cliente operativo";
                                                 OnFormat=BEGIN

                                                            CurrForm."Cliente operativo".UPDATEFORECOLOR(wColorTexto);
                                                          END;
                                                           }
    { 1100253001;Label  ;0    ;0    ;0    ;0    ;ParentControl=1100253000;
                                                 InColumnHeading=Yes }
    { 1103355009;TextBox;0    ;0    ;1700 ;0    ;ParentControl=1103355000;
                                                 InColumn=Yes;
                                                 SourceExpr="Codigo Servicio";
                                                 OnFormat=BEGIN
                                                            CurrForm."Codigo Servicio".UPDATEFORECOLOR(wColorTexto);
                                                          END;
                                                           }
    { 1103355010;Label  ;0    ;0    ;0    ;0    ;ParentControl=1103355009;
                                                 InColumnHeading=Yes }
    { 1103355011;TextBox;0    ;0    ;1700 ;0    ;ParentControl=1103355000;
                                                 InColumn=Yes;
                                                 SourceExpr="Tipo Servicio";
                                                 OnFormat=BEGIN
                                                            CurrForm."Tipo Servicio".UPDATEFORECOLOR(wColorTexto);
                                                          END;
                                                           }
    { 1103355012;Label  ;0    ;0    ;0    ;0    ;ParentControl=1103355011;
                                                 InColumnHeading=Yes }
    { 1103355013;TextBox;0    ;0    ;1234 ;0    ;ParentControl=1103355000;
                                                 InColumn=Yes;
                                                 SourceExpr="Adultos transportados";
                                                 OnFormat=BEGIN
                                                            CurrForm."Adultos transportados".UPDATEFORECOLOR(wColorTexto);
                                                          END;
                                                           }
    { 1103355014;Label  ;0    ;0    ;0    ;0    ;ParentControl=1103355013;
                                                 InColumnHeading=Yes }
    { 1103355015;TextBox;0    ;0    ;1100 ;0    ;ParentControl=1103355000;
                                                 InColumn=Yes;
                                                 SourceExpr="Ni¤os transportados";
                                                 OnFormat=BEGIN
                                                            CurrForm."Ni¤os transportados".UPDATEFORECOLOR(wColorTexto);
                                                          END;
                                                           }
    { 1103355016;Label  ;0    ;0    ;0    ;0    ;ParentControl=1103355015;
                                                 InColumnHeading=Yes }
    { 1103355019;TextBox;0    ;0    ;2090 ;0    ;ParentControl=1103355000;
                                                 InColumn=Yes;
                                                 SourceExpr="Ingreso Precios Por";
                                                 OnFormat=BEGIN
                                                            CurrForm."Ingreso Precios Por".UPDATEFORECOLOR(wColorTexto);
                                                          END;
                                                           }
    { 1103355020;Label  ;0    ;0    ;0    ;0    ;ParentControl=1103355019;
                                                 InColumnHeading=Yes }
    { 1103355021;TextBox;0    ;0    ;1760 ;0    ;Name=IngresoDL1;
                                                 ParentControl=1103355000;
                                                 InColumn=Yes;
                                                 CaptionML=ESP=Ingresos (DL);
                                                 SourceExpr=TotalIngresoDL;
                                                 OnFormat=BEGIN
                                                            CurrForm.IngresoDL1.UPDATEFORECOLOR(wColorTexto);
                                                          END;
                                                           }
    { 1103355022;Label  ;0    ;0    ;0    ;0    ;ParentControl=1103355021;
                                                 InColumnHeading=Yes }
    { 1103355023;TextBox;0    ;0    ;1700 ;0    ;ParentControl=1103355000;
                                                 InColumn=Yes;
                                                 SourceExpr="Fecha Facturacion";
                                                 OnFormat=BEGIN
                                                            CurrForm."Fecha Facturacion".UPDATEFORECOLOR(wColorTexto);
                                                          END;
                                                           }
    { 1103355024;Label  ;0    ;0    ;0    ;0    ;ParentControl=1103355023;
                                                 InColumnHeading=Yes }
    { 1103355025;TextBox;0    ;0    ;1700 ;0    ;ParentControl=1103355000;
                                                 InColumn=Yes;
                                                 SourceExpr="Fecha parte";
                                                 OnFormat=BEGIN
                                                            CurrForm."Fecha parte".UPDATEFORECOLOR(wColorTexto);
                                                          END;
                                                           }
    { 1103355026;Label  ;0    ;0    ;0    ;0    ;ParentControl=1103355025;
                                                 InColumnHeading=Yes }
    { 1103355027;TextBox;0    ;0    ;1700 ;0    ;ParentControl=1103355000;
                                                 InColumn=Yes;
                                                 SourceExpr="Cod. Divisa venta";
                                                 OnFormat=BEGIN
                                                            CurrForm."Cod. Divisa venta".UPDATEFORECOLOR(wColorTexto);
                                                          END;
                                                           }
    { 1103355028;Label  ;0    ;0    ;0    ;0    ;ParentControl=1103355027;
                                                 InColumnHeading=Yes }
    { 1103355029;TextBox;0    ;0    ;2200 ;0    ;ParentControl=1103355000;
                                                 InColumn=Yes;
                                                 SourceExpr="Precio manual venta DL";
                                                 OnFormat=BEGIN
                                                            CurrForm."Precio manual venta DL".UPDATEFORECOLOR(wColorTexto);
                                                          END;
                                                           }
    { 1103355030;Label  ;0    ;0    ;0    ;0    ;ParentControl=1103355029;
                                                 InColumnHeading=Yes }
    { 1103355031;TextBox;0    ;0    ;2200 ;0    ;Name=IngresoC/I1;
                                                 ParentControl=1103355000;
                                                 InColumn=Yes;
                                                 CaptionML=ESP=Ingresos;
                                                 SourceExpr=TotalIngreso;
                                                 OnFormat=BEGIN
                                                            CurrForm."IngresoC/I1".UPDATEFORECOLOR(wColorTexto);
                                                          END;
                                                           }
    { 1103355032;Label  ;0    ;0    ;0    ;0    ;ParentControl=1103355031;
                                                 InColumnHeading=Yes }
    { 1103355033;TextBox;0    ;0    ;2219 ;0    ;ParentControl=1103355000;
                                                 InColumn=Yes;
                                                 SourceExpr="N§ Prefactura";
                                                 OnFormat=BEGIN
                                                            CurrForm."N§ Prefactura".UPDATEFORECOLOR(wColorTexto);
                                                          END;
                                                           }
    { 1103355034;Label  ;0    ;0    ;0    ;0    ;ParentControl=1103355033;
                                                 InColumnHeading=Yes }
    { 1103355035;TextBox;0    ;0    ;2286 ;0    ;ParentControl=1103355000;
                                                 InColumn=Yes;
                                                 SourceExpr="N§ Factura";
                                                 OnFormat=BEGIN
                                                            CurrForm."N§ Factura".UPDATEFORECOLOR(wColorTexto);
                                                          END;
                                                           }
    { 1103355036;Label  ;0    ;0    ;0    ;0    ;ParentControl=1103355035;
                                                 InColumnHeading=Yes }
    { 1103355037;TextBox;0    ;0    ;2243 ;0    ;ParentControl=1103355000;
                                                 InColumn=Yes;
                                                 SourceExpr="Fecha Registro Factura";
                                                 OnFormat=BEGIN
                                                            CurrForm."Fecha Registro Factura".UPDATEFORECOLOR(wColorTexto);
                                                          END;
                                                           }
    { 1103355038;Label  ;0    ;0    ;0    ;0    ;ParentControl=1103355037;
                                                 InColumnHeading=Yes }
    { 1103355039;TextBox;0    ;0    ;3960 ;0    ;HorzGlue=Both;
                                                 ParentControl=1103355000;
                                                 InColumn=Yes;
                                                 SourceExpr=Referencia;
                                                 OnFormat=BEGIN
                                                            CurrForm.Referencia.UPDATEFORECOLOR(wColorTexto);
                                                          END;
                                                           }
    { 1103355040;Label  ;0    ;0    ;0    ;0    ;ParentControl=1103355039;
                                                 InColumnHeading=Yes }
    { 1103355041;TextBox;0    ;0    ;2208 ;0    ;ParentControl=1103355000;
                                                 InColumn=Yes;
                                                 SourceExpr="N§ Contrato venta";
                                                 OnFormat=BEGIN
                                                            CurrForm."N§ Contrato venta".UPDATEFORECOLOR(wColorTexto);
                                                          END;
                                                           }
    { 1103355042;Label  ;0    ;0    ;0    ;0    ;ParentControl=1103355041;
                                                 InColumnHeading=Yes }
    { 1103355043;TextBox;0    ;0    ;4400 ;0    ;ParentControl=1103355000;
                                                 InColumn=Yes;
                                                 SourceExpr="Concepto facturacion";
                                                 OnFormat=BEGIN
                                                            CurrForm."Concepto facturacion".UPDATEFORECOLOR(wColorTexto);
                                                          END;
                                                           }
    { 1103355044;Label  ;0    ;0    ;0    ;0    ;ParentControl=1103355043;
                                                 InColumnHeading=Yes }
    { 1103355045;TextBox;0    ;0    ;1700 ;0    ;ParentControl=1103355000;
                                                 InColumn=Yes;
                                                 SourceExpr="Zona trabajo";
                                                 OnFormat=BEGIN
                                                            CurrForm."Zona trabajo".UPDATEFORECOLOR(wColorTexto);
                                                          END;
                                                           }
    { 1103355046;Label  ;0    ;0    ;0    ;0    ;ParentControl=1103355045;
                                                 InColumnHeading=Yes }
    { 1103355017;TextBox;0    ;0    ;1242 ;0    ;ParentControl=1103355000;
                                                 InColumn=Yes;
                                                 SourceExpr="N§ Viajes";
                                                 OnFormat=BEGIN
                                                            CurrForm."N§ Viajes".UPDATEFORECOLOR(wColorTexto);
                                                          END;
                                                           }
    { 1103355018;Label  ;0    ;0    ;0    ;0    ;ParentControl=1103355017;
                                                 InColumnHeading=Yes }
    { 1103355047;CommandButton;10450;12870;2200;550;
                                                 HorzGlue=Right;
                                                 VertGlue=Bottom;
                                                 Default=Yes;
                                                 PushAction=LookupOK;
                                                 InvalidActionAppearance=Hide }
    { 1103355048;CommandButton;12870;12870;2200;550;
                                                 HorzGlue=Right;
                                                 VertGlue=Bottom;
                                                 Cancel=Yes;
                                                 PushAction=LookupCancel;
                                                 InvalidActionAppearance=Hide }
    { 1103355049;CommandButton;20130;12870;2200;550;
                                                 HorzGlue=Right;
                                                 VertGlue=Bottom;
                                                 PushAction=FormHelp }
    { 1103355050;MenuButton;17710;12870;2200;550;HorzGlue=Right;
                                                 VertGlue=Bottom;
                                                 CaptionML=ESP=&Ingresos;
                                                 Menu=MENUITEMS
                                                 {
                                                   { ID=1103355051;
                                                     PushAction=RunObject;
                                                     ShortCutKey=Ctrl+P;
                                                     CaptionML=ESP=Ver Ficha parte;
                                                     RunObject=Form 7010400;
                                                     RunFormLink=N§ Parte=FIELD(N§ Parte) }
                                                   { ID=1103355055;
                                                     ShortCutKey=Ctrl+Z;
                                                     CaptionML=ESP=Ver PDF Parte;
                                                     OnPush=VAR
                                                              lrParte@1103355000 : Record 7010360;
                                                            BEGIN
                                                              CLEAR(lrParte);
                                                              IF lrParte.GET("N§ Parte") THEN
                                                                lrParte.VerPDF;
                                                            END;
                                                             }
                                                   { ID=1103355052;
                                                     CaptionML=ESP=Ver Prefactura;
                                                     OnPush=VAR
                                                              lrPI@1103355000 : Record 7035392;
                                                              lrPref@1103355001 : Record 7010415;
                                                              lfFormPrefac@1103355002 : Form 7010477;
                                                            BEGIN
                                                              lrPI.RESET;
                                                              lrPref.RESET;
                                                              CurrForm.SubLineas.FORM.GETRECORD(lrPI);
                                                              lrPref.SETRANGE("N§ Prefactura", lrPI."N§ Prefactura");
                                                              lfFormPrefac.SETTABLEVIEW(lrPref);
                                                              lfFormPrefac.RUNMODAL;
                                                            END;
                                                             }
                                                   { ID=1103355053;
                                                     CaptionML=ESP=Ver Factura;
                                                     OnPush=VAR
                                                              lfFormFac@1103355005 : Form 43;
                                                              lrPar@1103355003 : Record 7010311;
                                                              lrCabVenta@1103355002 : Record 36;
                                                              lfTabFraEco@1103355001 : Form 7010485;
                                                              lfFormFacFinBus@1103355000 : Form 7010485;
                                                            BEGIN
                                                              lrPar.RESET;
                                                              lrPar.FINDFIRST;


                                                              CASE lrPar."Tipo Contabilizaci¢n" OF
                                                                lrPar."Tipo Contabilizaci¢n"::ECOFIN:
                                                                BEGIN

                                                                  lrCabVenta.RESET;
                                                                  lrCabVenta.SETRANGE("No.", "N§ Factura");
                                                                  IF lrCabVenta.FINDFIRST THEN BEGIN
                                                                    CLEAR(lfTabFraEco);
                                                                    lfTabFraEco.SETTABLEVIEW(lrCabVenta);
                                                                    lfTabFraEco.RUNMODAL;
                                                                  END;
                                                                END;
                                                                lrPar."Tipo Contabilizaci¢n"::Standard:
                                                                BEGIN

                                                                  lrCabVenta.RESET;
                                                                  lrCabVenta.SETRANGE("No.", "N§ Factura");
                                                                  IF lrCabVenta.FINDFIRST THEN BEGIN
                                                                    CLEAR(lfFormFac);
                                                                    lfFormFac.SETTABLEVIEW(lrCabVenta);
                                                                    lfFormFac.RUNMODAL;
                                                                  END;
                                                                END;

                                                                lrPar."Tipo Contabilizaci¢n"::"Sin contabilidad":
                                                                BEGIN

                                                                  lrCabVenta.RESET;
                                                                  lrCabVenta.SETRANGE("No.", "N§ Factura");
                                                                  IF lrCabVenta.FINDFIRST THEN BEGIN
                                                                    CLEAR(lfFormFacFinBus);
                                                                    lfFormFacFinBus.SETTABLEVIEW(lrCabVenta);
                                                                    lfFormFacFinBus.RUNMODAL;
                                                                  END;
                                                                END;
                                                              END;
                                                            END;
                                                             }
                                                   { ID=1103355056;
                                                     MenuItemType=Separator }
                                                   { ID=1103355057;
                                                     CaptionML=ESP=Reimprimir Prefactura;
                                                     OnPush=VAR
                                                              lrPref@1103355000 : Record 7010415;
                                                            BEGIN
                                                              CLEAR(lrPref);
                                                              lrPref.SETRANGE("N§ Prefactura","N§ Prefactura");
                                                              IF lrPref.FINDFIRST THEN
                                                                cFacCli.ImprimirRegistroPrefactura(lrPref);
                                                            END;
                                                             }
                                                   { ID=1103355058;
                                                     CaptionML=ESP=Reimprimir Factura;
                                                     OnPush=VAR
                                                              lrPref@1103355000 : Record 7010415;
                                                            BEGIN
                                                              CLEAR(lrPref);
                                                              IF lrPref.GET("N§ Prefactura") THEN
                                                                cFacCli.ImprimeRegistroFactura(lrPref);
                                                            END;
                                                             }
                                                 }
                                                  }
    { 1103355054;SubForm;220  ;7150 ;22110;5500 ;Name=SubLineas;
                                                 HorzGlue=Both;
                                                 VertGlue=Both;
                                                 Border=No;
                                                 SubFormID=Form7010483;
                                                 SubFormLink=N§ Parte=FIELD(N§ Parte) }
    { 1103355059;Label  ;770  ;12870;2200 ;550  ;VertGlue=Bottom;
                                                 ForeColor=0;
                                                 FontBold=Yes;
                                                 LeaderDots=No;
                                                 CaptionML=ESP=Prefacturado }
    { 1103355060;Label  ;6270 ;12870;2090 ;550  ;VertGlue=Bottom;
                                                 ForeColor=0;
                                                 FontBold=Yes;
                                                 LeaderDots=No;
                                                 CaptionML=ESP=Sin procesar }
    { 1103355061;CommandButton;5720;12870;440;550;
                                                 VertGlue=Bottom;
                                                 ShowCaption=No;
                                                 BackColor=0;
                                                 Border=No }
    { 1103355062;Label  ;3740 ;12870;1760 ;550  ;VertGlue=Bottom;
                                                 ForeColor=0;
                                                 FontBold=Yes;
                                                 LeaderDots=No;
                                                 CaptionML=ESP=Facturado }
    { 1103355063;CommandButton;3190;12870;440;550;
                                                 VertGlue=Bottom;
                                                 ShowCaption=No;
                                                 BackColor=255;
                                                 Border=No }
    { 1103355064;CommandButton;220;12870;440;550;VertGlue=Bottom;
                                                 ShowCaption=No;
                                                 BackColor=8421504;
                                                 Border=No }
    { 1103355065;MenuButton;15290;12870;2200;550;HorzGlue=Right;
                                                 VertGlue=Bottom;
                                                 CaptionML=ESP=A&cciones;
                                                 Menu=MENUITEMS
                                                 {
                                                   { ID=1103355066;
                                                     ShortCutKey=F9;
                                                     CaptionML=ESP=Totalizar;
                                                     OnPush=BEGIN
                                                              cFun."totalizar_importe_TTOO/Parte"(Rec);
                                                            END;
                                                             }
                                                   { ID=1103355073;
                                                     ShortCutKey=Ctrl+G;
                                                     CaptionML=ESP=Filtrar x Gestor;
                                                     OnPush=BEGIN
                                                              wUsaGestor := NOT wUsaGestor;
                                                              FiltroGestor;
                                                            END;
                                                             }
                                                   { ID=1103355074;
                                                     CaptionML=ESP=Contar Partes Filtrados;
                                                     OnPush=VAR
                                                              lrTTOOPart@1103355003 : Record 7010365;
                                                              wCuentaRecs@1103355002 : Integer;
                                                              wSumAD@1103355001 : Decimal;
                                                              wSumNI@1103355000 : Decimal;
                                                            BEGIN
                                                              wCuentaRecs := 0;
                                                              wSumAD      := 0;
                                                              wSumNI      := 0;

                                                              lrTTOOPart.COPY(Rec);
                                                              IF lrTTOOPart.FINDSET THEN BEGIN
                                                                wCuentaRecs := COUNT;
                                                                REPEAT
                                                                  wSumAD  += lrTTOOPart."Adultos transportados";
                                                                  wSumNI  += lrTTOOPart."Ni¤os transportados";
                                                                UNTIL lrTTOOPart.NEXT = 0;
                                                              END;

                                                              wVentana.OPEN(Text005);
                                                              wVentana.UPDATE(1, wCuentaRecs);
                                                              wVentana.UPDATE(2, wSumAD);
                                                              wVentana.INPUT(3, wSumNI);
                                                              wVentana.CLOSE;
                                                            END;
                                                             }
                                                   { ID=1103355067;
                                                     MenuItemType=Separator }
                                                   { ID=1103355068;
                                                     CaptionML=ESP=Deshacer Prefactura;
                                                     OnPush=BEGIN
                                                              cFun.deshacer_prefactura("N§ Prefactura");
                                                              CurrForm.UPDATE(FALSE);
                                                            END;
                                                             }
                                                   { ID=1103355069;
                                                     CaptionML=ESP=Abonar Factura;
                                                     OnPush=VAR
                                                              lcFunAbonar@1103355000 : Codeunit 7010322;
                                                            BEGIN
                                                              lcFunAbonar.seleccion_tipoabono("N§ Factura");
                                                            END;
                                                             }
                                                   { ID=1103355070;
                                                     MenuItemType=Separator }
                                                   { ID=1103355071;
                                                     ShortCutKey=Ctrl+F1;
                                                     CaptionML=ESP=Marcar linea;
                                                     OnPush=VAR
                                                              lrPI@1103355000 : Record 7035392;
                                                            BEGIN
                                                                CurrForm.SubLineas.FORM.GETRECORD(lrPI);

                                                                lrPI.SETRANGE("N§ Parte" , "N§ Parte");
                                                                IF Marca <> UPPERCASE(USERID) THEN BEGIN
                                                                  Marca := UPPERCASE(USERID);
                                                                  MODIFY;
                                                                  lrPI.MODIFYALL(Marca , UPPERCASE(USERID));
                                                                END
                                                                ELSE BEGIN
                                                                  Marca :='';
                                                                  MODIFY;
                                                                  lrPI.MODIFYALL(Marca , '');
                                                                END;
                                                                CurrForm.SubLineas.FORM.SETRECORD(lrPI);
                                                            END;
                                                             }
                                                   { ID=1103355072;
                                                     ShortCutKey=F11;
                                                     CaptionML=ESP=Facturar;
                                                     OnPush=VAR
                                                              lrPI@1103355000 : Record 7035392;
                                                            BEGIN
                                                              CurrForm.SubLineas.FORM.GETRECORD(lrPI);

                                                              rPar.FINDFIRST;

                                                              CASE rPar."Empresa Real" OF
                                                                rPar."Empresa Real"::IBZ, rPar."Empresa Real"::SJO: cFunFact.facturacion_ingresos(lrPI);
                                                                ELSE cFacCli.FacturarIngresos(lrPI);
                                                              END;
                                                            END;
                                                             }
                                                 }
                                                  }
  }
  CODE
  {
    VAR
      rPar@1103355002 : Record 7010311;
      cFacCli@1103355000 : Codeunit 7010406;
      cFunFact@1103355003 : Codeunit 7010321;
      cFun@1103355001 : Codeunit 7010318;
      wUsaGestor@1103355004 : Boolean;
      wEstado@1103355005 : Integer;
      wColorTexto@1103355006 : Integer;
      Text005@1103355007 : TextConst 'ESP=CUENTA DE TTOO/PARTES FILTRADOS #1########\ADULTOS #2######\NI¥OS   #3######';
      wVentana@1103355008 : Dialog;

    PROCEDURE Estado_Facturacion@1(pNParte@1100244000 : Code[10];pNTTOO@1100244001 : Code[10]) : Integer;
    VAR
      lrCI@1100244002 : Record 7010414;
      lrPI@1103355001 : Record 7035392;
      lwHaySinPrefact@1100244003 : Boolean;
      lwHayPrefact@1100244004 : Boolean;
      lwHayFact@1103355000 : Boolean;
      lwResultado@1100244005 : Integer;
    BEGIN
      // Estado_Facturacion
      // Mira si para un parte y touroperador dado hay alguna linea facturada o prefacturada

      // Seg£n sea la linea de parte x Touroperador Devuelve:
      // 0 si no hay nada facturado ni prefacturado
      // 1 Si hay algo prefacturado
      // 2 Si esta todo prefacturado
      // 3 Si hay algo facturado  (Desactivado)
      // 4 Si est  todo facturado
      // El orden de prioridad es inverso al numerico

      CLEAR(lwHaySinPrefact);
      CLEAR(lwHayPrefact);
      CLEAR(lwHayFact);
      lwResultado   :=0;


      CLEAR(lrPI);
      lrPI.SETCURRENTKEY("N§ Parte", Touroperador, "Tipo linea", "Linea abono", "Tipo elemento");
      lrPI.SETRANGE("N§ Parte"     , pNParte);
      lrPI.SETRANGE(Touroperador   , pNTTOO);
      lrPI.SETFILTER("N§ Prefactura",'=%1', '');
      lwHaySinPrefact  := lrPI.FINDFIRST;
      lrPI.SETFILTER("N§ Prefactura",'<>%1', '');
      lwHayPrefact     := lrPI.FINDFIRST;

      lrCI.RESET;
      lrCI.SETCURRENTKEY("N§ Parte",
                         Touroperador,
                         "Tipo linea",
                         "Tipo elemento");
      lrCI.SETRANGE("N§ Parte"  , pNParte);
      lrCI.SETRANGE(Touroperador, pNTTOO);
      lwHayFact := lrCI.FINDFIRST;

      IF lwHayFact THEN BEGIN
        IF NOT (lwHaySinPrefact OR lwHayPrefact) THEN
          lwResultado := 4
        ELSE
          lwResultado := 3;
      END
      ELSE BEGIN
        IF lwHaySinPrefact THEN
          lwResultado := 1
        ELSE
          lwResultado := 2;
      END;

      EXIT(lwResultado);
    END;

    PROCEDURE FiltroGestor@1103350001();
    BEGIN
      // FiltroGestor
      // Define el comportamiento del filtro del campo Gestor en Virtud de la variable

      FILTERGROUP(2);
      IF wUsaGestor THEN
        SETFILTER(Gestor,'%1|%2',USERID,'')
      ELSE
        SETRANGE(Gestor);
      FILTERGROUP(0);
    END;

    BEGIN
    END.
  }
}
