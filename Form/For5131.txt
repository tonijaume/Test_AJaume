OBJECT Form 5131 Opportunities
{
  OBJECT-PROPERTIES
  {
    Date=05/11/08;
    Time=12:00:00;
    Version List=NAVW16.00;
  }
  PROPERTIES
  {
    Width=16500;
    Height=10670;
    CaptionML=[ENU=Opportunities;
               ESP=Oportunidades];
    SaveValues=Yes;
    InsertAllowed=No;
    DeleteAllowed=No;
    ModifyAllowed=No;
    TableBoxID=77;
    LinksAllowed=No;
    SourceTable=Table5102;
    DataCaptionExpr=FORMAT(SELECTSTR(OutPutOption+1,Text002));
    OnOpenForm=BEGIN
                 CurrForm."Sales Cycle Stage Filter".ENABLED(GETFILTER("Sales Cycle Filter") <> '');
                 CurrForm."Close Opportunity Filter".ENABLED(OptionStatusFilter <> OptionStatusFilter::"In Progress");
                 ValidateStatus;
                 ValidateFilter;
               END;

    OnFindRecord=BEGIN
                   EXIT(FindRec(TableOption,Rec,Which));
                 END;

    OnNextRecord=BEGIN
                   EXIT(NextRec(TableOption,Rec,Steps));
                 END;

  }
  CONTROLS
  {
    { 76  ;CommandButton;14080;9900 ;2200 ;550  ;HorzGlue=Right;
                                                 VertGlue=Bottom;
                                                 PushAction=FormHelp }
    { 77  ;MatrixBox    ;220  ;4180 ;16060;5500 ;Name=Matrix;
                                                 HorzGlue=Both;
                                                 VertGlue=Both;
                                                 MatrixColumnWidth=1980;
                                                 MatrixSourceTable=Table2000000007;
                                                 OnFindRecord=BEGIN
                                                                EXIT(PeriodFormMgt.FindDate(Which,CurrForm.Matrix.MatrixRec,PeriodType));
                                                              END;

                                                 OnNextRecord=BEGIN
                                                                EXIT(PeriodFormMgt.NextDate(Steps,CurrForm.Matrix.MatrixRec,PeriodType));
                                                              END;

                                                 OnAfterGetRecord=BEGIN
                                                                    SetDateFilter;
                                                                    CASE OutPutOption OF
                                                                      OutPutOption::"No of Opportunities":
                                                                        CALCFIELDS("No. of Opportunities");
                                                                      OutPutOption::"Estimated Value (LCY)":
                                                                        CALCFIELDS("Estimated Value (LCY)");
                                                                      OutPutOption::"Calc. Current Value (LCY)":
                                                                        CALCFIELDS("Calcd. Current Value (LCY)");
                                                                      OutPutOption::"Avg. Estimated Value (LCY)":
                                                                        CALCFIELDS("Avg. Estimated Value (LCY)");
                                                                      OutPutOption::"Avg. Calc. Current Value (LCY)":
                                                                        CALCFIELDS("Avg.Calcd. Current Value (LCY)");
                                                                    END;
                                                                  END;
                                                                   }
    { 2   ;TextBox      ;0    ;4290 ;1703 ;440  ;Editable=No;
                                                 ParentControl=77;
                                                 InColumn=Yes;
                                                 SourceExpr="No.";
                                                 OnFormat=BEGIN
                                                            CurrForm."No.".UPDATEFONTBOLD(Type = Type::Company);
                                                          END;

                                                 OnLookup=VAR
                                                            Campaign@1002 : Record 5071;
                                                            SalesPurchPerson@1003 : Record 13;
                                                            Contact@1004 : Record 5050;
                                                          BEGIN
                                                            CASE TableOption OF
                                                              TableOption::SalesPerson:
                                                                BEGIN
                                                                  SalesPurchPerson.GET("No.");
                                                                  FORM.RUNMODAL(0,SalesPurchPerson);
                                                                END;
                                                              TableOption::Campaign:
                                                                BEGIN
                                                                  Campaign.GET("No.");
                                                                  FORM.RUNMODAL(0,Campaign);
                                                                END;
                                                              TableOption::Contact:
                                                                BEGIN
                                                                  Contact.GET("No.");
                                                                  FORM.RUNMODAL(0,Contact);
                                                                END;
                                                            END;
                                                          END;
                                                           }
    { 3   ;Label        ;0    ;0    ;0    ;0    ;ParentControl=2;
                                                 InColumnHeading=Yes }
    { 4   ;TextBox      ;1640 ;4840 ;2640 ;440  ;HorzGlue=Both;
                                                 Editable=No;
                                                 ParentControl=77;
                                                 InColumn=Yes;
                                                 SourceExpr=Name;
                                                 OnFormat=BEGIN
                                                            CurrForm.Name.UPDATEFONTBOLD(Type = Type::Company);
                                                            IF (Type = Type::Person) AND (TableOption = TableOption::Contact) THEN
                                                              CurrForm.Name.UPDATEINDENT(220);
                                                          END;
                                                           }
    { 5   ;Label        ;0    ;0    ;0    ;0    ;ParentControl=4;
                                                 InColumnHeading=Yes }
    { 84  ;TextBox      ;7056 ;1210 ;10670;440  ;Name=MatrixValue;
                                                 ParentControl=77;
                                                 InMatrix=Yes;
                                                 BlankZero=Yes;
                                                 SourceExpr=ReturnOutput;
                                                 OnActivate=BEGIN
                                                              SetDateFilter;
                                                            END;

                                                 OnFormat=BEGIN
                                                            FormatAmount(Text);
                                                            CurrForm.MatrixValue.UPDATEFONTBOLD(Type = Type::Company);
                                                          END;

                                                 OnDrillDown=VAR
                                                               OppEntry@1001 : Record 5093;
                                                               Opp@1002 : Record 5092;
                                                               TempOpp@1003 : TEMPORARY Record 5092;
                                                             BEGIN
                                                               OppEntry.SETCURRENTKEY(Active,"Salesperson Code","Estimated Close Date",
                                                                                              "Action Taken","Sales Cycle Code","Sales Cycle Stage",
                                                                                              "Completed %","Probability %","Contact No.","Contact Company No.",
                                                                                              "Campaign No.","Chances of Success %","Estimated Value (LCY)",
                                                                                              "Calcd. Current Value (LCY)","Close Opportunity Code");

                                                               OppEntry.SETRANGE(Active,TRUE);
                                                               IF GETFILTER("Salesperson Filter") <> '' THEN
                                                                 OppEntry.SETFILTER("Salesperson Code","No.");

                                                               IF GETFILTER("Campaign Filter") <> '' THEN
                                                                 OppEntry.SETFILTER("Campaign No.","No.");

                                                               IF GETFILTER("Contact Filter") <> '' THEN
                                                                 OppEntry.SETFILTER("Contact No.","No.");

                                                               IF GETFILTER("Contact Company Filter") <> '' THEN
                                                                 OppEntry.SETFILTER("Contact Company No.","Company No.");

                                                               IF GETFILTER("Date Filter") <> '' THEN
                                                                 OppEntry.SETFILTER("Estimated Close Date",GETFILTER("Date Filter"));

                                                               IF GETFILTER("Sales Cycle Filter") <> '' THEN
                                                                 OppEntry.SETFILTER("Sales Cycle Code",GETFILTER("Sales Cycle Filter"));

                                                               IF GETFILTER("Sales Cycle Stage Filter") <> '' THEN
                                                                 OppEntry.SETFILTER("Sales Cycle Stage",GETFILTER("Sales Cycle Stage Filter"));

                                                               IF GETFILTER("Action Taken Filter") <> '' THEN
                                                                 OppEntry.SETFILTER("Action Taken",GETFILTER("Action Taken Filter"));

                                                               IF GETFILTER("Probability % Filter") <> '' THEN
                                                                 OppEntry.SETFILTER("Probability %",GETFILTER("Probability % Filter"));

                                                               IF GETFILTER("Completed % Filter") <> '' THEN
                                                                 OppEntry.SETFILTER("Completed %",GETFILTER("Completed % Filter"));

                                                               IF GETFILTER("Close Opportunity Filter") <> '' THEN
                                                                 OppEntry.SETFILTER("Close Opportunity Code",GETFILTER("Close Opportunity Filter"));

                                                               IF GETFILTER("Chances of Success % Filter") <> '' THEN
                                                                 OppEntry.SETFILTER("Chances of Success %",GETFILTER("Chances of Success % Filter"));

                                                               IF GETFILTER("Estimated Value Filter") <> '' THEN
                                                                 OppEntry.SETFILTER("Estimated Value (LCY)",GETFILTER("Estimated Value Filter"));

                                                               IF GETFILTER("Calcd. Current Value Filter") <> '' THEN
                                                                 OppEntry.SETFILTER("Calcd. Current Value (LCY)",GETFILTER("Calcd. Current Value Filter"));

                                                               IF OppEntry.FIND('-') THEN BEGIN
                                                                 REPEAT
                                                                   Opp.GET(OppEntry."Opportunity No.");
                                                                   TempOpp := Opp;
                                                                   TempOpp.INSERT;
                                                                 UNTIL OppEntry.NEXT = 0;
                                                               END;

                                                               FORM.RUN(FORM::"Active Opportunity List",TempOpp);
                                                             END;
                                                              }
    { 1   ;TextBox      ;9900 ;440  ;1650 ;440  ;ParentControl=84;
                                                 InMatrixHeading=Yes;
                                                 CaptionML=[ENU=Period Name;
                                                            ESP=Nombre periodo];
                                                 SourceExpr=PeriodFormMgt.CreatePeriodFormat(PeriodType,CurrForm.Matrix.MatrixRec."Period Start") }
    { 8   ;OptionButton ;2970 ;9900 ;550  ;550  ;VertGlue=Bottom;
                                                 FocusOnClick=No;
                                                 ShowCaption=No;
                                                 Border=Yes;
                                                 BitmapPos=Center;
                                                 Bitmap=14;
                                                 ToolTipML=[ENU=Accounting Period;
                                                            ESP=Periodo contable];
                                                 SourceExpr=PeriodType;
                                                 OptionValue=Accounting Period }
    { 9   ;OptionButton ;2420 ;9900 ;550  ;550  ;VertGlue=Bottom;
                                                 FocusOnClick=No;
                                                 ShowCaption=No;
                                                 Border=Yes;
                                                 BitmapPos=Center;
                                                 Bitmap=13;
                                                 ToolTipML=[ENU=Year;
                                                            ESP=A¤o];
                                                 SourceExpr=PeriodType;
                                                 OptionValue=Year }
    { 10  ;OptionButton ;1870 ;9900 ;550  ;550  ;VertGlue=Bottom;
                                                 FocusOnClick=No;
                                                 ShowCaption=No;
                                                 Border=Yes;
                                                 BitmapPos=Center;
                                                 Bitmap=12;
                                                 ToolTipML=[ENU=Quarter;
                                                            ESP=Trimestre];
                                                 SourceExpr=PeriodType;
                                                 OptionValue=Quarter }
    { 11  ;OptionButton ;1320 ;9900 ;550  ;550  ;VertGlue=Bottom;
                                                 FocusOnClick=No;
                                                 ShowCaption=No;
                                                 Border=Yes;
                                                 BitmapPos=Center;
                                                 Bitmap=11;
                                                 ToolTipML=[ENU=Month;
                                                            ESP=Mes];
                                                 SourceExpr=PeriodType;
                                                 OptionValue=Month }
    { 12  ;OptionButton ;770  ;9900 ;550  ;550  ;VertGlue=Bottom;
                                                 FocusOnClick=No;
                                                 ShowCaption=No;
                                                 Border=Yes;
                                                 BitmapPos=Center;
                                                 Bitmap=10;
                                                 ToolTipML=[ENU=Week;
                                                            ESP=Semana];
                                                 SourceExpr=PeriodType;
                                                 OptionValue=Week }
    { 15  ;OptionButton ;220  ;9900 ;550  ;550  ;VertGlue=Bottom;
                                                 FocusOnClick=No;
                                                 ShowCaption=No;
                                                 Border=Yes;
                                                 BitmapPos=Center;
                                                 Bitmap=9;
                                                 ToolTipML=[ENU=Day;
                                                            ESP=D¡a];
                                                 SourceExpr=PeriodType;
                                                 OptionValue=Day }
    { 6   ;TabControl   ;220  ;220  ;16060;3740 ;HorzGlue=Both;
                                                 VertGlue=Top;
                                                 PageNamesML=[ENU=General,Filters;
                                                              ESP=General,Filtros] }
    { 23  ;TextBox      ;3850 ;2090 ;2750 ;440  ;ParentControl=6;
                                                 InPage=0;
                                                 CaptionML=[ENU=Rounding Factor;
                                                            ESP=Factor redondeo];
                                                 OptionCaptionML=[ENU=None,1,1000,1000000;
                                                                  ESP=No,1,1000,1000000];
                                                 SourceExpr=RoundingFactor }
    { 24  ;Label        ;440  ;2090 ;3300 ;440  ;ParentControl=23 }
    { 25  ;TextBox      ;3850 ;1540 ;2750 ;440  ;ParentControl=6;
                                                 InPage=0;
                                                 CaptionML=[ENU=Show;
                                                            ESP=Muestra];
                                                 OptionCaptionML=[ENU=No of Opportunities,Estimated Value (LCY),Calc. Current Value (LCY),Avg. Estimated Value (LCY),Avg. Calc. Current Value (LCY);
                                                                  ESP=N§ de oportunidades,Valor estimado (DL),Valor actual calc. (DL),Valor estim. medio (DL),Valor actual calc. medio (DL)];
                                                 SourceExpr=OutPutOption }
    { 26  ;Label        ;440  ;1540 ;3300 ;440  ;ParentControl=25 }
    { 30  ;TextBox      ;3850 ;990  ;2750 ;440  ;ParentControl=6;
                                                 InPage=0;
                                                 CaptionML=[ENU=Show as Lines;
                                                            ESP=Muestra como l¡neas];
                                                 OptionCaptionML=[ENU=Salesperson,Campaign,Contact;
                                                                  ESP=Vendedor,Campa¤a,Contacto];
                                                 SourceExpr=TableOption;
                                                 OnAfterValidate=BEGIN
                                                                   ValidateFilter;
                                                                 END;
                                                                  }
    { 31  ;Label        ;440  ;990  ;3300 ;440  ;ParentControl=30 }
    { 7   ;TextBox      ;3850 ;990  ;2750 ;440  ;ParentControl=6;
                                                 InPage=1;
                                                 CaptionML=[ENU=Status Filter;
                                                            ESP=Filtro estado];
                                                 OptionCaptionML=[ENU=In Progress,Won,Lost;
                                                                  ESP=En progreso,Ganada,Perdida];
                                                 SourceExpr=OptionStatusFilter;
                                                 OnAfterValidate=BEGIN
                                                                   SETRANGE("Close Opportunity Filter");
                                                                   CurrForm."Close Opportunity Filter".ENABLED(OptionStatusFilter <> OptionStatusFilter::"In Progress");
                                                                   ValidateStatus;
                                                                   ValidateFilter;
                                                                 END;
                                                                  }
    { 13  ;Label        ;440  ;990  ;3300 ;440  ;ParentControl=7 }
    { 14  ;TextBox      ;3850 ;2750 ;2750 ;440  ;ParentControl=6;
                                                 InPage=1;
                                                 SourceExpr="Probability % Filter";
                                                 OnAfterValidate=BEGIN
                                                                   ValidateFilter;
                                                                 END;
                                                                  }
    { 16  ;Label        ;440  ;2750 ;3300 ;440  ;ParentControl=14 }
    { 17  ;TextBox      ;3850 ;3300 ;2750 ;440  ;ParentControl=6;
                                                 InPage=1;
                                                 SourceExpr="Completed % Filter";
                                                 OnAfterValidate=BEGIN
                                                                   ValidateFilter;
                                                                 END;
                                                                  }
    { 18  ;Label        ;440  ;3300 ;3300 ;440  ;ParentControl=17 }
    { 19  ;TextBox      ;12980;2090 ;2750 ;440  ;ParentControl=6;
                                                 InPage=1;
                                                 SourceExpr="Sales Cycle Filter";
                                                 OnAfterValidate=BEGIN
                                                                   SETRANGE("Sales Cycle Stage Filter");
                                                                   ValidateFilter;
                                                                   CurrForm."Sales Cycle Stage Filter".ENABLED(GETFILTER("Sales Cycle Filter") <> '');
                                                                 END;
                                                                  }
    { 20  ;Label        ;9570 ;2090 ;3300 ;440  ;ParentControl=19 }
    { 21  ;TextBox      ;12980;2640 ;1650 ;440  ;Name=Sales Cycle Stage Filter;
                                                 ParentControl=6;
                                                 InPage=1;
                                                 SourceExpr="Sales Cycle Stage Filter";
                                                 OnAfterValidate=BEGIN
                                                                   ValidateFilter;
                                                                 END;
                                                                  }
    { 22  ;Label        ;9570 ;2640 ;3300 ;440  ;ParentControl=21 }
    { 27  ;TextBox      ;3850 ;2200 ;2750 ;440  ;ParentControl=6;
                                                 InPage=1;
                                                 SourceExpr="Chances of Success % Filter";
                                                 OnAfterValidate=BEGIN
                                                                   ValidateFilter;
                                                                 END;
                                                                  }
    { 28  ;Label        ;440  ;2200 ;3300 ;440  ;ParentControl=27 }
    { 29  ;TextBox      ;12980;990  ;2750 ;440  ;ParentControl=6;
                                                 InPage=1;
                                                 SourceExpr="Estimated Value Filter";
                                                 OnAfterValidate=BEGIN
                                                                   ValidateFilter;
                                                                 END;
                                                                  }
    { 32  ;Label        ;9570 ;990  ;3300 ;440  ;ParentControl=29 }
    { 33  ;TextBox      ;12980;1540 ;2750 ;440  ;ParentControl=6;
                                                 InPage=1;
                                                 SourceExpr="Calcd. Current Value Filter";
                                                 OnAfterValidate=BEGIN
                                                                   ValidateFilter;
                                                                 END;
                                                                  }
    { 34  ;Label        ;9570 ;1540 ;3300 ;440  ;ParentControl=33 }
    { 35  ;TextBox      ;3850 ;1540 ;2750 ;440  ;ParentControl=6;
                                                 InPage=1;
                                                 SourceExpr="Close Opportunity Filter";
                                                 OnLookup=VAR
                                                            CloseOpportunityCode@1000 : Record 5094;
                                                          BEGIN
                                                            CASE OptionStatusFilter OF
                                                              OptionStatusFilter::Won: CloseOpportunityCode.SETRANGE(Type,CloseOpportunityCode.Type::Won);
                                                              OptionStatusFilter::Lost: CloseOpportunityCode.SETRANGE(Type,CloseOpportunityCode.Type::Lost);
                                                            ELSE
                                                              EXIT;
                                                            END;

                                                            IF FORM.RUNMODAL(0,CloseOpportunityCode) = ACTION::LookupOK THEN BEGIN
                                                              Text := CloseOpportunityCode.Code;
                                                              EXIT(TRUE);
                                                            END;
                                                          END;

                                                 OnAfterValidate=BEGIN
                                                                   ValidateFilter;
                                                                 END;
                                                                  }
    { 36  ;Label        ;440  ;1540 ;3300 ;440  ;ParentControl=35 }
  }
  CODE
  {
    VAR
      Text000@1000 : TextConst 'ENU=<Sign><Integer>;ESP=<Sign><Integer>';
      Text001@1001 : TextConst 'ENU=<Sign><Integer Thousand><Decimals,2>;ESP=<Sign><Integer Thousand><Decimals,2>';
      Cont@1002 : Record 5050;
      "Salesperson/Purchaser"@1003 : Record 13;
      Campaign@1004 : Record 5071;
      PeriodFormMgt@1005 : Codeunit 359;
      PeriodType@1006 : 'Day,Week,Month,Quarter,Year,Accounting Period';
      OptionStatusFilter@1007 : 'In Progress,Won,Lost';
      OutPutOption@1008 : 'No of Opportunities,Estimated Value (LCY),Calc. Current Value (LCY),Avg. Estimated Value (LCY),Avg. Calc. Current Value (LCY)';
      RoundingFactor@1009 : 'None,1,1000,1000000';
      TableOption@1010 : 'SalesPerson,Campaign,Contact';
      Text002@1011 : TextConst 'ENU=No of Opportunities,Estimated Value (LCY),Calc. Current Value (LCY),Avg. Estimated Value (LCY),Avg. Calc. Current Value (LCY);ESP=N§ de oportunidades,Valor estimado (DL),Valor actual calc. (DL),Valor estim. medio (DL),Valor actual calc. medio (DL)';

    LOCAL PROCEDURE SetDateFilter@1();
    BEGIN
      IF CurrForm.Matrix.MatrixRec."Period Start" = CurrForm.Matrix.MatrixRec."Period End" THEN
        SETRANGE("Date Filter",CurrForm.Matrix.MatrixRec."Period Start")
      ELSE
        SETRANGE("Date Filter",CurrForm.Matrix.MatrixRec."Period Start",CurrForm.Matrix.MatrixRec."Period End");

      CASE TableOption OF
        TableOption::SalesPerson:
          SETRANGE("Salesperson Filter","No.");
        TableOption::Campaign:
          SETRANGE("Campaign Filter","No.");
        TableOption::Contact:
          BEGIN
            IF Type = Type::Company THEN BEGIN
              SETRANGE("Contact Filter");
              SETRANGE("Contact Company Filter","Company No.");
            END ELSE BEGIN
              SETRANGE("Contact Filter","No.");
              SETRANGE("Contact Company Filter","Company No.");
            END;
          END;
      END;
    END;

    LOCAL PROCEDURE ReturnOutput@2() : Decimal;
    BEGIN
      CASE OutPutOption OF
        OutPutOption::"No of Opportunities":
          EXIT("No. of Opportunities");
        OutPutOption::"Estimated Value (LCY)":
          EXIT("Estimated Value (LCY)");
        OutPutOption::"Calc. Current Value (LCY)":
          EXIT("Calcd. Current Value (LCY)");
        OutPutOption::"Avg. Estimated Value (LCY)":
          EXIT("Avg. Estimated Value (LCY)");
        OutPutOption::"Avg. Calc. Current Value (LCY)":
          EXIT("Avg.Calcd. Current Value (LCY)");
      END;
    END;

    LOCAL PROCEDURE FormatAmount@6(VAR Text@1000 : Text[250]);
    VAR
      Amount@1001 : Decimal;
    BEGIN
      IF Text <> '' THEN BEGIN
        EVALUATE(Amount,Text);
        IF OutPutOption = OutPutOption::"No of Opportunities" THEN
          Text := FORMAT(Amount,0,Text000);

        IF (RoundingFactor = RoundingFactor::None) THEN
          EXIT;
        CASE RoundingFactor OF
          RoundingFactor::"1":
            Amount := ROUND(Amount,1);
          RoundingFactor::"1000":
            Amount := ROUND(Amount / 1000,0.1);
          RoundingFactor::"1000000":
            Amount := ROUND(Amount / 1000000,0.1);
        END;

        IF Amount = 0 THEN
          Text := ''
        ELSE
          CASE RoundingFactor OF
            RoundingFactor::"1":
              Text := FORMAT(Amount);
            RoundingFactor::"1000",RoundingFactor::"1000000":
              Text := FORMAT(Amount,0,Text001);
          END;
      END;
    END;

    LOCAL PROCEDURE FindRec@59(TableOpt@1000 : 'Salesperson,Campaign,Contact';VAR RMMatrixMgt@1001 : Record 5102;Which@1002 : Text[250]) : Boolean;
    VAR
      Found@1003 : Boolean;
    BEGIN
      CASE TableOpt OF
        TableOpt::Salesperson:
          BEGIN
            RMMatrixMgt."No." := COPYSTR(RMMatrixMgt."No.",1,MAXSTRLEN("Salesperson/Purchaser".Code));
            "Salesperson/Purchaser".Code := RMMatrixMgt."No.";
            Found := "Salesperson/Purchaser".FIND(Which);
              IF Found THEN
                CopySalespersonToBuf("Salesperson/Purchaser",RMMatrixMgt);
          END;
        TableOpt::Campaign:
          BEGIN
            Campaign."No." := RMMatrixMgt."No.";
            Found := Campaign.FIND(Which);
              IF Found THEN
                CopyCampaignToBuf(Campaign,RMMatrixMgt);
          END;
        TableOpt::Contact:
          BEGIN
            Cont."Company Name" := RMMatrixMgt."Company Name";
            Cont.Type := RMMatrixMgt.Type;
            Cont.Name := RMMatrixMgt.Name;
            Cont."No." := RMMatrixMgt."No.";
            Cont."Company No." := RMMatrixMgt."Company No.";
            Found := Cont.FIND(Which);
              IF Found THEN
                CopyContactToBuf(Cont,RMMatrixMgt);
          END;
      END;

      EXIT(Found);
    END;

    LOCAL PROCEDURE NextRec@60(TableOpt@1000 : 'Salesperson,Campaign,Contact';VAR RMMatrixMgt@1001 : Record 5102;Steps@1002 : Integer) : Integer;
    VAR
      ResultSteps@1003 : Integer;
    BEGIN
      CASE TableOpt OF
        TableOpt::Salesperson:
          BEGIN
            RMMatrixMgt."No." := COPYSTR(RMMatrixMgt."No.",1,MAXSTRLEN("Salesperson/Purchaser".Code));
            "Salesperson/Purchaser".Code := RMMatrixMgt."No.";
            ResultSteps := "Salesperson/Purchaser".NEXT(Steps);
            IF ResultSteps <> 0 THEN
              CopySalespersonToBuf("Salesperson/Purchaser",RMMatrixMgt);
          END;
        TableOpt::Campaign:
          BEGIN
            Campaign."No." := RMMatrixMgt."No.";
            ResultSteps := Campaign.NEXT(Steps);
            IF ResultSteps <> 0 THEN
                CopyCampaignToBuf(Campaign,RMMatrixMgt);
          END;
        TableOpt::Contact:
          BEGIN
            Cont."Company Name" := RMMatrixMgt."Company Name";
            Cont.Type := RMMatrixMgt.Type;
            Cont.Name := RMMatrixMgt.Name;
            Cont."No." := RMMatrixMgt."No.";
            Cont."Company No." := RMMatrixMgt."Company No.";
            ResultSteps := Cont.NEXT(Steps);
            IF ResultSteps <> 0 THEN
                CopyContactToBuf(Cont,RMMatrixMgt);
          END;
      END;
      EXIT(ResultSteps);
    END;

    LOCAL PROCEDURE CopySalespersonToBuf@3(VAR SalesPurchPerson@1000 : Record 13;VAR RMMatrixMgt@1001 : Record 5102);
    BEGIN
      WITH RMMatrixMgt DO BEGIN
        INIT;
        "Company Name" := SalesPurchPerson.Code;
        Type := Type::Person;
        Name := SalesPurchPerson.Name;
        "No." := SalesPurchPerson.Code;
        "Company No." := '';
      END;
    END;

    LOCAL PROCEDURE CopyCampaignToBuf@4(VAR TheCampaign@1000 : Record 5071;VAR RMMatrixMgt@1001 : Record 5102);
    BEGIN
      WITH RMMatrixMgt DO BEGIN
        INIT;
        "Company Name" := TheCampaign."No.";
        Type := Type::Person;
        Name := TheCampaign.Description;
        "No." := TheCampaign."No.";
        "Company No." := '';
      END;
    END;

    LOCAL PROCEDURE CopyContactToBuf@5(VAR TheCont@1000 : Record 5050;VAR RMMatrixMgt@1001 : Record 5102);
    BEGIN
      WITH RMMatrixMgt DO BEGIN
        INIT;
        "Company Name" := TheCont."Company Name";
        Type := TheCont.Type;
        Name := TheCont.Name;
        "No." := TheCont."No.";
        "Company No." := TheCont."Company No.";
      END;
    END;

    LOCAL PROCEDURE ValidateStatus@9();
    BEGIN
      CASE OptionStatusFilter OF
        OptionStatusFilter::"In Progress":
          BEGIN
            SETRANGE("Action Taken Filter","Action Taken Filter"::" ","Action Taken Filter"::Jumped);
          END;
        OptionStatusFilter::Won:
          BEGIN
            SETRANGE("Action Taken Filter","Action Taken Filter"::Won);
          END;
        OptionStatusFilter::Lost:
          BEGIN
            SETRANGE("Action Taken Filter","Action Taken Filter"::Lost);
          END;
      END;
    END;

    LOCAL PROCEDURE ValidateFilter@7();
    BEGIN
      CASE TableOption OF
        TableOption::SalesPerson:
          BEGIN
            SETRANGE("Campaign Filter");
            SETRANGE("Contact Filter");
            SETRANGE("Contact Company Filter");
            UpdateSalespersonFilter;
          END;
        TableOption::Campaign:
          BEGIN
            SETRANGE("Salesperson Filter");
            SETRANGE("Contact Filter");
            SETRANGE("Contact Company Filter");
            UpdateCampaignFilter;
          END;
        TableOption::Contact:
          BEGIN
            SETRANGE("Salesperson Filter");
            SETRANGE("Campaign Filter");
            UpdateContactFilter;
          END;
      END;
      CurrForm.UPDATE(FALSE);
    END;

    LOCAL PROCEDURE UpdateSalespersonFilter@10();
    BEGIN
      "Salesperson/Purchaser".RESET;

      IF GETFILTER("Action Taken Filter") <> '' THEN
        "Salesperson/Purchaser".SETFILTER("Action Taken Filter",GETFILTER("Action Taken Filter"));

      IF GETFILTER("Sales Cycle Filter") <> '' THEN
        "Salesperson/Purchaser".SETFILTER("Sales Cycle Filter",GETFILTER("Sales Cycle Filter"));

      IF GETFILTER("Sales Cycle Stage Filter") <> '' THEN
        "Salesperson/Purchaser".SETFILTER("Sales Cycle Stage Filter",GETFILTER("Sales Cycle Stage Filter"));

      IF GETFILTER("Probability % Filter") <> '' THEN
        "Salesperson/Purchaser".SETFILTER("Probability % Filter",GETFILTER("Probability % Filter"));

      IF GETFILTER("Completed % Filter") <> '' THEN
        "Salesperson/Purchaser".SETFILTER("Completed % Filter",GETFILTER("Completed % Filter"));

      IF GETFILTER("Close Opportunity Filter") <> '' THEN
        "Salesperson/Purchaser".SETFILTER("Close Opportunity Filter",GETFILTER("Close Opportunity Filter"));

      IF GETFILTER("Contact Filter") <> '' THEN
        "Salesperson/Purchaser".SETFILTER("Contact Filter",GETFILTER("Contact Filter"));

      IF GETFILTER("Contact Company Filter") <> '' THEN
        "Salesperson/Purchaser".SETFILTER("Contact Company Filter",GETFILTER("Contact Company Filter"));

      IF GETFILTER("Campaign Filter") <> '' THEN
        "Salesperson/Purchaser".SETFILTER("Campaign Filter",GETFILTER("Campaign Filter"));

      IF GETFILTER("Estimated Value Filter") <> '' THEN
        "Salesperson/Purchaser".SETFILTER("Estimated Value Filter",GETFILTER("Estimated Value Filter"));

      IF GETFILTER("Calcd. Current Value Filter") <> '' THEN
        "Salesperson/Purchaser".SETFILTER("Calcd. Current Value Filter",GETFILTER("Calcd. Current Value Filter"));

      IF GETFILTER("Chances of Success % Filter") <> '' THEN
        "Salesperson/Purchaser".SETFILTER("Chances of Success % Filter",GETFILTER("Chances of Success % Filter"));

      "Salesperson/Purchaser".SETRANGE("Opportunity Entry Exists",TRUE);
    END;

    LOCAL PROCEDURE UpdateCampaignFilter@11();
    BEGIN
      Campaign.RESET;

      IF GETFILTER("Action Taken Filter") <> '' THEN
        Campaign.SETFILTER("Action Taken Filter",GETFILTER("Action Taken Filter"));

      IF GETFILTER("Sales Cycle Filter") <> '' THEN
        Campaign.SETFILTER("Sales Cycle Filter",GETFILTER("Sales Cycle Filter"));

      IF GETFILTER("Sales Cycle Stage Filter") <> '' THEN
        Campaign.SETFILTER("Sales Cycle Stage Filter",GETFILTER("Sales Cycle Stage Filter"));

      IF GETFILTER("Probability % Filter") <> '' THEN
        Campaign.SETFILTER("Probability % Filter",GETFILTER("Probability % Filter"));

      IF GETFILTER("Completed % Filter") <> '' THEN
        Campaign.SETFILTER("Completed % Filter",GETFILTER("Completed % Filter"));

      IF GETFILTER("Close Opportunity Filter") <> '' THEN
        Campaign.SETFILTER("Close Opportunity Filter",GETFILTER("Close Opportunity Filter"));

      IF GETFILTER("Contact Filter") <> '' THEN
        Campaign.SETFILTER("Contact Filter",GETFILTER("Contact Filter"));

      IF GETFILTER("Contact Company Filter") <> '' THEN
        Campaign.SETFILTER("Contact Company Filter",GETFILTER("Contact Company Filter"));

      IF GETFILTER("Estimated Value Filter") <> '' THEN
        Campaign.SETFILTER("Estimated Value Filter",GETFILTER("Estimated Value Filter"));

      IF GETFILTER("Salesperson Filter") <> '' THEN
        Campaign.SETFILTER("Salesperson Filter",GETFILTER("Salesperson Filter"));

      IF GETFILTER("Calcd. Current Value Filter") <> '' THEN
        Campaign.SETFILTER("Calcd. Current Value Filter",GETFILTER("Calcd. Current Value Filter"));

      IF GETFILTER("Chances of Success % Filter") <> '' THEN
        Campaign.SETFILTER("Chances of Success % Filter",GETFILTER("Chances of Success % Filter"));

      Campaign.SETRANGE("Opportunity Entry Exists",TRUE);
    END;

    LOCAL PROCEDURE UpdateContactFilter@12();
    BEGIN
      Cont.RESET;
      Cont.SETCURRENTKEY("Company Name","Company No.",Type,Name);

      IF GETFILTER("Action Taken Filter") <> '' THEN
        Cont.SETFILTER("Action Taken Filter",GETFILTER("Action Taken Filter"));

      IF GETFILTER("Sales Cycle Filter") <> '' THEN
        Cont.SETFILTER("Sales Cycle Filter",GETFILTER("Sales Cycle Filter"));

      IF GETFILTER("Sales Cycle Stage Filter") <> '' THEN
        Cont.SETFILTER("Sales Cycle Stage Filter",GETFILTER("Sales Cycle Stage Filter"));

      IF GETFILTER("Probability % Filter") <> '' THEN
        Cont.SETFILTER("Probability % Filter",GETFILTER("Probability % Filter"));

      IF GETFILTER("Completed % Filter") <> '' THEN
        Cont.SETFILTER("Completed % Filter",GETFILTER("Completed % Filter"));

      IF GETFILTER("Close Opportunity Filter") <> '' THEN
        Cont.SETFILTER("Close Opportunity Filter",GETFILTER("Close Opportunity Filter"));

      IF GETFILTER("Estimated Value Filter") <> '' THEN
        Cont.SETFILTER("Estimated Value Filter",GETFILTER("Estimated Value Filter"));

      IF GETFILTER("Salesperson Filter") <> '' THEN
        Cont.SETFILTER("Salesperson Filter",GETFILTER("Salesperson Filter"));

      IF GETFILTER("Calcd. Current Value Filter") <> '' THEN
        Cont.SETFILTER("Calcd. Current Value Filter",GETFILTER("Calcd. Current Value Filter"));

      IF GETFILTER("Chances of Success % Filter") <> '' THEN
        Cont.SETFILTER("Chances of Success % Filter",GETFILTER("Chances of Success % Filter"));

      IF GETFILTER("Campaign Filter") <> '' THEN
        Cont.SETFILTER("Campaign Filter",GETFILTER("Campaign Filter"));

      Cont.SETRANGE("Opportunity Entry Exists",TRUE);
    END;

    BEGIN
    END.
  }
}
