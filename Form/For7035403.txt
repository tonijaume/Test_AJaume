OBJECT Form 7035403 Consulta reservas shuttle
{
  OBJECT-PROPERTIES
  {
    Date=18/05/15;
    Time=15:56:14;
    Modified=Yes;
    Version List=TRANSFER;
  }
  PROPERTIES
  {
    Width=23100;
    Height=12870;
    CaptionML=ESP=Consulta reservas shuttle;
    InsertAllowed=No;
    DeleteAllowed=No;
    TableBoxID=1103355000;
    SourceTable=Table7010359;
    UpdateOnActivate=Yes;
    TimerInterval=300000;
    OnOpenForm=VAR
                 ldtLimiteInferior@1103355000 : DateTime;
                 ldtLimiteSuperior@1103355001 : DateTime;
               BEGIN

                 cuFShuttle.LimpiarMarcas;
                 rPar.FINDFIRST;

                 // JPT 02/02/10 Pasamos los Datetime a Biginteger
                 // SETCURRENTKEY("FechaHora Parte", "FechaHora Vuelo");
                 SETCURRENTKEY("FechaHora Parte BI", "FechaHora Vuelo BI");
                 FILTERGROUP(2);

                 SETRANGE ("Origen creacion", "Origen creacion"::Shuttle);
                 SETRANGE ("Codigo Servicio", rPar."Codigo Entradas");

                 FILTERGROUP(0);

                 ldtLimiteInferior := CURRENTDATETIME - (12 * 60 * 60000); // -12 Horas.
                 ldtLimiteSuperior := CURRENTDATETIME + (24 * 60 * 60000); // +24 Horas.

                 // SETRANGE("FechaHora Vuelo", ldtLimiteInferior, ldtLimiteSuperior);
                 SETRANGE("FechaHora Vuelo BI", cFunBas.DTtoBIGINT(ldtLimiteInferior), cFunBas.DTtoBIGINT(ldtLimiteSuperior));

                 // Filtramos los vuelos para colorear.
                 // JPT 02/02/10 Datetime a Biginteger
                 rVuelos.RESET;
                 // rVuelos.SETCURRENTKEY ("FechaHora Vuelo");
                 // rVuelos.SETRANGE      ("FechaHora Vuelo", ldtLimiteInferior, ldtLimiteSuperior);
                 rVuelos.SETCURRENTKEY ("FechaHora Vuelo BI");
                 rVuelos.SETRANGE ("FechaHora Vuelo BI", cFunBas.DTtoBIGINT(ldtLimiteInferior), cFunBas.DTtoBIGINT(ldtLimiteSuperior));

                 //rVuelos.SETRANGE      ("N§Parte", );
               END;

    OnAfterGetRecord=BEGIN
                       // AJS 14.04.2008
                       // Filtramos por el numero de parte especial de shuttle

                       // JPT 02/02/10 Aseguramos el valor de "FechaHora Vuelo"
                       VALIDATE("FechaHora Vuelo BI");
                       wParteShuttle := Text50000 + FORMAT("FechaHora Vuelo", 0, Text50001);

                       rVuelos.SETRANGE("N§Parte"         , wParteShuttle);

                       rVuelos.SETRANGE("Referencia Vuelo"   , PADSTR(Vuelo,10));

                       // AJS 27.03.2008
                       // Trabajamos con la parte fecha del campo "FechaHora vuelo"
                       //rVuelos.SETRANGE("Fecha Llegada Vuelo", Fecha);

                       rVuelos.SETRANGE("Fecha Llegada Vuelo", DT2DATE("FechaHora Vuelo"));
                       bVueloEncontrado := rVuelos.FINDFIRST;

                       wMarca := (Marca = UPPERCASE(USERID));
                     END;

    OnAfterGetCurrRecord=BEGIN
                           // AJS 14.04.2008
                           // En este disparador no necesitamos este codigo

                           //rVuelos.SETRANGE("Referencia Vuelo", PADSTR(Vuelo,10));

                           // AJS 27.03.2008
                           // Trabajamos con la parte fecha del campo "FechaHora vuelo"
                           //rVuelos.SETRANGE("Fecha Llegada Vuelo", Fecha);

                           //rVuelos.SETRANGE("Fecha Llegada Vuelo", DT2DATE("FechaHora Vuelo"));
                           //bVueloEncontrado := rVuelos.FINDFIRST;
                         END;

    OnTimer=BEGIN
              CurrForm.UPDATE;
            END;

  }
  CONTROLS
  {
    { 1103355000;TableBox;220 ;1870 ;22660;10010;Name=Grid;
                                                 HorzGlue=Both;
                                                 VertGlue=Both;
                                                 Editable=Yes;
                                                 HeadingHeight=880 }
    { 1103355068;CheckBox;0   ;2530 ;660  ;440  ;ParentControl=1103355000;
                                                 InColumn=Yes;
                                                 ShowCaption=No;
                                                 CaptionML=ESP=X;
                                                 SourceExpr=wMarca;
                                                 OnPush=BEGIN


                                                          IF (Marca <> UPPERCASE(USERID)) AND (Marca <> '') THEN BEGIN
                                                            wMarca := FALSE;
                                                            ERROR(Text0003);
                                                          END;

                                                          IF Marca = '' THEN BEGIN
                                                            wMarca := TRUE;
                                                            Marca := USERID;
                                                          END
                                                          ELSE BEGIN
                                                            IF Marca = UPPERCASE(USERID) THEN BEGIN
                                                              wMarca := FALSE;
                                                              Marca := '';
                                                            END;
                                                          END;

                                                          MODIFY;
                                                        END;
                                                         }
    { 1103355069;Label  ;0    ;0    ;0    ;0    ;ParentControl=1103355068;
                                                 InColumnHeading=Yes;
                                                 HorzAlign=Center }
    { 1103355070;TextBox;1006 ;2420 ;1100 ;440  ;Editable=No;
                                                 ParentControl=1103355000;
                                                 InColumn=Yes;
                                                 SourceExpr=Marca }
    { 1103355071;Label  ;0    ;0    ;0    ;0    ;ParentControl=1103355070;
                                                 InColumnHeading=Yes }
    { 1103355029;TextBox;0    ;0    ;2253 ;0    ;Editable=No;
                                                 ParentControl=1103355000;
                                                 InColumn=Yes;
                                                 ForeColor=0;
                                                 BackColor=16777215;
                                                 BackTransparent=No;
                                                 SourceExpr="N§ Parte";
                                                 OnFormat=BEGIN
                                                            IF Confirmada THEN BEGIN

                                                               CurrForm."N§ Parte".UPDATEFORECOLOR(16711680);

                                                            END
                                                            ELSE BEGIN

                                                              IF bVueloEncontrado THEN BEGIN
                                                                CASE rVuelos.Estado OF
                                                                  rVuelos.Estado::Normal :
                                                                    CurrForm."N§ Parte".UPDATEFORECOLOR(0);
                                                                  rVuelos.Estado::Retrasado :
                                                                    CurrForm."N§ Parte".UPDATEFORECOLOR(255);
                                                                  rVuelos.Estado::Confirmado :
                                                                    CurrForm."N§ Parte".UPDATEFORECOLOR(32768);
                                                                END;
                                                              END;

                                                            END;
                                                          END;
                                                           }
    { 1103355030;Label  ;0    ;0    ;0    ;0    ;ParentControl=1103355029;
                                                 InColumnHeading=Yes }
    { 1103355005;TextBox;0    ;0    ;2210 ;0    ;Name=Punto recogida;
                                                 ParentControl=1103355000;
                                                 InColumn=Yes;
                                                 SourceExpr="Punto recogida";
                                                 OnFormat=BEGIN
                                                            IF Confirmada THEN BEGIN

                                                               CurrForm."Punto recogida".UPDATEFORECOLOR(16711680);

                                                            END
                                                            ELSE BEGIN

                                                              IF bVueloEncontrado THEN BEGIN
                                                                CASE rVuelos.Estado OF
                                                                  rVuelos.Estado::Normal :
                                                                    CurrForm."Punto recogida".UPDATEFORECOLOR(0);
                                                                  rVuelos.Estado::Retrasado :
                                                                    CurrForm."Punto recogida".UPDATEFORECOLOR(255);
                                                                  rVuelos.Estado::Confirmado :
                                                                    CurrForm."Punto recogida".UPDATEFORECOLOR(32768);
                                                                END;
                                                              END;
                                                            END;
                                                          END;
                                                           }
    { 1103355006;Label  ;0    ;0    ;0    ;0    ;ParentControl=1103355005;
                                                 InColumnHeading=Yes }
    { 1103355042;TextBox;3334 ;2310 ;1430 ;880  ;ParentControl=1103355000;
                                                 InColumn=Yes;
                                                 SourceExpr="Codigo Servicio" }
    { 1103355053;Label  ;0    ;0    ;0    ;0    ;ParentControl=1103355042;
                                                 InColumnHeading=Yes }
    { 1103355011;TextBox;3677 ;0    ;1430 ;0    ;Editable=No;
                                                 ParentControl=1103355000;
                                                 InColumn=Yes;
                                                 SourceExpr="Adultos transportados";
                                                 OnFormat=BEGIN

                                                            IF Confirmada THEN BEGIN

                                                               CurrForm."Adultos transportados".UPDATEFORECOLOR(16711680);

                                                            END
                                                            ELSE BEGIN

                                                              IF bVueloEncontrado THEN BEGIN
                                                                CASE rVuelos.Estado OF
                                                                  rVuelos.Estado::Normal :
                                                                    CurrForm."Adultos transportados".UPDATEFORECOLOR(0);
                                                                  rVuelos.Estado::Retrasado :
                                                                    CurrForm."Adultos transportados".UPDATEFORECOLOR(255);
                                                                  rVuelos.Estado::Confirmado :
                                                                    CurrForm."Adultos transportados".UPDATEFORECOLOR(32768);
                                                                END;
                                                              END;
                                                            END;
                                                          END;
                                                           }
    { 1103355012;Label  ;0    ;0    ;0    ;0    ;ParentControl=1103355011;
                                                 InColumnHeading=Yes }
    { 1103355015;TextBox;0    ;0    ;1547 ;0    ;Editable=No;
                                                 ParentControl=1103355000;
                                                 InColumn=Yes;
                                                 SourceExpr="Ni¤os transportados";
                                                 OnFormat=BEGIN

                                                            IF Confirmada THEN BEGIN

                                                               CurrForm."Ni¤os transportados".UPDATEFORECOLOR(16711680);

                                                            END
                                                            ELSE BEGIN

                                                              IF bVueloEncontrado THEN BEGIN
                                                                CASE rVuelos.Estado OF
                                                                  rVuelos.Estado::Normal :
                                                                    CurrForm."Ni¤os transportados".UPDATEFORECOLOR(0);
                                                                  rVuelos.Estado::Retrasado :
                                                                    CurrForm."Ni¤os transportados".UPDATEFORECOLOR(255);
                                                                  rVuelos.Estado::Confirmado :
                                                                    CurrForm."Ni¤os transportados".UPDATEFORECOLOR(32768);
                                                                END;
                                                              END;
                                                            END;
                                                          END;
                                                           }
    { 1103355016;Label  ;0    ;0    ;0    ;0    ;ParentControl=1103355015;
                                                 InColumnHeading=Yes }
    { 1103355013;TextBox;0    ;0    ;2302 ;0    ;Editable=No;
                                                 ParentControl=1103355000;
                                                 InColumn=Yes;
                                                 Lookup=No;
                                                 SourceExpr=Touroperador;
                                                 OnFormat=BEGIN

                                                            IF Confirmada THEN BEGIN

                                                               CurrForm.Touroperador.UPDATEFORECOLOR(16711680);

                                                            END
                                                            ELSE BEGIN

                                                              IF bVueloEncontrado THEN BEGIN
                                                                CASE rVuelos.Estado OF
                                                                  rVuelos.Estado::Normal :
                                                                    CurrForm.Touroperador.UPDATEFORECOLOR(0);
                                                                  rVuelos.Estado::Retrasado :
                                                                    CurrForm.Touroperador.UPDATEFORECOLOR(255);
                                                                  rVuelos.Estado::Confirmado :
                                                                    CurrForm.Touroperador.UPDATEFORECOLOR(32768);
                                                                END;
                                                              END;
                                                            END;
                                                          END;
                                                           }
    { 1103355014;Label  ;0    ;0    ;0    ;0    ;ParentControl=1103355013;
                                                 InColumnHeading=Yes }
    { 1103355019;TextBox;9366 ;2310 ;2085 ;440  ;Editable=No;
                                                 ParentControl=1103355000;
                                                 InColumn=Yes;
                                                 SourceExpr="Zona Trabajo";
                                                 OnFormat=BEGIN
                                                            IF Confirmada THEN BEGIN

                                                               CurrForm."Zona Trabajo".UPDATEFORECOLOR(16711680);

                                                            END
                                                            ELSE BEGIN

                                                              IF bVueloEncontrado THEN BEGIN
                                                                CASE rVuelos.Estado OF
                                                                  rVuelos.Estado::Normal :
                                                                    CurrForm."Zona Trabajo".UPDATEFORECOLOR(0);
                                                                  rVuelos.Estado::Retrasado :
                                                                    CurrForm."Zona Trabajo".UPDATEFORECOLOR(255);
                                                                  rVuelos.Estado::Confirmado :
                                                                    CurrForm."Zona Trabajo".UPDATEFORECOLOR(32768);
                                                                END;
                                                              END;
                                                            END;
                                                          END;
                                                           }
    { 1103355022;Label  ;0    ;0    ;0    ;0    ;ParentControl=1103355019;
                                                 InColumnHeading=Yes }
    { 1103355023;TextBox;11066;2310 ;1700 ;440  ;Editable=No;
                                                 ParentControl=1103355000;
                                                 InColumn=Yes;
                                                 SourceExpr="Num vehiculo";
                                                 OnFormat=BEGIN
                                                            IF Confirmada THEN BEGIN

                                                               CurrForm."Num vehiculo".UPDATEFORECOLOR(16711680);

                                                            END
                                                            ELSE BEGIN

                                                              IF bVueloEncontrado THEN BEGIN
                                                                CASE rVuelos.Estado OF
                                                                  rVuelos.Estado::Normal :
                                                                    CurrForm."Num vehiculo".UPDATEFORECOLOR(0);
                                                                  rVuelos.Estado::Retrasado :
                                                                    CurrForm."Num vehiculo".UPDATEFORECOLOR(255);
                                                                  rVuelos.Estado::Confirmado :
                                                                    CurrForm."Num vehiculo".UPDATEFORECOLOR(32768);
                                                                END;
                                                              END;
                                                            END;
                                                          END;
                                                           }
    { 1103355024;Label  ;0    ;0    ;0    ;0    ;ParentControl=1103355023;
                                                 InColumnHeading=Yes }
    { 1103355033;TextBox;0    ;0    ;1693 ;0    ;Editable=No;
                                                 ParentControl=1103355000;
                                                 InColumn=Yes;
                                                 SourceExpr=Fecha;
                                                 OnFormat=BEGIN
                                                            IF Confirmada THEN BEGIN

                                                               CurrForm.Fecha.UPDATEFORECOLOR(16711680);

                                                            END
                                                            ELSE BEGIN

                                                              IF bVueloEncontrado THEN BEGIN
                                                                CASE rVuelos.Estado OF
                                                                  rVuelos.Estado::Normal :
                                                                    CurrForm.Fecha.UPDATEFORECOLOR(0);
                                                                  rVuelos.Estado::Retrasado :
                                                                    CurrForm.Fecha.UPDATEFORECOLOR(255);
                                                                  rVuelos.Estado::Confirmado :
                                                                    CurrForm.Fecha.UPDATEFORECOLOR(32768);
                                                                END;
                                                              END;
                                                            END;
                                                          END;
                                                           }
    { 1103355034;Label  ;0    ;0    ;0    ;0    ;ParentControl=1103355033;
                                                 InColumnHeading=Yes }
    { 1103355027;TextBox;0    ;0    ;2837 ;0    ;Editable=No;
                                                 ParentControl=1103355000;
                                                 InColumn=Yes;
                                                 SourceExpr=Vuelo;
                                                 OnFormat=BEGIN
                                                            IF Confirmada THEN BEGIN

                                                               CurrForm.Vuelo.UPDATEFORECOLOR(16711680);

                                                            END
                                                            ELSE BEGIN

                                                              IF bVueloEncontrado THEN BEGIN
                                                                CASE rVuelos.Estado OF
                                                                  rVuelos.Estado::Normal :
                                                                    CurrForm.Vuelo.UPDATEFORECOLOR(0);
                                                                  rVuelos.Estado::Retrasado :
                                                                    CurrForm.Vuelo.UPDATEFORECOLOR(255);
                                                                  rVuelos.Estado::Confirmado :
                                                                    CurrForm.Vuelo.UPDATEFORECOLOR(32768);
                                                                END;
                                                              END;
                                                            END;
                                                          END;
                                                           }
    { 1103355028;Label  ;0    ;0    ;0    ;0    ;ParentControl=1103355027;
                                                 InColumnHeading=Yes }
    { 1103355017;TextBox;0    ;0    ;1478 ;0    ;Editable=No;
                                                 ParentControl=1103355000;
                                                 InColumn=Yes;
                                                 SourceExpr="Hora Vuelo";
                                                 Format=<Hours24,2>:<Minutes,2>;
                                                 OnFormat=BEGIN
                                                            IF Confirmada THEN BEGIN

                                                               CurrForm."Hora Vuelo".UPDATEFORECOLOR(16711680);

                                                            END
                                                            ELSE BEGIN

                                                              IF bVueloEncontrado THEN BEGIN
                                                                CASE rVuelos.Estado OF
                                                                  rVuelos.Estado::Normal :
                                                                    CurrForm."Hora Vuelo".UPDATEFORECOLOR(0);
                                                                  rVuelos.Estado::Retrasado :
                                                                    CurrForm."Hora Vuelo".UPDATEFORECOLOR(255);
                                                                  rVuelos.Estado::Confirmado :
                                                                    CurrForm."Hora Vuelo".UPDATEFORECOLOR(32768);
                                                                END;
                                                              END;

                                                            END;
                                                          END;
                                                           }
    { 1103355018;Label  ;0    ;0    ;0    ;0    ;ParentControl=1103355017;
                                                 InColumnHeading=Yes }
    { 1103355045;TextBox;0    ;0    ;2750 ;0    ;Editable=No;
                                                 ParentControl=1103355000;
                                                 InColumn=Yes;
                                                 CaptionML=ESP=Localizador;
                                                 SourceExpr=Reserva;
                                                 OnFormat=BEGIN
                                                            IF Confirmada THEN BEGIN

                                                               CurrForm.Reserva.UPDATEFORECOLOR(16711680);

                                                            END
                                                            ELSE BEGIN

                                                              IF bVueloEncontrado THEN BEGIN
                                                                CASE rVuelos.Estado OF
                                                                  rVuelos.Estado::Normal :
                                                                    CurrForm.Reserva.UPDATEFORECOLOR(0);
                                                                  rVuelos.Estado::Retrasado :
                                                                    CurrForm.Reserva.UPDATEFORECOLOR(255);
                                                                  rVuelos.Estado::Confirmado :
                                                                    CurrForm.Reserva.UPDATEFORECOLOR(32768);
                                                                END;
                                                              END;
                                                            END;
                                                          END;
                                                           }
    { 1103355046;Label  ;0    ;0    ;0    ;0    ;ParentControl=1103355045;
                                                 InColumnHeading=Yes }
    { 1103355043;TextBox;0    ;0    ;4400 ;0    ;Editable=No;
                                                 ParentControl=1103355000;
                                                 InColumn=Yes;
                                                 SourceExpr="Nombre Cliente";
                                                 OnFormat=BEGIN
                                                            IF Confirmada THEN BEGIN

                                                               CurrForm."Nombre Cliente".UPDATEFORECOLOR(16711680);

                                                            END
                                                            ELSE BEGIN

                                                              IF bVueloEncontrado THEN BEGIN
                                                                CASE rVuelos.Estado OF
                                                                  rVuelos.Estado::Normal :
                                                                    CurrForm."Nombre Cliente".UPDATEFORECOLOR(0);
                                                                  rVuelos.Estado::Retrasado :
                                                                    CurrForm."Nombre Cliente".UPDATEFORECOLOR(255);
                                                                  rVuelos.Estado::Confirmado :
                                                                    CurrForm."Nombre Cliente".UPDATEFORECOLOR(32768);
                                                                END;
                                                              END;

                                                            END;
                                                          END;
                                                           }
    { 1103355044;Label  ;0    ;0    ;0    ;0    ;ParentControl=1103355043;
                                                 InColumnHeading=Yes }
    { 1103355038;CheckBox;26671;2310;1320 ;990  ;ParentControl=1103355000;
                                                 InColumn=Yes;
                                                 ShowCaption=No;
                                                 SourceExpr=Cobrado }
    { 1103355039;Label  ;0    ;0    ;0    ;0    ;ParentControl=1103355038;
                                                 InColumnHeading=Yes }
    { 1103355040;TextBox;15214;2200 ;1652 ;880  ;ParentControl=1103355000;
                                                 InColumn=Yes;
                                                 BlankZero=Yes;
                                                 SourceExpr=Importe }
    { 1103355041;Label  ;0    ;0    ;0    ;0    ;ParentControl=1103355040;
                                                 InColumnHeading=Yes }
    { 1103355007;TextBox;0    ;0    ;4400 ;0    ;HorzGlue=Both;
                                                 Editable=No;
                                                 ParentControl=1103355000;
                                                 InColumn=Yes;
                                                 SourceExpr="Descripcion Punto Recogida";
                                                 OnFormat=BEGIN
                                                            IF Confirmada THEN BEGIN

                                                               CurrForm."Descripcion Punto Recogida".UPDATEFORECOLOR(16711680);

                                                            END
                                                            ELSE BEGIN

                                                              IF bVueloEncontrado THEN BEGIN
                                                                CASE rVuelos.Estado OF
                                                                  rVuelos.Estado::Normal :
                                                                    CurrForm."Descripcion Punto Recogida".UPDATEFORECOLOR(0);
                                                                  rVuelos.Estado::Retrasado :
                                                                    CurrForm."Descripcion Punto Recogida".UPDATEFORECOLOR(255);
                                                                  rVuelos.Estado::Confirmado :
                                                                    CurrForm."Descripcion Punto Recogida".UPDATEFORECOLOR(32768);
                                                                END;
                                                              END;

                                                            END;
                                                          END;
                                                           }
    { 1103355008;Label  ;0    ;0    ;0    ;0    ;ParentControl=1103355007;
                                                 InColumnHeading=Yes }
    { 1103355009;TextBox;0    ;0    ;1693 ;0    ;Editable=No;
                                                 ParentControl=1103355000;
                                                 InColumn=Yes;
                                                 SourceExpr="Zona fisica";
                                                 OnFormat=BEGIN
                                                            IF Confirmada THEN BEGIN

                                                               CurrForm."Zona fisica".UPDATEFORECOLOR(16711680);

                                                            END
                                                            ELSE BEGIN

                                                              IF bVueloEncontrado THEN BEGIN
                                                                CASE rVuelos.Estado OF
                                                                  rVuelos.Estado::Normal :
                                                                    CurrForm."Zona fisica".UPDATEFORECOLOR(0);
                                                                  rVuelos.Estado::Retrasado :
                                                                    CurrForm."Zona fisica".UPDATEFORECOLOR(255);
                                                                  rVuelos.Estado::Confirmado :
                                                                    CurrForm."Zona fisica".UPDATEFORECOLOR(32768);
                                                                END;
                                                              END;

                                                            END;
                                                          END;
                                                           }
    { 1103355010;Label  ;0    ;0    ;0    ;0    ;ParentControl=1103355009;
                                                 InColumnHeading=Yes }
    { 1103355064;TextBox;17013;2310 ;2530 ;440  ;Editable=No;
                                                 ParentControl=1103355000;
                                                 InColumn=Yes;
                                                 SourceExpr="Plaza Parking" }
    { 1103355065;Label  ;0    ;0    ;0    ;0    ;ParentControl=1103355064;
                                                 InColumnHeading=Yes }
    { 1103355066;TextBox;39678;2420 ;1870 ;440  ;Editable=No;
                                                 ParentControl=1103355000;
                                                 InColumn=Yes;
                                                 SourceExpr="Shuttle Time" }
    { 1103355067;Label  ;0    ;0    ;0    ;0    ;ParentControl=1103355066;
                                                 InColumnHeading=Yes }
    { 1103355025;TextBox;0    ;0    ;4400 ;0    ;Editable=No;
                                                 ParentControl=1103355000;
                                                 InColumn=Yes;
                                                 SourceExpr=Observaciones;
                                                 OnFormat=BEGIN
                                                            IF Confirmada THEN BEGIN

                                                               CurrForm.Observaciones.UPDATEFORECOLOR(16711680);

                                                            END
                                                            ELSE BEGIN

                                                              IF bVueloEncontrado THEN BEGIN
                                                                CASE rVuelos.Estado OF
                                                                  rVuelos.Estado::Normal :
                                                                    CurrForm.Observaciones.UPDATEFORECOLOR(0);
                                                                  rVuelos.Estado::Retrasado :
                                                                    CurrForm.Observaciones.UPDATEFORECOLOR(255);
                                                                  rVuelos.Estado::Confirmado :
                                                                    CurrForm.Observaciones.UPDATEFORECOLOR(32768);
                                                                END;
                                                              END;

                                                            END;
                                                          END;
                                                           }
    { 1103355026;Label  ;0    ;0    ;0    ;0    ;ParentControl=1103355025;
                                                 InColumnHeading=Yes }
    { 1103355049;CommandButton;20680;12100;2200;550;
                                                 HorzGlue=Right;
                                                 VertGlue=Bottom;
                                                 PushAction=FormHelp }
    { 1103355050;MenuButton;18260;12100;2200;550;HorzGlue=Right;
                                                 VertGlue=Bottom;
                                                 CaptionML=ESP=&L¡neas;
                                                 Menu=MENUITEMS
                                                 {
                                                   { ID=1103355031;
                                                     PushAction=RunObject;
                                                     ShortCutKey=Ctrl+F5;
                                                     CaptionML=ESP=Ficha Parte;
                                                     RunObject=Form 7010400;
                                                     RunFormLink=N§ Parte=FIELD(N§ Parte) }
                                                   { ID=1103355072;
                                                     ShortCutKey=Ctrl+L;
                                                     CaptionML=ESP=Limpiar marcas;
                                                     OnPush=BEGIN
                                                              cuFShuttle.LimpiarMarcas;
                                                            END;
                                                             }
                                                   { ID=1103355061;
                                                     CaptionML=ESP=Historia;
                                                     OnPush=VAR
                                                              rHist@1103355001 : Record 7010361;
                                                              fTabHisSerPar@1103355000 : Form 7010403;
                                                            BEGIN
                                                              rHist.RESET;
                                                              rHist.SETRANGE("Tipo Fichero", rHist."Tipo Fichero"::Linea);
                                                              rHist.SETRANGE("N§"          , "N§ Servicio");
                                                              rHist.SETRANGE("N§ Linea"    , "N§ Linea");
                                                              CLEAR(fTabHisSerPar);
                                                              fTabHisSerPar.SETTABLEVIEW(rHist);
                                                              fTabHisSerPar.RUNMODAL;
                                                            END;
                                                             }
                                                   { ID=1103355063;
                                                     PushAction=RunObject;
                                                     CaptionML=ESP=Historia reservas eliminadas;
                                                     RunObject=Form 7035408 }
                                                   { ID=1000000000;
                                                     MenuItemType=Separator }
                                                   { ID=1103355073;
                                                     CaptionML=ESP=Reasignar reserva;
                                                     OnPush=VAR
                                                              lfPartes@1103355004 : Form 7010401;
                                                              lrParte@1103355003 : Record 7010360;
                                                              lrLinsParte@1103355002 : Record 7010359;
                                                              liPlazasLibres@1103355001 : Integer;
                                                              liPaxesLins@1103355000 : Integer;
                                                            BEGIN
                                                              CLEAR(lrLinsParte);
                                                              //CurrForm.SETSELECTIONFILTER(lrLinsParte);

                                                              rPar.FINDFIRST;

                                                              lrParte.SETFILTER(Fecha, '>=%1',     TODAY);
                                                              lrParte.SETRANGE ("Origen creacion", "Origen creacion"::Shuttle);
                                                              lrParte.SETRANGE ("Codigo Servicio", rPar."Codigo Entradas");

                                                              IF (wZonaTrabajo <> '') THEN BEGIN
                                                                lrParte.SETRANGE ("Zona trabajo", wZonaTrabajo);
                                                              END;

                                                              lfPartes.LOOKUPMODE := TRUE;
                                                              lfPartes.SETTABLEVIEW(lrParte);
                                                              lfPartes.SETRECORD(lrParte);
                                                              IF (lfPartes.RUNMODAL= ACTION::LookupOK) THEN BEGIN
                                                                lfPartes.GETRECORD(lrParte);
                                                                cuFShuttle.ComprobarCapacidadParte(lrParte, lrLinsParte, liPlazasLibres, liPaxesLins);
                                                                IF (liPlazasLibres < 0) THEN BEGIN
                                                                  IF NOT(CONFIRM(conf001, FALSE, liPaxesLins, lrParte."N§ Parte", ABS(liPlazasLibres))) THEN BEGIN
                                                                    EXIT;
                                                                  END;
                                                                END;

                                                                IF (CONFIRM(conf002, FALSE, liPaxesLins, lrParte."N§ Parte")) THEN BEGIN
                                                                  cuFShuttle.ReasignarReservas(lrParte, lrLinsParte);
                                                                END;
                                                              END;
                                                            END;
                                                             }
                                                   { ID=1103355060;
                                                     CaptionML=ESP=Desasignar reserva;
                                                     OnPush=VAR
                                                              lrLinParte@1103355000 : Record 7010359;
                                                            BEGIN

                                                              lrLinParte.COPY(Rec);
                                                              lrLinParte.SETRECFILTER;

                                                              cuFShuttle.DesasignarReserva(lrLinParte);
                                                            END;
                                                             }
                                                   { ID=1103355062;
                                                     CaptionML=ESP=Eliminar reserva deasignada;
                                                     OnPush=BEGIN
                                                              IF CONFIRM(Text0002, FALSE, Reserva) THEN
                                                                cuFShuttle.EliminarReserva(Rec);
                                                            END;
                                                             }
                                                   { ID=1103355074;
                                                     CaptionML=ESP=Crear nuevo Parte;
                                                     OnPush=VAR
                                                              lrParte@1103355001 : Record 7010360;
                                                              lrLinsparte@1103355000 : Record 7010359;
                                                            BEGIN
                                                              rParGenerales.FINDFIRST;

                                                              CLEAR(lrLinsparte);
                                                              lrLinsparte.SETCURRENTKEY(Marca);
                                                              lrLinsparte.SETRANGE(Marca, USERID);
                                                              IF lrLinsparte.FINDFIRST THEN
                                                              BEGIN

                                                                IF (CONFIRM(conf003, FALSE)) THEN
                                                                BEGIN
                                                                  cuFShuttle.CrearParte(lrLinsparte, lrParte);
                                                                  cuFShuttle.ReasignarReservas(lrParte, lrLinsparte);
                                                                  // mostramos el n£mero de parte y pedimos si desea ver la ficha.
                                                                  IF CONFIRM(Text0001, FALSE, lrParte."N§ Parte") THEN
                                                                  BEGIN
                                                                    lrParte.SETRECFILTER;
                                                                    FORM.RUN(7010400, lrParte);
                                                                  END;
                                                                END;
                                                              END;
                                                            END;
                                                             }
                                                   { ID=1103355004;
                                                     ShortCutKey=Ctrl+R;
                                                     CaptionML=ESP=Reagrupar reservas;
                                                     OnPush=VAR
                                                              lrCondTemp@1103355009 : Record 7010420;
                                                              lfSeleccFH@1103355008 : Form 7035405;
                                                              ldtInicio@1103355007 : DateTime;
                                                              ldtFinal@1103355006 : DateTime;
                                                              lrLinsParte@1103355005 : Record 7010359;
                                                              iLinsPendientes@1103355004 : Integer;
                                                              iLinsAgrupadas@1103355003 : Integer;
                                                              liAdultos@1103355001 : Integer;
                                                              liNinos@1103355000 : Integer;
                                                            BEGIN

                                                              rParGenerales.FINDFIRST;

                                                              lrCondTemp.Inicializa;

                                                              COMMIT;

                                                              // Recogemos las condiciones para filtrar por rango de fechas y horas.
                                                              lfSeleccFH.SETRECORD(lrCondTemp);
                                                              IF (lfSeleccFH.RUNMODAL = ACTION::OK) THEN BEGIN
                                                                lfSeleccFH.GETRECORD(lrCondTemp);

                                                                IF (lrCondTemp."Fecha desde" = 0D) OR (lrCondTemp."Fecha hasta" = 0D) OR
                                                                  (lrCondTemp.Hora = 0T) OR (lrCondTemp."Hora Hasta" = 0T) THEN BEGIN
                                                                  ERROR (err001);
                                                                END;

                                                                ldtInicio := CREATEDATETIME(lrCondTemp."Fecha desde", lrCondTemp.Hora);
                                                                ldtFinal  := CREATEDATETIME(lrCondTemp."Fecha hasta", lrCondTemp."Hora Hasta");

                                                                IF (ldtInicio >= ldtFinal) THEN BEGIN
                                                                  ERROR (err002, ldtInicio, ldtFinal);
                                                                END;

                                                                // Hacemos un recuento de los partes pendientes.
                                                                lrLinsParte.SETRANGE("N§ Parte", '');
                                                                // JPT 02/02/10 Datetime a Biginteger
                                                                // lrLinsParte.SETRANGE("FechaHora Vuelo", ldtInicio, ldtFinal);
                                                                lrLinsParte.SETRANGE("FechaHora Vuelo BI", cFunBas.DTtoBIGINT(ldtInicio), cFunBas.DTtoBIGINT(ldtFinal));
                                                                lrLinsParte.SETRANGE("Codigo Servicio", rParGenerales."Codigo Entradas");
                                                                lrLinsParte.SETRANGE("Origen creacion", lrLinsParte."Origen creacion"::Shuttle);

                                                                iLinsPendientes := lrLinsParte.COUNT;


                                                                IF (iLinsPendientes = 0) THEN BEGIN
                                                                  ERROR (err003, ldtInicio, ldtFinal);
                                                                END;

                                                                // Reagrupamos.
                                                                IF (CONFIRM (cnf001, FALSE, iLinsPendientes, ldtInicio, ldtFinal)) THEN BEGIN
                                                                  iLinsAgrupadas := cuFShuttle.ReagruparReservas(ldtInicio, ldtFinal, liAdultos, liNinos);
                                                                  IF (iLinsAgrupadas <= 0) THEN BEGIN
                                                                    MESSAGE(msg001, ldtInicio, ldtFinal);
                                                                  END
                                                                  ELSE BEGIN
                                                                    MESSAGE(msg002, iLinsAgrupadas, ldtInicio, ldtFinal, (iLinsPendientes - iLinsAgrupadas), liAdultos, liNinos);
                                                                  END;
                                                                END;
                                                              END;
                                                            END;
                                                             }
                                                   { ID=1103355001;
                                                     MenuItemType=Separator }
                                                   { ID=1103355002;
                                                     PushAction=RunObject;
                                                     ShortCutKey=Ctrl+U;
                                                     CaptionML=ESP=Consulta vuelos;
                                                     RunObject=Form 7035402 }
                                                   { ID=1103355047;
                                                     MenuItemType=Separator }
                                                   { ID=1103355048;
                                                     ShortCutKey=Ctrl+P;
                                                     CaptionML=ESP=Imprimir Reservas;
                                                     OnPush=BEGIN
                                                              REPORT.RUN(7010444, TRUE, TRUE, Rec);
                                                            END;
                                                             }
                                                 }
                                                  }
    { 1103355003;TabControl;220;220 ;22660;1430 ;HorzGlue=Both;
                                                 PageNamesML=ESP=Filtros }
    { 1103355021;TextBox;3850 ;990  ;2860 ;440  ;VertGlue=Bottom;
                                                 ParentControl=1103355003;
                                                 InPage=0;
                                                 AssistEdit=No;
                                                 CaptionML=ESP=Filtro Zona Trabajo;
                                                 NextControl=1103355051;
                                                 SourceExpr=wZonaTrabajo;
                                                 TableRelation="Zona de trabajo";
                                                 OnValidate=BEGIN

                                                              IF (wZonaTrabajo <> '') THEN BEGIN
                                                                SETRANGE("Zona Trabajo", wZonaTrabajo);
                                                                cuFShuttle.LimpiarMarcas;
                                                              END
                                                              ELSE BEGIN
                                                                SETRANGE("Zona Trabajo");
                                                              END;
                                                            END;

                                                 OnAfterValidate=BEGIN
                                                                   CurrForm.UPDATE;
                                                                 END;
                                                                  }
    { 1103355020;Label  ;440  ;990  ;3300 ;440  ;ParentControl=1103355021;
                                                 CaptionML=ESP=Zona Trabajo }
    { 1103355032;CommandButton;13420;12100;2200;550;
                                                 HorzGlue=Right;
                                                 VertGlue=Bottom;
                                                 CaptionML=ESP=&Confirmar;
                                                 OnPush=BEGIN
                                                          ConfirmarReserva;
                                                        END;
                                                         }
    { 1103355035;CommandButton;15840;12100;2200;550;
                                                 HorzGlue=Right;
                                                 VertGlue=Bottom;
                                                 CaptionML=ESP=&Desconfirmar;
                                                 OnPush=BEGIN
                                                          DesconfirmarReserva;
                                                        END;
                                                         }
    { 1103355036;Label  ;2640 ;12100;2750 ;550  ;VertGlue=Bottom;
                                                 LeaderDots=No;
                                                 CaptionML=ESP=Reserva Confirmada }
    { 1103355037;Shape  ;1980 ;12100;550  ;550  ;VertGlue=Bottom;
                                                 BackColor=16711680;
                                                 BackTransparent=No }
    { 1103355054;Label  ;9350 ;12100;2200 ;550  ;VertGlue=Bottom;
                                                 LeaderDots=No;
                                                 CaptionML=ESP=Vuelo Retrasado }
    { 1103355055;Shape  ;8690 ;12100;550  ;550  ;VertGlue=Bottom;
                                                 BackColor=255;
                                                 BackTransparent=No }
    { 1103355056;Label  ;880  ;12100;990  ;550  ;VertGlue=Bottom;
                                                 LeaderDots=No;
                                                 CaptionML=ESP=Normal }
    { 1103355057;Shape  ;220  ;12100;550  ;550  ;VertGlue=Bottom;
                                                 BackColor=0;
                                                 BackTransparent=No }
    { 1103355058;Label  ;6160 ;12100;2420 ;550  ;HorzGlue=Left;
                                                 VertGlue=Bottom;
                                                 LeaderDots=No;
                                                 CaptionML=ESP=Vuelo Confirmado }
    { 1103355059;Shape  ;5500 ;12100;550  ;550  ;VertGlue=Bottom;
                                                 BackColor=2646048;
                                                 BackTransparent=No }
  }
  CODE
  {
    VAR
      Text50000@1103355022 : TextConst 'ESP=SHU';
      Text50001@1103355023 : TextConst 'ESP=<Year><Month,2><Day,2>';
      cuFShuttle@1103355000 : Codeunit 7010412;
      conf001@1103355001 : TextConst 'ESP=Est  intentando introducir %1 paxes en el parte %2. Esto excede en %3 plazas la capacidad m xima del veh¡culo asignado al parte.\¨Desea que el proceso asigne solo aquellas l¡neas que quepan en el parte?';
      conf002@1103355002 : TextConst 'ESP=¨Est  seguro de que quiere asignar las l¡neas seleccionadas con %1 paxes al parte %2?';
      conf003@1103355003 : TextConst 'ESP=¨Est  seguro de que desea mover las l¡neas seleccionadas a un nuevo parte?';
      cGestionPartes@1103355021 : Codeunit 7010318;
      cFunBas@1103355024 : Codeunit 7010310;
      rPar@1103355004 : Record 7010311;
      rVuelos@1103355006 : Record 7035335;
      rParGenerales@1103355008 : Record 7010311;
      err001@1103355014 : TextConst 'ESP=No se han introducido todos los datos en los campos de filtro de fechas. Rellenelos y vuelva a intentarlo.';
      err002@1103355013 : TextConst 'ESP="El intervalo de fechas no es v lido. La fecha de inicio debe ser menor a la fecha de final.\Fecha de inicio : %1 Fecha final: %2 "';
      err003@1103355012 : TextConst 'ESP=No hay l¡neas de recogida pendientes de agrupar entre %1 y %2.';
      cnf001@1103355011 : TextConst 'ESP="Hay %1 l¡neas de recogida no asignadas entre %2 y %3. Desea intentar agruparlas en los partes con espacio? "';
      msg001@1103355010 : TextConst 'ESP=Ninguna l¡nea a podido ser asignada entre %1 y %2.';
      msg002@1103355009 : TextConst 'ESP=%1 l¡neas han sido asignadas entre %2 y %3 con %5 Adultos y %6 Ni¤os.%4 l¡neas han quedado pendientes de agrupar.';
      wParteShuttle@1103355015 : Code[20];
      wZonaTrabajo@1103355005 : Code[10];
      bVueloEncontrado@1103355007 : Boolean;
      err004@1103355016 : TextConst 'ESP=Para usar esta opci¢n se han de filtrar solo las entradas.';
      Text0001@1103355017 : TextConst 'ESP=Creado Parte N§ %1. ¨Desea Abrir la ficha de parte?';
      Text0002@1103355018 : TextConst 'ESP=¨Est  seguro de que desea Eliminar la l¡nea seleccionada con Localizador : %1?';
      wMarca@1103355019 : Boolean;
      Text0003@1103355020 : TextConst 'ESP=La reserva ya ha sido marcada por otro usuario.';

    BEGIN
    {
      JPT 02/02/10 Datetime a Biginteger

      $001 AJS 18052015 Modifico la funcion Crear nuevo parte para que trabaje con el campo Marca
    }
    END.
  }
}
