OBJECT Form 6520 Item Tracing
{
  OBJECT-PROPERTIES
  {
    Date=05/11/08;
    Time=12:00:00;
    Version List=NAVW16.00;
  }
  PROPERTIES
  {
    Width=16830;
    Height=10780;
    CaptionML=[ENU=Item Tracing;
               ESP=Seguimiento productos];
    InsertAllowed=No;
    DeleteAllowed=No;
    ModifyAllowed=No;
    TableBoxID=1;
    SourceTable=Table6520;
    SourceTableTemporary=Yes;
    OnOpenForm=BEGIN
                 InitButtons;
                 TraceMethod := TraceMethod::"Usage->Origin";
                 ShowComponents := ShowComponents::"Item-tracked Only";
               END;

    OnAfterGetRecord=BEGIN
                       ItemTracingMgt.SetExpansionStatus(Rec,TempTrackEntry,Rec,ActualExpansionStatus);
                     END;

  }
  CONTROLS
  {
    { 1   ;TableBox     ;220  ;5170 ;16390;4620 ;HorzGlue=Both;
                                                 VertGlue=Both;
                                                 HeadingHeight=880 }
    { 1000000011;PictureBox;0 ;3850 ;603  ;3740 ;Name=ExpandCollapse;
                                                 ParentControl=1;
                                                 InColumn=Yes;
                                                 Border=No;
                                                 BitmapList=47,46;
                                                 CaptionML=[ENU=Expand/Collapse;
                                                            ESP=Expandir/Contraer];
                                                 ToolTipML=[ENU=Expand/Collapse;
                                                            ESP=Expandir/Contraer];
                                                 SourceExpr=ActualExpansionStatus;
                                                 OnPush=VAR
                                                          T@1001 : Integer;
                                                          xActualExpansionStatus@1002 : Integer;
                                                        BEGIN
                                                          ItemTracingMgt.ToggleExpandCollapse(Rec,TempTrackEntry,Rec,ActualExpansionStatus);
                                                        END;
                                                         }
    { 1000000012;Label  ;0    ;0    ;0    ;0    ;ParentControl=1000000011;
                                                 InColumnHeading=Yes }
    { 1000000015;TextBox;4604 ;3080 ;4400 ;440  ;HorzGlue=Both;
                                                 ParentControl=1;
                                                 InColumn=Yes;
                                                 SourceExpr=Description;
                                                 OnFormat=BEGIN
                                                            IF Level > 0 THEN
                                                              CurrForm.Description.UPDATEINDENT(Level * 220);
                                                          END;
                                                           }
    { 1000000016;Label  ;0    ;0    ;0    ;0    ;ParentControl=1000000015;
                                                 InColumnHeading=Yes }
    { 8   ;TextBox      ;7328 ;4290 ;1100 ;440  ;Visible=No;
                                                 ParentControl=1;
                                                 InColumn=Yes;
                                                 SourceExpr="Entry Type" }
    { 9   ;Label        ;0    ;0    ;0    ;0    ;ParentControl=8;
                                                 InColumnHeading=Yes }
    { 1000000034;TextBox;212  ;2860 ;1700 ;440  ;Editable=No;
                                                 ParentControl=1;
                                                 InColumn=Yes;
                                                 SourceExpr="Serial No.";
                                                 OnFormat=BEGIN
                                                            CurrForm."Serial No.".UPDATEFONTBOLD("Serial No." = SerialNoFilter);
                                                          END;
                                                           }
    { 1000000035;Label  ;0    ;0    ;0    ;0    ;ParentControl=1000000034;
                                                 InColumnHeading=Yes }
    { 27  ;TextBox      ;1667 ;3850 ;1650 ;440  ;Editable=No;
                                                 ParentControl=1;
                                                 InColumn=Yes;
                                                 SourceExpr="Lot No.";
                                                 OnFormat=BEGIN
                                                            CurrForm."Lot No.".UPDATEFONTBOLD("Lot No." = LotNoFilter);
                                                          END;
                                                           }
    { 28  ;Label        ;0    ;0    ;0    ;0    ;ParentControl=27;
                                                 InColumnHeading=Yes }
    { 1000000030;TextBox;2805 ;2970 ;1700 ;440  ;Editable=No;
                                                 ParentControl=1;
                                                 InColumn=Yes;
                                                 SourceExpr="Item No.";
                                                 OnFormat=BEGIN
                                                            CurrForm."Item No.".UPDATEFONTBOLD("Item No." = ItemNoFilter);
                                                          END;
                                                           }
    { 1000000031;Label  ;0    ;0    ;0    ;0    ;ParentControl=1000000030;
                                                 InColumnHeading=Yes }
    { 32  ;TextBox      ;5080 ;5280 ;4400 ;440  ;Editable=No;
                                                 ParentControl=1;
                                                 InColumn=Yes;
                                                 SourceExpr="Item Description" }
    { 33  ;Label        ;0    ;0    ;0    ;0    ;ParentControl=32;
                                                 InColumnHeading=Yes }
    { 2   ;TextBox      ;5080 ;3740 ;1700 ;440  ;Visible=No;
                                                 ParentControl=1;
                                                 InColumn=Yes;
                                                 SourceExpr="Variant Code" }
    { 3   ;Label        ;0    ;0    ;0    ;0    ;ParentControl=2;
                                                 InColumnHeading=Yes }
    { 1000000032;TextBox;265  ;3190 ;1700 ;440  ;Visible=No;
                                                 ParentControl=1;
                                                 InColumn=Yes;
                                                 SourceExpr="Document No." }
    { 1000000033;Label  ;0    ;0    ;0    ;0    ;ParentControl=1000000032;
                                                 InColumnHeading=Yes }
    { 1000000043;TextBox;8943 ;3630 ;1700 ;440  ;Visible=No;
                                                 ParentControl=1;
                                                 InColumn=Yes;
                                                 SourceExpr="Posting Date" }
    { 1000000044;Label  ;0    ;0    ;0    ;0    ;ParentControl=1000000043;
                                                 InColumnHeading=Yes }
    { 1000000017;TextBox;11880;2970 ;550  ;440  ;Visible=No;
                                                 ParentControl=1;
                                                 InColumn=Yes;
                                                 SourceExpr="Source Type" }
    { 1000000018;Label  ;0    ;0    ;0    ;0    ;ParentControl=1000000017;
                                                 InColumnHeading=Yes }
    { 6   ;TextBox      ;6653 ;3740 ;1650 ;440  ;Visible=No;
                                                 Editable=No;
                                                 ParentControl=1;
                                                 InColumn=Yes;
                                                 SourceExpr="Source No." }
    { 7   ;Label        ;0    ;0    ;0    ;0    ;ParentControl=6;
                                                 InColumnHeading=Yes }
    { 1000000003;TextBox;15345;2970 ;3190 ;440  ;Visible=No;
                                                 Editable=No;
                                                 ParentControl=1;
                                                 InColumn=Yes;
                                                 SourceExpr="Source Name" }
    { 1000000004;Label  ;0    ;0    ;0    ;0    ;ParentControl=1000000003;
                                                 InColumnHeading=Yes }
    { 23  ;TextBox      ;8963 ;3740 ;1507 ;440  ;Editable=No;
                                                 ParentControl=1;
                                                 InColumn=Yes;
                                                 SourceExpr="Location Code" }
    { 24  ;Label        ;0    ;0    ;0    ;0    ;ParentControl=23;
                                                 InColumnHeading=Yes }
    { 1000000021;TextBox;16748;3190 ;1884 ;440  ;ParentControl=1;
                                                 InColumn=Yes;
                                                 SourceExpr=Quantity;
                                                 OnDrillDown=VAR
                                                               ItemLedgerEntry@1000000000 : Record 32;
                                                             BEGIN
                                                               ItemLedgerEntry.RESET;
                                                               ItemLedgerEntry.SETRANGE("Entry No.","Item Ledger Entry No.");
                                                               FORM.RUNMODAL(0,ItemLedgerEntry);
                                                             END;
                                                              }
    { 1000000022;Label  ;0    ;0    ;0    ;0    ;ParentControl=1000000021;
                                                 InColumnHeading=Yes }
    { 1000000019;TextBox;12383;2970 ;1700 ;440  ;ParentControl=1;
                                                 InColumn=Yes;
                                                 SourceExpr="Remaining Quantity" }
    { 1000000020;Label  ;0    ;0    ;0    ;0    ;ParentControl=1000000019;
                                                 InColumnHeading=Yes }
    { 1000000023;TextBox;18865;3520 ;1700 ;440  ;Visible=No;
                                                 ParentControl=1;
                                                 InColumn=Yes;
                                                 Lookup=Yes;
                                                 SourceExpr="Created by" }
    { 1000000024;Label  ;0    ;0    ;0    ;0    ;ParentControl=1000000023;
                                                 InColumnHeading=Yes }
    { 1000000025;TextBox;20565;3520 ;1700 ;440  ;Visible=No;
                                                 ParentControl=1;
                                                 InColumn=Yes;
                                                 SourceExpr="Created on" }
    { 1000000026;Label  ;0    ;0    ;0    ;0    ;ParentControl=1000000025;
                                                 InColumnHeading=Yes }
    { 1000000001;TabControl;220;220 ;16390;3960 ;HorzGlue=Both;
                                                 VertGlue=Top;
                                                 PageNamesML=[ENU=General;
                                                              ESP=General] }
    { 22  ;OptionButton ;12540;1540 ;3850 ;440  ;HorzGlue=Right;
                                                 ParentControl=1000000001;
                                                 InPage=0;
                                                 CaptionML=[ENU=Origin -> Usage;
                                                            ESP=Origen -> Uso];
                                                 ToolTipML=[ENU=Find earliest occurence and investigate what these items were used for.;
                                                            ESP=Busque la primera aparici¢n e investigue para qu‚ se utilizaban estos productos.];
                                                 NextControl=20;
                                                 SourceExpr=TraceMethod;
                                                 OptionValue=Origin->Usage }
    { 21  ;OptionButton ;12540;990  ;3850 ;440  ;HorzGlue=Right;
                                                 ParentControl=1000000001;
                                                 InPage=0;
                                                 CaptionML=[ENU=Usage -> Origin;
                                                            ESP=Uso -> Origen];
                                                 ToolTipML=[ENU=Find latest occurence and investigate where these items came from.;
                                                            ESP=Busque la £ltima aparici¢n e investigue de d¢nde proceden estos productos.];
                                                 SourceExpr=TraceMethod;
                                                 OptionValue=Usage->Origin }
    { 13  ;TextBox      ;3850 ;1540 ;2530 ;440  ;ParentControl=1000000001;
                                                 InPage=0;
                                                 CaptionML=[ENU=Lot No. Filter;
                                                            ESP=Filtro n§ lote];
                                                 SourceExpr=LotNoFilter;
                                                 OnLookup=VAR
                                                            LotNoInfo@1002 : Record 6505;
                                                            LotNoList@1003 : Form 6508;
                                                          BEGIN
                                                            LotNoInfo.RESET;

                                                            CLEAR(LotNoList);
                                                            LotNoList.SETTABLEVIEW(LotNoInfo);
                                                            IF LotNoList.RUNMODAL = ACTION::LookupOK THEN
                                                              LotNoFilter := LotNoList.GetSelectionFilter;
                                                          END;
                                                           }
    { 14  ;Label        ;440  ;1540 ;3300 ;440  ;ParentControl=13 }
    { 18  ;TextBox      ;3850 ;990  ;2530 ;440  ;ParentControl=1000000001;
                                                 InPage=0;
                                                 CaptionML=[ENU=Serial No. Filter;
                                                            ESP=Filtro n§ serie];
                                                 SourceExpr=SerialNoFilter;
                                                 OnLookup=VAR
                                                            SerialNoInfo@1003 : Record 6504;
                                                            SerialNoList@1002 : Form 6509;
                                                          BEGIN
                                                            SerialNoInfo.RESET;

                                                            CLEAR(SerialNoList);
                                                            SerialNoList.SETTABLEVIEW(SerialNoInfo);
                                                            IF SerialNoList.RUNMODAL = ACTION::LookupOK THEN
                                                              SerialNoFilter := SerialNoList.GetSelectionFilter;
                                                          END;
                                                           }
    { 15  ;Label        ;440  ;990  ;3300 ;440  ;ParentControl=18 }
    { 1000000002;Label  ;9130 ;990  ;3300 ;440  ;HorzGlue=Right;
                                                 ParentControl=1000000001;
                                                 InPage=0;
                                                 CaptionML=[ENU=Trace Method;
                                                            ESP=M‚todo seguimiento] }
    { 1000000013;TextBox;3850 ;2200 ;2530 ;440  ;ParentControl=1000000001;
                                                 InPage=0;
                                                 CaptionML=[ENU=Item Filter;
                                                            ESP=Filtro producto];
                                                 SourceExpr=ItemNoFilter;
                                                 OnValidate=BEGIN
                                                              IF ItemNoFilter = '' THEN
                                                                VariantFilter := '';
                                                            END;

                                                 OnLookup=VAR
                                                            Item@1002 : Record 27;
                                                            ItemList@1003 : Form 31;
                                                          BEGIN
                                                            Item.RESET;

                                                            CLEAR(ItemList);
                                                            ItemList.SETTABLEVIEW(Item);
                                                            ItemList.LOOKUPMODE(TRUE);
                                                            IF ItemList.RUNMODAL = ACTION::LookupOK THEN
                                                              ItemNoFilter := ItemList.GetSelectionFilter;
                                                          END;
                                                           }
    { 1000000014;Label  ;440  ;2200 ;3300 ;440  ;ParentControl=1000000013 }
    { 4   ;TextBox      ;3850 ;2750 ;2530 ;440  ;ParentControl=1000000001;
                                                 InPage=0;
                                                 CaptionML=[ENU=Variant Filter;
                                                            ESP=Filtro variante];
                                                 SourceExpr=VariantFilter;
                                                 OnValidate=BEGIN
                                                              IF ItemNoFilter = '' THEN
                                                                ERROR(Text001);
                                                            END;

                                                 OnLookup=VAR
                                                            ItemVariant@1003 : Record 5401;
                                                            ItemVariants@1002 : Form 5401;
                                                          BEGIN
                                                            IF ItemNoFilter = '' THEN
                                                              ERROR(Text001);

                                                            ItemVariant.RESET;

                                                            CLEAR(ItemVariants);
                                                            ItemVariant.SETFILTER("Item No.",ItemNoFilter);
                                                            ItemVariants.SETTABLEVIEW(ItemVariant);
                                                            ItemVariants.LOOKUPMODE(TRUE);
                                                            IF ItemVariants.RUNMODAL = ACTION::LookupOK THEN BEGIN
                                                              ItemVariants.GETRECORD(ItemVariant);
                                                              VariantFilter := ItemVariant.Code;
                                                            END;
                                                          END;
                                                           }
    { 5   ;Label        ;440  ;2750 ;3300 ;440  ;ParentControl=4 }
    { 20  ;CommandButton;14190;3300 ;2200 ;550  ;HorzGlue=Right;
                                                 ParentControl=1000000001;
                                                 InPage=0;
                                                 CaptionML=[ENU=&Trace;
                                                            ESP=&Realizar seguimiento];
                                                 NextControl=18;
                                                 OnPush=BEGIN
                                                          FindRecords;
                                                        END;
                                                         }
    { 25  ;TextBox      ;3850 ;3410 ;3300 ;440  ;ParentControl=1000000001;
                                                 InPage=0;
                                                 CaptionML=[ENU=Show Components;
                                                            ESP=Mostrar componentes];
                                                 OptionCaptionML=[ENU=No,Item-tracked Only,All;
                                                                  ESP=No,S¢lo producto seguido,Todos];
                                                 OptionString=No,Item-tracked Only,All;
                                                 SourceExpr=ShowComponents }
    { 31  ;Label        ;440  ;3410 ;3300 ;440  ;ParentControl=25;
                                                 InPage=0 }
    { 34  ;MenuButton   ;2310 ;10010;2200 ;550  ;Name=Line;
                                                 HorzGlue=Right;
                                                 VertGlue=Bottom;
                                                 CaptionML=[ENU=&Line;
                                                            ESP=&L¡nea];
                                                 Menu=MENUITEMS
                                                 {
                                                   { ID=60;
                                                     ShortCutKey=May£s+F5;
                                                     CaptionML=[ENU=Show Document;
                                                                ESP=Muestra documento];
                                                     OnPush=BEGIN
                                                              ItemTracingMgt.ShowDocument("Record Identifier");
                                                            END;
                                                             }
                                                 }
                                                  }
    { 36  ;MenuButton   ;7150 ;10010;2200 ;550  ;Name=Functions;
                                                 HorzGlue=Right;
                                                 VertGlue=Bottom;
                                                 CaptionML=[ENU=F&unctions;
                                                            ESP=Acci&ones];
                                                 Menu=MENUITEMS
                                                 {
                                                   { ID=55;
                                                     ShortCutKey=May£s+Ctrl+A;
                                                     CaptionML=[ENU=Exp&and/Collapse;
                                                                ESP=E&xpandir/Contraer];
                                                     OnPush=BEGIN
                                                              ItemTracingMgt.ToggleExpandCollapse(Rec,TempTrackEntry,Rec,ActualExpansionStatus);
                                                            END;
                                                             }
                                                   { ID=56;
                                                     CaptionML=[ENU=E&xpand All;
                                                                ESP=E&xpandir todo];
                                                     OnPush=BEGIN
                                                              ItemTracingMgt.ExpandAll(TempTrackEntry,Rec);
                                                            END;
                                                             }
                                                   { ID=57;
                                                     CaptionML=[ENU=C&ollapse All;
                                                                ESP=C&ontraer todo];
                                                     OnPush=BEGIN
                                                              ItemTracingMgt.InitTempTable(TempTrackEntry,Rec);
                                                            END;
                                                             }
                                                   { ID=58;
                                                     MenuItemType=Separator }
                                                   { ID=59;
                                                     CaptionML=[ENU=&Trace Opposite - from Line;
                                                                ESP=&Realizar seguimiento opuestos - desde l¡nea];
                                                     OnPush=BEGIN
                                                              IF TraceMethod = TraceMethod::"Origin->Usage" THEN
                                                                TraceMethod := TraceMethod::"Usage->Origin"
                                                              ELSE
                                                                TraceMethod := TraceMethod::"Origin->Usage";
                                                              OppositeTraceFromLine;
                                                            END;
                                                             }
                                                   { ID=26;
                                                     CaptionML=[ENU=Set &Filters with Line Values;
                                                                ESP=Establecer &filtros con valores de l¡nea];
                                                     OnPush=BEGIN
                                                              ItemTracingMgt.InitSearchParm(Rec,SerialNoFilter,LotNoFilter,ItemNoFilter,VariantFilter);
                                                            END;
                                                             }
                                                   { ID=37;
                                                     ShortCutKey=Alt+Derecha;
                                                     CaptionML=[ENU=Next Trace Result;
                                                                ESP=Resultado seguimiento siguiente];
                                                     OnPush=BEGIN
                                                              RecallHistory(1);
                                                            END;
                                                             }
                                                   { ID=38;
                                                     ShortCutKey=Alt+Izquierda;
                                                     CaptionML=[ENU=Previous Trace Result;
                                                                ESP=Resultado seguimiento anterior];
                                                     OnPush=BEGIN
                                                              RecallHistory(-1);
                                                            END;
                                                             }
                                                 }
                                                  }
    { 11  ;CommandButton;11990;10010;2200 ;550  ;Name=Navigate;
                                                 HorzGlue=Right;
                                                 VertGlue=Bottom;
                                                 CaptionML=[ENU=&Navigate;
                                                            ESP=&Navegar];
                                                 OnPush=VAR
                                                          Navigate@1000 : Form 344;
                                                        BEGIN
                                                          Navigate.SetTracking("Serial No.","Lot No.");
                                                          Navigate.RUN;
                                                        END;
                                                         }
    { 16  ;CommandButton;9570 ;10010;2200 ;550  ;Name=Print;
                                                 HorzGlue=Right;
                                                 VertGlue=Bottom;
                                                 Ellipsis=Yes;
                                                 CaptionML=[ENU=&Print;
                                                            ESP=&Imprimir];
                                                 OnPush=VAR
                                                          xItemTracingBuffer@1002 : Record 6520;
                                                          PrintTracking@1000 : Report 6520;
                                                        BEGIN
                                                          CLEAR(PrintTracking);
                                                          xItemTracingBuffer.COPY(Rec);
                                                          PrintTracking.TransferEntries(Rec);
                                                          COPY(xItemTracingBuffer);
                                                          PrintTracking.RUN;
                                                        END;
                                                         }
    { 12  ;CommandButton;14410;10010;2200 ;550  ;HorzGlue=Right;
                                                 VertGlue=Bottom;
                                                 PushAction=FormHelp }
    { 10  ;MenuButton   ;4730 ;10010;2200 ;550  ;Name=Item;
                                                 HorzGlue=Right;
                                                 VertGlue=Bottom;
                                                 CaptionML=[ENU=&Item;
                                                            ESP=&Producto];
                                                 Menu=MENUITEMS
                                                 {
                                                   { ID=17;
                                                     PushAction=RunObject;
                                                     ShortCutKey=May£s+F5;
                                                     CaptionML=[ENU=Card;
                                                                ESP=Ficha];
                                                     RunObject=Form 30;
                                                     RunFormLinkType=OnUpdate;
                                                     RunFormLink=No.=FIELD(Item No.) }
                                                   { ID=19;
                                                     PushAction=RunObject;
                                                     ShortCutKey=Ctrl+F5;
                                                     CaptionML=[ENU=Ledger E&ntries;
                                                                ESP=&Movimientos];
                                                     RunObject=Form 38;
                                                     RunFormLinkType=OnUpdate;
                                                     RunFormView=SORTING(Item No.);
                                                     RunFormLink=Item No.=FIELD(Item No.) }
                                                 }
                                                  }
    { 35  ;TextBox      ;1540 ;4290 ;15070;660  ;HorzGlue=Both;
                                                 Editable=No;
                                                 Focusable=No;
                                                 BackTransparent=Yes;
                                                 ToolTipML=[ENU=These are the settings that were used to generate the trace result below;
                                                            ESP=Esta es la configuraci¢n utilizada para generar el siguiente resultado de seguimiento];
                                                 SourceExpr=TraceText }
    { 39  ;PictureBox   ;220  ;4290 ;660  ;660  ;Name=Previous;
                                                 Border=No;
                                                 BitmapList=51,50;
                                                 ToolTipML=[ENU=Previous Trace Result;
                                                            ESP=Resultado seguimiento anterior];
                                                 SourceExpr=PreviousExists;
                                                 OnPush=BEGIN
                                                          RecallHistory(-1);
                                                        END;
                                                         }
    { 40  ;PictureBox   ;880  ;4290 ;660  ;660  ;Name=Next;
                                                 Border=No;
                                                 BitmapList=49,48;
                                                 ToolTipML=[ENU=Next Trace Result;
                                                            ESP=Resultado seguimiento siguiente];
                                                 SourceExpr=NextExists;
                                                 OnPush=BEGIN
                                                          RecallHistory(1);
                                                        END;
                                                         }
    { 30  ;MenuButton   ;6380 ;8580 ;2200 ;550  ;Name=Functions2;
                                                 HorzGlue=Right;
                                                 VertGlue=Bottom;
                                                 CaptionML=[ENU=F&unctions;
                                                            ESP=Acci&ones];
                                                 Menu=MENUITEMS
                                                 {
                                                   { ID=47;
                                                     ShortCutKey=Alt+Derecha;
                                                     CaptionML=[ENU=Next Trace Result;
                                                                ESP=Resultado seguimiento siguiente];
                                                     OnPush=BEGIN
                                                              RecallHistory(1);
                                                            END;
                                                             }
                                                   { ID=48;
                                                     ShortCutKey=Alt+Izquierda;
                                                     CaptionML=[ENU=Previous Trace Result;
                                                                ESP=Resultado seguimiento anterior];
                                                     OnPush=BEGIN
                                                              RecallHistory(-1);
                                                            END;
                                                             }
                                                 }
                                                  }
  }
  CODE
  {
    VAR
      TrackFilters@1011 : Record 6520;
      TempTrackEntry@1000 : TEMPORARY Record 6520;
      ItemTracingMgt@1017 : Codeunit 6520;
      TraceMethod@1004 : 'Origin->Usage,Usage->Origin';
      ShowComponents@1000000002 : 'No,Item-tracked Only,All';
      ActualExpansionStatus@1009 : 'Has Children,Expanded,No Children';
      SerialNoFilter@1000000009 : Code[1000];
      LotNoFilter@1006 : Code[1000];
      ItemNoFilter@1000000007 : Code[1000];
      VariantFilter@1001 : Code[1000];
      Text001@1002 : TextConst 'ENU=Item No. Filter required.;ESP=Filtro n§ producto requerido.';
      TraceText@1005 : Text[1000];
      Text002@1007 : TextConst 'ENU=Serial No.: %1, Lot No.: %2, Item: %3, Variant: %4, %5, %6;ESP=N§ serie: %1, N§ lote: %2, Producto: %3, Variante: %4, %5, %6';
      PreviousExists@1010 : Boolean;
      NextExists@1012 : Boolean;
      Text003@1008 : TextConst 'ENU=Filters too large to show.;ESP=Filtros demasiado amplios para mostrar.';
      Text004@1003 : TextConst 'ENU=Origin->Usage,Usage->Origin;ESP=Origen->Uso,Uso->Origen';
      Text005@1013 : TextConst 'ENU=No,Item-tracked Only,All;ESP=No,S¢lo producto seguido,Todos';

    PROCEDURE FindRecords@1000000001();
    BEGIN
      ItemTracingMgt.FindRecords(TempTrackEntry,Rec,
        SerialNoFilter,LotNoFilter,ItemNoFilter,VariantFilter,
        TraceMethod,ShowComponents);
      InitButtons;

      ItemTracingMgt.GetHistoryStatus(PreviousExists,NextExists);

      UpdateTraceText;

      IF ISSERVICETIER THEN BEGIN
        ItemTracingMgt.ExpandAll(TempTrackEntry,Rec);
        CurrForm.UPDATE(FALSE)
      END;
    END;

    PROCEDURE OppositeTraceFromLine@1();
    BEGIN
      ItemTracingMgt.InitSearchParm(Rec,SerialNoFilter,LotNoFilter,ItemNoFilter,VariantFilter);
      FindRecords;
    END;

    PROCEDURE InitButtons@7();
    BEGIN
      IF NOT TempTrackEntry.FIND('-') THEN BEGIN
        CurrForm.Line.ENABLED(FALSE);
        CurrForm.Item.ENABLED(FALSE);
        CurrForm.Functions.ENABLED(FALSE);
        CurrForm.Functions2.VISIBLE(TRUE);
        CurrForm.Print.ENABLED(FALSE);
        CurrForm.Navigate.ENABLED(FALSE);
      END ELSE BEGIN
        CurrForm.Line.ENABLED(TRUE);
        CurrForm.Item.ENABLED(TRUE);
        CurrForm.Functions.ENABLED(TRUE);
        CurrForm.Functions2.VISIBLE(FALSE);
        CurrForm.Print.ENABLED(TRUE);
        CurrForm.Navigate.ENABLED(TRUE);
      END;

      IF ISSERVICETIER THEN BEGIN
        CurrForm.Previous.VISIBLE := FALSE;
        CurrForm.Next.VISIBLE := FALSE;
      END;
    END;

    PROCEDURE InitFilters@4(VAR ItemTrackingEntry@1000 : Record 6520);
    BEGIN
      SerialNoFilter := ItemTrackingEntry.GETFILTER("Serial No.");
      LotNoFilter := ItemTrackingEntry.GETFILTER("Lot No.");
      ItemNoFilter := ItemTrackingEntry.GETFILTER("Item No.");
      VariantFilter := ItemTrackingEntry.GETFILTER("Variant Code");
      TraceMethod := TraceMethod::"Usage->Origin";
      ShowComponents := ShowComponents::"Item-tracked Only";
    END;

    PROCEDURE RecallHistory@2(Steps@1000 : Integer);
    BEGIN
      ItemTracingMgt.RecallHistory(Steps,TempTrackEntry,Rec,SerialNoFilter,
                                 LotNoFilter,ItemNoFilter,VariantFilter,TraceMethod,ShowComponents);
      UpdateTraceText;
      InitButtons;
      ItemTracingMgt.GetHistoryStatus(PreviousExists,NextExists);
      CurrForm.Previous.UPDATE;
      CurrForm.Next.UPDATE;

      IF ISSERVICETIER THEN BEGIN
        ItemTracingMgt.ExpandAll(TempTrackEntry,Rec);
        CurrForm.UPDATE(FALSE);
      END;
    END;

    LOCAL PROCEDURE UpdateTraceText@3();
    VAR
      LengthOfText@1001 : Integer;
      L1@1002 : Integer;
      L2@1003 : Integer;
      Overflow@1000 : Boolean;
    BEGIN
      LengthOfText := (STRLEN(Text002 + SerialNoFilter + LotNoFilter + ItemNoFilter + VariantFilter) +
        STRLEN(FORMAT(TraceMethod)) + STRLEN(FORMAT(ShowComponents)) - 6); // 6 = number of positions in Text002

      Overflow :=  LengthOfText > 512;

      IF Overflow THEN
        TraceText := Text003
      ELSE
        TraceText := STRSUBSTNO(Text002,SerialNoFilter,LotNoFilter,ItemNoFilter,VariantFilter,
          SELECTSTR(TraceMethod+1,Text004) , SELECTSTR(ShowComponents+1,Text005));
    END;

    BEGIN
    {
      Button Function2 is hidden behind tablebox - ensure that shortkeys for next and previous are active even though the
      real Function button is disabled.
    }
    END.
  }
}
