OBJECT Form 7009853 Booking Trans. Venta
{
  OBJECT-PROPERTIES
  {
    Date=02/10/12;
    Time=12:00:00;
    Modified=Yes;
    Version List=AIC2009;
  }
  PROPERTIES
  {
    Width=17490;
    Height=11330;
    CaptionML=[ENU=Sale Trans. Booking;
               ESP=Booking Trans. Venta];
    SaveValues=Yes;
    TableBoxID=77;
    SourceTable=Table7009776;
    DataCaptionExpr=NombreHotel();
    OnInit=BEGIN

             DiaInicial := WORKDATE;
           END;

    OnOpenForm=VAR
                 ok@1103355000 : Boolean;
               BEGIN
                 ok := rHot.GET(Hotel);

                 Init_Hab();

                 SETRANGE("Tipo Habitacion",TipoHab);

                 Habitaciones();
               END;

  }
  CONTROLS
  {
    { 14  ;TabControl   ;110  ;220  ;17160;3190 ;HorzGlue=Both }
    { 17  ;Label        ;330  ;1540 ;2750 ;440  ;ParentControl=14;
                                                 InPage=0;
                                                 CaptionML=[ENU=TTOO;
                                                            ESP=TTOO] }
    { 8   ;TextBox      ;3190 ;1540 ;8250 ;440  ;ValidateTableRelation=No;
                                                 ParentControl=14;
                                                 InPage=0;
                                                 ClearOnLookup=No;
                                                 SourceExpr=FiltTTOO;
                                                 OnLookup=VAR
                                                            lrTTOO@1103355002 : Record 7009717;
                                                          BEGIN
                                                            CLEAR(lrTTOO);
                                                            IF lrTTOO.FIND('-') THEN BEGIN
                                                              IF FORM.RUNMODAL(0, lrTTOO)= ACTION::LookupOK THEN BEGIN
                                                                IF STRPOS(FiltTTOO,lrTTOO.TourOperador) = 0 THEN BEGIN
                                                                  IF FiltTTOO <>'' THEN
                                                                   FiltTTOO:= FiltTTOO + '|';
                                                                  FiltTTOO:= FiltTTOO + lrTTOO.TourOperador;
                                                                END;
                                                              END;
                                                            END;
                                                          END;
                                                           }
    { 77  ;Label        ;7920 ;1650 ;1430 ;330  ;Visible=No;
                                                 ParentControl=14;
                                                 InPage=0 }
    { 1   ;Label        ;11770;1540 ;2750 ;440  ;HorzGlue=Right;
                                                 ParentControl=14;
                                                 InPage=0;
                                                 CaptionML=[ENU=Day;
                                                            ESP=D¡a] }
    { 2   ;TextBox      ;14630;1540 ;2420 ;440  ;HorzGlue=Right;
                                                 ParentControl=14;
                                                 InPage=0;
                                                 SourceExpr=DiaInicial;
                                                 OnValidate=BEGIN

                                                              CurrForm.Matriz.MatrixRec."Period Start" := DiaInicial;
                                                            END;
                                                             }
    { 46  ;TextBox      ;3190 ;990  ;5060 ;440  ;Editable=No;
                                                 Focusable=No;
                                                 ParentControl=14;
                                                 InPage=0;
                                                 SourceExpr=Hotel + ' - ' + cNoms.nom_hotel(Hotel) }
    { 47  ;Label        ;330  ;990  ;2750 ;440  ;ParentControl=46;
                                                 CaptionML=[ENU=Hotel;
                                                            ESP=Hotel] }
    { 6   ;CheckBox     ;330  ;2200 ;440  ;440  ;Name=ch01;
                                                 ParentControl=14;
                                                 InPage=0;
                                                 ShowCaption=No;
                                                 CaptionML=[ENU=ch01;
                                                            ESP=ch01];
                                                 SourceExpr=ch01;
                                                 OnValidate=BEGIN

                                                              Filtros_TipHab();
                                                            END;
                                                             }
    { 7   ;TextBox      ;880  ;2200 ;1210 ;440  ;Name=tex01;
                                                 Visible=No;
                                                 Editable=No;
                                                 Focusable=No;
                                                 ParentControl=6;
                                                 Border=No;
                                                 CaptionML=[ENU=tex01;
                                                            ESP=tex01];
                                                 SourceExpr=tex01 }
    { 10  ;CheckBox     ;2200 ;2200 ;440  ;440  ;Name=ch03;
                                                 ParentControl=14;
                                                 InPage=0;
                                                 ShowCaption=No;
                                                 CaptionML=[ENU=ch03;
                                                            ESP=ch03];
                                                 SourceExpr=ch03;
                                                 OnValidate=BEGIN

                                                              Filtros_TipHab();
                                                            END;
                                                             }
    { 11  ;TextBox      ;2750 ;2200 ;1210 ;440  ;Name=Tex03;
                                                 Visible=No;
                                                 Editable=No;
                                                 Focusable=No;
                                                 ParentControl=10;
                                                 Border=No;
                                                 CaptionML=[ENU=Tex03;
                                                            ESP=Tex03];
                                                 SourceExpr=tex03 }
    { 12  ;CheckBox     ;4070 ;2200 ;440  ;440  ;Name=ch05;
                                                 ParentControl=14;
                                                 InPage=0;
                                                 ShowCaption=No;
                                                 CaptionML=[ENU=ch05;
                                                            ESP=ch05];
                                                 SourceExpr=ch05;
                                                 OnValidate=BEGIN

                                                              Filtros_TipHab();
                                                            END;
                                                             }
    { 13  ;TextBox      ;4620 ;2200 ;1210 ;440  ;Name=tex05;
                                                 Visible=No;
                                                 Editable=No;
                                                 Focusable=No;
                                                 ParentControl=12;
                                                 Border=No;
                                                 CaptionML=[ENU=tex05;
                                                            ESP=tex05];
                                                 SourceExpr=tex05 }
    { 15  ;CheckBox     ;5940 ;2200 ;440  ;440  ;Name=ch07;
                                                 ParentControl=14;
                                                 InPage=0;
                                                 ShowCaption=No;
                                                 CaptionML=[ENU=ch07;
                                                            ESP=ch07];
                                                 SourceExpr=ch07;
                                                 OnValidate=BEGIN

                                                              Filtros_TipHab();
                                                            END;
                                                             }
    { 16  ;TextBox      ;6490 ;2200 ;1210 ;440  ;Name=tex07;
                                                 Visible=No;
                                                 Editable=No;
                                                 Focusable=No;
                                                 ParentControl=15;
                                                 Border=No;
                                                 CaptionML=[ENU=tex07;
                                                            ESP=tex07];
                                                 SourceExpr=tex07 }
    { 18  ;CheckBox     ;7810 ;2200 ;440  ;440  ;Name=ch09;
                                                 ParentControl=14;
                                                 InPage=0;
                                                 ShowCaption=No;
                                                 CaptionML=[ENU=ch09;
                                                            ESP=ch09];
                                                 SourceExpr=ch09;
                                                 OnValidate=BEGIN

                                                              Filtros_TipHab();
                                                            END;
                                                             }
    { 25  ;TextBox      ;8360 ;2200 ;1210 ;440  ;Name=tex09;
                                                 Visible=No;
                                                 Editable=No;
                                                 Focusable=No;
                                                 ParentControl=18;
                                                 Border=No;
                                                 CaptionML=[ENU=tex09;
                                                            ESP=tex09];
                                                 SourceExpr=tex09 }
    { 27  ;CheckBox     ;5940 ;2750 ;440  ;440  ;Name=ch08;
                                                 ParentControl=14;
                                                 InPage=0;
                                                 ShowCaption=No;
                                                 CaptionML=[ENU=ch08;
                                                            ESP=ch08];
                                                 SourceExpr=ch08;
                                                 OnValidate=BEGIN

                                                              Filtros_TipHab();
                                                            END;
                                                             }
    { 28  ;TextBox      ;6490 ;2750 ;1210 ;440  ;Name=tex08;
                                                 Visible=No;
                                                 Editable=No;
                                                 Focusable=No;
                                                 ParentControl=27;
                                                 Border=No;
                                                 CaptionML=[ENU=tex08;
                                                            ESP=tex08];
                                                 SourceExpr=tex08 }
    { 29  ;CheckBox     ;7810 ;2750 ;440  ;440  ;Name=ch10;
                                                 ParentControl=14;
                                                 InPage=0;
                                                 ShowCaption=No;
                                                 CaptionML=[ENU=ch10;
                                                            ESP=ch10];
                                                 SourceExpr=ch10;
                                                 OnValidate=BEGIN

                                                              Filtros_TipHab();
                                                            END;
                                                             }
    { 30  ;TextBox      ;8360 ;2750 ;1210 ;440  ;Name=tex10;
                                                 Visible=No;
                                                 Editable=No;
                                                 Focusable=No;
                                                 ParentControl=29;
                                                 Border=No;
                                                 CaptionML=[ENU=tex10;
                                                            ESP=tex10];
                                                 SourceExpr=tex10 }
    { 33  ;CheckBox     ;4070 ;2750 ;440  ;440  ;Name=ch06;
                                                 ParentControl=14;
                                                 InPage=0;
                                                 ShowCaption=No;
                                                 CaptionML=[ENU=ch06;
                                                            ESP=ch06];
                                                 SourceExpr=ch06;
                                                 OnValidate=BEGIN

                                                              Filtros_TipHab();
                                                            END;
                                                             }
    { 34  ;TextBox      ;4620 ;2750 ;1210 ;440  ;Name=tex06;
                                                 Visible=No;
                                                 Editable=No;
                                                 Focusable=No;
                                                 ParentControl=33;
                                                 Border=No;
                                                 CaptionML=[ENU=tex06;
                                                            ESP=tex06];
                                                 SourceExpr=tex06 }
    { 35  ;CheckBox     ;2200 ;2750 ;440  ;440  ;Name=ch04;
                                                 ParentControl=14;
                                                 InPage=0;
                                                 ShowCaption=No;
                                                 CaptionML=[ENU=ch04;
                                                            ESP=ch04];
                                                 SourceExpr=ch04;
                                                 OnValidate=BEGIN

                                                              Filtros_TipHab();
                                                            END;
                                                             }
    { 36  ;TextBox      ;2750 ;2750 ;1210 ;440  ;Name=tex04;
                                                 Visible=No;
                                                 Editable=No;
                                                 Focusable=No;
                                                 ParentControl=35;
                                                 Border=No;
                                                 CaptionML=[ENU=tex04;
                                                            ESP=tex04];
                                                 SourceExpr=tex04 }
    { 37  ;CheckBox     ;330  ;2750 ;440  ;440  ;Name=ch02;
                                                 ParentControl=14;
                                                 InPage=0;
                                                 ShowCaption=No;
                                                 CaptionML=[ENU=ch02;
                                                            ESP=ch02];
                                                 SourceExpr=ch02;
                                                 OnPush=BEGIN

                                                          Filtros_TipHab();
                                                        END;
                                                         }
    { 38  ;TextBox      ;880  ;2750 ;1210 ;440  ;Name=Tex02;
                                                 Visible=No;
                                                 Editable=No;
                                                 Focusable=No;
                                                 ParentControl=37;
                                                 Border=No;
                                                 CaptionML=[ENU=Tex02;
                                                            ESP=Tex02];
                                                 SourceExpr=tex02 }
    { 48  ;CheckBox     ;9680 ;2200 ;440  ;440  ;Name=ch11;
                                                 ParentControl=14;
                                                 InPage=0;
                                                 ShowCaption=No;
                                                 CaptionML=[ENU=ch11;
                                                            ESP=ch11];
                                                 SourceExpr=ch11;
                                                 OnValidate=BEGIN

                                                              Filtros_TipHab();
                                                            END;
                                                             }
    { 50  ;TextBox      ;10230;2200 ;1210 ;440  ;Name=tex11;
                                                 Visible=No;
                                                 Editable=No;
                                                 Focusable=No;
                                                 ParentControl=48;
                                                 Border=No;
                                                 CaptionML=[ENU=tex11;
                                                            ESP=tex11];
                                                 SourceExpr=tex11 }
    { 49  ;CheckBox     ;9680 ;2750 ;440  ;440  ;Name=ch12;
                                                 ParentControl=14;
                                                 InPage=0;
                                                 ShowCaption=No;
                                                 CaptionML=[ENU=ch12;
                                                            ESP=ch12];
                                                 SourceExpr=ch12;
                                                 OnPush=BEGIN

                                                          Filtros_TipHab();
                                                        END;
                                                         }
    { 53  ;TextBox      ;10230;2750 ;1210 ;440  ;Name=Tex12;
                                                 Visible=No;
                                                 Editable=No;
                                                 Focusable=No;
                                                 ParentControl=49;
                                                 Border=No;
                                                 CaptionML=[ENU=Tex12;
                                                            ESP=Tex12];
                                                 SourceExpr=tex12 }
    { 51  ;CheckBox     ;11550;2200 ;440  ;440  ;Name=ch13;
                                                 ParentControl=14;
                                                 InPage=0;
                                                 ShowCaption=No;
                                                 CaptionML=[ENU=ch13;
                                                            ESP=ch13];
                                                 SourceExpr=ch13;
                                                 OnValidate=BEGIN

                                                              Filtros_TipHab();
                                                            END;
                                                             }
    { 54  ;TextBox      ;12100;2200 ;1210 ;440  ;Name=Tex13;
                                                 Visible=No;
                                                 Editable=No;
                                                 Focusable=No;
                                                 ParentControl=51;
                                                 Border=No;
                                                 CaptionML=[ENU=Tex13;
                                                            ESP=Tex13];
                                                 SourceExpr=tex13 }
    { 52  ;CheckBox     ;11550;2750 ;440  ;440  ;Name=ch14;
                                                 ParentControl=14;
                                                 InPage=0;
                                                 ShowCaption=No;
                                                 CaptionML=[ENU=ch14;
                                                            ESP=ch14];
                                                 SourceExpr=ch14;
                                                 OnValidate=BEGIN

                                                              Filtros_TipHab();
                                                            END;
                                                             }
    { 57  ;TextBox      ;12100;2750 ;1210 ;440  ;Name=tex14;
                                                 Visible=No;
                                                 Editable=No;
                                                 Focusable=No;
                                                 ParentControl=52;
                                                 Border=No;
                                                 CaptionML=[ENU=tex14;
                                                            ESP=tex14];
                                                 SourceExpr=tex14 }
    { 55  ;CheckBox     ;13420;2200 ;440  ;440  ;Name=ch15;
                                                 ParentControl=14;
                                                 InPage=0;
                                                 ShowCaption=No;
                                                 CaptionML=[ENU=ch15;
                                                            ESP=ch15];
                                                 SourceExpr=ch15;
                                                 OnValidate=BEGIN

                                                              Filtros_TipHab();
                                                            END;
                                                             }
    { 58  ;TextBox      ;13970;2200 ;1210 ;440  ;Name=tex15;
                                                 Visible=No;
                                                 Editable=No;
                                                 Focusable=No;
                                                 ParentControl=55;
                                                 Border=No;
                                                 CaptionML=[ENU=tex15;
                                                            ESP=tex15];
                                                 SourceExpr=tex15 }
    { 56  ;CheckBox     ;13420;2750 ;440  ;440  ;Name=ch16;
                                                 ParentControl=14;
                                                 InPage=0;
                                                 ShowCaption=No;
                                                 CaptionML=[ENU=ch16;
                                                            ESP=ch16];
                                                 SourceExpr=ch16;
                                                 OnValidate=BEGIN

                                                              Filtros_TipHab();
                                                            END;
                                                             }
    { 59  ;TextBox      ;13970;2750 ;1210 ;440  ;Name=tex16;
                                                 Visible=No;
                                                 Editable=No;
                                                 Focusable=No;
                                                 ParentControl=56;
                                                 Border=No;
                                                 CaptionML=[ENU=tex16;
                                                            ESP=tex16];
                                                 SourceExpr=tex16 }
    { 60  ;CheckBox     ;15290;2200 ;440  ;440  ;Name=ch17;
                                                 ParentControl=14;
                                                 InPage=0;
                                                 ShowCaption=No;
                                                 CaptionML=[ENU=ch17;
                                                            ESP=ch17];
                                                 SourceExpr=ch17;
                                                 OnValidate=BEGIN

                                                              Filtros_TipHab();
                                                            END;
                                                             }
    { 61  ;TextBox      ;15840;2200 ;1210 ;440  ;Name=tex17;
                                                 Visible=No;
                                                 Editable=No;
                                                 Focusable=No;
                                                 ParentControl=60;
                                                 Border=No;
                                                 CaptionML=[ENU=tex17;
                                                            ESP=tex17];
                                                 SourceExpr=tex17 }
    { 9   ;CommandButton;15070;9790 ;2200 ;550  ;HorzGlue=Right;
                                                 VertGlue=Bottom;
                                                 PushAction=FormHelp }
    { 19  ;OptionButton ;2860 ;9790 ;550  ;550  ;VertGlue=Bottom;
                                                 FocusOnClick=No;
                                                 ShowCaption=No;
                                                 Border=Yes;
                                                 BitmapPos=Center;
                                                 Bitmap=14;
                                                 ToolTipML=[ENU=Accounting term;
                                                            ESP=Periodo contable];
                                                 SourceExpr=TipoPeriodo;
                                                 OptionValue=Periodo contable }
    { 20  ;OptionButton ;2310 ;9790 ;550  ;550  ;VertGlue=Bottom;
                                                 FocusOnClick=No;
                                                 ShowCaption=No;
                                                 Border=Yes;
                                                 BitmapPos=Center;
                                                 Bitmap=13;
                                                 ToolTipML=[ENU=Year;
                                                            ESP=A¤o];
                                                 SourceExpr=TipoPeriodo;
                                                 OptionValue=A¤o }
    { 21  ;OptionButton ;1760 ;9790 ;550  ;550  ;VertGlue=Bottom;
                                                 FocusOnClick=No;
                                                 ShowCaption=No;
                                                 Border=Yes;
                                                 BitmapPos=Center;
                                                 Bitmap=12;
                                                 ToolTipML=[ENU=Three-month;
                                                            ESP=Trimestre];
                                                 SourceExpr=TipoPeriodo;
                                                 OptionValue=Trimestre }
    { 22  ;OptionButton ;1210 ;9790 ;550  ;550  ;VertGlue=Bottom;
                                                 FocusOnClick=No;
                                                 ShowCaption=No;
                                                 Border=Yes;
                                                 BitmapPos=Center;
                                                 Bitmap=11;
                                                 ToolTipML=[ENU=Month;
                                                            ESP=Mes];
                                                 SourceExpr=TipoPeriodo;
                                                 OptionValue=Mes }
    { 23  ;OptionButton ;660  ;9790 ;550  ;550  ;VertGlue=Bottom;
                                                 FocusOnClick=No;
                                                 ShowCaption=No;
                                                 Border=Yes;
                                                 BitmapPos=Center;
                                                 Bitmap=10;
                                                 ToolTipML=[ENU=Week;
                                                            ESP=Semana];
                                                 SourceExpr=TipoPeriodo;
                                                 OptionValue=Semana }
    { 24  ;OptionButton ;110  ;9790 ;550  ;550  ;VertGlue=Bottom;
                                                 FocusOnClick=No;
                                                 ShowCaption=No;
                                                 Border=Yes;
                                                 BitmapPos=Center;
                                                 Bitmap=9;
                                                 ToolTipML=[ENU=Day;
                                                            ESP=D¡a];
                                                 SourceExpr=TipoPeriodo;
                                                 OptionValue=D¡a }
    { 26  ;MatrixBox    ;110  ;3630 ;17160;5940 ;Name=Matriz;
                                                 HorzGlue=Both;
                                                 VertGlue=Both;
                                                 Editable=No;
                                                 MatrixSourceTable=Table2000000007;
                                                 OnFindRecord=BEGIN

                                                                IF CurrForm.Matriz.MatrixRec."Period Start" = 0D THEN
                                                                  CurrForm.Matriz.MatrixRec."Period Start" := DiaInicial;

                                                                EXIT(GestionFormPeriodo.FindDate(Which,CurrForm.Matriz.MatrixRec,TipoPeriodo));
                                                              END;

                                                 OnNextRecord=BEGIN

                                                                EXIT(GestionFormPeriodo.NextDate(Steps,CurrForm.Matriz.MatrixRec,TipoPeriodo));
                                                              END;

                                                 OnAfterGetRecord=BEGIN

                                                                    // AsigFiltFecha;

                                                                    IF TipoHab = TipoHab::Basica THEN
                                                                      Importe := CalculaImporteBas(Rec)
                                                                    ELSE
                                                                      Importe := CalculaImporteCup(Rec);
                                                                  END;
                                                                   }
    { 3   ;TextBox      ;0    ;2090 ;4070 ;440  ;Name=Texto;
                                                 ParentControl=26;
                                                 InColumn=Yes;
                                                 CaptionML=[ENU=Text;
                                                            ESP=Texto];
                                                 SourceExpr=Texto;
                                                 OnFormat=BEGIN

                                                            CurrForm.Texto.UPDATEFONTBOLD := FALSE;
                                                            CurrForm.Texto.UPDATEINDENT(0);

                                                            IF "Tipo de Registro" = "Tipo de Registro"::T¡tulo THEN
                                                              CurrForm.Texto.UPDATEFONTBOLD := TRUE
                                                            ELSE
                                                              CurrForm.Texto.UPDATEINDENT(440);
                                                          END;
                                                           }
    { 4   ;Label        ;0    ;0    ;0    ;0    ;ParentControl=3;
                                                 InColumnHeading=Yes }
    { 31  ;TextBox      ;5684 ;2530 ;11703;440  ;Name=Importe;
                                                 ParentControl=26;
                                                 InMatrix=Yes;
                                                 CaptionML=[ENU=Amount;
                                                            ESP=Importe];
                                                 BlankZero=Yes;
                                                 SourceExpr=Importe;
                                                 OnActivate=BEGIN
                                                              AsigFiltFecha;
                                                            END;

                                                 OnFormat=BEGIN

                                                            IF Importe > 0 THEN
                                                              CurrForm.Importe.UPDATEFORECOLOR(16711680)
                                                            ELSE
                                                              IF Importe < 0 THEN
                                                                CurrForm.Importe.UPDATEFORECOLOR(255)
                                                              ELSE
                                                                CurrForm.Importe.UPDATEFORECOLOR(0);
                                                          END;

                                                 OnDrillDown=VAR
                                                               ok@1103355001 : Boolean;
                                                             BEGIN

                                                               IF ("Tipo de Registro" = "Tipo de Registro"::Contrato) THEN BEGIN
                                                                 rCup.RESET;
                                                                 rCup.SETCURRENTKEY(Dia,Hotel,TourOperador);
                                                                 rCup.SETRANGE(Hotel,Hotel);
                                                                 rCup.SETRANGE(Dia,CurrForm.Matriz.MatrixRec."Period Start",CurrForm.Matriz.MatrixRec."Period End");
                                                                 IF Rec."C¢d. habitaci¢n" = '' THEN
                                                                   rCup.SETRANGE(rCup."Habitacion basica")
                                                                 ELSE BEGIN
                                                                   IF "Tipo Habitacion" = "Tipo Habitacion"::Basica THEN
                                                                     rCup.SETRANGE(rCup."Habitacion basica", "C¢d. habitaci¢n")
                                                                   ELSE
                                                                     rCup.SETRANGE(Habitacion, "C¢d. habitaci¢n");
                                                                 END;
                                                                 FORM.RUN(0,rCup);
                                                               END;

                                                               IF ("Tipo de Registro" = "Tipo de Registro"::Cupo) THEN BEGIN
                                                                 rCup.RESET;
                                                                 rCup.SETCURRENTKEY(Dia,Hotel,TourOperador);
                                                                 rCup.SETRANGE(Hotel,Hotel);
                                                                 IF FiltTTOO = '' THEN
                                                                   rCup.SETRANGE(TourOperador)
                                                                 ELSE
                                                                   rCup.SETFILTER(TourOperador,FiltTTOO);
                                                                 IF Rec."C¢d. habitaci¢n" = '' THEN
                                                                   rCup.SETRANGE(rCup."Habitacion basica")
                                                                 ELSE BEGIN
                                                                   IF "Tipo Habitacion" = "Tipo Habitacion"::Basica THEN
                                                                     rCup.SETRANGE(rCup."Habitacion basica",Rec."C¢d. habitaci¢n")
                                                                   ELSE
                                                                     rCup.SETRANGE(rCup.Habitacion, Rec."C¢d. habitaci¢n");
                                                                 END;
                                                                 rCup.SETRANGE(Dia,CurrForm.Matriz.MatrixRec."Period Start",CurrForm.Matriz.MatrixRec."Period End");
                                                                 FORM.RUN(0,rCup);
                                                               END;
                                                               // AJS 30-06-99
                                                               //
                                                               IF ("Tipo de Registro" = "Tipo de Registro"::Prevision) THEN BEGIN
                                                                 rPre.RESET;
                                                                 IF "Tipo Habitacion" = "Tipo Habitacion"::Basica THEN
                                                                   rPre.SETCURRENTKEY("Tipo Contrato",
                                                                                      Hotel,
                                                                                      TourOperador,
                                                                                      Dia,
                                                                                      "Habitacion basica")
                                                                 ELSE
                                                                   rPre.SETCURRENTKEY("Tipo Contrato",
                                                                                      Hotel,
                                                                                      TourOperador,
                                                                                      Dia,
                                                                                      "Habitacion cupo");
                                                                 rPre.SETRANGE("Tipo Contrato", rPre."Tipo Contrato"::Venta);
                                                                 rPre.SETRANGE(Hotel          , Hotel);
                                                                 IF FiltTTOO = '' THEN
                                                                   rPre.SETRANGE(TourOperador)
                                                                 ELSE
                                                                   rPre.SETFILTER(TourOperador, FiltTTOO);
                                                                 IF Rec."C¢d. habitaci¢n" = '' THEN
                                                                   rPre.SETRANGE("Habitacion basica")
                                                                 ELSE BEGIN
                                                                   IF "Tipo Habitacion" = "Tipo Habitacion"::Basica THEN
                                                                     rPre.SETRANGE("Habitacion basica",Rec."C¢d. habitaci¢n")
                                                                   ELSE
                                                                     rPre.SETRANGE("Habitacion cupo", Rec."C¢d. habitaci¢n");
                                                                 END;
                                                                 rPre.SETRANGE(Dia, CurrForm.Matriz.MatrixRec."Period Start", CurrForm.Matriz.MatrixRec."Period End");
                                                                 FORM.RUN(0, rPre);
                                                               END;
                                                               // FIN AJS 30-06-99
                                                               //
                                                               IF ("Tipo de Registro" = "Tipo de Registro"::Ocupado) OR ("Tipo de Registro" = "Tipo de Registro"::Asignado) THEN BEGIN
                                                                 rRsv.RESET;
                                                                 IF ("Tipo de Registro" = "Tipo de Registro"::Ocupado) AND rHot.NoName THEN BEGIN
                                                                   IF "Tipo Habitacion" = "Tipo Habitacion"::Basica THEN
                                                                     rRsv.SETCURRENTKEY("Hotel Reservado", TourOperador, Dia, Habitacion)
                                                                   ELSE
                                                                     rRsv.SETCURRENTKEY("Hotel Reservado", TourOperador, Dia, "Habitacion cupo");
                                                                   rRsv.SETRANGE(rRsv."Hotel Reservado",Hotel);
                                                                   IF FiltTTOO = '' THEN
                                                                     rRsv.SETRANGE(TourOperador)
                                                                   ELSE
                                                                     rRsv.SETFILTER(TourOperador,FiltTTOO);
                                                                   rRsv.SETRANGE(Dia, CurrForm.Matriz.MatrixRec."Period Start", CurrForm.Matriz.MatrixRec."Period End");
                                                                   IF Rec."C¢d. habitaci¢n" = '' THEN
                                                                     rRsv.SETRANGE(rRsv.Habitacion)
                                                                   ELSE BEGIN
                                                                     IF "Tipo Habitacion" = "Tipo Habitacion"::Basica THEN
                                                                       rRsv.SETRANGE(rRsv.Habitacion, "C¢d. habitaci¢n")
                                                                     ELSE
                                                                       rRsv.SETRANGE(rRsv."Habitacion cupo", "C¢d. habitaci¢n");
                                                                   END;
                                                                   rRsv.SETRANGE("Cantidad booking");
                                                                   rRsv.SETRANGE(Asignado);
                                                                   rRsv.SETFILTER("Cantidad reservado",'>%1',0);
                                                                   FORM.RUN(0,rRsv);
                                                                 END
                                                                 ELSE BEGIN
                                                                   IF "Tipo Habitacion" = "Tipo Habitacion"::Basica THEN
                                                                     rRsv.SETCURRENTKEY("Hotel Booking", TourOperador, Dia, Habitacion)
                                                                   ELSE
                                                                     rRsv.SETCURRENTKEY("Hotel Booking", TourOperador, Dia, "Habitacion cupo");
                                                                   rRsv.SETRANGE(rRsv."Hotel Booking",Hotel);
                                                                   IF FiltTTOO = '' THEN
                                                                     rRsv.SETRANGE(TourOperador)
                                                                   ELSE
                                                                     rRsv.SETFILTER(TourOperador,FiltTTOO);
                                                                   rRsv.SETRANGE(Dia, CurrForm.Matriz.MatrixRec."Period Start", CurrForm.Matriz.MatrixRec."Period End");
                                                                   IF Rec."C¢d. habitaci¢n" = '' THEN
                                                                     rRsv.SETRANGE(rRsv.Habitacion)
                                                                   ELSE BEGIN
                                                                     IF "Tipo Habitacion" = "Tipo Habitacion"::Basica THEN
                                                                       rRsv.SETRANGE(rRsv.Habitacion, "C¢d. habitaci¢n")
                                                                     ELSE
                                                                       rRsv.SETRANGE(rRsv."Habitacion cupo", "C¢d. habitaci¢n");
                                                                   END;
                                                                   rRsv.SETRANGE("Cantidad booking");
                                                                   rRsv.SETRANGE(Asignado);
                                                                   IF ("Tipo de Registro" = "Tipo de Registro"::Ocupado) THEN
                                                                     rRsv.SETFILTER("Cantidad booking",'>%1',0);
                                                                   IF ("Tipo de Registro" = "Tipo de Registro"::Asignado) THEN
                                                                     rRsv.SETFILTER(Asignado,'>%1',0);
                                                                   FORM.RUN(0,rRsv);
                                                                 END;
                                                               END;
                                                             END;
                                                              }
    { 32  ;TextBox      ;9570 ;3300 ;2200 ;440  ;Name=Cab;
                                                 ParentControl=31;
                                                 InMatrixHeading=Yes;
                                                 CaptionML=[ENU=Term;
                                                            ESP=Periodo];
                                                 SourceExpr=GestionFormPeriodo.CreatePeriodFormat(TipoPeriodo,CurrForm.Matriz.MatrixRec."Period Start");
                                                 OnFormat=BEGIN
                                                            IF Ovbk() = '*' THEN BEGIN
                                                              IF Paro() = '*' THEN BEGIN
                                                                CurrForm.Cab.UPDATEFORECOLOR(65280);  // Verde
                                                                CurrForm.Cab.UPDATEFONTBOLD(TRUE);
                                                              END
                                                              ELSE BEGIN
                                                                CurrForm.Cab.UPDATEFORECOLOR(255);  // Rojo
                                                                CurrForm.Cab.UPDATEFONTBOLD(TRUE);
                                                              END;
                                                            END
                                                            ELSE BEGIN
                                                              IF Paro() = '*' THEN BEGIN
                                                                CurrForm.Cab.UPDATEFORECOLOR(65535);  // Amarillo
                                                                CurrForm.Cab.UPDATEFONTBOLD(TRUE);
                                                              END
                                                              ELSE BEGIN
                                                                CurrForm.Cab.UPDATEFORECOLOR(0);  // Negro
                                                                CurrForm.Cab.UPDATEFONTBOLD(TRUE);
                                                              END;
                                                            END;
                                                          END;
                                                           }
    { 5   ;MenuButton   ;12650;9790 ;2200 ;550  ;HorzGlue=Right;
                                                 VertGlue=Bottom;
                                                 CaptionML=[ENU=&Hotel;
                                                            ESP=Hote&l];
                                                 Menu=MENUITEMS
                                                 {
                                                   { ID=62;
                                                     CaptionML=[ENU=Windows;
                                                                ESP=Ventanas] }
                                                   { ID=39;
                                                     PushAction=RunObject;
                                                     ShortCutKey=Ctrl+F5;
                                                     MenuLevel=1;
                                                     CaptionML=[ENU=&Card;
                                                                ESP=&Ficha];
                                                     RunObject=Form 7009730;
                                                     RunFormLink=Hotel=FIELD(Hotel) }
                                                   { ID=63;
                                                     MenuLevel=1;
                                                     CaptionML=[ENU=Contracts;
                                                                ESP=Contratos];
                                                     OnPush=VAR
                                                              rConVen@1103355001 : Record 7009727;
                                                            BEGIN
                                                              rConVen.RESET;
                                                              rConVen.SETCURRENTKEY(Delegacion, TourOperador, Hotel, "Fecha inicio contrato", "Fecha final contrato");
                                                              IF FiltTTOO <> '' THEN
                                                                rConVen.SETFILTER(TourOperador, FiltTTOO);

                                                              rConVen.SETRANGE (Hotel, Hotel);
                                                              rConVen.SETFILTER("Fecha inicio contrato", '<=%1', CurrForm.Matriz.MatrixRec."Period Start");
                                                              rConVen.SETFILTER("Fecha final contrato" , '>=%1', CurrForm.Matriz.MatrixRec."Period Start");
                                                              FORM.RUNMODAL(FORM::"Tabla Contrato venta hotel", rConVen);
                                                              rConVen.RESET;
                                                            END;
                                                             }
                                                   { ID=64;
                                                     CaptionML=[ENU=Listed;
                                                                ESP=Listados] }
                                                   { ID=44;
                                                     MenuLevel=1;
                                                     CaptionML=[ENU=Print;
                                                                ESP=Impresion];
                                                     OnPush=VAR
                                                              repBooking@1103355001 : Report 7009723;
                                                            BEGIN
                                                              //REPORT.RUNMODAL(7009723, TRUE, FALSE, Rec);
                                                              CLEAR(repBooking);
                                                              repBooking.Parametros(FiltTTOO,
                                                                                    CurrForm.Matriz.MatrixRec."Period Start",
                                                                                    CurrForm.Matriz.MatrixRec."Period End",
                                                                                    TipoPeriodo,
                                                                                    TipoHab);
                                                              repBooking.SETTABLEVIEW(Rec);
                                                              repBooking.RUNMODAL;
                                                              CLEAR(repBooking);
                                                            END;
                                                             }
                                                   { ID=65;
                                                     PushAction=RunObject;
                                                     MenuLevel=1;
                                                     CaptionML=[ENU=Rooming List;
                                                                ESP=Rooming List];
                                                     RunObject=Report 7009701 }
                                                   { ID=40;
                                                     Visible=No;
                                                     CaptionML=[ENU=Caption;
                                                                ESP=Leyenda];
                                                     OnPush=BEGIN
                                                              MESSAGE(Text000 +
                                                                      '\' +
                                                                      Text001 +
                                                                      Text002 +
                                                                      Text003 +
                                                                      Text004);
                                                            END;
                                                             }
                                                 }
                                                  }
    { 42  ;OptionButton ;4290 ;9790 ;550  ;550  ;VertGlue=Bottom;
                                                 FocusOnClick=No;
                                                 HorzAlign=Center;
                                                 Border=Yes;
                                                 FontBold=Yes;
                                                 BitmapPos=None;
                                                 CaptionML=[ENU=C;
                                                            ESP=C];
                                                 ToolTipML=[ENU=Allotment;
                                                            ESP=Cupo];
                                                 SourceExpr=TipoHab;
                                                 OptionValue=Cupo;
                                                 OnPush=BEGIN

                                                          SETRANGE("Tipo Habitacion",TipoHab);
                                                          Habitaciones();
                                                        END;
                                                         }
    { 43  ;OptionButton ;3740 ;9790 ;550  ;550  ;VertGlue=Bottom;
                                                 FocusOnClick=No;
                                                 HorzAlign=Center;
                                                 Border=Yes;
                                                 FontBold=Yes;
                                                 BitmapPos=None;
                                                 CaptionML=[ENU=B;
                                                            ESP=B];
                                                 ToolTipML=[ENU=Basic;
                                                            ESP=Basica];
                                                 SourceExpr=TipoHab;
                                                 OptionValue=Basica;
                                                 OnPush=BEGIN

                                                          SETRANGE("Tipo Habitacion",TipoHab);
                                                          Habitaciones();
                                                        END;
                                                         }
    { 45  ;TextBox      ;4950 ;9790 ;2420 ;550  ;VertGlue=Bottom;
                                                 Editable=No;
                                                 Focusable=No;
                                                 SourceExpr=TipoHab }
    { 41  ;Shape        ;110  ;10450;17160;660  ;HorzGlue=Both;
                                                 VertGlue=Bottom }
    { 66  ;Shape        ;330  ;10560;440  ;440  ;HorzGlue=Right;
                                                 VertGlue=Bottom;
                                                 BackColor=65280;
                                                 BackTransparent=No }
    { 67  ;Label        ;880  ;10560;4070 ;440  ;HorzGlue=Right;
                                                 VertGlue=Bottom;
                                                 LeaderDots=No;
                                                 CaptionML=[ENU=Sales stop + Overbooking;
                                                            ESP=Paro de ventas + Overbooking] }
    { 68  ;Shape        ;6380 ;10560;440  ;440  ;HorzGlue=Right;
                                                 VertGlue=Bottom;
                                                 BackColor=255;
                                                 BackTransparent=No }
    { 69  ;Label        ;6930 ;10560;1760 ;440  ;HorzGlue=Right;
                                                 VertGlue=Bottom;
                                                 LeaderDots=No;
                                                 CaptionML=[ENU=Overbooking;
                                                            ESP=Overbooking] }
    { 70  ;Shape        ;9900 ;10560;440  ;440  ;HorzGlue=Right;
                                                 VertGlue=Bottom;
                                                 BackColor=65535;
                                                 BackTransparent=No }
    { 71  ;Label        ;10450;10560;2090 ;440  ;HorzGlue=Right;
                                                 VertGlue=Bottom;
                                                 LeaderDots=No;
                                                 CaptionML=[ENU=Sales stop;
                                                            ESP=Paro de ventas] }
    { 72  ;Shape        ;13750;10560;440  ;440  ;HorzGlue=Right;
                                                 VertGlue=Bottom;
                                                 BackColor=0;
                                                 BackTransparent=No }
    { 73  ;Label        ;14300;10560;1870 ;440  ;HorzGlue=Right;
                                                 VertGlue=Bottom;
                                                 LeaderDots=No;
                                                 CaptionML=[ENU=Normal date;
                                                            ESP=Fecha normal] }
  }
  CODE
  {
    VAR
      Text000@1103355065 : TextConst 'ENU=CAPTION OF COLORS\;ESP=LEYENDA DE COLORES\';
      Text001@1103355066 : TextConst 'ENU=Green    --> Sales Stop + Overbooking\;ESP=Verde    --> Paro Ventas + Overbooking\';
      Text002@1103355067 : TextConst 'ENU=Red     --> Overbooking\;ESP=Rojo     --> Overbooking\';
      Text003@1103355068 : TextConst 'ENU=Yellow --> Sales Stop\;ESP=Amarillo --> Paro ventas\';
      Text004@1103355069 : TextConst 'ENU=Black   --> Normal;ESP=Negro    --> Normal';
      rRsv@1103355000 : Record 7009756;
      rTTOO@1103355001 : Record 7009717;
      PeriodoContable@1103355002 : Record 50;
      rTipHab@1103355003 : Record 7009711;
      GestionFormPeriodo@1103355004 : Codeunit 359;
      rCup@1103355005 : Record 7009758;
      rPre@1103355006 : Record 7009783;
      rTra@1103355007 : Record 7009776;
      rHot@1103355008 : Record 7009724;
      rHotOvk@1103355009 : Record 7009780;
      TipoPeriodo@1103355010 : 'D¡a,Semana,Mes,Trimestre,A¤o,Periodo contable';
      TipoImporte@1103355011 : 'Ocupaci¢n,Estancias,Porcentaje,Libres';
      Importe@1103355012 : Decimal;
      FactorRedondeo@1103355013 : 'No,1,1000,1000000';
      FiltTTOO@1103355014 : Code[100];
      UltGra@1103355015 : Integer;
      wOrden@1103355016 : Integer;
      wFecha@1103355017 : Date;
      EspacioEntreFechas@1103355018 : Text[10];
      PrimeraFecha@1103355019 : Text[10];
      UltimaFecha@1103355020 : Text[10];
      wFechaInicio@1103355021 : Date;
      wFechaFin@1103355022 : Date;
      Numhabi@1103355023 : Integer;
      DiaInicial@1103355024 : Date;
      ch01@1103355025 : Boolean;
      ch02@1103355026 : Boolean;
      ch03@1103355027 : Boolean;
      ch04@1103355028 : Boolean;
      ch05@1103355029 : Boolean;
      ch06@1103355030 : Boolean;
      ch07@1103355031 : Boolean;
      ch08@1103355032 : Boolean;
      ch09@1103355033 : Boolean;
      ch10@1103355034 : Boolean;
      ch11@1103355035 : Boolean;
      ch12@1103355036 : Boolean;
      ch13@1103355037 : Boolean;
      ch14@1103355038 : Boolean;
      ch15@1103355039 : Boolean;
      ch16@1103355040 : Boolean;
      ch17@1103355041 : Boolean;
      tex01@1103355042 : Text[10];
      tex02@1103355043 : Text[10];
      tex03@1103355044 : Text[10];
      tex04@1103355045 : Text[10];
      tex05@1103355046 : Text[10];
      tex06@1103355047 : Text[10];
      tex07@1103355048 : Text[10];
      tex08@1103355049 : Text[10];
      tex09@1103355050 : Text[10];
      tex10@1103355051 : Text[10];
      tex11@1103355052 : Text[10];
      tex12@1103355053 : Text[10];
      tex13@1103355054 : Text[10];
      tex14@1103355055 : Text[10];
      tex15@1103355056 : Text[10];
      tex16@1103355057 : Text[10];
      tex17@1103355058 : Text[10];
      ind@1103355059 : Integer;
      FiltHab@1103355060 : Text[218];
      PrimerFiltro@1103355061 : Boolean;
      TipoHab@1103355062 : 'Basica,Cupo';
      CH@1103355063 : ARRAY [17,2] OF Boolean;
      cNoms@1103355064 : Codeunit 7009702;

    LOCAL PROCEDURE AsigFiltFecha@1();
    BEGIN

      Rec.SETRANGE(Hotel,Hotel);

      IF FiltTTOO = '' THEN
        SETRANGE("TourOperador Rango")
      ELSE
        SETFILTER("TourOperador Rango",FiltTTOO);

      SETRANGE("Dia Rango",CurrForm.Matriz.MatrixRec."Period Start",CurrForm.Matriz.MatrixRec."Period End");
    END;

    PROCEDURE CalculaImporteBas@2(Rec@1103355000 : Record 7009776) imp : Decimal;
    VAR
      ok@1103355001 : Boolean;
    BEGIN
      // CalculaImporteBas
      //
      Rec.SETRANGE(Hotel,Hotel);

      IF FiltTTOO = '' THEN
        Rec.SETRANGE("TourOperador Rango")
      ELSE
        Rec.SETFILTER("TourOperador Rango",FiltTTOO);

      Rec.SETRANGE("Dia Rango",CurrForm.Matriz.MatrixRec."Period Start",CurrForm.Matriz.MatrixRec."Period End");

      IF Rec."C¢d. habitaci¢n" = '' THEN
        Rec.SETRANGE("Habitacion Rango")
      ELSE
        Rec.SETRANGE("Habitacion Rango",Rec."C¢d. habitaci¢n");

      IF "Tipo de Registro" = "Tipo de Registro"::T¡tulo THEN BEGIN
          imp := 0;
        END;

      IF "Tipo de Registro" = "Tipo de Registro"::Contrato THEN BEGIN
        Rec.CALCFIELDS("Cupo hotel");
        imp := Rec."Cupo hotel";
      END;

      IF "Tipo de Registro" = "Tipo de Registro"::Cupo THEN BEGIN
        Rec.CALCFIELDS("Cupo contratado");
        imp := Rec."Cupo contratado";
      END;
      // AJS 30-06-99
      //
      IF "Tipo de Registro" = "Tipo de Registro"::Prevision THEN BEGIN
        IF rHot.NoName THEN BEGIN
          Rec.CALCFIELDS(Reservado);
          Rec.CALCFIELDS(Asignado);
          Rec.CALCFIELDS("Prevision ocupacion");
          IF Rec."Prevision ocupacion" <> 0 THEN
            imp := Rec."Prevision ocupacion" - Rec.Reservado - Rec.Asignado
          ELSE
            imp := Rec."Prevision ocupacion";
        END
        ELSE BEGIN
          Rec.CALCFIELDS(Ocupado);
          Rec.CALCFIELDS(Asignado);
          Rec.CALCFIELDS("Prevision ocupacion");
          IF Rec."Prevision ocupacion" <> 0 THEN
            imp := Rec."Prevision ocupacion" - Rec.Ocupado - Rec.Asignado
          ELSE
            imp := Rec."Prevision ocupacion";
        END;
      END;
      // AJS 30-06-99
      IF "Tipo de Registro" = "Tipo de Registro"::Ocupado THEN BEGIN
        IF rHot.NoName THEN BEGIN
          Rec.CALCFIELDS(Reservado);
          imp := Rec.Reservado;
        END
        ELSE BEGIN
          Rec.CALCFIELDS(Ocupado);
          imp := Rec.Ocupado;
        END
      END;

      IF "Tipo de Registro" = "Tipo de Registro"::Asignado THEN BEGIN
        Rec.CALCFIELDS(Asignado);
        imp := Rec.Asignado;
      END;
      IF "Tipo de Registro" = "Tipo de Registro"::Libre THEN BEGIN
        IF rHot.NoName THEN BEGIN
          Rec.CALCFIELDS("Cupo contratado");
          Rec.CALCFIELDS(Reservado);
          Rec.CALCFIELDS(Asignado);
          imp := Rec."Cupo contratado" - Rec.Reservado - Rec.Asignado;
        END
        ELSE BEGIN
          Rec.CALCFIELDS("Cupo contratado");
          Rec.CALCFIELDS(Ocupado);
          Rec.CALCFIELDS(Asignado);
          imp := Rec."Cupo contratado" - Rec.Ocupado - Rec.Asignado;
        END;
      END;
      IF "Tipo de Registro" = "Tipo de Registro"::Porcentaje THEN BEGIN
        IF rHot.NoName THEN BEGIN
          Rec.CALCFIELDS("Cupo contratado");
          Rec.CALCFIELDS(Reservado);
          Rec.CALCFIELDS(Asignado);
          IF Rec."Cupo contratado" = 0 THEN
            imp := 0
          ELSE
            imp := ROUND(((Rec.Reservado + Rec.Asignado) * 100) / Rec."Cupo contratado");
        END
        ELSE BEGIN
          Rec.CALCFIELDS("Cupo contratado");
          Rec.CALCFIELDS(Ocupado);
          Rec.CALCFIELDS(Asignado);
          IF Rec."Cupo contratado" = 0 THEN
            imp := 0
          ELSE
            imp := ROUND(((Rec.Ocupado + Rec.Asignado) * 100) / Rec."Cupo contratado");
        END;
      END;
      // AJS 30-06-99
      //
      IF "Tipo de Registro" = "Tipo de Registro"::"Porcentaje prevision" THEN BEGIN
        IF rHot.NoName THEN BEGIN
          Rec.CALCFIELDS("Cupo contratado");
          Rec.CALCFIELDS(Reservado);
          Rec.CALCFIELDS(Asignado);
          Rec.CALCFIELDS("Prevision ocupacion");
          IF Rec."Cupo contratado" = 0 THEN
            imp := 0
          ELSE BEGIN
            IF Rec."Prevision ocupacion" > (Rec.Reservado + Rec.Asignado) THEN
              imp := ROUND((Rec."Prevision ocupacion" * 100) / Rec."Cupo contratado")
            ELSE
              imp := ROUND(((Rec.Reservado + Rec.Asignado) * 100) / Rec."Cupo contratado");
          END;
        END
        ELSE BEGIN
          Rec.CALCFIELDS("Cupo contratado");
          Rec.CALCFIELDS(Ocupado);
          Rec.CALCFIELDS(Asignado);
          Rec.CALCFIELDS("Prevision ocupacion");
          IF Rec."Cupo contratado" = 0 THEN
            imp := 0
          ELSE BEGIN
            IF Rec."Prevision ocupacion" > (Rec.Ocupado + Rec.Asignado) THEN
              imp := ROUND((Rec."Prevision ocupacion" * 100) / Rec."Cupo contratado")
            ELSE
              imp := ROUND(((Rec.Ocupado + Rec.Asignado) * 100) / Rec."Cupo contratado");
          END;
        END;
      END;
      // FIN AJS 30-06-99
      //
    END;

    PROCEDURE CalculaImporteCup@4(Rec@1103355000 : Record 7009776) imp : Decimal;
    VAR
      ok@1103355001 : Boolean;
    BEGIN
      // CalculaImporteCup
      //
      Rec.SETRANGE(Hotel,Hotel);

      IF FiltTTOO = '' THEN
        Rec.SETRANGE("TourOperador Rango")
      ELSE
        Rec.SETFILTER("TourOperador Rango",FiltTTOO);

      Rec.SETRANGE("Dia Rango",CurrForm.Matriz.MatrixRec."Period Start",CurrForm.Matriz.MatrixRec."Period End");

      IF Rec."C¢d. habitaci¢n" = '' THEN
        Rec.SETRANGE("Habitacion Cupo Rango")
      ELSE
        Rec.SETRANGE("Habitacion Cupo Rango",Rec."C¢d. habitaci¢n");

      IF "Tipo de Registro" = "Tipo de Registro"::T¡tulo THEN BEGIN
          imp := 0;
        END;

      IF "Tipo de Registro" = "Tipo de Registro"::Contrato THEN BEGIN
        Rec.CALCFIELDS("Cupo hotel 2");
        imp := Rec."Cupo hotel 2";
      END;
      IF "Tipo de Registro" = "Tipo de Registro"::Cupo THEN BEGIN
        Rec.CALCFIELDS("Cupo contratado 2");
        imp := Rec."Cupo contratado 2";
      END;
      // AJS 30-06-99
      //
      IF "Tipo de Registro" = "Tipo de Registro"::Prevision THEN BEGIN
        IF rHot.NoName THEN BEGIN
          Rec.CALCFIELDS("Reservado 2");
          Rec.CALCFIELDS("Asignado 2");
          Rec.CALCFIELDS("Prevision ocupacion 2");
          IF Rec."Prevision ocupacion 2" <> 0 THEN
            imp := Rec."Prevision ocupacion 2" - Rec."Reservado 2" - Rec."Asignado 2"
          ELSE
            imp := Rec."Prevision ocupacion 2";
        END
        ELSE BEGIN
          Rec.CALCFIELDS("Ocupado 2");
          Rec.CALCFIELDS("Asignado 2");
          Rec.CALCFIELDS("Prevision ocupacion 2");
          IF Rec."Prevision ocupacion 2" <> 0 THEN
            imp := Rec."Prevision ocupacion 2" - Rec."Ocupado 2" - Rec."Asignado 2"
          ELSE
            imp := Rec."Prevision ocupacion 2";
        END;
      //  Rec.CALCFIELDS("Prevision ocupacion 2");
      //  imp := Rec."Prevision ocupacion 2";
      END;
      // FIN AJS 30-06-99
      //
      IF "Tipo de Registro" = "Tipo de Registro"::Ocupado THEN BEGIN
        IF rHot.NoName THEN BEGIN
          Rec.CALCFIELDS("Reservado 2");
          imp := Rec."Reservado 2";
        END
        ELSE BEGIN
          Rec.CALCFIELDS("Ocupado 2");
          imp := Rec."Ocupado 2";
        END;
      END;
      IF "Tipo de Registro" = "Tipo de Registro"::Asignado THEN BEGIN
        Rec.CALCFIELDS("Asignado 2");
        imp := Rec."Asignado 2";
      END;
      IF "Tipo de Registro" = "Tipo de Registro"::Libre THEN BEGIN
        IF rHot.NoName THEN BEGIN
          Rec.CALCFIELDS("Cupo contratado 2");
          Rec.CALCFIELDS("Reservado 2");
          Rec.CALCFIELDS("Asignado 2");
          imp := Rec."Cupo contratado 2" - Rec."Reservado 2" - Rec."Asignado 2";
        END
        ELSE BEGIN
          Rec.CALCFIELDS("Cupo contratado 2");
          Rec.CALCFIELDS("Ocupado 2");
          Rec.CALCFIELDS("Asignado 2");
          imp := Rec."Cupo contratado 2" - Rec."Ocupado 2" - Rec."Asignado 2";
        END;
      END;
      IF "Tipo de Registro" = "Tipo de Registro"::Porcentaje THEN BEGIN
        IF rHot.NoName THEN BEGIN
          Rec.CALCFIELDS("Cupo contratado 2");
          Rec.CALCFIELDS("Reservado 2");
          Rec.CALCFIELDS("Asignado 2");
          IF Rec."Cupo contratado 2" = 0 THEN
            imp := 0
          ELSE
            imp := ROUND(((Rec."Reservado 2" + Rec."Asignado 2") * 100) / Rec."Cupo contratado 2");
        END
        ELSE BEGIN
          Rec.CALCFIELDS("Cupo contratado 2");
          Rec.CALCFIELDS("Ocupado 2");
          Rec.CALCFIELDS("Asignado 2");
          IF Rec."Cupo contratado 2" = 0 THEN
            imp := 0
          ELSE
            imp := ROUND(((Rec."Ocupado 2" + Rec."Asignado 2") * 100) / Rec."Cupo contratado 2");
        END;
      END;
      // AJS 30-06-99
      //
      IF "Tipo de Registro" = "Tipo de Registro"::"Porcentaje prevision" THEN BEGIN
        IF rHot.NoName THEN BEGIN
          Rec.CALCFIELDS("Cupo contratado 2");
          Rec.CALCFIELDS("Reservado 2");
          Rec.CALCFIELDS("Asignado 2");
          Rec.CALCFIELDS("Prevision ocupacion 2");
          IF Rec."Cupo contratado 2" = 0 THEN
            imp := 0
          ELSE BEGIN
            IF Rec."Prevision ocupacion 2" > (Rec."Reservado 2" + Rec."Asignado 2") THEN
              imp := ROUND((Rec."Prevision ocupacion 2" * 100) / Rec."Cupo contratado 2")
            ELSE
              imp := ROUND(((Rec."Reservado 2" + Rec."Asignado 2") * 100) / Rec."Cupo contratado 2");
          END;
        END
        ELSE BEGIN
          Rec.CALCFIELDS("Cupo contratado 2");
          Rec.CALCFIELDS("Ocupado 2");
          Rec.CALCFIELDS("Asignado 2");
          Rec.CALCFIELDS("Prevision ocupacion 2");
          IF Rec."Cupo contratado 2" = 0 THEN
            imp := 0
          ELSE BEGIN
            IF Rec."Prevision ocupacion 2" > (Rec."Ocupado 2" + Rec."Asignado 2") THEN
              imp := ROUND((Rec."Prevision ocupacion 2" * 100) / Rec."Cupo contratado 2")
            ELSE
              imp := ROUND(((Rec."Ocupado 2" + Rec."Asignado 2") * 100) / Rec."Cupo contratado 2");
          END;
        END;
      END;
      // FIN AJS 30-06-99
      //
    END;

    PROCEDURE Habitaciones@3();
    BEGIN
      // Habitaciones
      //
      Salva_Hab();

      CurrForm.ch01.VISIBLE := FALSE;
      CurrForm.ch02.VISIBLE := FALSE;
      CurrForm.ch03.VISIBLE := FALSE;
      CurrForm.ch04.VISIBLE := FALSE;
      CurrForm.ch05.VISIBLE := FALSE;
      CurrForm.ch06.VISIBLE := FALSE;
      CurrForm.ch07.VISIBLE := FALSE;
      CurrForm.ch08.VISIBLE := FALSE;
      CurrForm.ch09.VISIBLE := FALSE;
      CurrForm.ch10.VISIBLE := FALSE;
      CurrForm.ch11.VISIBLE := FALSE;
      CurrForm.ch12.VISIBLE := FALSE;
      CurrForm.ch13.VISIBLE := FALSE;
      CurrForm.ch14.VISIBLE := FALSE;
      CurrForm.ch15.VISIBLE := FALSE;
      CurrForm.ch16.VISIBLE := FALSE;
      CurrForm.ch17.VISIBLE := FALSE;

      CurrForm.tex01.VISIBLE := FALSE;
      CurrForm.Tex02.VISIBLE := FALSE;
      CurrForm.Tex03.VISIBLE := FALSE;
      CurrForm.tex04.VISIBLE := FALSE;
      CurrForm.tex05.VISIBLE := FALSE;
      CurrForm.tex06.VISIBLE := FALSE;
      CurrForm.tex07.VISIBLE := FALSE;
      CurrForm.tex08.VISIBLE := FALSE;
      CurrForm.tex09.VISIBLE := FALSE;
      CurrForm.tex10.VISIBLE := FALSE;
      CurrForm.tex11.VISIBLE := FALSE;
      CurrForm.Tex12.VISIBLE := FALSE;
      CurrForm.Tex13.VISIBLE := FALSE;
      CurrForm.tex14.VISIBLE := FALSE;
      CurrForm.tex15.VISIBLE := FALSE;
      CurrForm.tex16.VISIBLE := FALSE;
      CurrForm.tex17.VISIBLE := FALSE;

      ind := 0;
      rTra.RESET;
      rTra.SETRANGE(Usuario,USERID());
      rTra.SETRANGE(Hotel,Hotel);
      rTra.SETRANGE("Tipo de Registro","Tipo de Registro"::T¡tulo);
      rTra.SETRANGE("Tipo Habitacion",TipoHab);

      IF rTra.FIND('-') THEN REPEAT
        IF rTra."C¢d. habitaci¢n" <> '' THEN BEGIN
          ind := ind + 1;
          IF ind = 1 THEN BEGIN
            ch01 := CH[1][TipoHab+1];
            tex01 := rTra."C¢d. habitaci¢n";
            CurrForm.ch01.VISIBLE := TRUE;
            CurrForm.tex01.VISIBLE := TRUE;
          END;
          IF ind = 2 THEN BEGIN
            ch02 := CH[2][TipoHab+1];
            tex02 := rTra."C¢d. habitaci¢n";
            CurrForm.ch02.VISIBLE := TRUE;
            CurrForm.Tex02.VISIBLE := TRUE;
          END;
          IF ind = 3 THEN BEGIN
            ch03 := CH[3][TipoHab+1];
            tex03 := rTra."C¢d. habitaci¢n";
            CurrForm.ch03.VISIBLE := TRUE;
            CurrForm.Tex03.VISIBLE := TRUE;
          END;
          IF ind = 4 THEN BEGIN
            ch04 := CH[4][TipoHab+1];
            tex04 := rTra."C¢d. habitaci¢n";
            CurrForm.ch04.VISIBLE := TRUE;
            CurrForm.tex04.VISIBLE := TRUE;
          END;
          IF ind = 5 THEN BEGIN
            ch05 := CH[5][TipoHab+1];
            tex05 := rTra."C¢d. habitaci¢n";
            CurrForm.ch05.VISIBLE := TRUE;
            CurrForm.tex05.VISIBLE := TRUE;
          END;
          IF ind = 6 THEN BEGIN
            ch06 := CH[6][TipoHab+1];
            tex06 := rTra."C¢d. habitaci¢n";
            CurrForm.ch06.VISIBLE := TRUE;
            CurrForm.tex06.VISIBLE := TRUE;
          END;
          IF ind = 7 THEN BEGIN
            ch07 := CH[7][TipoHab+1];
            tex07 := rTra."C¢d. habitaci¢n";
            CurrForm.ch07.VISIBLE := TRUE;
            CurrForm.tex07.VISIBLE := TRUE;
          END;
          IF ind = 8 THEN BEGIN
            ch08 := CH[8][TipoHab+1];
            tex08 := rTra."C¢d. habitaci¢n";
            CurrForm.ch08.VISIBLE := TRUE;
            CurrForm.tex08.VISIBLE := TRUE;
          END;
          IF ind = 9 THEN BEGIN
            ch09 := CH[9][TipoHab+1];
            tex09 := rTra."C¢d. habitaci¢n";
            CurrForm.ch09.VISIBLE := TRUE;
            CurrForm.tex09.VISIBLE := TRUE;
          END;
          IF ind = 10 THEN BEGIN
            ch10 := CH[10][TipoHab+1];
            tex10 := rTra."C¢d. habitaci¢n";
            CurrForm.ch10.VISIBLE := TRUE;
            CurrForm.tex10.VISIBLE := TRUE;
          END;
          IF ind = 11 THEN BEGIN
            ch11 := CH[11][TipoHab+1];
            tex11 := rTra."C¢d. habitaci¢n";
            CurrForm.ch11.VISIBLE := TRUE;
            CurrForm.tex11.VISIBLE := TRUE;
          END;
          IF ind = 12 THEN BEGIN
            ch12 := CH[12][TipoHab+1];
            tex12 := rTra."C¢d. habitaci¢n";
            CurrForm.ch12.VISIBLE := TRUE;
            CurrForm.Tex12.VISIBLE := TRUE;
          END;
          IF ind = 13 THEN BEGIN
            ch13 := CH[13][TipoHab+1];
            tex13 := rTra."C¢d. habitaci¢n";
            CurrForm.ch13.VISIBLE := TRUE;
            CurrForm.Tex13.VISIBLE := TRUE;
          END;
          IF ind = 14 THEN BEGIN
            ch14 := CH[14][TipoHab+1];
            tex14 := rTra."C¢d. habitaci¢n";
            CurrForm.ch14.VISIBLE := TRUE;
            CurrForm.tex14.VISIBLE := TRUE;
          END;
          IF ind = 15 THEN BEGIN
            ch15 := CH[15][TipoHab+1];
            tex15 := rTra."C¢d. habitaci¢n";
            CurrForm.ch15.VISIBLE := TRUE;
            CurrForm.tex15.VISIBLE := TRUE;
          END;
          IF ind = 16 THEN BEGIN
            ch16 := CH[16][TipoHab+1];
            tex16 := rTra."C¢d. habitaci¢n";
            CurrForm.ch16.VISIBLE := TRUE;
            CurrForm.tex16.VISIBLE := TRUE;
          END;
          IF ind = 17 THEN BEGIN
            ch17 := CH[17][TipoHab+1];
            tex17 := rTra."C¢d. habitaci¢n";
            CurrForm.ch17.VISIBLE := TRUE;
            CurrForm.tex17.VISIBLE := TRUE;
          END;
        END;
      UNTIL rTra.NEXT = 0;

      Filtros_TipHab();
    END;

    PROCEDURE Filtros_TipHab@5();
    BEGIN
      // Filtros_TipHab
      //
      FiltHab := '';
      PrimerFiltro := FALSE;

      IF (NOT ch01) AND (tex01 <> '') THEN BEGIN
        PrimerFiltro := TRUE;
        FiltHab := FiltHab + '<>' + tex01;
      END;

      IF (NOT ch02) AND (tex02 <> '') THEN BEGIN
        IF PrimerFiltro THEN
          FiltHab := FiltHab + '&';
        PrimerFiltro := TRUE;
        FiltHab := FiltHab + '<>' + tex02;
      END;

      IF (NOT ch03) AND (tex03 <> '') THEN BEGIN
        IF PrimerFiltro THEN
          FiltHab := FiltHab + '&';
        PrimerFiltro := TRUE;
        FiltHab := FiltHab + '<>' + tex03;
      END;

      IF (NOT ch04) AND (tex04 <> '') THEN BEGIN
        IF PrimerFiltro THEN
          FiltHab := FiltHab + '&';
        PrimerFiltro := TRUE;
        FiltHab := FiltHab + '<>' + tex04;
      END;

      IF (NOT ch05) AND (tex05 <> '') THEN BEGIN
        IF PrimerFiltro THEN
          FiltHab := FiltHab + '&';
        PrimerFiltro := TRUE;
        FiltHab := FiltHab + '<>' + tex05;
      END;

      IF (NOT ch06) AND (tex06 <> '') THEN BEGIN
        IF PrimerFiltro THEN
          FiltHab := FiltHab + '&';
        PrimerFiltro := TRUE;
        FiltHab := FiltHab + '<>' + tex06;
      END;

      IF (NOT ch07) AND (tex07 <> '') THEN BEGIN
        IF PrimerFiltro THEN
          FiltHab := FiltHab + '&';
        PrimerFiltro := TRUE;
        FiltHab := FiltHab + '<>' + tex07;
      END;

      IF (NOT ch08) AND (tex08 <> '') THEN BEGIN
        IF PrimerFiltro THEN
          FiltHab := FiltHab + '&';
        PrimerFiltro := TRUE;
        FiltHab := FiltHab + '<>' + tex08;
      END;

      IF (NOT ch09) AND (tex09 <> '') THEN BEGIN
        IF PrimerFiltro THEN
          FiltHab := FiltHab + '&';
        PrimerFiltro := TRUE;
        FiltHab := FiltHab + '<>' + tex09;
      END;

      IF (NOT ch10) AND (tex10 <> '') THEN BEGIN
        IF PrimerFiltro THEN
          FiltHab := FiltHab + '&';
        PrimerFiltro := TRUE;
        FiltHab := FiltHab + '<>' + tex10;
      END;

      IF (NOT ch11) AND (tex11 <> '') THEN BEGIN
        IF PrimerFiltro THEN
          FiltHab := FiltHab + '&';
        PrimerFiltro := TRUE;
        FiltHab := FiltHab + '<>' + tex11;
      END;
      IF (NOT ch12) AND (tex12 <> '') THEN BEGIN
        IF PrimerFiltro THEN
          FiltHab := FiltHab + '&';
        PrimerFiltro := TRUE;
        FiltHab := FiltHab + '<>' + tex12;
      END;
      IF (NOT ch13) AND (tex13 <> '') THEN BEGIN
        IF PrimerFiltro THEN
          FiltHab := FiltHab + '&';
        PrimerFiltro := TRUE;
        FiltHab := FiltHab + '<>' + tex13;
      END;
      IF (NOT ch14) AND (tex14 <> '') THEN BEGIN
        IF PrimerFiltro THEN
          FiltHab := FiltHab + '&';
        PrimerFiltro := TRUE;
        FiltHab := FiltHab + '<>' + tex14;
      END;
      IF (NOT ch15) AND (tex15 <> '') THEN BEGIN
        IF PrimerFiltro THEN
          FiltHab := FiltHab + '&';
        PrimerFiltro := TRUE;
        FiltHab := FiltHab + '<>' + tex15;
      END;
      IF (NOT ch16) AND (tex16 <> '') THEN BEGIN
        IF PrimerFiltro THEN
          FiltHab := FiltHab + '&';
        PrimerFiltro := TRUE;
        FiltHab := FiltHab + '<>' + tex16;
      END;
      IF (NOT ch17) AND (tex17 <> '') THEN BEGIN
        IF PrimerFiltro THEN
          FiltHab := FiltHab + '&';
        PrimerFiltro := TRUE;
        FiltHab := FiltHab + '<>' + tex17;
      END;

      SETFILTER("C¢d. habitaci¢n",FiltHab);
    END;

    PROCEDURE Salva_Hab@6();
    BEGIN
      // Salva_Hab
      //
      IF TipoHab = TipoHab::Basica THEN BEGIN
        CH[1][2] := ch01;
        CH[2][2] := ch02;
        CH[3][2] := ch03;
        CH[4][2] := ch04;
        CH[5][2] := ch05;
        CH[6][2] := ch06;
        CH[7][2] := ch07;
        CH[8][2] := ch08;
        CH[9][2] := ch09;
        CH[10][2] := ch10;
        CH[11][2] := ch11;
        CH[12][2] := ch12;
        CH[13][2] := ch13;
        CH[14][2] := ch14;
        CH[15][2] := ch15;
        CH[16][2] := ch16;
        CH[17][2] := ch17;
      END
      ELSE BEGIN
        CH[1][1] := ch01;
        CH[2][1] := ch02;
        CH[3][1] := ch03;
        CH[4][1] := ch04;
        CH[5][1] := ch05;
        CH[6][1] := ch06;
        CH[7][1] := ch07;
        CH[8][1] := ch08;
        CH[9][1] := ch09;
        CH[10][1] := ch10;
        CH[11][1] := ch11;
        CH[12][1] := ch12;
        CH[13][1] := ch13;
        CH[14][1] := ch14;
        CH[15][1] := ch15;
        CH[16][1] := ch16;
        CH[17][1] := ch17;
      END;
    END;

    PROCEDURE Init_Hab@9();
    BEGIN
      // Init_Hab
      //
      CH[1][2] := TRUE;
      CH[2][2] := TRUE;
      CH[3][2] := TRUE;
      CH[4][2] := TRUE;
      CH[5][2] := TRUE;
      CH[6][2] := TRUE;
      CH[7][2] := TRUE;
      CH[8][2] := TRUE;
      CH[9][2] := TRUE;
      CH[10][2] := TRUE;
      CH[11][2] := TRUE;
      CH[12][2] := TRUE;
      CH[13][2] := TRUE;
      CH[14][2] := TRUE;
      CH[15][2] := TRUE;
      CH[16][2] := TRUE;
      CH[17][2] := TRUE;
      CH[1][1] := TRUE;
      CH[2][1] := TRUE;
      CH[3][1] := TRUE;
      CH[4][1] := TRUE;
      CH[5][1] := TRUE;
      CH[6][1] := TRUE;
      CH[7][1] := TRUE;
      CH[8][1] := TRUE;
      CH[9][1] := TRUE;
      CH[10][1] := TRUE;
      CH[11][1] := TRUE;
      CH[12][1] := TRUE;
      CH[13][1] := TRUE;
      CH[14][1] := TRUE;
      CH[15][1] := TRUE;
      CH[16][1] := TRUE;
      CH[17][1] := TRUE;

      ch01 := TRUE;
      ch02 := TRUE;
      ch03 := TRUE;
      ch04 := TRUE;
      ch05 := TRUE;
      ch06 := TRUE;
      ch07 := TRUE;
      ch08 := TRUE;
      ch09 := TRUE;
      ch10 := TRUE;
      ch11 := TRUE;
      ch12 := TRUE;
      ch13 := TRUE;
      ch14 := TRUE;
      ch15 := TRUE;
      ch16 := TRUE;
      ch17 := TRUE;
    END;

    PROCEDURE NombreHotel@7() Nombre : Text[50];
    BEGIN

      IF rHot.GET(Hotel) THEN
        EXIT(rHot.Hotel+ '-' +rHot.Nombre)
      ELSE
        EXIT('');
    END;

    PROCEDURE Ovbk@8() O : Text[1];
    BEGIN

      rHotOvk.RESET;
      rHotOvk.SETRANGE(Hotel,Hotel);

      IF rHotOvk.FIND('-') THEN REPEAT
        IF  (rHotOvk.Desde <= CurrForm.Matriz.MatrixRec."Period End")
        AND (rHotOvk.Hasta >= CurrForm.Matriz.MatrixRec."Period Start") THEN
          EXIT('*');

      UNTIL rHotOvk.NEXT = 0;

      EXIT('');
    END;

    PROCEDURE Paro@10() : Char;
    VAR
      rParo@1103355000 : Record 7009781;
    BEGIN
      // Paro
      //
      CLEAR(rParo);
      rParo.SETRANGE (Hotel        , Hotel);
      rParo.SETFILTER("Fecha desde", '<=%1', CurrForm.Matriz.MatrixRec."Period End");
      rParo.SETFILTER("Fecha hasta", '>=%1', CurrForm.Matriz.MatrixRec."Period Start");
      IF rParo.FIND('-') THEN
        EXIT('*')
      ELSE
        EXIT(' ');
    END;

    BEGIN
    END.
  }
}
