OBJECT Form 490 Acc. Schedule Overview
{
  OBJECT-PROPERTIES
  {
    Date=14/08/09;
    Time=12:00:00;
    Version List=NAVW16.00,CACEM6.00,NAVES6.00.01;
  }
  PROPERTIES
  {
    Width=16500;
    Height=8910;
    CaptionML=[ENU=Acc. Schedule Overview;
               ESP=Panorama esq. cta.];
    CaptionBar=Normal;
    SaveValues=Yes;
    LinksAllowed=No;
    SourceTable=Table85;
    DataCaptionExpr=CurrentSchedName + ' - ' + CurrentColumnName;
    OnOpenForm=BEGIN
                 GLSetup.GET;
                 IF NewCurrentSchedName <> '' THEN
                   CurrentSchedName := NewCurrentSchedName;
                 IF CurrentSchedName = '' THEN
                   CurrentSchedName := Text000;
                 IF NewCurrentColumnName <> '' THEN
                   CurrentColumnName := NewCurrentColumnName;
                 IF CurrentColumnName = '' THEN
                   CurrentColumnName := Text000;
                 AccSchedManagement.CopyColumnsToTemp(CurrentColumnName,TempColumnLayout);
                 AccSchedManagement.OpenSchedule(CurrentSchedName,Rec);
                 AccSchedManagement.OpenColumns(CurrentColumnName,CurrForm.AccSchedMatrix.MatrixRec);
                 AccSchedManagement.CheckAnalysisView(CurrentSchedName,CurrentColumnName,TRUE);

                 IF AccSchedName.GET(CurrentSchedName) THEN
                   IF AccSchedName."Analysis View Name" <> '' THEN
                     AnalysisView.GET(AccSchedName."Analysis View Name")
                   ELSE BEGIN
                     CLEAR(AnalysisView);
                     AnalysisView."Dimension 1 Code" := GLSetup."Global Dimension 1 Code";
                     AnalysisView."Dimension 2 Code" := GLSetup."Global Dimension 2 Code";
                   END;

                 FindPeriod('');
                 SETRANGE("Dimension 1 Filter");
                 SETRANGE("Dimension 2 Filter");
                 SETRANGE("Dimension 3 Filter");
                 SETRANGE("Dimension 4 Filter");
                 CurrForm.Dim1Filter.ENABLED := AnalysisView."Dimension 1 Code" <> '';
                 CurrForm.Dim2Filter.ENABLED := AnalysisView."Dimension 2 Code" <> '';
                 CurrForm.Dim3Filter.ENABLED := AnalysisView."Dimension 3 Code" <> '';
                 CurrForm.Dim4Filter.ENABLED := AnalysisView."Dimension 4 Code" <> '';
                 CurrForm.UPDATECONTROLS;
               END;

  }
  CONTROLS
  {
    { 1   ;MatrixBox    ;220  ;2420 ;16060;5500 ;Name=AccSchedMatrix;
                                                 HorzGlue=Both;
                                                 VertGlue=Both;
                                                 Editable=No;
                                                 MatrixColumnWidth=2200;
                                                 MatrixSourceTable=Table334;
                                                 OnFindRecord=VAR
                                                                Found@1002 : Boolean;
                                                              BEGIN
                                                                Found := TempColumnLayout.FIND(Which);
                                                                IF Found THEN
                                                                  CurrForm.AccSchedMatrix.MatrixRec := TempColumnLayout;
                                                                EXIT(Found);
                                                              END;

                                                 OnNextRecord=VAR
                                                                ResultSteps@1002 : Integer;
                                                              BEGIN
                                                                ResultSteps := TempColumnLayout.NEXT(Steps);
                                                                IF ResultSteps <> 0 THEN
                                                                  CurrForm.AccSchedMatrix.MatrixRec := TempColumnLayout;
                                                                EXIT(ResultSteps);
                                                              END;

                                                 OnAfterGetRecord=BEGIN
                                                                    IF Totaling = '' THEN
                                                                      ColumnValue := 0
                                                                    ELSE
                                                                      ColumnValue :=
                                                                        AccSchedManagement.CalcCell(Rec,CurrForm.AccSchedMatrix.MatrixRec,UseAmtsInAddCurr);
                                                                  END;
                                                                   }
    { 2   ;TextBox      ;0    ;1100 ;1650 ;440  ;ParentControl=1;
                                                 InColumn=Yes;
                                                 SourceExpr="Row No.";
                                                 OnFormat=BEGIN
                                                            IF Bold THEN
                                                              CurrForm."Row No.".UPDATEFONTBOLD := TRUE;
                                                          END;
                                                           }
    { 3   ;Label        ;0    ;0    ;0    ;0    ;ParentControl=2;
                                                 InColumnHeading=Yes }
    { 4   ;TextBox      ;2514 ;1540 ;4400 ;440  ;HorzGlue=Both;
                                                 ParentControl=1;
                                                 InColumn=Yes;
                                                 SourceExpr=Description;
                                                 OnFormat=BEGIN
                                                            IF Bold THEN
                                                              CurrForm.Description.UPDATEFONTBOLD := TRUE;
                                                          END;
                                                           }
    { 5   ;Label        ;0    ;0    ;0    ;0    ;ParentControl=4;
                                                 InColumnHeading=Yes }
    { 6   ;TextBox      ;9350 ;2200 ;8800 ;440  ;Name=ColumnValue;
                                                 ParentControl=1;
                                                 InMatrix=Yes;
                                                 DrillDown=Yes;
                                                 CaptionML=[ENU=Value;
                                                            ESP=Valor];
                                                 SourceExpr=ColumnValue;
                                                 AutoFormatType=1;
                                                 OnFormat=VAR
                                                            Value@1002 : Decimal;
                                                          BEGIN
                                                            EVALUATE(Value, Text);
                                                            IF Value = 0 THEN
                                                              Text := '';
                                                            IF Bold THEN
                                                              CurrForm.ColumnValue.UPDATEFONTBOLD := TRUE;
                                                            IF AccSchedManagement.GetDivisionError THEN
                                                              IF ShowError IN [ShowError::"Division by Zero",ShowError::Both] THEN BEGIN
                                                                Text := Text001;
                                                                CurrForm.ColumnValue.UPDATEFONTBOLD := TRUE;
                                                              END ELSE
                                                                Text := '';
                                                            IF AccSchedManagement.GetPeriodError THEN
                                                              IF ShowError IN [ShowError::"Period Error",ShowError::Both] THEN BEGIN
                                                                Text := Text004;
                                                                CurrForm.ColumnValue.UPDATEFONTBOLD := TRUE;
                                                              END ELSE
                                                                Text := '';

                                                            CASE Color OF
                                                              Color::red: CurrForm.ColumnValue.UPDATEFORECOLOR(255);
                                                              Color::blue: CurrForm.ColumnValue.UPDATEFORECOLOR(16711680);
                                                              Color::pink: CurrForm.ColumnValue.UPDATEFORECOLOR(8388736);
                                                            END;
                                                          END;

                                                 OnDrillDown=VAR
                                                               GLAcc@1001 : Record 15;
                                                               GLAccAnalysisView@1002 : Record 376;
                                                               ChartofAccAnalysisView@1004 : Form 569;
                                                               AccSchedName@1100003 : Record 84;
                                                               HistoricGLAcc@1100002 : Record 10721;
                                                               ChartofHistAccAnalysisView@1100001 : Form 10733;
                                                               CostTypeChart@1460000 : Form 3010551;
                                                               CostBudPerPeriod@1460001 : Form 3010573;
                                                               CostType@1460002 : Record 3010551;
                                                               HistGLAccAnalysisView@1100004 : Record 10725;
                                                             BEGIN
                                                               IF CurrForm.AccSchedMatrix.MatrixRec."Column Type" = TempColumnLayout."Column Type"::Formula THEN
                                                                 MESSAGE(Text002,CurrForm.AccSchedMatrix.MatrixRec.Formula)
                                                               ELSE
                                                                 IF "Totaling Type" IN ["Totaling Type"::Formula,"Totaling Type"::"Set Base For Percent"] THEN
                                                                   MESSAGE(Text003,Totaling)
                                                                   // ELSE
                                                                   // IF Totaling <> '' THEN BEGIN
                                                                 ELSE BEGIN
                                                                   IF AccSchedName.GET(NewCurrentSchedName) THEN
                                                                     IF AccSchedName."Acc. No. Referred to old Acc." THEN BEGIN
                                                                       IF (Totaling <> '') AND
                                                                          ("Totaling Type" IN ["Totaling Type"::"Posting Accounts","Totaling Type"::"Total Accounts"])
                                                                       THEN BEGIN
                                                                         COPYFILTER("Business Unit Filter",HistoricGLAcc."Business Unit Filter");
                                                                         COPYFILTER("Budget Filter",HistoricGLAcc."Budget Filter");
                                                                         AccSchedManagement.SetHistoricGLAccRowFilters(HistoricGLAcc,Rec);
                                                                         AccSchedManagement.SetHistoricGLAccColumnFilters(HistoricGLAcc,Rec,CurrForm.AccSchedMatrix.MatrixRec);
                                                                         IF AccSchedName."Analysis View Name" = '' THEN BEGIN
                                                                           COPYFILTER("Dimension 1 Filter",HistoricGLAcc."Global Dimension 1 Filter");
                                                                           COPYFILTER("Dimension 2 Filter",HistoricGLAcc."Global Dimension 2 Filter");
                                                                           COPYFILTER("Business Unit Filter",HistoricGLAcc."Business Unit Filter");
                                                                           HistoricGLAcc.FILTERGROUP(2);
                                                                           HistoricGLAcc.SETFILTER("Global Dimension 1 Filter",AccSchedManagement.GetDimTotalingFilter(1,"Dimension 1 Totaling"))
                                                               ;
                                                                           HistoricGLAcc.SETFILTER("Global Dimension 2 Filter",AccSchedManagement.GetDimTotalingFilter(2,"Dimension 2 Totaling"))
                                                               ;
                                                                           HistoricGLAcc.FILTERGROUP(6);
                                                                           HistoricGLAcc.SETFILTER(
                                                                             "Global Dimension 1 Filter",
                                                                             AccSchedManagement.GetDimTotalingFilter(1,CurrForm.AccSchedMatrix.MatrixRec."Dimension 1 Totaling"));
                                                                           HistoricGLAcc.SETFILTER(
                                                                             "Global Dimension 2 Filter",
                                                                             AccSchedManagement.GetDimTotalingFilter(2,CurrForm.AccSchedMatrix.MatrixRec."Dimension 2 Totaling"));
                                                                           HistoricGLAcc.SETFILTER("Business Unit Filter",CurrForm.AccSchedMatrix.MatrixRec."Business Unit Totaling");
                                                                           HistoricGLAcc.FILTERGROUP(0);
                                                                           FORM.RUN(FORM::"Historic Chart of Acc. (G/L)",HistoricGLAcc)
                                                                         END ELSE BEGIN
                                                                           HistoricGLAcc.COPYFILTER("Date Filter",HistGLAccAnalysisView."Date Filter");
                                                                           HistoricGLAcc.COPYFILTER("Budget Filter",HistGLAccAnalysisView."Budget Filter");
                                                                           HistoricGLAcc.COPYFILTER("Business Unit Filter",HistGLAccAnalysisView."Business Unit Filter");
                                                                           HistGLAccAnalysisView.SETRANGE("Analysis View Filter",AccSchedName."Analysis View Name");
                                                                           COPYFILTER("Dimension 1 Filter",HistGLAccAnalysisView."Dimension 1 Filter");
                                                                           COPYFILTER("Dimension 2 Filter",HistGLAccAnalysisView."Dimension 2 Filter");
                                                                           COPYFILTER("Dimension 3 Filter",HistGLAccAnalysisView."Dimension 3 Filter");
                                                                           COPYFILTER("Dimension 4 Filter",HistGLAccAnalysisView."Dimension 4 Filter");
                                                                           HistGLAccAnalysisView.FILTERGROUP(2);
                                                                           HistGLAccAnalysisView.SETFILTER("Dimension 1 Filter",AccSchedManagement.GetDimTotalingFilter(1,"Dimension 1 Totaling")
                                                               );
                                                                           HistGLAccAnalysisView.SETFILTER("Dimension 2 Filter",AccSchedManagement.GetDimTotalingFilter(2,"Dimension 2 Totaling")
                                                               );
                                                                           HistGLAccAnalysisView.SETFILTER("Dimension 3 Filter",AccSchedManagement.GetDimTotalingFilter(3,"Dimension 3 Totaling")
                                                               );
                                                                           HistGLAccAnalysisView.SETFILTER("Dimension 4 Filter",AccSchedManagement.GetDimTotalingFilter(4,"Dimension 4 Totaling")
                                                               );
                                                                           HistGLAccAnalysisView.FILTERGROUP(6);
                                                                           HistGLAccAnalysisView.SETFILTER(
                                                                             "Dimension 1 Filter",
                                                                             AccSchedManagement.GetDimTotalingFilter(1,CurrForm.AccSchedMatrix.MatrixRec."Dimension 1 Totaling"));
                                                                           HistGLAccAnalysisView.SETFILTER(
                                                                             "Dimension 2 Filter",
                                                                             AccSchedManagement.GetDimTotalingFilter(2,CurrForm.AccSchedMatrix.MatrixRec."Dimension 2 Totaling"));
                                                                           HistGLAccAnalysisView.SETFILTER(
                                                                             "Dimension 3 Filter",
                                                                             AccSchedManagement.GetDimTotalingFilter(3,CurrForm.AccSchedMatrix.MatrixRec."Dimension 3 Totaling"));
                                                                           HistGLAccAnalysisView.SETFILTER(
                                                                             "Dimension 4 Filter",
                                                                             AccSchedManagement.GetDimTotalingFilter(4,CurrForm.AccSchedMatrix.MatrixRec."Dimension 4 Totaling"));
                                                                           HistGLAccAnalysisView.SETFILTER("Business Unit Filter",CurrForm.AccSchedMatrix.MatrixRec."Business Unit Totaling");
                                                                           HistGLAccAnalysisView.FILTERGROUP(0);
                                                                           CLEAR(ChartofHistAccAnalysisView);
                                                                           ChartofHistAccAnalysisView.InsertTempGLAccAnalysisViews(HistoricGLAcc);
                                                                           ChartofHistAccAnalysisView.SETTABLEVIEW(HistGLAccAnalysisView);
                                                                           ChartofHistAccAnalysisView.RUN;
                                                                         END;
                                                                       END;
                                                                     END ELSE BEGIN
                                                                       IF (Totaling <> '') AND
                                                                          ("Totaling Type" IN ["Totaling Type"::"Posting Accounts","Totaling Type"::"Total Accounts"])
                                                                       THEN BEGIN
                                                                         COPYFILTER("Business Unit Filter",GLAcc."Business Unit Filter");
                                                                         COPYFILTER("Budget Filter",GLAcc."Budget Filter");
                                                                         AccSchedManagement.SetGLAccRowFilters(GLAcc,Rec);
                                                                         AccSchedManagement.SetGLAccColumnFilters(GLAcc,Rec,CurrForm.AccSchedMatrix.MatrixRec);
                                                                         // AccSchedName.GET(CurrentSchedName);
                                                                         IF AccSchedName."Analysis View Name" = '' THEN BEGIN
                                                                           COPYFILTER("Dimension 1 Filter",GLAcc."Global Dimension 1 Filter");
                                                                           COPYFILTER("Dimension 2 Filter",GLAcc."Global Dimension 2 Filter");
                                                                           COPYFILTER("Business Unit Filter",GLAcc."Business Unit Filter");
                                                                           GLAcc.FILTERGROUP(2);
                                                                           GLAcc.SETFILTER("Global Dimension 1 Filter",AccSchedManagement.GetDimTotalingFilter(1,"Dimension 1 Totaling"));
                                                                           GLAcc.SETFILTER("Global Dimension 2 Filter",AccSchedManagement.GetDimTotalingFilter(2,"Dimension 2 Totaling"));
                                                                           GLAcc.FILTERGROUP(6);
                                                                           GLAcc.SETFILTER(
                                                                             "Global Dimension 1 Filter",
                                                                             AccSchedManagement.GetDimTotalingFilter(1,CurrForm.AccSchedMatrix.MatrixRec."Dimension 1 Totaling"));
                                                                           GLAcc.SETFILTER(
                                                                             "Global Dimension 2 Filter",
                                                                             AccSchedManagement.GetDimTotalingFilter(2,CurrForm.AccSchedMatrix.MatrixRec."Dimension 2 Totaling"));
                                                                           GLAcc.SETFILTER("Business Unit Filter",CurrForm.AccSchedMatrix.MatrixRec."Business Unit Totaling");
                                                                           GLAcc.FILTERGROUP(0);
                                                                           FORM.RUN(FORM::"Chart of Accounts (G/L)",GLAcc)
                                                                         END ELSE BEGIN
                                                                           GLAcc.COPYFILTER("Date Filter",GLAccAnalysisView."Date Filter");
                                                                           GLAcc.COPYFILTER("Budget Filter",GLAccAnalysisView."Budget Filter");
                                                                           GLAcc.COPYFILTER("Business Unit Filter",GLAccAnalysisView."Business Unit Filter");
                                                                           GLAccAnalysisView.SETRANGE("Analysis View Filter",AccSchedName."Analysis View Name");
                                                                           COPYFILTER("Dimension 1 Filter",GLAccAnalysisView."Dimension 1 Filter");
                                                                           COPYFILTER("Dimension 2 Filter",GLAccAnalysisView."Dimension 2 Filter");
                                                                           COPYFILTER("Dimension 3 Filter",GLAccAnalysisView."Dimension 3 Filter");
                                                                           COPYFILTER("Dimension 4 Filter",GLAccAnalysisView."Dimension 4 Filter");
                                                                           GLAccAnalysisView.FILTERGROUP(2);
                                                                           GLAccAnalysisView.SETFILTER("Dimension 1 Filter",AccSchedManagement.GetDimTotalingFilter(1,"Dimension 1 Totaling"));
                                                                           GLAccAnalysisView.SETFILTER("Dimension 2 Filter",AccSchedManagement.GetDimTotalingFilter(2,"Dimension 2 Totaling"));
                                                                           GLAccAnalysisView.SETFILTER("Dimension 3 Filter",AccSchedManagement.GetDimTotalingFilter(3,"Dimension 3 Totaling"));
                                                                           GLAccAnalysisView.SETFILTER("Dimension 4 Filter",AccSchedManagement.GetDimTotalingFilter(4,"Dimension 4 Totaling"));
                                                                           GLAccAnalysisView.FILTERGROUP(6);
                                                                           GLAccAnalysisView.SETFILTER(
                                                                             "Dimension 1 Filter",
                                                                             AccSchedManagement.GetDimTotalingFilter(1,CurrForm.AccSchedMatrix.MatrixRec."Dimension 1 Totaling"));
                                                                           GLAccAnalysisView.SETFILTER(
                                                                                 "Dimension 2 Filter",
                                                                             AccSchedManagement.GetDimTotalingFilter(2,CurrForm.AccSchedMatrix.MatrixRec."Dimension 2 Totaling"));
                                                                           GLAccAnalysisView.SETFILTER(
                                                                             "Dimension 3 Filter",
                                                                             AccSchedManagement.GetDimTotalingFilter(3,CurrForm.AccSchedMatrix.MatrixRec."Dimension 3 Totaling"));
                                                                           GLAccAnalysisView.SETFILTER(
                                                                             "Dimension 4 Filter",
                                                                             AccSchedManagement.GetDimTotalingFilter(4,CurrForm.AccSchedMatrix.MatrixRec."Dimension 4 Totaling"));
                                                                           GLAccAnalysisView.SETFILTER("Business Unit Filter",CurrForm.AccSchedMatrix.MatrixRec."Business Unit Totaling");
                                                                           GLAccAnalysisView.FILTERGROUP(0);
                                                                           CLEAR(ChartofAccAnalysisView);
                                                                           ChartofAccAnalysisView.InsertTempGLAccAnalysisViews(GLAcc);
                                                                           ChartofAccAnalysisView.SETTABLEVIEW(GLAccAnalysisView);
                                                                           ChartofAccAnalysisView.RUN;
                                                                         END;
                                                                       END;
                                                                     END;

                                                                   IF (Totaling <> '') AND
                                                                      ("Totaling Type" IN ["Totaling Type"::"Cost Type","Totaling Type"::"Cost Type Total"])
                                                                   THEN BEGIN
                                                                     AccSchedManagement.SetCostTypeRowFilters(CostType,Rec,CurrForm.AccSchedMatrix.MatrixRec);

                                                                     // AccSchedManagement.SetCostTypeColumnFilters(CostType,CurrForm.AccSchedMatrix.MatrixRec);
                                                                     AccSchedManagement.SetCostTypeColumnFilters(CostType,Rec,CurrForm.AccSchedMatrix.MatrixRec);

                                                                     WITH CurrForm.AccSchedMatrix.MatrixRec DO BEGIN
                                                                       CASE "Ledger Entry Type" OF
                                                                         TempColumnLayout."Ledger Entry Type"::"G/L Entries":
                                                                           BEGIN
                                                                             CostTypeChart.SETTABLEVIEW(CostType);
                                                                             CostTypeChart.RUN;
                                                                           END;
                                                                         TempColumnLayout."Ledger Entry Type"::"G/L Budget Entries":
                                                                           BEGIN
                                                                             CostBudPerPeriod.SETTABLEVIEW(CostType);
                                                                             CostBudPerPeriod.RUN;
                                                                           END;
                                                                       END;  // Case
                                                                     END;  // With
                                                                   END;  // Begin
                                                                 END; // else Begin
                                                             END;
                                                              }
    { 7   ;TextBox      ;12650;1540 ;1650 ;440  ;ParentControl=6;
                                                 InMatrixHeading=Yes;
                                                 HorzAlign=Right;
                                                 CaptionML=[ENU=Column Header;
                                                            ESP=Cabecera columna];
                                                 SourceExpr=CurrForm.AccSchedMatrix.MatrixRec."Column Header" }
    { 8   ;TabControl   ;220  ;220  ;16060;1980 ;HorzGlue=Both;
                                                 PageNamesML=[ENU=General,Dimension Filters,Options;
                                                              ESP=General,Fitros dimensi¢n,Opciones] }
    { 10  ;TextBox      ;3850 ;990  ;2750 ;440  ;ParentControl=8;
                                                 InPage=0;
                                                 Lookup=Yes;
                                                 CaptionML=[ENU=Account Schedule Name;
                                                            ESP=Nombre esquema cuenta];
                                                 SourceExpr=CurrentSchedName;
                                                 LookupFormID=Account Schedule Names;
                                                 OnValidate=BEGIN
                                                              AccSchedManagement.CheckName(CurrentSchedName);
                                                            END;

                                                 OnLookup=BEGIN
                                                            EXIT(AccSchedManagement.LookupName(CurrentSchedName,Text));
                                                          END;

                                                 OnAfterValidate=VAR
                                                                   AccSchedName@1001 : Record 84;
                                                                   PrevAnalysisView@1002 : Record 363;
                                                                 BEGIN
                                                                   CurrForm.SAVERECORD;
                                                                   AccSchedManagement.SetName(CurrentSchedName,Rec);
                                                                   IF AccSchedName.GET(CurrentSchedName) THEN
                                                                     IF (AccSchedName."Default Column Layout" <> '') AND
                                                                        (CurrentColumnName <> AccSchedName."Default Column Layout")
                                                                     THEN BEGIN
                                                                       CurrentColumnName := AccSchedName."Default Column Layout";
                                                                       AccSchedManagement.CopyColumnsToTemp(CurrentColumnName,TempColumnLayout);
                                                                       AccSchedManagement.SetColumnName(CurrentColumnName,CurrForm.AccSchedMatrix.MatrixRec);
                                                                     END;
                                                                   AccSchedManagement.CheckAnalysisView(CurrentSchedName,CurrentColumnName,TRUE);

                                                                   IF AccSchedName."Analysis View Name" <> AnalysisView.Code THEN BEGIN
                                                                     PrevAnalysisView := AnalysisView;
                                                                     IF AccSchedName."Analysis View Name" <> '' THEN
                                                                       AnalysisView.GET(AccSchedName."Analysis View Name")
                                                                     ELSE BEGIN
                                                                       CLEAR(AnalysisView);
                                                                       AnalysisView."Dimension 1 Code" := GLSetup."Global Dimension 1 Code";
                                                                       AnalysisView."Dimension 2 Code" := GLSetup."Global Dimension 2 Code";
                                                                     END;
                                                                     IF PrevAnalysisView."Dimension 1 Code" <> AnalysisView."Dimension 1 Code" THEN
                                                                       SETRANGE("Dimension 1 Filter");
                                                                     IF PrevAnalysisView."Dimension 2 Code" <> AnalysisView."Dimension 2 Code" THEN
                                                                       SETRANGE("Dimension 2 Filter");
                                                                     IF PrevAnalysisView."Dimension 3 Code" <> AnalysisView."Dimension 3 Code" THEN
                                                                       SETRANGE("Dimension 3 Filter");
                                                                     IF PrevAnalysisView."Dimension 4 Code" <> AnalysisView."Dimension 4 Code" THEN
                                                                       SETRANGE("Dimension 4 Filter");
                                                                   END;

                                                                   CurrForm.Dim1Filter.ENABLED := AnalysisView."Dimension 1 Code" <> '';
                                                                   CurrForm.Dim2Filter.ENABLED := AnalysisView."Dimension 2 Code" <> '';
                                                                   CurrForm.Dim3Filter.ENABLED := AnalysisView."Dimension 3 Code" <> '';
                                                                   CurrForm.Dim4Filter.ENABLED := AnalysisView."Dimension 4 Code" <> '';

                                                                   CurrForm.UPDATE(FALSE);
                                                                   CurrForm.UPDATECONTROLS;
                                                                 END;
                                                                  }
    { 9   ;Label        ;440  ;990  ;3300 ;440  ;ParentControl=10 }
    { 12  ;TextBox      ;3850 ;1540 ;2750 ;440  ;ParentControl=8;
                                                 InPage=0;
                                                 Lookup=Yes;
                                                 CaptionML=[ENU=Column Layout Name;
                                                            ESP=Nombre plantilla columna];
                                                 SourceExpr=CurrentColumnName;
                                                 TableRelation="Column Layout Name".Name;
                                                 OnValidate=BEGIN
                                                              AccSchedManagement.CheckColumnName(CurrentColumnName);
                                                            END;

                                                 OnLookup=BEGIN
                                                            EXIT(AccSchedManagement.LookupColumnName(CurrentColumnName,Text));
                                                          END;

                                                 OnAfterValidate=BEGIN
                                                                   AccSchedManagement.CopyColumnsToTemp(CurrentColumnName,TempColumnLayout);
                                                                   AccSchedManagement.SetColumnName(CurrentColumnName,CurrForm.AccSchedMatrix.MatrixRec);
                                                                   AccSchedManagement.CheckAnalysisView(CurrentSchedName,CurrentColumnName,TRUE);

                                                                   CurrForm.UPDATE(FALSE);
                                                                 END;
                                                                  }
    { 11  ;Label        ;440  ;1540 ;3300 ;440  ;ParentControl=12 }
    { 16  ;TextBox      ;12980;990  ;2750 ;440  ;ParentControl=8;
                                                 InPage=0;
                                                 NextControl=10;
                                                 SourceExpr="Date Filter";
                                                 OnAfterValidate=BEGIN
                                                                   CurrForm.UPDATE;
                                                                 END;
                                                                  }
    { 15  ;Label        ;9570 ;990  ;3300 ;440  ;ParentControl=16 }
    { 30  ;TextBox      ;12980;1540 ;2750 ;440  ;ParentControl=8;
                                                 InPage=0;
                                                 SourceExpr="Budget Filter" }
    { 31  ;Label        ;9570 ;1540 ;3300 ;440  ;ParentControl=30 }
    { 36  ;TextBox      ;3850 ;1540 ;2750 ;440  ;Name=Dim2Filter;
                                                 ParentControl=8;
                                                 InPage=1;
                                                 CaptionML=[ENU=Dimension 2 Filter;
                                                            ESP=Filtro dimensi¢n 2];
                                                 ClearOnLookup=No;
                                                 SourceExpr="Dimension 2 Filter";
                                                 CaptionClass=FormGetCaptionClass(2);
                                                 OnLookup=BEGIN
                                                            EXIT(FormLookUpDimFilter(AnalysisView."Dimension 2 Code",Text));
                                                          END;

                                                 OnAfterValidate=BEGIN
                                                                   CurrForm.UPDATE;
                                                                 END;
                                                                  }
    { 33  ;Label        ;440  ;1540 ;3300 ;440  ;ParentControl=36 }
    { 37  ;TextBox      ;3850 ;990  ;2750 ;440  ;Name=Dim1Filter;
                                                 ParentControl=8;
                                                 InPage=1;
                                                 CaptionML=[ENU=Dimension 1 Filter;
                                                            ESP=Filtro dimensi¢n 1];
                                                 ClearOnLookup=No;
                                                 SourceExpr="Dimension 1 Filter";
                                                 CaptionClass=FormGetCaptionClass(1);
                                                 OnLookup=BEGIN
                                                            EXIT(FormLookUpDimFilter(AnalysisView."Dimension 1 Code",Text));
                                                          END;

                                                 OnAfterValidate=BEGIN
                                                                   CurrForm.UPDATE;
                                                                 END;
                                                                  }
    { 41  ;Label        ;440  ;990  ;3300 ;440  ;ParentControl=37;
                                                 CaptionClass=FormGetCaptionClass(1) }
    { 38  ;TextBox      ;12980;1540 ;2750 ;440  ;Name=Dim4Filter;
                                                 ParentControl=8;
                                                 InPage=1;
                                                 CaptionML=[ENU=Dimension 4 Filter;
                                                            ESP=Filtro dimensi¢n 4];
                                                 ClearOnLookup=No;
                                                 SourceExpr="Dimension 4 Filter";
                                                 CaptionClass=FormGetCaptionClass(4);
                                                 OnLookup=BEGIN
                                                            EXIT(FormLookUpDimFilter(AnalysisView."Dimension 4 Code",Text));
                                                          END;

                                                 OnAfterValidate=BEGIN
                                                                   CurrForm.UPDATE;
                                                                 END;
                                                                  }
    { 35  ;Label        ;9570 ;1540 ;3300 ;440  ;ParentControl=38 }
    { 39  ;TextBox      ;12980;990  ;2750 ;440  ;Name=Dim3Filter;
                                                 ParentControl=8;
                                                 InPage=1;
                                                 CaptionML=[ENU=Dimension 3 Filter;
                                                            ESP=Filtro dimensi¢n 3];
                                                 ClearOnLookup=No;
                                                 SourceExpr="Dimension 3 Filter";
                                                 CaptionClass=FormGetCaptionClass(3);
                                                 OnLookup=BEGIN
                                                            EXIT(FormLookUpDimFilter(AnalysisView."Dimension 3 Code",Text));
                                                          END;

                                                 OnAfterValidate=BEGIN
                                                                   CurrForm.UPDATE;
                                                                 END;
                                                                  }
    { 34  ;Label        ;9570 ;990  ;3300 ;440  ;ParentControl=39 }
    { 24  ;CheckBox     ;3850 ;1540 ;440  ;440  ;ParentControl=8;
                                                 InPage=2;
                                                 ShowCaption=No;
                                                 CaptionML=[ENU=Show Amounts in Add. Reporting Currency;
                                                            ESP=Muestra importes en div.-adic.];
                                                 SourceExpr=UseAmtsInAddCurr;
                                                 OnAfterValidate=BEGIN
                                                                   CurrForm.UPDATE;
                                                                 END;
                                                                  }
    { 25  ;Label        ;440  ;1540 ;3300 ;440  ;ParentControl=24;
                                                 MultiLine=Yes }
    { 32  ;TextBox      ;3850 ;990  ;1650 ;440  ;ParentControl=8;
                                                 InPage=2;
                                                 CaptionML=[ENU=Show Error;
                                                            ESP=Mostrar error];
                                                 OptionCaptionML=[ENU=None,Division by Zero,Period Error,Both;
                                                                  ESP=Ninguno,Divisi¢n entre cero,Error Periodo,Ambos];
                                                 OptionString=None,Division by Zero,Period Error,Both;
                                                 SourceExpr=ShowError }
    { 18  ;Label        ;440  ;990  ;3300 ;440  ;ParentControl=32 }
    { 13  ;CommandButton;14080;8140 ;2200 ;550  ;HorzGlue=Right;
                                                 VertGlue=Bottom;
                                                 PushAction=FormHelp }
    { 14  ;OptionButton ;2420 ;8140 ;550  ;550  ;VertGlue=Bottom;
                                                 FocusOnClick=No;
                                                 ShowCaption=No;
                                                 Border=Yes;
                                                 BitmapPos=Center;
                                                 Bitmap=13;
                                                 ToolTipML=[ENU=Year;
                                                            ESP=A¤o];
                                                 SourceExpr=PeriodType;
                                                 OptionValue=Year;
                                                 OnPush=BEGIN
                                                          FindPeriod('');
                                                        END;
                                                         }
    { 19  ;OptionButton ;1870 ;8140 ;550  ;550  ;VertGlue=Bottom;
                                                 FocusOnClick=No;
                                                 ShowCaption=No;
                                                 Border=Yes;
                                                 BitmapPos=Center;
                                                 Bitmap=12;
                                                 ToolTipML=[ENU=Quarter;
                                                            ESP=Trimestre];
                                                 SourceExpr=PeriodType;
                                                 OptionValue=Quarter;
                                                 OnPush=BEGIN
                                                          FindPeriod('');
                                                        END;
                                                         }
    { 20  ;OptionButton ;1320 ;8140 ;550  ;550  ;VertGlue=Bottom;
                                                 FocusOnClick=No;
                                                 ShowCaption=No;
                                                 Border=Yes;
                                                 BitmapPos=Center;
                                                 Bitmap=11;
                                                 ToolTipML=[ENU=Month;
                                                            ESP=Mes];
                                                 SourceExpr=PeriodType;
                                                 OptionValue=Month;
                                                 OnPush=BEGIN
                                                          FindPeriod('');
                                                        END;
                                                         }
    { 21  ;OptionButton ;770  ;8140 ;550  ;550  ;VertGlue=Bottom;
                                                 FocusOnClick=No;
                                                 ShowCaption=No;
                                                 Border=Yes;
                                                 BitmapPos=Center;
                                                 Bitmap=10;
                                                 ToolTipML=[ENU=Week;
                                                            ESP=Semana];
                                                 SourceExpr=PeriodType;
                                                 OptionValue=Week;
                                                 OnPush=BEGIN
                                                          FindPeriod('');
                                                        END;
                                                         }
    { 22  ;OptionButton ;220  ;8140 ;550  ;550  ;VertGlue=Bottom;
                                                 FocusOnClick=No;
                                                 ShowCaption=No;
                                                 Border=Yes;
                                                 BitmapPos=Center;
                                                 Bitmap=9;
                                                 ToolTipML=[ENU=Day;
                                                            ESP=D¡a];
                                                 SourceExpr=PeriodType;
                                                 OptionValue=Day;
                                                 OnPush=BEGIN
                                                          FindPeriod('');
                                                        END;
                                                         }
    { 23  ;OptionButton ;2970 ;8140 ;550  ;550  ;VertGlue=Bottom;
                                                 FocusOnClick=No;
                                                 ShowCaption=No;
                                                 Border=Yes;
                                                 BitmapPos=Center;
                                                 Bitmap=14;
                                                 ToolTipML=[ENU=Accounting Period;
                                                            ESP=Periodo contable];
                                                 SourceExpr=PeriodType;
                                                 OptionValue=Accounting Period;
                                                 OnPush=BEGIN
                                                          FindPeriod('');
                                                        END;
                                                         }
    { 26  ;CommandButton;3740 ;8140 ;550  ;550  ;VertGlue=Bottom;
                                                 FocusOnClick=No;
                                                 ShowCaption=No;
                                                 BitmapPos=Center;
                                                 AutoRepeat=Yes;
                                                 Bitmap=15;
                                                 ToolTipML=[ENU=Previous Period;
                                                            ESP=Periodo anterior];
                                                 OnPush=BEGIN
                                                          FindPeriod('<=');
                                                        END;
                                                         }
    { 27  ;CommandButton;4290 ;8140 ;550  ;550  ;VertGlue=Bottom;
                                                 FocusOnClick=No;
                                                 ShowCaption=No;
                                                 BitmapPos=Center;
                                                 AutoRepeat=Yes;
                                                 Bitmap=16;
                                                 ToolTipML=[ENU=Next Period;
                                                            ESP=Periodo siguiente];
                                                 OnPush=BEGIN
                                                          FindPeriod('>=');
                                                        END;
                                                         }
    { 28  ;MenuButton   ;11660;8140 ;2200 ;550  ;HorzGlue=Right;
                                                 VertGlue=Bottom;
                                                 CaptionML=[ENU=F&unctions;
                                                            ESP=Acci&ones];
                                                 Menu=MENUITEMS
                                                 {
                                                   { ID=29;
                                                     Ellipsis=Yes;
                                                     CaptionML=[ENU=Export to Excel;
                                                                ESP=Exportar a Excel];
                                                     OnPush=VAR
                                                              ExportAccSchedToExcel@1001 : Report 29;
                                                            BEGIN
                                                              ExportAccSchedToExcel.SetOptions(Rec,CurrentColumnName,UseAmtsInAddCurr);
                                                              ExportAccSchedToExcel.RUN;
                                                            END;
                                                             }
                                                   { ID=40;
                                                     Ellipsis=Yes;
                                                     CaptionML=[ENU=Print;
                                                                ESP=Imprimir];
                                                     OnPush=VAR
                                                              AccSched@1000 : Report 25;
                                                              DateFilter@1002 : Text[30];
                                                              BudgetFilter@1003 : Text[30];
                                                              BusUnitFilter@1004 : Text[30];
                                                              Dim1Filter@1005 : Text[250];
                                                              Dim2Filter@1006 : Text[250];
                                                              Dim3Filter@1007 : Text[250];
                                                              Dim4Filter@1008 : Text[250];
                                                            BEGIN
                                                              AccSched.SetAccSchedName(CurrentSchedName);
                                                              AccSched.SetColumnLayoutName(CurrentColumnName);
                                                              DateFilter := GETFILTER("Date Filter");
                                                              BudgetFilter := GETFILTER("Budget Filter");
                                                              BusUnitFilter := GETFILTER("Business Unit Filter");
                                                              Dim1Filter := GETFILTER("Dimension 1 Filter");
                                                              Dim2Filter := GETFILTER("Dimension 2 Filter");
                                                              Dim3Filter := GETFILTER("Dimension 3 Filter");
                                                              Dim4Filter := GETFILTER("Dimension 4 Filter");
                                                              AccSched.SetFilters(DateFilter,BudgetFilter,BusUnitFilter,Dim1Filter,Dim2Filter,Dim3Filter,Dim4Filter);
                                                              {
                                                              AccSched.SetFilter(
                                                                GETFILTER("Date Filter"),GETFILTER("Budget Filter"),GETFILTER("Business Unit Filter"),
                                                                GETFILTER("Dimension 1 Filter"),GETFILTER("Dimension 2 Filter"),
                                                                GETFILTER("Dimension 3 Filter"),GETFILTER("Dimension 4 Filter"));
                                                              }
                                                              AccSched.RUN;
                                                            END;
                                                             }
                                                   { ID=17;
                                                     Ellipsis=Yes;
                                                     CaptionML=[ENU=Show Bar Chart;
                                                                ESP=Mostrar gr fico de barras];
                                                     OnPush=BEGIN
                                                              ShowBarChart;
                                                            END;
                                                             }
                                                   { ID=1100000;
                                                     MenuItemType=Separator }
                                                   { ID=1100001;
                                                     PushAction=RunObject;
                                                     CaptionML=[ENU=Export Schedules to ASC format;
                                                                ESP=Exp. esq. ctas. a formato ASC];
                                                     RunObject=Report 10720 }
                                                 }
                                                  }
  }
  CODE
  {
    VAR
      Text000@1000 : TextConst 'ENU=DEFAULT;ESP=GENERICO';
      Text001@1001 : TextConst 'ENU=* ERROR *;ESP=* ERROR *';
      Text002@1002 : TextConst 'ENU=Column formula: %1;ESP=F¢rmula columna: %1';
      Text003@1003 : TextConst 'ENU=Row formula: %1;ESP=F¢rmula fila: %1';
      TempColumnLayout@1004 : TEMPORARY Record 334;
      AccSchedName@1005 : Record 84;
      AnalysisView@1020 : Record 363;
      GLSetup@1016 : Record 98;
      AccSchedManagement@1006 : Codeunit 8;
      CurrentSchedName@1007 : Code[10];
      CurrentColumnName@1008 : Code[10];
      NewCurrentSchedName@1009 : Code[10];
      NewCurrentColumnName@1010 : Code[10];
      ShowError@1011 : 'None,Division by Zero,Period Error,Both';
      ColumnValue@1012 : Decimal;
      PeriodType@1013 : 'Day,Week,Month,Quarter,Year,Accounting Period';
      UseAmtsInAddCurr@1014 : Boolean;
      Text004@1015 : TextConst 'ENU=Not Available;ESP=No disponible';
      Text005@1021 : TextConst 'ENU=1,6,,Dimension %1 Filter;ESP=1,6,,Filtro dimensi¢n %1';

    PROCEDURE SetAccSchedName@6(NewAccSchedName@1000 : Code[10]);
    VAR
      AccSchedName@1001 : Record 84;
    BEGIN
      NewCurrentSchedName := NewAccSchedName;
      IF AccSchedName.GET(NewCurrentSchedName) THEN
        IF AccSchedName."Default Column Layout" <> '' THEN
          NewCurrentColumnName := AccSchedName."Default Column Layout";
    END;

    LOCAL PROCEDURE FindPeriod@2(SearchText@1000 : Code[10]);
    VAR
      Calendar@1001 : Record 2000000007;
      PeriodFormMgt@1002 : Codeunit 359;
    BEGIN
      IF GETFILTER("Date Filter") <> '' THEN BEGIN
        Calendar.SETFILTER("Period Start",GETFILTER("Date Filter"));
        IF NOT PeriodFormMgt.FindDate('+',Calendar,PeriodType) THEN
          PeriodFormMgt.FindDate('+',Calendar,PeriodType::Day);
        Calendar.SETRANGE("Period Start");
      END;
      PeriodFormMgt.FindDate(SearchText,Calendar,PeriodType);
      SETRANGE("Date Filter",Calendar."Period Start",Calendar."Period End");
      IF GETRANGEMIN("Date Filter") = GETRANGEMAX("Date Filter") THEN
        SETRANGE("Date Filter",GETRANGEMIN("Date Filter"));
    END;

    LOCAL PROCEDURE FormLookUpDimFilter@57(Dim@1000 : Code[20];VAR Text@1001 : Text[1024]) : Boolean;
    VAR
      DimVal@1002 : Record 349;
      DimValList@1003 : Form 560;
    BEGIN
      IF Dim = '' THEN
        EXIT(FALSE);
      DimValList.LOOKUPMODE(TRUE);
      DimVal.SETRANGE("Dimension Code",Dim);
      DimValList.SETTABLEVIEW(DimVal);
      IF DimValList.RUNMODAL = ACTION::LookupOK THEN BEGIN
        DimValList.GETRECORD(DimVal);
        Text := DimValList.GetSelectionFilter;
        EXIT(TRUE);
      END ELSE
        EXIT(FALSE)
    END;

    LOCAL PROCEDURE FormGetCaptionClass@12(DimNo@1000 : Integer) : Text[250];
    BEGIN
      CASE DimNo OF
        1:
          BEGIN
            IF AnalysisView."Dimension 1 Code" <> '' THEN
              EXIT('1,6,' + AnalysisView."Dimension 1 Code")
            ELSE
              EXIT(STRSUBSTNO(Text005,DimNo));
          END;
        2:
          BEGIN
            IF AnalysisView."Dimension 2 Code" <> '' THEN
              EXIT('1,6,' + AnalysisView."Dimension 2 Code")
            ELSE
              EXIT(STRSUBSTNO(Text005,DimNo));
          END;
        3:
          BEGIN
            IF AnalysisView."Dimension 3 Code" <> '' THEN
              EXIT('1,6,' + AnalysisView."Dimension 3 Code")
            ELSE
              EXIT(STRSUBSTNO(Text005,DimNo));
          END;
        4:
          BEGIN
            IF AnalysisView."Dimension 4 Code" <> '' THEN
              EXIT('1,6,' + AnalysisView."Dimension 4 Code")
            ELSE
              EXIT(STRSUBSTNO(Text005,DimNo));
          END;
      END;
    END;

    LOCAL PROCEDURE ShowBarChart@1();
    VAR
      AccSchedLine@1004 : Record 85;
      AccSchedBarChart@1002 : Form 655;
      NoOfRows@1000 : Integer;
      LineNo@1001 : ARRAY [3] OF Integer;
      DateFilter@1003 : Text[80];
      BudgetFilter@1005 : Text[80];
      Dim1Filter@1006 : Text[80];
      Dim2Filter@1007 : Text[80];
      Dim3Filter@1008 : Text[80];
      Dim4Filter@1009 : Text[80];
    BEGIN
      CurrForm.SETSELECTIONFILTER(AccSchedLine);
      AccSchedLine.MARKEDONLY(TRUE);
      IF NOT AccSchedLine.FIND('-') THEN BEGIN
        NoOfRows := 1;
        LineNo[NoOfRows] := "Line No.";
      END ELSE
        REPEAT
          NoOfRows := NoOfRows + 1;
          LineNo[NoOfRows] := AccSchedLine."Line No.";
        UNTIL (NoOfRows = 3) OR (AccSchedLine.NEXT = 0);

      AccSchedBarChart.SetParams(
        CurrentSchedName,CurrentColumnName,LineNo[1],LineNo[2],LineNo[3],PeriodType,UseAmtsInAddCurr);

      DateFilter := GETFILTER("Date Filter");
      BudgetFilter := GETFILTER("Budget Filter");
      Dim1Filter := GETFILTER("Dimension 1 Filter");
      Dim2Filter := GETFILTER("Dimension 2 Filter");
      Dim3Filter := GETFILTER("Dimension 3 Filter");
      Dim4Filter := GETFILTER("Dimension 4 Filter");
      AccSchedBarChart.SetFilters(DateFilter,BudgetFilter,Dim1Filter,Dim2Filter,Dim3Filter,Dim4Filter);
      AccSchedBarChart.RUN;
    END;

    BEGIN
    END.
  }
}
