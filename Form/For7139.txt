OBJECT Form 7139 Sales Budget Overview
{
  OBJECT-PROPERTIES
  {
    Date=14/08/09;
    Time=12:00:00;
    Version List=NAVW16.00.01;
  }
  PROPERTIES
  {
    Width=18590;
    Height=10010;
    CaptionML=[ENU=Sales Budget Overview;
               ESP=Inf. general de presupuesto de ventas];
    SaveValues=Yes;
    InsertAllowed=No;
    DeleteAllowed=No;
    ModifyAllowed=No;
    LinksAllowed=No;
    SourceTable=Table367;
    OnOpenForm=BEGIN
                 CurrentAnalysisArea := CurrentAnalysisArea::Sales;
                 ItemBudgetManagement.BudgetNameSelection(
                   CurrentAnalysisArea,CurrentBudgetName,ItemBudgetName,ItemStatisticsBuffer,
                   BudgetDim1Filter,BudgetDim2Filter,BudgetDim3Filter);
                 ItemBudgetManagement.SetLineAndColDim(
                   ItemBudgetName,LineDimCode,LineDimOption,ColumnDimCode,ColumnDimOption);

                 GLSetup.GET;
                 NormalFormatString := Text001 + GLSetup."Amount Decimal Places" + Text002;
                 SourceTypeFilter := SourceTypeFilter::Customer;

                 UpdateDimCtrls;

                 FindPeriod('');
                 CurrForm.UPDATECONTROLS;
               END;

    OnFindRecord=BEGIN
                   EXIT(
                     ItemBudgetManagement.FindRec(
                       ItemBudgetName,LineDimOption,Rec,Which,
                       ItemFilter,SourceNoFilter,PeriodType,DateFilter,PeriodInitialized,InternalDateFilter,
                       GlobalDim1Filter,GlobalDim2Filter,BudgetDim1Filter,BudgetDim2Filter,BudgetDim3Filter));
                 END;

    OnNextRecord=BEGIN
                   EXIT(
                     ItemBudgetManagement.NextRec(
                       ItemBudgetName,LineDimOption,Rec,Steps,
                       ItemFilter,SourceNoFilter,PeriodType,DateFilter,
                       GlobalDim1Filter,GlobalDim2Filter,BudgetDim1Filter,BudgetDim2Filter,BudgetDim3Filter));
                 END;

    OnAfterGetRecord=BEGIN
                       IF CurrForm.TotalBudgetedAmount.VISIBLE THEN
                         Amount := CalcAmt(0,FALSE);
                       IF CurrForm.TotalBudgetedQuantity.VISIBLE THEN
                         Quantity := CalcAmt(2,FALSE);
                     END;

    OnAfterGetCurrRecord=BEGIN
                           IF CurrForm.TotalBudgetedAmount.VISIBLE THEN
                             Amount := CalcAmt(0,FALSE);
                           IF CurrForm.TotalBudgetedQuantity.VISIBLE THEN
                             Quantity := CalcAmt(2,FALSE);
                         END;

  }
  CONTROLS
  {
    { 1   ;TabControl   ;220  ;220  ;18150;3080 ;HorzGlue=Both;
                                                 PageNamesML=[ENU=General,Filters,Options;
                                                              ESP=General,Filtros,Opciones] }
    { 3   ;TextBox      ;3850 ;990  ;2750 ;440  ;ParentControl=1;
                                                 InPage=0;
                                                 CaptionML=[ENU=Item Budget Name;
                                                            ESP=Nombre ppto. producto];
                                                 SourceExpr=CurrentBudgetName;
                                                 OnValidate=BEGIN
                                                              ItemBudgetManagement.CheckBudgetName(CurrentAnalysisArea,CurrentBudgetName,ItemBudgetName);
                                                            END;

                                                 OnLookup=BEGIN
                                                            ItemBudgetManagement.LookupItemBudgetName(
                                                              CurrentBudgetName,ItemBudgetName,ItemStatisticsBuffer,
                                                              BudgetDim1Filter,BudgetDim2Filter,BudgetDim3Filter);
                                                            ItemBudgetManagement.ValidateLineDimCode(
                                                              ItemBudgetName,LineDimCode,LineDimOption,ColumnDimOption,
                                                              InternalDateFilter,DateFilter,ItemStatisticsBuffer,PeriodInitialized);
                                                            ItemBudgetManagement.ValidateColumnDimCode(
                                                              ItemBudgetName,ColumnDimCode,ColumnDimOption,LineDimOption,
                                                              InternalDateFilter,DateFilter,ItemStatisticsBuffer,PeriodInitialized);
                                                            UpdateDimCtrls;
                                                            CurrForm.UPDATE(FALSE);
                                                          END;

                                                 OnAfterValidate=BEGIN
                                                                   ItemBudgetManagement.SetItemBudgetName(
                                                                     CurrentBudgetName,ItemBudgetName,ItemStatisticsBuffer,
                                                                     BudgetDim1Filter,BudgetDim2Filter,BudgetDim3Filter);
                                                                   ItemBudgetManagement.ValidateLineDimCode(
                                                                     ItemBudgetName,LineDimCode,LineDimOption,ColumnDimOption,
                                                                     InternalDateFilter,DateFilter,ItemStatisticsBuffer,PeriodInitialized);
                                                                   ItemBudgetManagement.ValidateColumnDimCode(
                                                                     ItemBudgetName,ColumnDimCode,ColumnDimOption,LineDimOption,
                                                                     InternalDateFilter,DateFilter,ItemStatisticsBuffer,PeriodInitialized);
                                                                   UpdateDimCtrls;
                                                                   CurrForm.UPDATE(FALSE);
                                                                 END;
                                                                  }
    { 4   ;Label        ;440  ;990  ;3300 ;440  ;ParentControl=3 }
    { 7   ;TextBox      ;3850 ;2200 ;2750 ;440  ;ParentControl=1;
                                                 InPage=0;
                                                 CaptionML=[ENU=Show as Columns;
                                                            ESP=Muestra como columnas];
                                                 SourceExpr=ColumnDimCode;
                                                 OnValidate=BEGIN
                                                              IF (UPPERCASE(LineDimCode) = UPPERCASE(ColumnDimCode)) AND (LineDimCode <> '') THEN BEGIN
                                                                LineDimCode := '';
                                                                ItemBudgetManagement.ValidateLineDimCode(
                                                                  ItemBudgetName,LineDimCode,LineDimOption,ColumnDimOption,
                                                                  InternalDateFilter,DateFilter,ItemStatisticsBuffer,PeriodInitialized);
                                                              END;
                                                              ItemBudgetManagement.ValidateColumnDimCode(
                                                                ItemBudgetName,ColumnDimCode,ColumnDimOption,LineDimOption,
                                                                InternalDateFilter,DateFilter,ItemStatisticsBuffer,PeriodInitialized);
                                                            END;

                                                 OnLookup=VAR
                                                            NewCode@1000 : Text[30];
                                                          BEGIN
                                                            NewCode := ItemBudgetManagement.GetDimSelection(ColumnDimCode,ItemBudgetName);
                                                            IF NewCode <> ColumnDimCode THEN BEGIN
                                                              Text := NewCode;
                                                              EXIT(TRUE);
                                                            END;
                                                          END;

                                                 OnAfterValidate=BEGIN
                                                                   CurrForm.UPDATE(FALSE);
                                                                 END;
                                                                  }
    { 8   ;Label        ;440  ;2200 ;3300 ;440  ;ParentControl=7 }
    { 5   ;TextBox      ;3850 ;1650 ;2750 ;440  ;ParentControl=1;
                                                 InPage=0;
                                                 CaptionML=[ENU=Show as Lines;
                                                            ESP=Muestra como l¡neas];
                                                 SourceExpr=LineDimCode;
                                                 OnValidate=BEGIN
                                                              IF (UPPERCASE(LineDimCode) = UPPERCASE(ColumnDimCode)) AND (LineDimCode <> '') THEN BEGIN
                                                                ColumnDimCode := '';
                                                                ItemBudgetManagement.ValidateColumnDimCode(
                                                                  ItemBudgetName,ColumnDimCode,ColumnDimOption,LineDimOption,
                                                                  InternalDateFilter,DateFilter,ItemStatisticsBuffer,PeriodInitialized);
                                                              END;
                                                              ItemBudgetManagement.ValidateLineDimCode(
                                                                ItemBudgetName,LineDimCode,LineDimOption,ColumnDimOption,
                                                                InternalDateFilter,DateFilter,ItemStatisticsBuffer,PeriodInitialized);
                                                              IF LineDimOption = LineDimOption::Period THEN
                                                                SETCURRENTKEY("Period Start")
                                                              ELSE
                                                                SETCURRENTKEY(Code);
                                                            END;

                                                 OnLookup=VAR
                                                            NewCode@1000 : Text[30];
                                                          BEGIN
                                                            NewCode := ItemBudgetManagement.GetDimSelection(LineDimCode,ItemBudgetName);
                                                            IF NewCode <> LineDimCode THEN BEGIN
                                                              Text := NewCode;
                                                              EXIT(TRUE);
                                                            END;
                                                          END;

                                                 OnAfterValidate=BEGIN
                                                                   CurrForm.UPDATE(FALSE);
                                                                 END;
                                                                  }
    { 6   ;Label        ;440  ;1650 ;3300 ;440  ;ParentControl=5 }
    { 13  ;TextBox      ;15290;1540 ;2750 ;440  ;Name=SalesCodeFilterCtrl;
                                                 ParentControl=1;
                                                 InPage=0;
                                                 CaptionML=[ENU=Customer Filter;
                                                            ESP=Filtro cliente];
                                                 ClearOnLookup=No;
                                                 SourceExpr=SourceNoFilter;
                                                 OnLookup=VAR
                                                            CustList@1005 : Form 22;
                                                            VendList@1004 : Form 27;
                                                          BEGIN
                                                            CASE SourceTypeFilter OF
                                                              SourceTypeFilter::Customer:
                                                                BEGIN
                                                                  CustList.LOOKUPMODE := TRUE;
                                                                  IF CustList.RUNMODAL = ACTION::LookupOK THEN
                                                                    Text := CustList.GetSelectionFilter
                                                                  ELSE
                                                                    EXIT(FALSE);
                                                                END;
                                                              SourceTypeFilter::Vendor:
                                                                BEGIN
                                                                  VendList.LOOKUPMODE := TRUE;
                                                                  IF VendList.RUNMODAL = ACTION::LookupOK THEN
                                                                    Text := VendList.GetSelectionFilter
                                                                  ELSE
                                                                    EXIT(FALSE);
                                                                END;
                                                            END;

                                                            EXIT(TRUE);
                                                          END;
                                                           }
    { 10  ;Label        ;11880;1540 ;3300 ;440  ;ParentControl=13 }
    { 14  ;TextBox      ;15290;2640 ;2750 ;440  ;ParentControl=1;
                                                 InPage=0;
                                                 CaptionML=[ENU=Show Value as;
                                                            ESP=Mostrar valor como];
                                                 OptionCaptionML=[ENU=Sales Amount,COGS Amount,Quantity;
                                                                  ESP=Importe venta,Coste ventas,Cantidad];
                                                 OptionString=Sales Amount,COGS Amount,Quantity;
                                                 SourceExpr=ValueType }
    { 12  ;Label        ;11880;2640 ;3300 ;440  ;ParentControl=14 }
    { 15  ;TextBox      ;15290;2090 ;2750 ;440  ;ParentControl=1;
                                                 InPage=0;
                                                 CaptionML=[ENU=Item Filter;
                                                            ESP=Filtro producto];
                                                 ClearOnLookup=No;
                                                 SourceExpr=ItemFilter;
                                                 OnLookup=VAR
                                                            ItemList@1002 : Form 31;
                                                          BEGIN
                                                            ItemList.LOOKUPMODE(TRUE);
                                                            IF ItemList.RUNMODAL = ACTION::LookupOK THEN BEGIN
                                                              Text := ItemList.GetSelectionFilter;
                                                              EXIT(TRUE);
                                                            END;
                                                          END;

                                                 OnAfterValidate=BEGIN
                                                                   ItemStatisticsBuffer.SETFILTER("Item Filter",ItemFilter);
                                                                   CurrForm.UPDATE(FALSE);
                                                                 END;
                                                                  }
    { 11  ;Label        ;11880;2090 ;3300 ;440  ;ParentControl=15 }
    { 16  ;TextBox      ;15290;990  ;2750 ;440  ;ParentControl=1;
                                                 InPage=0;
                                                 CaptionML=[ENU=Date Filter;
                                                            ESP=Filtro fecha];
                                                 SourceExpr=DateFilter;
                                                 OnValidate=VAR
                                                              ApplicationManagement@1001 : Codeunit 1;
                                                            BEGIN
                                                              IF ApplicationManagement.MakeDateFilter(DateFilter) = 0 THEN;
                                                              ItemStatisticsBuffer.SETFILTER("Date Filter",DateFilter);
                                                              DateFilter := ItemStatisticsBuffer.GETFILTER("Date Filter");
                                                              InternalDateFilter := DateFilter;
                                                            END;

                                                 OnAfterValidate=BEGIN
                                                                   CurrForm.UPDATE;
                                                                 END;
                                                                  }
    { 9   ;Label        ;11880;990  ;3300 ;440  ;ParentControl=16 }
    { 43  ;TextBox      ;15290;2090 ;2750 ;440  ;Name=BudgetDim3Filter;
                                                 ParentControl=1;
                                                 InPage=1;
                                                 CaptionML=[ENU=Budget Dimension 3 Filter;
                                                            ESP=Filtro dim. presupuesto 3];
                                                 ClearOnLookup=No;
                                                 SourceExpr=BudgetDim3Filter;
                                                 CaptionClass=GetCaptionClass(3);
                                                 OnLookup=BEGIN
                                                            EXIT(LookUpDimFilter(ItemBudgetName."Budget Dimension 3 Code",Text));
                                                          END;

                                                 OnAfterValidate=BEGIN
                                                                   ItemStatisticsBuffer.SETFILTER("Dimension 3 Filter",BudgetDim3Filter);
                                                                 END;
                                                                  }
    { 46  ;Label        ;11880;2090 ;3300 ;440  ;ParentControl=43 }
    { 44  ;TextBox      ;15290;1540 ;2750 ;440  ;Name=BudgetDim2Filter;
                                                 ParentControl=1;
                                                 InPage=1;
                                                 CaptionML=[ENU=Budget Dimension 2 Filter;
                                                            ESP=Filtro dim. presupuesto 2];
                                                 ClearOnLookup=No;
                                                 SourceExpr=BudgetDim2Filter;
                                                 CaptionClass=GetCaptionClass(2);
                                                 OnLookup=BEGIN
                                                            EXIT(LookUpDimFilter(ItemBudgetName."Budget Dimension 2 Code",Text));
                                                          END;

                                                 OnAfterValidate=BEGIN
                                                                   ItemStatisticsBuffer.SETFILTER("Dimension 2 Filter",BudgetDim2Filter);
                                                                 END;
                                                                  }
    { 45  ;Label        ;11880;1540 ;3300 ;440  ;ParentControl=44 }
    { 47  ;TextBox      ;15290;990  ;2750 ;440  ;Name=BudgetDim1Filter;
                                                 ParentControl=1;
                                                 InPage=1;
                                                 CaptionML=[ENU=Budget Dimension 1 Filter;
                                                            ESP=Filtro dim. presupuesto 1];
                                                 ClearOnLookup=No;
                                                 SourceExpr=BudgetDim1Filter;
                                                 CaptionClass=GetCaptionClass(1);
                                                 OnLookup=BEGIN
                                                            EXIT(LookUpDimFilter(ItemBudgetName."Budget Dimension 1 Code",Text));
                                                          END;

                                                 OnAfterValidate=BEGIN
                                                                   ItemStatisticsBuffer.SETFILTER("Dimension 1 Filter",BudgetDim1Filter);
                                                                 END;
                                                                  }
    { 48  ;Label        ;11880;990  ;3300 ;440  ;ParentControl=47 }
    { 49  ;TextBox      ;3850 ;1540 ;2750 ;440  ;Name=GlobalDim2Filter;
                                                 ParentControl=1;
                                                 InPage=1;
                                                 CaptionML=[ENU=Global Dimension 2 Filter;
                                                            ESP=Filtro dimensi¢n global  2];
                                                 ClearOnLookup=No;
                                                 SourceExpr=GlobalDim2Filter;
                                                 CaptionClass='1,3,2';
                                                 OnLookup=BEGIN
                                                            EXIT(LookUpDimFilter(GLSetup."Global Dimension 2 Code",Text));
                                                          END;

                                                 OnAfterValidate=BEGIN
                                                                   ItemStatisticsBuffer.SETFILTER("Global Dimension 2 Filter",GlobalDim2Filter);
                                                                 END;
                                                                  }
    { 52  ;Label        ;440  ;1540 ;3300 ;440  ;ParentControl=49 }
    { 50  ;TextBox      ;3850 ;990  ;2750 ;440  ;Name=GlobalDim1Filter;
                                                 ParentControl=1;
                                                 InPage=1;
                                                 CaptionML=[ENU=Global Dimension 1 Filter;
                                                            ESP=Filtro dimensi¢n global 1];
                                                 ClearOnLookup=No;
                                                 SourceExpr=GlobalDim1Filter;
                                                 CaptionClass='1,3,1';
                                                 OnLookup=BEGIN
                                                            EXIT(LookUpDimFilter(GLSetup."Global Dimension 1 Code",Text));
                                                          END;

                                                 OnAfterValidate=BEGIN
                                                                   ItemStatisticsBuffer.SETFILTER("Global Dimension 1 Filter",GlobalDim1Filter);
                                                                 END;
                                                                  }
    { 51  ;Label        ;440  ;990  ;3300 ;440  ;ParentControl=50 }
    { 36  ;CheckBox     ;3850 ;1540 ;440  ;440  ;ParentControl=1;
                                                 InPage=2;
                                                 ShowCaption=No;
                                                 CaptionML=[ENU=Show Column Name;
                                                            ESP=Muestra nombre columna];
                                                 SourceExpr=ShowColumnName }
    { 37  ;Label        ;440  ;1540 ;3300 ;440  ;ParentControl=36 }
    { 38  ;TextBox      ;3850 ;990  ;2750 ;440  ;ParentControl=1;
                                                 InPage=2;
                                                 CaptionML=[ENU=Rounding Factor;
                                                            ESP=Factor redondeo];
                                                 OptionCaptionML=[ENU=None,1,1000,1000000;
                                                                  ESP=No,1,1000,1000000];
                                                 OptionString=None,1,1000,1000000;
                                                 SourceExpr=RoundingFactor }
    { 39  ;Label        ;440  ;990  ;3300 ;440  ;ParentControl=38 }
    { 2   ;CommandButton;16170;9240 ;2200 ;550  ;HorzGlue=Right;
                                                 VertGlue=Bottom;
                                                 PushAction=FormHelp }
    { 19  ;MatrixBox    ;220  ;3520 ;18150;5500 ;Name=Matrix;
                                                 HorzGlue=Both;
                                                 VertGlue=Both;
                                                 MatrixSourceTable=Table367;
                                                 OnFindRecord=BEGIN
                                                                EXIT(
                                                                  ItemBudgetManagement.FindRec(
                                                                    ItemBudgetName,
                                                                    ColumnDimOption,
                                                                    CurrForm.Matrix.MatrixRec,
                                                                    Which,
                                                                    ItemFilter,
                                                                    SourceNoFilter,
                                                                    PeriodType,
                                                                    DateFilter,
                                                                    PeriodInitialized,
                                                                    InternalDateFilter,
                                                                    GlobalDim1Filter,
                                                                    GlobalDim2Filter,
                                                                    BudgetDim1Filter,
                                                                    BudgetDim2Filter,
                                                                    BudgetDim3Filter
                                                                    ));
                                                              END;

                                                 OnNextRecord=BEGIN
                                                                EXIT(
                                                                  ItemBudgetManagement.NextRec(
                                                                    ItemBudgetName,
                                                                    ColumnDimOption,
                                                                    CurrForm.Matrix.MatrixRec,
                                                                    Steps,
                                                                    ItemFilter,
                                                                    SourceNoFilter,
                                                                    PeriodType,
                                                                    DateFilter,
                                                                    GlobalDim1Filter,
                                                                    GlobalDim2Filter,
                                                                    BudgetDim1Filter,
                                                                    BudgetDim2Filter,
                                                                    BudgetDim3Filter
                                                                    ));
                                                              END;

                                                 OnAfterGetRecord=BEGIN
                                                                    IF ShowColumnName THEN
                                                                      MatrixHeader := CurrForm.Matrix.MatrixRec.Name
                                                                    ELSE
                                                                      MatrixHeader := CurrForm.Matrix.MatrixRec.Code;

                                                                    BudgetedAmount := CalcAmt(ValueType,TRUE);
                                                                  END;

                                                 OnAfterGetCurrRecord=BEGIN
                                                                        BudgetedAmount := CalcAmt(ValueType,TRUE);
                                                                      END;
                                                                       }
    { 20  ;TextBox      ;159  ;4620 ;1650 ;440  ;Editable=No;
                                                 ParentControl=19;
                                                 InColumn=Yes;
                                                 SourceExpr=Code;
                                                 OnFormat=BEGIN
                                                            CurrForm.Code.UPDATEFONTBOLD("Show in Bold");
                                                          END;
                                                           }
    { 21  ;Label        ;0    ;0    ;0    ;0    ;ParentControl=20;
                                                 InColumnHeading=Yes }
    { 22  ;TextBox      ;1859 ;4620 ;4400 ;440  ;HorzGlue=Both;
                                                 Editable=No;
                                                 ParentControl=19;
                                                 InColumn=Yes;
                                                 SourceExpr=Name;
                                                 OnFormat=BEGIN
                                                            CurrForm.Name.UPDATEFONTBOLD("Show in Bold");
                                                            CurrForm.Name.UPDATEINDENT(220 * Indentation);
                                                          END;
                                                           }
    { 23  ;Label        ;0    ;0    ;0    ;0    ;ParentControl=22;
                                                 InColumnHeading=Yes }
    { 26  ;TextBox      ;8286 ;4950 ;1650 ;440  ;Name=TotalBudgetedQuantity;
                                                 Editable=No;
                                                 ParentControl=19;
                                                 InColumn=Yes;
                                                 CaptionML=[ENU=Budgeted Quantity;
                                                            ESP=Cantidad presupuestada];
                                                 SourceExpr=Quantity;
                                                 OnDrillDown=BEGIN
                                                               DrillDown(TRUE,ValueType::Quantity);
                                                             END;
                                                              }
    { 27  ;Label        ;0    ;0    ;0    ;0    ;ParentControl=26;
                                                 InColumnHeading=Yes }
    { 24  ;TextBox      ;6086 ;4950 ;2200 ;440  ;Name=TotalBudgetedAmount;
                                                 Editable=No;
                                                 ParentControl=19;
                                                 InColumn=Yes;
                                                 CaptionML=[ENU=Budgeted Sales Amount;
                                                            ESP=Importe ventas presupuestado];
                                                 SourceExpr=Amount;
                                                 OnFormat=BEGIN
                                                            ItemBudgetManagement.FormatAmount(Text,RoundingFactor);
                                                          END;

                                                 OnDrillDown=BEGIN
                                                               DrillDown(TRUE,ValueType::"Sales Amount");
                                                             END;
                                                              }
    { 25  ;Label        ;0    ;0    ;0    ;0    ;ParentControl=24;
                                                 InColumnHeading=Yes }
    { 30  ;TextBox      ;16060;5720 ;6930 ;440  ;Name=CellAmount;
                                                 ParentControl=19;
                                                 InMatrix=Yes;
                                                 SourceExpr=BudgetedAmount;
                                                 OnFormat=BEGIN
                                                            BudgetedAmount := CalcAmt(ValueType,TRUE);

                                                            IF BudgetedAmount = 0 THEN
                                                              Text := ''
                                                            ELSE
                                                              Text := FORMAT(BudgetedAmount,0,NormalFormatString);
                                                            ItemBudgetManagement.FormatAmount(Text,RoundingFactor);
                                                            CurrForm.CellAmount.UPDATEFONTBOLD("Show in Bold" OR CurrForm.Matrix.MatrixRec."Show in Bold");
                                                          END;

                                                 OnAfterInput=BEGIN
                                                                BudgetedAmount := CalcAmt(ValueType,TRUE);

                                                                ItemBudgetManagement.EvaluateAmount(Text,InputError,InputErrorText,RoundingFactor)
                                                              END;

                                                 OnValidate=BEGIN
                                                              IF InputError THEN BEGIN
                                                                ERROR(Text000,InputErrorText);
                                                                InputError := FALSE;
                                                                InputErrorText := '';
                                                              END;
                                                              ItemBudgetName.TESTFIELD(Blocked,FALSE);
                                                            END;

                                                 OnDrillDown=BEGIN
                                                               DrillDown(FALSE,ValueType);
                                                             END;

                                                 OnAfterValidate=VAR
                                                                   ItemBudgEntry2@1004 : Record 7134;
                                                                   RecRef@1003 : RecordRef;
                                                                   ChangeLogMgt@1002 : Codeunit 423;
                                                                   LastEntryNo2@1001 : Integer;
                                                                   LogInsertion@1000 : Boolean;
                                                                 BEGIN
                                                                   LogInsertion :=  ChangeLogMgt.GetTableTriggerMask(DATABASE::"Item Budget Entry") MOD 2 <> 0;
                                                                   IF LogInsertion THEN
                                                                     IF ItemBudgEntry2.FIND('+') THEN
                                                                       LastEntryNo2 := ItemBudgEntry2."Entry No.";

                                                                   CASE ValueType OF
                                                                     ValueType::Quantity:
                                                                       BEGIN
                                                                         ItemStatisticsBuffer.CALCFIELDS("Budgeted Quantity");
                                                                         ItemStatisticsBuffer.VALIDATE("Budgeted Quantity",BudgetedAmount - ItemStatisticsBuffer."Budgeted Quantity");
                                                                       END;
                                                                     ValueType::"COGS Amount":
                                                                       BEGIN
                                                                         ItemStatisticsBuffer.CALCFIELDS("Budgeted Cost Amount");
                                                                         ItemStatisticsBuffer.VALIDATE("Budgeted Cost Amount",BudgetedAmount - ItemStatisticsBuffer."Budgeted Cost Amount");
                                                                       END;
                                                                     ValueType::"Sales Amount":
                                                                       BEGIN
                                                                         ItemStatisticsBuffer.CALCFIELDS("Budgeted Sales Amount");
                                                                         ItemStatisticsBuffer.VALIDATE("Budgeted Sales Amount",BudgetedAmount - ItemStatisticsBuffer."Budgeted Sales Amount");
                                                                       END;
                                                                   END;

                                                                   IF CurrForm.TotalBudgetedAmount.VISIBLE THEN
                                                                     Amount := CalcAmt(0,FALSE);
                                                                   IF CurrForm.TotalBudgetedQuantity.VISIBLE THEN
                                                                     Quantity := CalcAmt(2,FALSE);
                                                                   BudgetedAmount := CalcAmt(ValueType,TRUE);

                                                                   IF LogInsertion THEN
                                                                     IF ItemBudgEntry2.FIND('+') THEN
                                                                       IF LastEntryNo2 < ItemBudgEntry2."Entry No." THEN BEGIN
                                                                         RecRef.GETTABLE(ItemBudgEntry2);
                                                                         ChangeLogMgt.LogInsertion(RecRef);
                                                                       END;
                                                                 END;
                                                                  }
    { 31  ;TextBox      ;16720;6600 ;1650 ;440  ;ParentControl=30;
                                                 InMatrixHeading=Yes;
                                                 SourceExpr=MatrixHeader }
    { 17  ;CommandButton;4290 ;9240 ;550  ;550  ;VertGlue=Bottom;
                                                 FocusOnClick=No;
                                                 ShowCaption=No;
                                                 BitmapPos=Center;
                                                 AutoRepeat=Yes;
                                                 Bitmap=16;
                                                 ToolTipML=[ENU=Next Period;
                                                            ESP=Periodo siguiente];
                                                 OnPush=BEGIN
                                                          FindPeriod('>=');
                                                        END;
                                                         }
    { 18  ;CommandButton;3740 ;9240 ;550  ;550  ;VertGlue=Bottom;
                                                 FocusOnClick=No;
                                                 ShowCaption=No;
                                                 BitmapPos=Center;
                                                 AutoRepeat=Yes;
                                                 Bitmap=15;
                                                 ToolTipML=[ENU=Previous Period;
                                                            ESP=Periodo anterior];
                                                 OnPush=BEGIN
                                                          FindPeriod('<=');
                                                        END;
                                                         }
    { 28  ;OptionButton ;2970 ;9240 ;550  ;550  ;VertGlue=Bottom;
                                                 FocusOnClick=No;
                                                 ShowCaption=No;
                                                 Border=Yes;
                                                 BitmapPos=Center;
                                                 Bitmap=14;
                                                 ToolTipML=[ENU=Accounting Period;
                                                            ESP=Periodo contable];
                                                 SourceExpr=PeriodType;
                                                 OptionValue=Accounting Period;
                                                 OnPush=BEGIN
                                                          FindPeriod('');
                                                        END;
                                                         }
    { 29  ;OptionButton ;2420 ;9240 ;550  ;550  ;VertGlue=Bottom;
                                                 FocusOnClick=No;
                                                 ShowCaption=No;
                                                 Border=Yes;
                                                 BitmapPos=Center;
                                                 Bitmap=13;
                                                 ToolTipML=[ENU=Year;
                                                            ESP=A¤o];
                                                 SourceExpr=PeriodType;
                                                 OptionValue=Year;
                                                 OnPush=BEGIN
                                                          FindPeriod('');
                                                        END;
                                                         }
    { 32  ;OptionButton ;1870 ;9240 ;550  ;550  ;VertGlue=Bottom;
                                                 FocusOnClick=No;
                                                 ShowCaption=No;
                                                 Border=Yes;
                                                 BitmapPos=Center;
                                                 Bitmap=12;
                                                 ToolTipML=[ENU=Quarter;
                                                            ESP=Trimestre];
                                                 SourceExpr=PeriodType;
                                                 OptionValue=Quarter;
                                                 OnPush=BEGIN
                                                          FindPeriod('');
                                                        END;
                                                         }
    { 33  ;OptionButton ;1320 ;9240 ;550  ;550  ;VertGlue=Bottom;
                                                 FocusOnClick=No;
                                                 ShowCaption=No;
                                                 Border=Yes;
                                                 BitmapPos=Center;
                                                 Bitmap=11;
                                                 ToolTipML=[ENU=Month;
                                                            ESP=Mes];
                                                 SourceExpr=PeriodType;
                                                 OptionValue=Month;
                                                 OnPush=BEGIN
                                                          FindPeriod('');
                                                        END;
                                                         }
    { 34  ;OptionButton ;770  ;9240 ;550  ;550  ;VertGlue=Bottom;
                                                 FocusOnClick=No;
                                                 ShowCaption=No;
                                                 Border=Yes;
                                                 BitmapPos=Center;
                                                 Bitmap=10;
                                                 ToolTipML=[ENU=Week;
                                                            ESP=Semana];
                                                 SourceExpr=PeriodType;
                                                 OptionValue=Week;
                                                 OnPush=BEGIN
                                                          FindPeriod('');
                                                        END;
                                                         }
    { 35  ;OptionButton ;220  ;9240 ;550  ;550  ;VertGlue=Bottom;
                                                 FocusOnClick=No;
                                                 ShowCaption=No;
                                                 Border=Yes;
                                                 BitmapPos=Center;
                                                 Bitmap=9;
                                                 ToolTipML=[ENU=Day;
                                                            ESP=D¡a];
                                                 SourceExpr=PeriodType;
                                                 OptionValue=Day;
                                                 OnPush=BEGIN
                                                          FindPeriod('');
                                                        END;
                                                         }
    { 40  ;MenuButton   ;13750;9240 ;2200 ;550  ;HorzGlue=Right;
                                                 VertGlue=Bottom;
                                                 CaptionML=[ENU=F&unctions;
                                                            ESP=Acci&ones];
                                                 Menu=MENUITEMS
                                                 {
                                                   { ID=41;
                                                     CaptionML=[ENU=Reverse Lines and Columns;
                                                                ESP=Invertir l¡neas y columnas];
                                                     OnPush=VAR
                                                              TempDimCode@1001 : Text[30];
                                                            BEGIN
                                                              TempDimCode := ColumnDimCode;
                                                              ColumnDimCode := LineDimCode;
                                                              LineDimCode := TempDimCode;
                                                              ItemBudgetManagement.ValidateLineDimCode(
                                                                ItemBudgetName,LineDimCode,LineDimOption,ColumnDimOption,
                                                                InternalDateFilter,DateFilter,ItemStatisticsBuffer,PeriodInitialized);
                                                              ItemBudgetManagement.ValidateColumnDimCode(
                                                                ItemBudgetName,ColumnDimCode,ColumnDimOption,LineDimOption,
                                                                InternalDateFilter,DateFilter,ItemStatisticsBuffer,PeriodInitialized);
                                                            END;
                                                             }
                                                   { ID=53;
                                                     MenuItemType=Separator }
                                                   { ID=54;
                                                     CaptionML=[ENU=Delete Budget;
                                                                ESP=Borrar presupuesto];
                                                     OnPush=BEGIN
                                                              ItemBudgetManagement.DeleteBudget(
                                                                CurrentAnalysisArea,CurrentBudgetName,
                                                                ItemFilter,DateFilter,
                                                                SourceTypeFilter,SourceNoFilter,
                                                                GlobalDim1Filter,GlobalDim2Filter,
                                                                BudgetDim1Filter,BudgetDim2Filter,BudgetDim3Filter);
                                                            END;
                                                             }
                                                   { ID=55;
                                                     MenuItemType=Separator }
                                                   { ID=42;
                                                     Ellipsis=Yes;
                                                     CaptionML=[ENU=Export to Excel;
                                                                ESP=Exportar a Excel];
                                                     OnPush=VAR
                                                              ExportToXl@1000 : Report 7132;
                                                            BEGIN
                                                              ExportToXl.SetOptions(
                                                                CurrentAnalysisArea,
                                                                CurrentBudgetName,
                                                                ValueType,
                                                                GlobalDim1Filter,GlobalDim2Filter,
                                                                BudgetDim1Filter,BudgetDim2Filter,BudgetDim3Filter,
                                                                DateFilter,
                                                                SourceTypeFilter,SourceNoFilter,
                                                                ItemFilter,
                                                                InternalDateFilter,PeriodInitialized,PeriodType,
                                                                LineDimOption,ColumnDimOption,LineDimCode,ColumnDimCode);
                                                              ExportToXl.RUN;
                                                            END;
                                                             }
                                                   { ID=56;
                                                     Ellipsis=Yes;
                                                     CaptionML=[ENU=Import from Excel;
                                                                ESP=Importar desde Excel];
                                                     OnPush=VAR
                                                              ImportItemBudgetFromExcel@1000 : Report 7131;
                                                            BEGIN
                                                              ImportItemBudgetFromExcel.SetProperties(CurrentBudgetName,CurrentAnalysisArea,ValueType);
                                                              ImportItemBudgetFromExcel.RUNMODAL;
                                                            END;
                                                             }
                                                 }
                                                  }
  }
  CODE
  {
    VAR
      GLSetup@1035 : Record 98;
      ItemBudgetName@1006 : Record 7132;
      ItemStatisticsBuffer@1010 : Record 5821;
      ItemBudgetManagement@1003 : Codeunit 7130;
      CurrentAnalysisArea@1005 : 'Sales,Purchase,Inventory';
      CurrentBudgetName@1002 : Code[10];
      SourceTypeFilter@1017 : ' ,Customer,Vendor,Item';
      SourceNoFilter@1016 : Code[250];
      ItemFilter@1019 : Code[250];
      ValueType@1018 : 'Sales Amount,COGS Amount,Quantity';
      RoundingFactor@1028 : 'None,1,1000,1000000';
      LineDimOption@1001 : 'Item,Customer,Vendor,Period,Location,Global Dimension 1,Global Dimension 2,Budget Dimension 1,Budget Dimension 2,Budget Dimension 3';
      ColumnDimOption@1000 : 'Item,Customer,Vendor,Period,Location,Global Dimension 1,Global Dimension 2,Budget Dimension 1,Budget Dimension 2,Budget Dimension 3';
      PeriodType@1022 : 'Day,Week,Month,Quarter,Year,Accounting Period';
      GlobalDim1Filter@1024 : Code[250];
      GlobalDim2Filter@1023 : Code[250];
      BudgetDim1Filter@1009 : Code[250];
      BudgetDim2Filter@1008 : Code[250];
      BudgetDim3Filter@1007 : Code[250];
      LineDimCode@1012 : Text[30];
      ColumnDimCode@1011 : Text[30];
      DateFilter@1014 : Text[30];
      InternalDateFilter@1013 : Text[30];
      PeriodInitialized@1015 : Boolean;
      BudgetedAmount@1020 : Decimal;
      MatrixHeader@1021 : Text[50];
      ShowColumnName@1025 : Boolean;
      InputError@1026 : Boolean;
      InputErrorText@1027 : Text[250];
      Text000@1029 : TextConst 'ENU=You cannot enter %1 in the amount field.;ESP=No puede introd. %1 en el campo importe.';
      NormalFormatString@1030 : Text[80];
      Text001@1032 : TextConst 'ENU=<Precision,;ESP=<Precision,';
      Text002@1031 : TextConst 'ENU=><Standard Format,0>;ESP=><Standard Format,0>';
      Text003@1034 : TextConst 'ENU=1,6,,Budget Dimension 1 Filter;ESP=1,6,,Filtro dimensi¢n presupuesto 1';
      Text004@1033 : TextConst 'ENU=1,6,,Budget Dimension 2 Filter;ESP=1,6,,Filtro dimensi¢n presupuesto 2';
      Text005@1004 : TextConst 'ENU=1,6,,Budget Dimension 3 Filter;ESP=1,6,,Filtro dimensi¢n presupuesto 3';

    LOCAL PROCEDURE FindPeriod@2(SearchText@1000 : Code[10]);
    VAR
      Item@1001 : Record 27;
      Calendar@1002 : Record 2000000007;
      PeriodFormMgt@1003 : Codeunit 359;
    BEGIN
      IF DateFilter <> '' THEN BEGIN
        Calendar.SETFILTER("Period Start",DateFilter);
        IF NOT PeriodFormMgt.FindDate('+',Calendar,PeriodType) THEN
          PeriodFormMgt.FindDate('+',Calendar,PeriodType::Day);
        Calendar.SETRANGE("Period Start");
      END;
      PeriodFormMgt.FindDate(SearchText,Calendar,PeriodType);
      Item.SETRANGE("Date Filter",Calendar."Period Start",Calendar."Period End");
      IF Item.GETRANGEMIN("Date Filter") = Item.GETRANGEMAX("Date Filter") THEN
        Item.SETRANGE("Date Filter",Item.GETRANGEMIN("Date Filter"));
      InternalDateFilter := Item.GETFILTER("Date Filter");
      IF (LineDimOption <> LineDimOption::Period) AND (ColumnDimOption <> ColumnDimOption::Period) THEN
        DateFilter := InternalDateFilter;
    END;

    LOCAL PROCEDURE CalcAmt@3(ValueType@1001 : Integer;SetColFilter@1000 : Boolean) : Decimal;
    BEGIN
      EXIT(
        ItemBudgetManagement.CalcAmount(
          ValueType,SetColFilter,
          ItemStatisticsBuffer,ItemBudgetName,
          ItemFilter,SourceTypeFilter,SourceNoFilter,DateFilter,
          GlobalDim1Filter,GlobalDim2Filter,BudgetDim1Filter,BudgetDim2Filter,BudgetDim3Filter,
          LineDimOption,Rec,
          ColumnDimOption,CurrForm.Matrix.MatrixRec));
    END;

    LOCAL PROCEDURE GetCaptionClass@13(BudgetDimType@1000 : Integer) : Text[250];
    BEGIN
      IF ItemBudgetName.Name <> CurrentBudgetName THEN
        ItemBudgetName.GET(CurrentAnalysisArea,CurrentBudgetName);
      CASE BudgetDimType OF
        1:
          BEGIN
            IF ItemBudgetName."Budget Dimension 1 Code" <> '' THEN
              EXIT('1,6,' + ItemBudgetName."Budget Dimension 1 Code");
            EXIT(Text003);
          END;
        2:
          BEGIN
            IF ItemBudgetName."Budget Dimension 2 Code" <> '' THEN
              EXIT('1,6,' + ItemBudgetName."Budget Dimension 2 Code");
            EXIT(Text004);
          END;
        3:
          BEGIN
            IF ItemBudgetName."Budget Dimension 3 Code" <> '' THEN
              EXIT('1,6,' + ItemBudgetName."Budget Dimension 3 Code");
            EXIT(Text005);
          END;
      END;
    END;

    LOCAL PROCEDURE LookUpDimFilter@57(Dim@1000 : Code[20];VAR Text@1001 : Text[250]) : Boolean;
    VAR
      DimVal@1002 : Record 349;
      DimValList@1003 : Form 560;
    BEGIN
      IF Dim = '' THEN
        EXIT(FALSE);
      DimVal.SETRANGE("Dimension Code",Dim);
      DimValList.SETTABLEVIEW(DimVal);
      DimValList.LOOKUPMODE(TRUE);
      IF DimValList.RUNMODAL = ACTION::LookupOK THEN BEGIN
        DimValList.GETRECORD(DimVal);
        Text := DimValList.GetSelectionFilter;
        EXIT(TRUE);
      END;
    END;

    LOCAL PROCEDURE UpdateDimCtrls@1();
    BEGIN
      CurrForm.BudgetDim1Filter.ENABLED := ItemBudgetName."Budget Dimension 1 Code" <> '';
      CurrForm.BudgetDim2Filter.ENABLED := ItemBudgetName."Budget Dimension 2 Code" <> '';
      CurrForm.BudgetDim3Filter.ENABLED := ItemBudgetName."Budget Dimension 3 Code" <> '';
      CurrForm.UPDATECONTROLS;
    END;

    LOCAL PROCEDURE DrillDown@4(OnlyLines@1000 : Boolean;ValueType@1001 : 'Sales Amount,Cost Amount,Quantity');
    BEGIN
      ItemBudgetManagement.BudgetDrillDown(
        ItemBudgetName,
        ItemFilter,SourceTypeFilter,SourceNoFilter,DateFilter,
        GlobalDim1Filter,GlobalDim2Filter,BudgetDim1Filter,BudgetDim2Filter,BudgetDim3Filter,
        LineDimOption,Rec,
        ColumnDimOption,CurrForm.Matrix.MatrixRec,
        ValueType,
        OnlyLines);
    END;

    PROCEDURE SetNewBudgetName@5(NewPurchBudgetName@1000 : Code[10]);
    BEGIN
      //Dummy function to make form 9374 compile
    END;

    BEGIN
    END.
  }
}
