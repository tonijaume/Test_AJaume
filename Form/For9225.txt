OBJECT Form 9225 Purch. Analysis by Dim Matrix
{
  OBJECT-PROPERTIES
  {
    Date=05/11/08;
    Time=12:00:00;
    Version List=NAVW16.00;
  }
  PROPERTIES
  {
    Width=19140;
    Height=6710;
    Editable=No;
    CaptionML=ENU=Purch. Analysis by Dim Matrix;
    TableBoxID=1;
    LinksAllowed=No;
    SourceTable=Table367;
    OnOpenForm=BEGIN
                 ApplyColumnFilter;

                 CurrForm.Field1.VISIBLE(1 <= NoOfRecords);
                 CurrForm.Field2.VISIBLE(2 <= NoOfRecords);
                 CurrForm.Field3.VISIBLE(3 <= NoOfRecords);
                 CurrForm.Field4.VISIBLE(4 <= NoOfRecords);
                 CurrForm.Field5.VISIBLE(5 <= NoOfRecords);
                 CurrForm.Field6.VISIBLE(6 <= NoOfRecords);
                 CurrForm.Field7.VISIBLE(7 <= NoOfRecords);
                 CurrForm.Field8.VISIBLE(8 <= NoOfRecords);
                 CurrForm.Field9.VISIBLE(9 <= NoOfRecords);
                 CurrForm.Field10.VISIBLE(10 <= NoOfRecords);
                 CurrForm.Field11.VISIBLE(11 <= NoOfRecords);
                 CurrForm.Field12.VISIBLE(12 <= NoOfRecords);
                 CurrForm.Field13.VISIBLE(13 <= NoOfRecords);
                 CurrForm.Field14.VISIBLE(14 <= NoOfRecords);
                 CurrForm.Field15.VISIBLE(15 <= NoOfRecords);
                 CurrForm.Field16.VISIBLE(16 <= NoOfRecords);
                 CurrForm.Field17.VISIBLE(17 <= NoOfRecords);
                 CurrForm.Field18.VISIBLE(18 <= NoOfRecords);
                 CurrForm.Field19.VISIBLE(19 <= NoOfRecords);
                 CurrForm.Field20.VISIBLE(20 <= NoOfRecords);
                 CurrForm.Field21.VISIBLE(21 <= NoOfRecords);
                 CurrForm.Field22.VISIBLE(22 <= NoOfRecords);
                 CurrForm.Field23.VISIBLE(23 <= NoOfRecords);
                 CurrForm.Field24.VISIBLE(24 <= NoOfRecords);
                 CurrForm.Field25.VISIBLE(25 <= NoOfRecords);
                 CurrForm.Field26.VISIBLE(26 <= NoOfRecords);
                 CurrForm.Field27.VISIBLE(27 <= NoOfRecords);
                 CurrForm.Field28.VISIBLE(28 <= NoOfRecords);
                 CurrForm.Field29.VISIBLE(29 <= NoOfRecords);
                 CurrForm.Field30.VISIBLE(30 <= NoOfRecords);
                 CurrForm.Field31.VISIBLE(31 <= NoOfRecords);
                 CurrForm.Field32.VISIBLE(32 <= NoOfRecords);

                 GLSetup.GET;
                 NormalFormatString := Text001 + GLSetup."Amount Decimal Places" + Text002;
               END;

    OnFindRecord=BEGIN
                   EXIT(
                     ItemAnalysisMgt.FindRec(
                       ItemAnalysisView,LineDimOption,Rec,Which,
                       ItemFilter,LocationFilter,PeriodType,DateFilter,PeriodInitialized,InternalDateFilter,
                       Dim1Filter,Dim2Filter,Dim3Filter));
                 END;

    OnNextRecord=BEGIN
                   EXIT(
                     ItemAnalysisMgt.NextRec(
                       ItemAnalysisView,LineDimOption,Rec,Steps,
                       ItemFilter,LocationFilter,PeriodType,DateFilter,
                       Dim1Filter,Dim2Filter,Dim3Filter));
                 END;

    OnAfterGetRecord=BEGIN
                       IF CurrForm.TotalQuantity.VISIBLE THEN
                         Quantity := CalcAmt(DimCodeBufferColumn,2,FALSE);
                       IF CurrForm.TotalInvtValue.VISIBLE THEN
                         Amount := CalcAmt(DimCodeBufferColumn,1,FALSE);
                       Steps := 1;
                       ApplyColumnFilter;
                       Which := '-';

                       ItemAnalysisMgt.FindRec(
                         ItemAnalysisView,ColumnDimOption,DimCodeBufferColumn3,Which,
                         ItemFilter1,LocationFilter1,PeriodType,DateFilter1,PeriodInitialized,InternalDateFilter,
                         Dim1Filter1,Dim2Filter1,Dim3Filter1);

                       i := 1;
                       WHILE (i <= NoOfRecords) AND (i <= ARRAYLEN(MatrixColumnCaptions)) DO BEGIN
                         MatrixData[i] := CalcAmt(DimCodeBufferColumn3,ValueType,TRUE);
                         ItemAnalysisMgt.NextRec(
                           ItemAnalysisView,ColumnDimOption,DimCodeBufferColumn3,Steps,
                           ItemFilter1,LocationFilter1,PeriodType,DateFilter1,
                           Dim1Filter1,Dim2Filter1,Dim3Filter1);
                         i := i + 1;
                       END;
                     END;

    OnAfterGetCurrRecord=BEGIN
                           IF CurrForm.TotalQuantity.VISIBLE THEN
                             Quantity := CalcAmt(DimCodeBufferColumn,2,FALSE);
                           IF CurrForm.TotalInvtValue.VISIBLE THEN
                             Amount := CalcAmt(DimCodeBufferColumn,1,FALSE);
                           Steps := 1;
                           ApplyColumnFilter;
                           Which := '-';

                           ItemAnalysisMgt.FindRec(
                             ItemAnalysisView,ColumnDimOption,DimCodeBufferColumn3,Which,
                             ItemFilter1,LocationFilter1,PeriodType,DateFilter1,PeriodInitialized,InternalDateFilter,
                             Dim1Filter1,Dim2Filter1,Dim3Filter1);

                           i := 1;
                           WHILE (i <= NoOfRecords) AND (i <= ARRAYLEN(MatrixColumnCaptions)) DO BEGIN
                             MatrixData[i] := CalcAmt(DimCodeBufferColumn3,ValueType,TRUE);
                             ItemAnalysisMgt.NextRec(
                               ItemAnalysisView,ColumnDimOption,DimCodeBufferColumn3,Steps,
                               ItemFilter1,LocationFilter1,PeriodType,DateFilter1,
                               Dim1Filter1,Dim2Filter1,Dim3Filter1);
                             i := i + 1;
                           END;
                         END;

  }
  CONTROLS
  {
    { 1   ;TableBox     ;220  ;220  ;18700;5500 ;HorzGlue=Both;
                                                 VertGlue=Both }
    { 2   ;TextBox      ;0    ;0    ;1700 ;0    ;ParentControl=1;
                                                 InColumn=Yes;
                                                 SourceExpr=Code }
    { 3   ;Label        ;0    ;0    ;0    ;0    ;ParentControl=2;
                                                 InColumnHeading=Yes }
    { 4   ;TextBox      ;0    ;0    ;4392 ;0    ;HorzGlue=Both;
                                                 ParentControl=1;
                                                 InColumn=Yes;
                                                 SourceExpr=Name }
    { 5   ;Label        ;0    ;0    ;0    ;0    ;ParentControl=4;
                                                 InColumnHeading=Yes }
    { 6   ;TextBox      ;0    ;0    ;2196 ;0    ;Name=TotalQuantity;
                                                 ParentControl=1;
                                                 InColumn=Yes;
                                                 CaptionML=ENU=Total Quantity;
                                                 BlankZero=Yes;
                                                 SourceExpr=+Quantity;
                                                 OnDrillDown=BEGIN
                                                               ItemAnalysisMgt.DrillDown(
                                                                 CurrentAnalysisArea,ItemStatisticsBuffer,CurrentItemAnalysisViewCode,
                                                                 ItemFilter,LocationFilter,DateFilter,
                                                                 Dim1Filter,Dim2Filter,Dim3Filter,BudgetFilter,
                                                                 LineDimOption,Rec,
                                                                 ColumnDimOption,DimCodeBufferColumn,
                                                                 FALSE,2,ShowActualBudget);
                                                             END;
                                                              }
    { 7   ;Label        ;0    ;0    ;0    ;0    ;ParentControl=6;
                                                 InColumnHeading=Yes }
    { 8   ;TextBox      ;0    ;0    ;2196 ;0    ;Name=TotalInvtValue;
                                                 ParentControl=1;
                                                 InColumn=Yes;
                                                 CaptionML=ENU=Total Cost Amount;
                                                 BlankZero=Yes;
                                                 SourceExpr=+Amount;
                                                 OnDrillDown=BEGIN
                                                               ItemAnalysisMgt.DrillDown(
                                                                 CurrentAnalysisArea,ItemStatisticsBuffer,CurrentItemAnalysisViewCode,
                                                                 ItemFilter,LocationFilter,DateFilter,
                                                                 Dim1Filter,Dim2Filter,Dim3Filter,BudgetFilter,
                                                                 LineDimOption,Rec,
                                                                 ColumnDimOption,DimCodeBufferColumn,
                                                                 FALSE,1,ShowActualBudget);
                                                             END;
                                                              }
    { 9   ;Label        ;0    ;0    ;0    ;0    ;ParentControl=8;
                                                 InColumnHeading=Yes }
    { 13  ;TextBox      ;9843 ;1320 ;1693 ;440  ;Name=Field1;
                                                 ParentControl=1;
                                                 InColumn=Yes;
                                                 BlankZero=Yes;
                                                 SourceExpr=MatrixData[1];
                                                 CaptionClass='3,' + MatrixColumnCaptions[1];
                                                 OnDrillDown=BEGIN
                                                               FieldDrillDown(1);
                                                             END;
                                                              }
    { 14  ;Label        ;0    ;0    ;0    ;0    ;ParentControl=13;
                                                 InColumnHeading=Yes }
    { 15  ;TextBox      ;11483;1210 ;1693 ;440  ;Name=Field2;
                                                 ParentControl=1;
                                                 InColumn=Yes;
                                                 BlankZero=Yes;
                                                 SourceExpr=MatrixData[2];
                                                 CaptionClass='3,' + MatrixColumnCaptions[2];
                                                 OnDrillDown=BEGIN
                                                               FieldDrillDown(2);
                                                             END;
                                                              }
    { 16  ;Label        ;0    ;0    ;0    ;0    ;ParentControl=15;
                                                 InColumnHeading=Yes }
    { 17  ;TextBox      ;13203;1320 ;1700 ;440  ;Name=Field3;
                                                 ParentControl=1;
                                                 InColumn=Yes;
                                                 BlankZero=Yes;
                                                 SourceExpr=MatrixData[3];
                                                 CaptionClass='3,' + MatrixColumnCaptions[3];
                                                 OnDrillDown=BEGIN
                                                               FieldDrillDown(3);
                                                             END;
                                                              }
    { 18  ;Label        ;0    ;0    ;0    ;0    ;ParentControl=17;
                                                 InColumnHeading=Yes }
    { 25  ;TextBox      ;16298;1870 ;1700 ;440  ;Name=Field4;
                                                 ParentControl=1;
                                                 InColumn=Yes;
                                                 BlankZero=Yes;
                                                 SourceExpr=MatrixData[4];
                                                 CaptionClass='3,' + MatrixColumnCaptions[4];
                                                 OnDrillDown=BEGIN
                                                               FieldDrillDown(4);
                                                             END;
                                                              }
    { 26  ;Label        ;0    ;0    ;0    ;0    ;ParentControl=25;
                                                 InColumnHeading=Yes }
    { 23  ;TextBox      ;16298;1870 ;1700 ;440  ;Name=Field5;
                                                 ParentControl=1;
                                                 InColumn=Yes;
                                                 BlankZero=Yes;
                                                 SourceExpr=MatrixData[5];
                                                 CaptionClass='3,' + MatrixColumnCaptions[5];
                                                 OnDrillDown=BEGIN
                                                               FieldDrillDown(5);
                                                             END;
                                                              }
    { 24  ;Label        ;0    ;0    ;0    ;0    ;ParentControl=23;
                                                 InColumnHeading=Yes }
    { 21  ;TextBox      ;16298;1870 ;1700 ;440  ;Name=Field6;
                                                 ParentControl=1;
                                                 InColumn=Yes;
                                                 BlankZero=Yes;
                                                 SourceExpr=MatrixData[6];
                                                 CaptionClass='3,' + MatrixColumnCaptions[6];
                                                 OnDrillDown=BEGIN
                                                               FieldDrillDown(6);
                                                             END;
                                                              }
    { 22  ;Label        ;0    ;0    ;0    ;0    ;ParentControl=21;
                                                 InColumnHeading=Yes }
    { 19  ;TextBox      ;15028;1540 ;1700 ;440  ;Name=Field7;
                                                 ParentControl=1;
                                                 InColumn=Yes;
                                                 BlankZero=Yes;
                                                 SourceExpr=MatrixData[7];
                                                 CaptionClass='3,' + MatrixColumnCaptions[7];
                                                 OnDrillDown=BEGIN
                                                               FieldDrillDown(7);
                                                             END;
                                                              }
    { 20  ;Label        ;0    ;0    ;0    ;0    ;ParentControl=19;
                                                 InColumnHeading=Yes }
    { 31  ;TextBox      ;21326;550  ;1700 ;440  ;Name=Field8;
                                                 ParentControl=1;
                                                 InColumn=Yes;
                                                 BlankZero=Yes;
                                                 SourceExpr=MatrixData[8];
                                                 CaptionClass='3,' + MatrixColumnCaptions[8];
                                                 OnDrillDown=BEGIN
                                                               FieldDrillDown(8);
                                                             END;
                                                              }
    { 32  ;Label        ;0    ;0    ;0    ;0    ;ParentControl=31;
                                                 InColumnHeading=Yes }
    { 39  ;TextBox      ;23019;440  ;1700 ;440  ;Name=Field9;
                                                 ParentControl=1;
                                                 InColumn=Yes;
                                                 BlankZero=Yes;
                                                 SourceExpr=MatrixData[9];
                                                 CaptionClass='3,' + MatrixColumnCaptions[9];
                                                 OnDrillDown=BEGIN
                                                               FieldDrillDown(9);
                                                             END;
                                                              }
    { 40  ;Label        ;0    ;0    ;0    ;0    ;ParentControl=39;
                                                 InColumnHeading=Yes }
    { 41  ;TextBox      ;24606;440  ;1700 ;440  ;Name=Field10;
                                                 ParentControl=1;
                                                 InColumn=Yes;
                                                 BlankZero=Yes;
                                                 SourceExpr=MatrixData[10];
                                                 CaptionClass='3,' + MatrixColumnCaptions[10];
                                                 OnDrillDown=BEGIN
                                                               FieldDrillDown(10);
                                                             END;
                                                              }
    { 42  ;Label        ;0    ;0    ;0    ;0    ;ParentControl=41;
                                                 InColumnHeading=Yes }
    { 45  ;TextBox      ;26141;660  ;1700 ;440  ;Name=Field11;
                                                 ParentControl=1;
                                                 InColumn=Yes;
                                                 BlankZero=Yes;
                                                 SourceExpr=MatrixData[11];
                                                 CaptionClass='3,' + MatrixColumnCaptions[11];
                                                 OnDrillDown=BEGIN
                                                               FieldDrillDown(11);
                                                             END;
                                                              }
    { 46  ;Label        ;0    ;0    ;0    ;0    ;ParentControl=45;
                                                 InColumnHeading=Yes }
    { 27  ;TextBox      ;28099;440  ;1700 ;440  ;Name=Field12;
                                                 ParentControl=1;
                                                 InColumn=Yes;
                                                 BlankZero=Yes;
                                                 SourceExpr=MatrixData[12];
                                                 CaptionClass='3,' + MatrixColumnCaptions[12];
                                                 OnDrillDown=BEGIN
                                                               FieldDrillDown(12);
                                                             END;
                                                              }
    { 28  ;Label        ;0    ;0    ;0    ;0    ;ParentControl=27;
                                                 InColumnHeading=Yes }
    { 29  ;TextBox      ;29739;440  ;1700 ;440  ;Name=Field13;
                                                 ParentControl=1;
                                                 InColumn=Yes;
                                                 BlankZero=Yes;
                                                 SourceExpr=MatrixData[13];
                                                 CaptionClass='3,' + MatrixColumnCaptions[13];
                                                 OnDrillDown=BEGIN
                                                               FieldDrillDown(13);
                                                             END;
                                                              }
    { 30  ;Label        ;0    ;0    ;0    ;0    ;ParentControl=29;
                                                 InColumnHeading=Yes }
    { 33  ;TextBox      ;32782;440  ;1700 ;440  ;Name=Field14;
                                                 ParentControl=1;
                                                 InColumn=Yes;
                                                 BlankZero=Yes;
                                                 SourceExpr=MatrixData[14];
                                                 CaptionClass='3,' + MatrixColumnCaptions[14];
                                                 OnDrillDown=BEGIN
                                                               FieldDrillDown(14);
                                                             END;
                                                              }
    { 34  ;Label        ;0    ;0    ;0    ;0    ;ParentControl=33;
                                                 InColumnHeading=Yes }
    { 35  ;TextBox      ;34396;440  ;1700 ;440  ;Name=Field15;
                                                 ParentControl=1;
                                                 InColumn=Yes;
                                                 BlankZero=Yes;
                                                 SourceExpr=MatrixData[15];
                                                 CaptionClass='3,' + MatrixColumnCaptions[15];
                                                 OnDrillDown=BEGIN
                                                               FieldDrillDown(15);
                                                             END;
                                                              }
    { 36  ;Label        ;0    ;0    ;0    ;0    ;ParentControl=35;
                                                 InColumnHeading=Yes }
    { 37  ;TextBox      ;36169;440  ;1700 ;440  ;Name=Field16;
                                                 ParentControl=1;
                                                 InColumn=Yes;
                                                 BlankZero=Yes;
                                                 SourceExpr=MatrixData[16];
                                                 CaptionClass='3,' + MatrixColumnCaptions[16];
                                                 OnDrillDown=BEGIN
                                                               FieldDrillDown(16);
                                                             END;
                                                              }
    { 38  ;Label        ;0    ;0    ;0    ;0    ;ParentControl=37;
                                                 InColumnHeading=Yes }
    { 43  ;TextBox      ;36618;550  ;1700 ;440  ;Name=Field17;
                                                 ParentControl=1;
                                                 InColumn=Yes;
                                                 BlankZero=Yes;
                                                 SourceExpr=MatrixData[17];
                                                 CaptionClass='3,' + MatrixColumnCaptions[17];
                                                 OnDrillDown=BEGIN
                                                               FieldDrillDown(17);
                                                             END;
                                                              }
    { 44  ;Label        ;0    ;0    ;0    ;0    ;ParentControl=43;
                                                 InColumnHeading=Yes }
    { 47  ;TextBox      ;38338;440  ;1700 ;440  ;Name=Field18;
                                                 ParentControl=1;
                                                 InColumn=Yes;
                                                 BlankZero=Yes;
                                                 SourceExpr=MatrixData[18];
                                                 CaptionClass='3,' + MatrixColumnCaptions[18];
                                                 OnDrillDown=BEGIN
                                                               FieldDrillDown(18);
                                                             END;
                                                              }
    { 48  ;Label        ;0    ;0    ;0    ;0    ;ParentControl=47;
                                                 InColumnHeading=Yes }
    { 49  ;TextBox      ;41223;440  ;1700 ;440  ;Name=Field19;
                                                 ParentControl=1;
                                                 InColumn=Yes;
                                                 BlankZero=Yes;
                                                 SourceExpr=MatrixData[19];
                                                 CaptionClass='3,' + MatrixColumnCaptions[19];
                                                 OnDrillDown=BEGIN
                                                               FieldDrillDown(19);
                                                             END;
                                                              }
    { 50  ;Label        ;0    ;0    ;0    ;0    ;ParentControl=49;
                                                 InColumnHeading=Yes }
    { 51  ;TextBox      ;42677;440  ;1700 ;440  ;Name=Field20;
                                                 ParentControl=1;
                                                 InColumn=Yes;
                                                 BlankZero=Yes;
                                                 SourceExpr=MatrixData[20];
                                                 CaptionClass='3,' + MatrixColumnCaptions[20];
                                                 OnDrillDown=BEGIN
                                                               FieldDrillDown(20);
                                                             END;
                                                              }
    { 52  ;Label        ;0    ;0    ;0    ;0    ;ParentControl=51;
                                                 InColumnHeading=Yes }
    { 53  ;TextBox      ;44582;440  ;1700 ;440  ;Name=Field21;
                                                 ParentControl=1;
                                                 InColumn=Yes;
                                                 BlankZero=Yes;
                                                 SourceExpr=MatrixData[21];
                                                 CaptionClass='3,' + MatrixColumnCaptions[21];
                                                 OnDrillDown=BEGIN
                                                               FieldDrillDown(21);
                                                             END;
                                                              }
    { 54  ;Label        ;0    ;0    ;0    ;0    ;ParentControl=53;
                                                 InColumnHeading=Yes }
    { 55  ;TextBox      ;46144;440  ;1700 ;440  ;Name=Field22;
                                                 ParentControl=1;
                                                 InColumn=Yes;
                                                 BlankZero=Yes;
                                                 SourceExpr=MatrixData[22];
                                                 CaptionClass='3,' + MatrixColumnCaptions[22];
                                                 OnDrillDown=BEGIN
                                                               FieldDrillDown(22);
                                                             END;
                                                              }
    { 56  ;Label        ;0    ;0    ;0    ;0    ;ParentControl=55;
                                                 InColumnHeading=Yes }
    { 57  ;TextBox      ;47916;330  ;1700 ;440  ;Name=Field23;
                                                 ParentControl=1;
                                                 InColumn=Yes;
                                                 BlankZero=Yes;
                                                 SourceExpr=MatrixData[23];
                                                 CaptionClass='3,' + MatrixColumnCaptions[23];
                                                 OnDrillDown=BEGIN
                                                               FieldDrillDown(23);
                                                             END;
                                                              }
    { 58  ;Label        ;0    ;0    ;0    ;0    ;ParentControl=57;
                                                 InColumnHeading=Yes }
    { 59  ;TextBox      ;49477;440  ;1700 ;440  ;Name=Field24;
                                                 ParentControl=1;
                                                 InColumn=Yes;
                                                 BlankZero=Yes;
                                                 SourceExpr=MatrixData[24];
                                                 CaptionClass='3,' + MatrixColumnCaptions[24];
                                                 OnDrillDown=BEGIN
                                                               FieldDrillDown(24);
                                                             END;
                                                              }
    { 60  ;Label        ;0    ;0    ;0    ;0    ;ParentControl=59;
                                                 InColumnHeading=Yes }
    { 61  ;TextBox      ;51250;220  ;1700 ;440  ;Name=Field25;
                                                 ParentControl=1;
                                                 InColumn=Yes;
                                                 BlankZero=Yes;
                                                 SourceExpr=MatrixData[25];
                                                 CaptionClass='3,' + MatrixColumnCaptions[25];
                                                 OnDrillDown=BEGIN
                                                               FieldDrillDown(25);
                                                             END;
                                                              }
    { 62  ;Label        ;0    ;0    ;0    ;0    ;ParentControl=61;
                                                 InColumnHeading=Yes }
    { 63  ;TextBox      ;53102;440  ;1700 ;440  ;Name=Field26;
                                                 ParentControl=1;
                                                 InColumn=Yes;
                                                 BlankZero=Yes;
                                                 SourceExpr=MatrixData[26];
                                                 CaptionClass='3,' + MatrixColumnCaptions[26];
                                                 OnDrillDown=BEGIN
                                                               FieldDrillDown(26);
                                                             END;
                                                              }
    { 64  ;Label        ;0    ;0    ;0    ;0    ;ParentControl=63;
                                                 InColumnHeading=Yes }
    { 65  ;TextBox      ;54636;550  ;1700 ;440  ;Name=Field27;
                                                 ParentControl=1;
                                                 InColumn=Yes;
                                                 BlankZero=Yes;
                                                 SourceExpr=MatrixData[27];
                                                 CaptionClass='3,' + MatrixColumnCaptions[27];
                                                 OnDrillDown=BEGIN
                                                               FieldDrillDown(27);
                                                             END;
                                                              }
    { 66  ;Label        ;0    ;0    ;0    ;0    ;ParentControl=65;
                                                 InColumnHeading=Yes }
    { 67  ;TextBox      ;56357;440  ;1700 ;440  ;Name=Field28;
                                                 ParentControl=1;
                                                 InColumn=Yes;
                                                 BlankZero=Yes;
                                                 SourceExpr=MatrixData[28];
                                                 CaptionClass='3,' + MatrixColumnCaptions[28];
                                                 OnDrillDown=BEGIN
                                                               FieldDrillDown(28);
                                                             END;
                                                              }
    { 68  ;Label        ;0    ;0    ;0    ;0    ;ParentControl=67;
                                                 InColumnHeading=Yes }
    { 69  ;TextBox      ;57997;330  ;1700 ;440  ;Name=Field29;
                                                 ParentControl=1;
                                                 InColumn=Yes;
                                                 BlankZero=Yes;
                                                 SourceExpr=MatrixData[29];
                                                 CaptionClass='3,' + MatrixColumnCaptions[29];
                                                 OnDrillDown=BEGIN
                                                               FieldDrillDown(29);
                                                             END;
                                                              }
    { 70  ;Label        ;0    ;0    ;0    ;0    ;ParentControl=69;
                                                 InColumnHeading=Yes }
    { 71  ;TextBox      ;59716;440  ;1700 ;440  ;Name=Field30;
                                                 ParentControl=1;
                                                 InColumn=Yes;
                                                 BlankZero=Yes;
                                                 SourceExpr=MatrixData[30];
                                                 CaptionClass='3,' + MatrixColumnCaptions[30];
                                                 OnDrillDown=BEGIN
                                                               FieldDrillDown(30);
                                                             END;
                                                              }
    { 72  ;Label        ;0    ;0    ;0    ;0    ;ParentControl=71;
                                                 InColumnHeading=Yes }
    { 73  ;TextBox      ;61463;440  ;1700 ;440  ;Name=Field31;
                                                 ParentControl=1;
                                                 InColumn=Yes;
                                                 BlankZero=Yes;
                                                 SourceExpr=MatrixData[31];
                                                 CaptionClass='3,' + MatrixColumnCaptions[31];
                                                 OnDrillDown=BEGIN
                                                               FieldDrillDown(31);
                                                             END;
                                                              }
    { 74  ;Label        ;0    ;0    ;0    ;0    ;ParentControl=73;
                                                 InColumnHeading=Yes }
    { 75  ;TextBox      ;63024;550  ;1700 ;440  ;Name=Field32;
                                                 ParentControl=1;
                                                 InColumn=Yes;
                                                 BlankZero=Yes;
                                                 SourceExpr=MatrixData[32];
                                                 CaptionClass='3,' + MatrixColumnCaptions[32];
                                                 OnDrillDown=BEGIN
                                                               FieldDrillDown(32);
                                                             END;
                                                              }
    { 76  ;Label        ;0    ;0    ;0    ;0    ;ParentControl=75;
                                                 InColumnHeading=Yes }
    { 10  ;CommandButton;9460 ;5940 ;2200 ;550  ;HorzGlue=Right;
                                                 VertGlue=Bottom;
                                                 Default=Yes;
                                                 PushAction=LookupOK;
                                                 InvalidActionAppearance=Hide }
    { 11  ;CommandButton;11880;5940 ;2200 ;550  ;HorzGlue=Right;
                                                 VertGlue=Bottom;
                                                 Cancel=Yes;
                                                 PushAction=LookupCancel;
                                                 InvalidActionAppearance=Hide }
    { 12  ;CommandButton;16720;5940 ;2200 ;550  ;HorzGlue=Right;
                                                 VertGlue=Bottom;
                                                 PushAction=FormHelp }
    { 77  ;MenuButton   ;14300;5940 ;2200 ;550  ;HorzGlue=Right;
                                                 VertGlue=Bottom;
                                                 CaptionML=ENU=&Actions;
                                                 Menu=MENUITEMS
                                                 {
                                                   { ID=79;
                                                     CaptionML=ENU=Export to Excel;
                                                     OnPush=VAR
                                                              ItemAnalysisViewEntry@1000 : Record 7154;
                                                              ItemAnalysisViewToExcel@1001 : Codeunit 7152;
                                                            BEGIN
                                                              ItemAnalysisViewToExcel.SetCommonFilters(
                                                                CurrentAnalysisArea,CurrentItemAnalysisViewCode,
                                                                ItemAnalysisViewEntry,DateFilter,ItemFilter,Dim1Filter,Dim2Filter,Dim3Filter,LocationFilter);
                                                              ItemAnalysisViewEntry.FIND('-');
                                                              ItemAnalysisViewToExcel.ExportData(
                                                                ItemAnalysisViewEntry,LineDimCode,ColumnDimCode,ValueType,
                                                                PeriodType,ShowColumnName,DateFilter,ItemFilter,BudgetFilter,
                                                                Dim1Filter,Dim2Filter,Dim3Filter,ShowActualBudget,LocationFilter,ShowOppositeSign);
                                                            END;
                                                             }
                                                 }
                                                  }
  }
  CODE
  {
    VAR
      ItemAnalysisView@1011 : Record 7152;
      AVBreakdownBuffer@1013 : TEMPORARY Record 375;
      DimCodeBufferColumn@1014 : Record 367;
      DimCodeBufferColumn3@1034 : Record 367;
      ItemStatisticsBuffer@1019 : Record 5821;
      GLSetup@1029 : Record 98;
      ItemAnalysisMgt@1012 : Codeunit 7153;
      RoundingFactor@1033 : 'None,1,1000,1000000';
      ValueType@1003 : ',Cost Amount,Sales Quantity';
      LineDimOption@1002 : 'Item,Period,Location,Dimension 1,Dimension 2,Dimension 3';
      ColumnDimOption@1001 : 'Item,Period,Location,Dimension 1,Dimension 2,Dimension 3';
      LineDimCode@1035 : Text[30];
      ColumnDimCode@1027 : Text[30];
      PeriodType@1008 : 'Day,Week,Month,Quarter,Year,Accounting Period';
      ShowActualBudget@1015 : 'Actual Amounts,Budgeted Amounts,Variance,Variance%,Index%';
      CurrentAnalysisArea@1018 : 'Sales,Purchase,Inventory';
      CurrentItemAnalysisViewCode@1017 : Code[10];
      LocationFilter@1009 : Code[250];
      ItemFilter@1010 : Code[250];
      Dim1Filter@1007 : Code[250];
      Dim2Filter@1006 : Code[250];
      Dim3Filter@1005 : Code[250];
      BudgetFilter@1016 : Code[250];
      DateFilter@1004 : Text[30];
      MatrixColumnCaptions@1024 : ARRAY [32] OF Text[1024];
      InternalDateFilter@1025 : Text[30];
      Which@1026 : Text[1024];
      NormalFormatString@1030 : Text[80];
      ShowOppositeSign@1020 : Boolean;
      PeriodInitialized@1021 : Boolean;
      i@1022 : Integer;
      Steps@1023 : Integer;
      NoOfRecords@1028 : Integer;
      MatrixData@1000 : ARRAY [32] OF Decimal;
      Text001@1032 : TextConst 'ENU=<Precision,';
      Text002@1031 : TextConst 'ENU=><Standard Format,0>';
      LocationFilter1@1043 : Code[250];
      ItemFilter1@1042 : Code[250];
      Dim1Filter1@1041 : Code[250];
      Dim2Filter1@1040 : Code[250];
      Dim3Filter1@1039 : Code[250];
      DateFilter1@1038 : Text[30];
      FirstColumn@1044 : Text[50];
      LastColumn@1045 : Text[50];
      ShowColumnName@1036 : Boolean;

    PROCEDURE LoadVariables@1(ItemAnalysisView1@1000 : Record 7152;ItemStatisticsBuffer1@1004 : Record 5821;CurrentItemAnalysisViewCode1@1005 : Code[10];CurrentAnalysisArea1@1003 : 'Sales,Purchase,Inventory';LineDimOption1@1010 : 'Item,Period,Location,Dimension 1,Dimension 2,Dimension 3';ColumnDimOption1@1002 : 'Item,Period,Location,Dimension 1,Dimension 2,Dimension 3';LineDimCode1@1016 : Text[30];ColumnDimCode1@1015 : Text[30];PeriodType1@1007 : 'Day,Week,Month,Quarter,Year,Accounting Period';ValueType1@1009 : 'Sales Amount,Inventory Value,Sales Quantity';RoundingFactor1@1011 : 'None,1,1000,1000000';ShowActualBudget1@1012 : 'Actual Amounts,Budgeted Amounts,Variance,Variance%,Index%';MatrixColumnCaptions1@1001 : ARRAY [32] OF Text[1024];ShowOppositeSign1@1006 : Boolean;PeriodInitialized1@1008 : Boolean;FirstColumn1@1014 : Text[50];LastColumn1@1013 : Text[50];ShowColumnName1@1017 : Boolean;NoOfRecordsLocal@1018 : Integer);
    BEGIN
      CLEAR(MatrixColumnCaptions);
      ItemAnalysisView.COPY(ItemAnalysisView1);

      CurrentItemAnalysisViewCode := CurrentItemAnalysisViewCode1;
      CurrentAnalysisArea := CurrentAnalysisArea1;

      LineDimOption := LineDimOption1;
      ColumnDimOption := ColumnDimOption1;

      LineDimCode := LineDimCode1;
      ColumnDimCode := ColumnDimCode1;

      PeriodType := PeriodType1;
      ShowOppositeSign := ShowOppositeSign1;

      COPYARRAY(MatrixColumnCaptions,MatrixColumnCaptions1,1);

      PeriodInitialized := PeriodInitialized1;
      PeriodType := PeriodType1;
      ValueType := ValueType1;
      RoundingFactor := RoundingFactor1;
      ShowActualBudget := ShowActualBudget1;

      FirstColumn := FirstColumn1;
      LastColumn := LastColumn1;

      ShowColumnName := ShowColumnName1;

      NoOfRecords := NoOfRecordsLocal;
    END;

    PROCEDURE LoadFilters@2(ItemFilter1@1006 : Code[250];LocationFilter1@1005 : Code[250];Dim1Filter1@1004 : Code[250];Dim2Filter1@1003 : Code[250];Dim3Filter1@1002 : Code[250];DateFilter1@1001 : Text[30];BudgetFilter1@1000 : Code[250];InternalDateFilter1@1007 : Text[30]);
    BEGIN
      ItemFilter := ItemFilter1;
      LocationFilter := LocationFilter1;
      Dim1Filter := Dim1Filter1;
      Dim2Filter := Dim2Filter1;
      Dim3Filter := Dim3Filter1;
      DateFilter := DateFilter1;
      BudgetFilter := BudgetFilter1;
      InternalDateFilter := InternalDateFilter1;
    END;

    LOCAL PROCEDURE CalcAmt@3(DimCodeBufferColumn1@1004 : Record 367;ValueType@1001 : Integer;SetColFilter@1000 : Boolean) : Decimal;
    VAR
      Amt@1002 : Decimal;
      AmtFromBuffer@1003 : Boolean;
    BEGIN
      IF SetColFilter THEN
        IF AVBreakdownBuffer.GET(Code,DimCodeBufferColumn1.Code) THEN BEGIN
          Amt := AVBreakdownBuffer.Amount;
          AmtFromBuffer := TRUE;
        END;

      IF NOT AmtFromBuffer THEN BEGIN
        Amt := ItemAnalysisMgt.CalcAmount(
            ValueType,SetColFilter,
            CurrentAnalysisArea,ItemStatisticsBuffer,CurrentItemAnalysisViewCode,
            ItemFilter,LocationFilter,DateFilter,BudgetFilter,
            Dim1Filter,Dim2Filter,Dim3Filter,
            LineDimOption,Rec,
            ColumnDimOption,DimCodeBufferColumn1,
            ShowActualBudget);

        IF SetColFilter THEN BEGIN
          AVBreakdownBuffer."Line Code" := Code;
          AVBreakdownBuffer."Column Code" := DimCodeBufferColumn1.Code;
          AVBreakdownBuffer.Amount := Amt;
          AVBreakdownBuffer.INSERT;
        END;
      END;

      IF ShowOppositeSign THEN
        Amt := -Amt;

      CASE RoundingFactor OF
        RoundingFactor::"1":
          Amt := ROUND(Amt,1);
        RoundingFactor::"1000":
          Amt := ROUND(Amt / 1000,0.1);
        RoundingFactor::"1000000":
          Amt := ROUND(Amt / 1000000,0.1);
      END;

      EXIT(Amt);
    END;

    LOCAL PROCEDURE FieldDrillDown@4(Ordinal@1000 : Integer);
    BEGIN
      CLEAR(DimCodeBufferColumn3);
      Which := '-';

      ItemAnalysisMgt.FindRec(
        ItemAnalysisView,ColumnDimOption,DimCodeBufferColumn3,Which,
        ItemFilter1,LocationFilter1,PeriodType,DateFilter1,PeriodInitialized,InternalDateFilter,
        Dim1Filter1,Dim2Filter1,Dim3Filter1);

      Steps := Ordinal - 1;
      ItemAnalysisMgt.NextRec(
        ItemAnalysisView,ColumnDimOption,DimCodeBufferColumn3,Steps,
        ItemFilter1,LocationFilter1,PeriodType,DateFilter1,
        Dim1Filter1,Dim2Filter1,Dim3Filter1);

      ItemAnalysisMgt.DrillDown(
        CurrentAnalysisArea,ItemStatisticsBuffer,CurrentItemAnalysisViewCode,
        ItemFilter1,LocationFilter1,DateFilter1,
        Dim1Filter1,Dim2Filter1,Dim3Filter1,BudgetFilter,
        LineDimOption,Rec,
        ColumnDimOption,DimCodeBufferColumn3,
        TRUE,ValueType,ShowActualBudget);
    END;

    LOCAL PROCEDURE FindNextColumn@6();
    BEGIN
      ItemAnalysisMgt.NextRec(
        ItemAnalysisView,ColumnDimOption,DimCodeBufferColumn,Steps,
        ItemFilter,LocationFilter,PeriodType,DateFilter,
        Dim1Filter,Dim2Filter,Dim3Filter);
    END;

    LOCAL PROCEDURE CalcFormatAmt@7() : Text[1024];
    VAR
      Result@1000 : Decimal;
      Text1@1001 : Text[1024];
    BEGIN
      Result := CalcAmt(DimCodeBufferColumn3,ValueType,TRUE);
      IF Result = 0 THEN
        Text1 := ''
      ELSE
        Text1 := FORMAT(Result,0,NormalFormatString);
      ItemAnalysisMgt.FormatAmount(Text1,RoundingFactor);
      EXIT(Text1);
    END;

    PROCEDURE ApplyColumnFilter@13();
    BEGIN
      CLEAR(ItemFilter1);
      CLEAR(LocationFilter1);
      CLEAR(DateFilter1);
      CLEAR(Dim1Filter1);
      CLEAR(Dim2Filter1);
      CLEAR(Dim3Filter1);

      CASE ColumnDimOption OF
        ColumnDimOption::Item:
          BEGIN
            IF ItemFilter <> '' THEN
              ItemFilter1 := ItemFilter + '&';
            ItemFilter1 := ItemFilter1 + FORMAT(FirstColumn) + '..' + FORMAT(LastColumn);
            LocationFilter1 := LocationFilter;
            DateFilter1 := DateFilter;
            Dim1Filter1 := Dim1Filter;
            Dim2Filter1 := Dim2Filter;
            Dim3Filter1 := Dim3Filter;
          END;
        ColumnDimOption::Location:
          BEGIN
            ItemFilter1 := ItemFilter;
            IF LocationFilter <> '' THEN
              LocationFilter1 := LocationFilter + '&';
            LocationFilter1 := LocationFilter1 + FORMAT(FirstColumn) + '..' + FORMAT(LastColumn);
            DateFilter1 := DateFilter;
            Dim1Filter1 := Dim1Filter;
            Dim2Filter1 := Dim2Filter;
            Dim3Filter1 := Dim3Filter;
          END;
        ColumnDimOption::Period:
          BEGIN
            ItemFilter1 := ItemFilter;
            LocationFilter1 := LocationFilter;
            IF DateFilter <> '' THEN
              DateFilter1 := DateFilter
            ELSE
              DateFilter1 := FORMAT(FirstColumn) + '..' + FORMAT(LastColumn);
            Dim1Filter1 := Dim1Filter;
            Dim2Filter1 := Dim2Filter;
            Dim3Filter1 := Dim3Filter;
          END;
        ColumnDimOption::"Dimension 1":
          BEGIN
            ItemFilter1 := ItemFilter;
            LocationFilter1 := LocationFilter;
            DateFilter1 := DateFilter;
            IF Dim1Filter <> '' THEN
              Dim1Filter1 := Dim1Filter + '&';
            Dim1Filter1 := Dim1Filter1 + FORMAT(FirstColumn) + '..' + FORMAT(LastColumn);
            Dim2Filter1 := Dim2Filter;
            Dim3Filter1 := Dim3Filter;
          END;
        ColumnDimOption::"Dimension 2":
          BEGIN
            ItemFilter1 := ItemFilter;
            LocationFilter1 := LocationFilter;
            DateFilter1 := DateFilter;
            Dim1Filter1 := Dim1Filter;
            IF Dim2Filter <> '' THEN
              Dim2Filter1 := Dim2Filter + '&';
            Dim2Filter1 := Dim2Filter1 + FORMAT(FirstColumn) + '..' + FORMAT(LastColumn);
            Dim3Filter1 := Dim3Filter;
          END;
        ColumnDimOption::"Dimension 3":
          BEGIN
            ItemFilter1 := ItemFilter;
            LocationFilter1 := LocationFilter;
            DateFilter1 := DateFilter;
            Dim1Filter1 := Dim1Filter;
            Dim2Filter1 := Dim2Filter;
            IF Dim3Filter <> '' THEN
              Dim3Filter1 := Dim3Filter + '&';
            Dim3Filter1 := Dim3Filter1 + FORMAT(FirstColumn) + '..' + FORMAT(LastColumn);
          END;
      END;
    END;

    BEGIN
    END.
  }
}
