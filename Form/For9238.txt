OBJECT Form 9238 _Sales Budget Overview
{
  OBJECT-PROPERTIES
  {
    Date=14/08/09;
    Time=12:00:00;
    Version List=NAVW16.00.01;
  }
  PROPERTIES
  {
    Width=18590;
    Height=11550;
    CaptionML=ENU=Sales Budget Overview;
    InsertAllowed=No;
    DeleteAllowed=No;
    LinksAllowed=No;
    OnOpenForm=BEGIN
                 IF ValueType = 0 THEN
                   ValueType := ValueType::"Sales Amount";
                 CurrentAnalysisArea := CurrentAnalysisArea::Sales;
                 ItemBudgetManagement.BudgetNameSelection(
                   CurrentAnalysisArea,CurrentBudgetName,ItemBudgetName,ItemStatisticsBuffer,
                   BudgetDim1Filter,BudgetDim2Filter,BudgetDim3Filter);

                 IF (NewBudgetName <> '') AND (CurrentBudgetName <> NewBudgetName) THEN BEGIN
                   CurrentBudgetName := NewBudgetName;
                   ItemBudgetManagement.CheckBudgetName(CurrentAnalysisArea,CurrentBudgetName,ItemBudgetName);
                   ItemBudgetManagement.SetItemBudgetName(
                     CurrentBudgetName,ItemBudgetName,ItemStatisticsBuffer,
                     BudgetDim1Filter,BudgetDim2Filter,BudgetDim3Filter);
                 END;

                 ItemBudgetManagement.SetLineAndColDim(
                   ItemBudgetName,LineDimCode,LineDimOption,ColumnDimCode,ColumnDimOption);

                 GLSetup.GET;
                 NormalFormatString := Text001 + GLSetup."Amount Decimal Places" + Text002;
                 SourceTypeFilter := SourceTypeFilter::Customer;

                 UpdateDimCtrls;

                 FindPeriod('');
                 MATRIX_GenerateColumnCaptions(MATRIX_Step::Initial);
                 UpdateMatrixSubForm;
                 CurrForm.UPDATECONTROLS;
               END;

  }
  CONTROLS
  {
    { 1   ;TabControl   ;220  ;220  ;18150;4400 ;HorzGlue=Both;
                                                 PageNamesML=ENU=General,Filters }
    { 3   ;TextBox      ;3850 ;990  ;2750 ;440  ;ParentControl=1;
                                                 InPage=0;
                                                 CaptionML=ENU=Item Budget Name;
                                                 SourceExpr=CurrentBudgetName;
                                                 OnValidate=BEGIN
                                                              ItemBudgetManagement.CheckBudgetName(CurrentAnalysisArea,CurrentBudgetName,ItemBudgetName);
                                                            END;

                                                 OnLookup=BEGIN
                                                            ItemBudgetManagement.LookupItemBudgetName(
                                                              CurrentBudgetName,ItemBudgetName,ItemStatisticsBuffer,
                                                              BudgetDim1Filter,BudgetDim2Filter,BudgetDim3Filter);
                                                            ItemBudgetManagement.ValidateLineDimCode(
                                                              ItemBudgetName,LineDimCode,LineDimOption,ColumnDimOption,
                                                              InternalDateFilter,DateFilter,ItemStatisticsBuffer,PeriodInitialized);
                                                            ItemBudgetManagement.ValidateColumnDimCode(
                                                              ItemBudgetName,ColumnDimCode,ColumnDimOption,LineDimOption,
                                                              InternalDateFilter,DateFilter,ItemStatisticsBuffer,PeriodInitialized);
                                                            UpdateDimCtrls;
                                                            CurrForm.UPDATE(FALSE);
                                                          END;

                                                 OnAfterValidate=BEGIN
                                                                   ItemBudgetManagement.SetItemBudgetName(
                                                                     CurrentBudgetName,ItemBudgetName,ItemStatisticsBuffer,
                                                                     BudgetDim1Filter,BudgetDim2Filter,BudgetDim3Filter);
                                                                   ItemBudgetManagement.ValidateLineDimCode(
                                                                     ItemBudgetName,LineDimCode,LineDimOption,ColumnDimOption,
                                                                     InternalDateFilter,DateFilter,ItemStatisticsBuffer,PeriodInitialized);
                                                                   ItemBudgetManagement.ValidateColumnDimCode(
                                                                     ItemBudgetName,ColumnDimCode,ColumnDimOption,LineDimOption,
                                                                     InternalDateFilter,DateFilter,ItemStatisticsBuffer,PeriodInitialized);
                                                                   UpdateDimCtrls;
                                                                   CurrForm.UPDATE(FALSE);
                                                                 END;
                                                                  }
    { 4   ;Label        ;440  ;990  ;3300 ;440  ;ParentControl=3 }
    { 7   ;TextBox      ;3850 ;2200 ;2750 ;440  ;ParentControl=1;
                                                 InPage=0;
                                                 CaptionML=ENU=Show as Columns;
                                                 SourceExpr=ColumnDimCode;
                                                 OnValidate=VAR
                                                              MATRIX_SetWanted@1001 : 'First,Previous,Same,Next';
                                                            BEGIN
                                                              IF (UPPERCASE(LineDimCode) = UPPERCASE(ColumnDimCode)) AND (LineDimCode <> '') THEN BEGIN
                                                                LineDimCode := '';
                                                                ItemBudgetManagement.ValidateLineDimCode(
                                                                  ItemBudgetName,LineDimCode,LineDimOption,ColumnDimOption,
                                                                  InternalDateFilter,DateFilter,ItemStatisticsBuffer,PeriodInitialized);
                                                              END;
                                                              ItemBudgetManagement.ValidateColumnDimCode(
                                                                ItemBudgetName,ColumnDimCode,ColumnDimOption,LineDimOption,
                                                                InternalDateFilter,DateFilter,ItemStatisticsBuffer,PeriodInitialized);

                                                              MATRIX_GenerateColumnCaptions(MATRIX_SetWanted::First);
                                                            END;

                                                 OnLookup=VAR
                                                            NewCode@1000 : Text[30];
                                                          BEGIN
                                                            NewCode := ItemBudgetManagement.GetDimSelection(ColumnDimCode,ItemBudgetName);
                                                            IF NewCode <> ColumnDimCode THEN BEGIN
                                                              Text := NewCode;
                                                              EXIT(TRUE);
                                                            END;
                                                          END;

                                                 OnAfterValidate=BEGIN
                                                                   FindPeriod('');
                                                                   MATRIX_GenerateColumnCaptions(MATRIX_Step::Initial);
                                                                   UpdateMatrixSubForm;
                                                                 END;
                                                                  }
    { 8   ;Label        ;440  ;2200 ;3300 ;440  ;ParentControl=7 }
    { 5   ;TextBox      ;3850 ;1650 ;2750 ;440  ;ParentControl=1;
                                                 InPage=0;
                                                 CaptionML=ENU=Show as Lines;
                                                 SourceExpr=LineDimCode;
                                                 OnValidate=BEGIN
                                                              IF (UPPERCASE(LineDimCode) = UPPERCASE(ColumnDimCode)) AND (LineDimCode <> '') THEN BEGIN
                                                                ColumnDimCode := '';
                                                                ItemBudgetManagement.ValidateColumnDimCode(
                                                                  ItemBudgetName,ColumnDimCode,ColumnDimOption,LineDimOption,
                                                                  InternalDateFilter,DateFilter,ItemStatisticsBuffer,PeriodInitialized);
                                                              END;
                                                              ItemBudgetManagement.ValidateLineDimCode(
                                                                ItemBudgetName,LineDimCode,LineDimOption,ColumnDimOption,
                                                                InternalDateFilter,DateFilter,ItemStatisticsBuffer,PeriodInitialized);
                                                            END;

                                                 OnLookup=VAR
                                                            NewCode@1000 : Text[30];
                                                          BEGIN
                                                            NewCode := ItemBudgetManagement.GetDimSelection(LineDimCode,ItemBudgetName);
                                                            IF NewCode <> LineDimCode THEN BEGIN
                                                              Text := NewCode;
                                                              EXIT(TRUE);
                                                            END;
                                                          END;

                                                 OnAfterValidate=BEGIN
                                                                   FindPeriod('');
                                                                   MATRIX_GenerateColumnCaptions(MATRIX_Step::Initial);
                                                                   UpdateMatrixSubForm;
                                                                 END;
                                                                  }
    { 6   ;Label        ;440  ;1650 ;3300 ;440  ;ParentControl=5 }
    { 14  ;TextBox      ;15290;1100 ;2750 ;440  ;ParentControl=1;
                                                 InPage=0;
                                                 CaptionML=ENU=Show Value as;
                                                 OptionCaptionML=ENU=Sales Amount,COGS Amount,Quantity;
                                                 OptionString=Sales Amount,COGS Amount,Quantity;
                                                 SourceExpr=ValueType;
                                                 OnAfterValidate=BEGIN
                                                                   FindPeriod('');
                                                                   MATRIX_GenerateColumnCaptions(MATRIX_Step::Initial);
                                                                   UpdateMatrixSubForm;
                                                                 END;
                                                                  }
    { 12  ;Label        ;11880;1100 ;3300 ;440  ;ParentControl=14 }
    { 24  ;CommandButton;7810 ;880  ;550  ;550  ;VertGlue=Bottom;
                                                 FocusOnClick=No;
                                                 ParentControl=1;
                                                 InPage=0;
                                                 ShowCaption=No;
                                                 BitmapPos=Center;
                                                 AutoRepeat=Yes;
                                                 Bitmap=16;
                                                 CaptionML=ENU=Next Set;
                                                 ToolTipML=ENU=Next Set;
                                                 OnPush=VAR
                                                          MATRIX_Step@1001 : 'Initial,Previous,Same,Next';
                                                        BEGIN
                                                          MATRIX_GenerateColumnCaptions(MATRIX_Step::Next);
                                                          UpdateMatrixSubForm;
                                                        END;
                                                         }
    { 23  ;CommandButton;7810 ;2860 ;550  ;550  ;VertGlue=Bottom;
                                                 FocusOnClick=No;
                                                 ParentControl=1;
                                                 InPage=0;
                                                 ShowCaption=No;
                                                 BitmapPos=Center;
                                                 AutoRepeat=Yes;
                                                 Bitmap=15;
                                                 CaptionML=ENU=Previous Set;
                                                 ToolTipML=ENU=Previous Set;
                                                 OnPush=VAR
                                                          MATRIX_Step@1001 : 'Initial,Previous,Same,Next';
                                                        BEGIN
                                                          MATRIX_GenerateColumnCaptions(MATRIX_Step::Previous);
                                                          UpdateMatrixSubForm;
                                                        END;
                                                         }
    { 21  ;TextBox      ;15290;1650 ;2750 ;440  ;ParentControl=1;
                                                 InPage=0;
                                                 CaptionML=ENU=View by;
                                                 OptionCaptionML=ENU=Day,Week,Month,Quarter,Year,Accounting Period;
                                                 SourceExpr=PeriodType;
                                                 OnValidate=BEGIN
                                                              FindPeriod('');
                                                            END;

                                                 OnAfterValidate=VAR
                                                                   MATRIX_Step@1001 : 'First,Previous,Next';
                                                                 BEGIN
                                                                   IF ColumnDimOption = ColumnDimOption::Period THEN
                                                                     MATRIX_GenerateColumnCaptions(MATRIX_Step::First);
                                                                   UpdateMatrixSubForm;
                                                                 END;
                                                                  }
    { 22  ;Label        ;11880;1650 ;3300 ;440  ;ParentControl=21 }
    { 26  ;CheckBox     ;15290;2750 ;440  ;440  ;ParentControl=1;
                                                 InPage=0;
                                                 ShowCaption=No;
                                                 CaptionML=ENU=Show Column Name;
                                                 SourceExpr=ShowColumnName;
                                                 OnAfterValidate=VAR
                                                                   MATRIX_SetWanted@1000 : 'First,Previous,Same,Next';
                                                                 BEGIN
                                                                   MATRIX_GenerateColumnCaptions(MATRIX_SetWanted::Same);
                                                                   UpdateMatrixSubForm;
                                                                 END;
                                                                  }
    { 25  ;Label        ;11880;2750 ;3300 ;440  ;ParentControl=26 }
    { 27  ;TextBox      ;15290;2200 ;2750 ;440  ;ParentControl=1;
                                                 InPage=0;
                                                 CaptionML=ENU=Rounding Factor;
                                                 OptionCaptionML=ENU=None,1,1000,1000000;
                                                 OptionString=None,1,1000,1000000;
                                                 SourceExpr=RoundingFactor;
                                                 OnAfterValidate=BEGIN
                                                                   UpdateMatrixSubForm;
                                                                 END;
                                                                  }
    { 28  ;Label        ;11880;2200 ;3300 ;440  ;ParentControl=27 }
    { 9   ;CommandButton;7810 ;2200 ;550  ;550  ;VertGlue=Bottom;
                                                 FocusOnClick=No;
                                                 ParentControl=1;
                                                 InPage=0;
                                                 ShowCaption=No;
                                                 BitmapPos=Center;
                                                 AutoRepeat=Yes;
                                                 Bitmap=15;
                                                 CaptionML=ENU=Previous Column;
                                                 ToolTipML=ENU=Previous Set;
                                                 OnPush=BEGIN
                                                          MATRIX_GenerateColumnCaptions(MATRIX_Step::PreviousColumn);
                                                          UpdateMatrixSubForm;
                                                        END;
                                                         }
    { 11  ;CommandButton;7810 ;1540 ;550  ;550  ;VertGlue=Bottom;
                                                 FocusOnClick=No;
                                                 ParentControl=1;
                                                 InPage=0;
                                                 ShowCaption=No;
                                                 BitmapPos=Center;
                                                 AutoRepeat=Yes;
                                                 Bitmap=16;
                                                 CaptionML=ENU=Next Column;
                                                 ToolTipML=ENU=Next Set;
                                                 OnPush=BEGIN
                                                          MATRIX_GenerateColumnCaptions(MATRIX_Step::NextColumn);
                                                          UpdateMatrixSubForm;
                                                        END;
                                                         }
    { 10  ;CommandButton;7920 ;3520 ;550  ;550  ;VertGlue=Bottom;
                                                 FocusOnClick=No;
                                                 ParentControl=1;
                                                 InPage=0;
                                                 ShowCaption=No;
                                                 BitmapPos=Center;
                                                 AutoRepeat=Yes;
                                                 Bitmap=51;
                                                 CaptionML=ENU=Previous Period;
                                                 OnPush=BEGIN
                                                          IF (LineDimOption = LineDimOption::Period) OR (ColumnDimOption = ColumnDimOption::Period) THEN
                                                            EXIT;
                                                          FindPeriod('<');
                                                          CurrForm.UPDATE;
                                                          UpdateMatrixSubForm;
                                                        END;
                                                         }
    { 13  ;CommandButton;8580 ;3520 ;550  ;550  ;VertGlue=Bottom;
                                                 FocusOnClick=No;
                                                 ParentControl=1;
                                                 InPage=0;
                                                 ShowCaption=No;
                                                 BitmapPos=Center;
                                                 AutoRepeat=Yes;
                                                 Bitmap=49;
                                                 CaptionML=ENU=Next Period;
                                                 OnPush=BEGIN
                                                          IF (LineDimOption = LineDimOption::Period) OR (ColumnDimOption = ColumnDimOption::Period) THEN
                                                            EXIT;
                                                          FindPeriod('>');
                                                          CurrForm.UPDATE;
                                                          UpdateMatrixSubForm;
                                                        END;
                                                         }
    { 43  ;TextBox      ;15290;2090 ;2750 ;440  ;Name=BudgetDim3Filter;
                                                 ParentControl=1;
                                                 InPage=1;
                                                 CaptionML=ENU=Budget Dimension 3 Filter;
                                                 ClearOnLookup=No;
                                                 SourceExpr=BudgetDim3Filter;
                                                 CaptionClass=GetCaptionClass(3);
                                                 OnLookup=BEGIN
                                                            EXIT(LookUpDimFilter(ItemBudgetName."Budget Dimension 3 Code",Text));
                                                          END;

                                                 OnAfterValidate=BEGIN
                                                                   IF ColumnDimOption = ColumnDimOption::"Budget Dimension 3" THEN
                                                                     MATRIX_GenerateColumnCaptions(MATRIX_Step::Initial);
                                                                   UpdateMatrixSubForm;
                                                                 END;
                                                                  }
    { 46  ;Label        ;11880;2090 ;3300 ;440  ;ParentControl=43 }
    { 44  ;TextBox      ;15290;1540 ;2750 ;440  ;Name=BudgetDim2Filter;
                                                 ParentControl=1;
                                                 InPage=1;
                                                 CaptionML=ENU=Budget Dimension 2 Filter;
                                                 ClearOnLookup=No;
                                                 SourceExpr=BudgetDim2Filter;
                                                 CaptionClass=GetCaptionClass(2);
                                                 OnLookup=BEGIN
                                                            EXIT(LookUpDimFilter(ItemBudgetName."Budget Dimension 2 Code",Text));
                                                          END;

                                                 OnAfterValidate=BEGIN
                                                                   IF ColumnDimOption = ColumnDimOption::"Budget Dimension 2" THEN
                                                                     MATRIX_GenerateColumnCaptions(MATRIX_Step::Initial);
                                                                   UpdateMatrixSubForm;
                                                                 END;
                                                                  }
    { 45  ;Label        ;11880;1540 ;3300 ;440  ;ParentControl=44 }
    { 47  ;TextBox      ;15290;990  ;2750 ;440  ;Name=BudgetDim1Filter;
                                                 ParentControl=1;
                                                 InPage=1;
                                                 CaptionML=ENU=Budget Dimension 1 Filter;
                                                 ClearOnLookup=No;
                                                 SourceExpr=BudgetDim1Filter;
                                                 CaptionClass=GetCaptionClass(1);
                                                 OnLookup=BEGIN
                                                            EXIT(LookUpDimFilter(ItemBudgetName."Budget Dimension 1 Code",Text));
                                                          END;

                                                 OnAfterValidate=BEGIN
                                                                   IF ColumnDimOption = ColumnDimOption::"Budget Dimension 1" THEN
                                                                     MATRIX_GenerateColumnCaptions(MATRIX_Step::Initial);
                                                                   UpdateMatrixSubForm;
                                                                 END;
                                                                  }
    { 48  ;Label        ;11880;990  ;3300 ;440  ;ParentControl=47 }
    { 49  ;TextBox      ;15290;3300 ;2750 ;440  ;Name=GlobalDim2Filter;
                                                 ParentControl=1;
                                                 InPage=1;
                                                 CaptionML=ENU=Global Dimension 2 Filter;
                                                 ClearOnLookup=No;
                                                 SourceExpr=GlobalDim2Filter;
                                                 CaptionClass='1,3,2';
                                                 OnLookup=BEGIN
                                                            EXIT(LookUpDimFilter(GLSetup."Global Dimension 2 Code",Text));
                                                          END;

                                                 OnAfterValidate=BEGIN
                                                                   IF ColumnDimOption = ColumnDimOption::"Global Dimension 2" THEN
                                                                     MATRIX_GenerateColumnCaptions(MATRIX_Step::Initial);
                                                                   UpdateMatrixSubForm;
                                                                 END;
                                                                  }
    { 52  ;Label        ;11880;3300 ;3300 ;440  ;ParentControl=49 }
    { 50  ;TextBox      ;15290;2750 ;2750 ;440  ;Name=GlobalDim1Filter;
                                                 ParentControl=1;
                                                 InPage=1;
                                                 CaptionML=ENU=Global Dimension 1 Filter;
                                                 ClearOnLookup=No;
                                                 SourceExpr=GlobalDim1Filter;
                                                 CaptionClass='1,3,1';
                                                 OnLookup=BEGIN
                                                            EXIT(LookUpDimFilter(GLSetup."Global Dimension 1 Code",Text));
                                                          END;

                                                 OnAfterValidate=BEGIN
                                                                   IF ColumnDimOption = ColumnDimOption::"Global Dimension 1" THEN
                                                                     MATRIX_GenerateColumnCaptions(MATRIX_Step::Initial);
                                                                   UpdateMatrixSubForm;
                                                                 END;
                                                                  }
    { 51  ;Label        ;11880;2750 ;3300 ;440  ;ParentControl=50 }
    { 31  ;TextBox      ;3850 ;1540 ;2750 ;440  ;Name=SalesCodeFilterCtrl;
                                                 ParentControl=1;
                                                 InPage=1;
                                                 CaptionML=ENU=Customer Filter;
                                                 ClearOnLookup=No;
                                                 SourceExpr=SourceNoFilter;
                                                 OnLookup=VAR
                                                            CustList@1005 : Form 22;
                                                            VendList@1004 : Form 27;
                                                          BEGIN
                                                            CASE SourceTypeFilter OF
                                                              SourceTypeFilter::Customer:
                                                                BEGIN
                                                                  CustList.LOOKUPMODE := TRUE;
                                                                  IF CustList.RUNMODAL = ACTION::LookupOK THEN
                                                                    Text := CustList.GetSelectionFilter
                                                                  ELSE
                                                                    EXIT(FALSE);
                                                                END;
                                                              SourceTypeFilter::Vendor:
                                                                BEGIN
                                                                  VendList.LOOKUPMODE := TRUE;
                                                                  IF VendList.RUNMODAL = ACTION::LookupOK THEN
                                                                    Text := VendList.GetSelectionFilter
                                                                  ELSE
                                                                    EXIT(FALSE);
                                                                END;
                                                            END;

                                                            EXIT(TRUE);
                                                          END;

                                                 OnAfterValidate=BEGIN
                                                                   IF ColumnDimOption = ColumnDimOption::Customer THEN
                                                                     MATRIX_GenerateColumnCaptions(MATRIX_Step::Initial);
                                                                   UpdateMatrixSubForm;
                                                                 END;
                                                                  }
    { 29  ;Label        ;440  ;1540 ;3300 ;440  ;ParentControl=31 }
    { 32  ;TextBox      ;3850 ;2090 ;2750 ;440  ;ParentControl=1;
                                                 InPage=1;
                                                 CaptionML=ENU=Item Filter;
                                                 ClearOnLookup=No;
                                                 SourceExpr=ItemFilter;
                                                 OnLookup=VAR
                                                            ItemList@1002 : Form 31;
                                                          BEGIN
                                                            ItemList.LOOKUPMODE(TRUE);
                                                            IF ItemList.RUNMODAL = ACTION::LookupOK THEN BEGIN
                                                              Text := ItemList.GetSelectionFilter;
                                                              EXIT(TRUE);
                                                            END;
                                                          END;

                                                 OnAfterValidate=BEGIN
                                                                   IF ColumnDimOption = ColumnDimOption::Item THEN
                                                                     MATRIX_GenerateColumnCaptions(MATRIX_Step::Initial);
                                                                   UpdateMatrixSubForm;
                                                                 END;
                                                                  }
    { 30  ;Label        ;440  ;2090 ;3300 ;440  ;ParentControl=32 }
    { 33  ;TextBox      ;3850 ;990  ;2750 ;440  ;ParentControl=1;
                                                 InPage=1;
                                                 CaptionML=ENU=Date Filter;
                                                 SourceExpr=DateFilter;
                                                 OnValidate=VAR
                                                              ApplicationManagement@1001 : Codeunit 1;
                                                            BEGIN
                                                              IF ApplicationManagement.MakeDateFilter(DateFilter) = 0 THEN;
                                                              ItemStatisticsBuffer.SETFILTER("Date Filter",DateFilter);
                                                              DateFilter := ItemStatisticsBuffer.GETFILTER("Date Filter");
                                                              InternalDateFilter := DateFilter;
                                                            END;

                                                 OnAfterValidate=BEGIN
                                                                   IF ColumnDimOption = ColumnDimOption::Period THEN
                                                                     MATRIX_GenerateColumnCaptions(MATRIX_Step::Initial);
                                                                   UpdateMatrixSubForm;
                                                                 END;
                                                                  }
    { 34  ;Label        ;440  ;990  ;3300 ;440  ;ParentControl=33 }
    { 2   ;CommandButton;16170;10670;2200 ;550  ;HorzGlue=Right;
                                                 VertGlue=Bottom;
                                                 PushAction=FormHelp }
    { 40  ;MenuButton   ;13750;10670;2200 ;550  ;HorzGlue=Right;
                                                 VertGlue=Bottom;
                                                 CaptionML=ENU=F&unctions;
                                                 Menu=MENUITEMS
                                                 {
                                                   { ID=41;
                                                     CaptionML=ENU=Reverse Lines and Columns;
                                                     OnPush=VAR
                                                              TempDimCode@1001 : Text[30];
                                                            BEGIN
                                                              TempDimCode := ColumnDimCode;
                                                              ColumnDimCode := LineDimCode;
                                                              LineDimCode := TempDimCode;
                                                              ItemBudgetManagement.ValidateLineDimCode(
                                                                ItemBudgetName,LineDimCode,LineDimOption,ColumnDimOption,
                                                                InternalDateFilter,DateFilter,ItemStatisticsBuffer,PeriodInitialized);
                                                              ItemBudgetManagement.ValidateColumnDimCode(
                                                                ItemBudgetName,ColumnDimCode,ColumnDimOption,LineDimOption,
                                                                InternalDateFilter,DateFilter,ItemStatisticsBuffer,PeriodInitialized);
                                                              MATRIX_GenerateColumnCaptions(MATRIX_Step::Initial);
                                                              UpdateMatrixSubForm;
                                                            END;
                                                             }
                                                   { ID=53;
                                                     MenuItemType=Separator }
                                                   { ID=54;
                                                     CaptionML=ENU=Delete Budget;
                                                     OnPush=BEGIN
                                                              ItemBudgetManagement.DeleteBudget(
                                                                CurrentAnalysisArea,CurrentBudgetName,
                                                                ItemFilter,DateFilter,
                                                                SourceTypeFilter,SourceNoFilter,
                                                                GlobalDim1Filter,GlobalDim2Filter,
                                                                BudgetDim1Filter,BudgetDim2Filter,BudgetDim3Filter);
                                                            END;
                                                             }
                                                   { ID=55;
                                                     MenuItemType=Separator }
                                                   { ID=42;
                                                     Ellipsis=Yes;
                                                     CaptionML=ENU=Export to Excel;
                                                     OnPush=VAR
                                                              ExportToXl@1000 : Report 7132;
                                                            BEGIN
                                                              ExportToXl.SetOptions(
                                                                CurrentAnalysisArea,
                                                                CurrentBudgetName,
                                                                ValueType,
                                                                GlobalDim1Filter,GlobalDim2Filter,
                                                                BudgetDim1Filter,BudgetDim2Filter,BudgetDim3Filter,
                                                                DateFilter,
                                                                SourceTypeFilter,SourceNoFilter,
                                                                ItemFilter,
                                                                InternalDateFilter,PeriodInitialized,PeriodType,
                                                                LineDimOption,ColumnDimOption,LineDimCode,ColumnDimCode);
                                                              ExportToXl.RUN;
                                                            END;
                                                             }
                                                   { ID=56;
                                                     Ellipsis=Yes;
                                                     CaptionML=ENU=Import from Excel;
                                                     OnPush=VAR
                                                              ImportItemBudgetFromExcel@1000 : Report 7131;
                                                            BEGIN
                                                              ImportItemBudgetFromExcel.SetProperties(CurrentBudgetName,CurrentAnalysisArea,ValueType);
                                                              ImportItemBudgetFromExcel.RUNMODAL;
                                                            END;
                                                             }
                                                 }
                                                  }
    { 17  ;SubForm      ;220  ;4950 ;18150;5500 ;Name=MATRIX;
                                                 HorzGlue=Both;
                                                 VertGlue=Both;
                                                 SubFormID=Form9239 }
  }
  CODE
  {
    VAR
      MATRIX_MatrixRecords@1137 : ARRAY [32] OF Record 367;
      MATRIX_CaptionSet@1138 : ARRAY [32] OF Text[80];
      MATRIX_CaptionRange@1139 : Text[250];
      FirstColumn@1140 : Text[80];
      LastColumn@1141 : Text[80];
      MATRIX_CaptionFieldNo@1142 : Integer;
      MATRIX_PrimKeyFirstCaptionInCu@1143 : Text[80];
      MATRIX_CurrentNoOfColumns@1144 : Integer;
      GLSetup@1035 : Record 98;
      ItemBudgetName@1006 : Record 7132;
      ItemStatisticsBuffer@1010 : Record 5821;
      ItemBudgetManagement@1003 : Codeunit 7130;
      CurrentAnalysisArea@1005 : 'Sales,Purchase,Inventory';
      CurrentBudgetName@1002 : Code[10];
      SourceTypeFilter@1017 : ' ,Customer,Vendor,Item';
      SourceNoFilter@1016 : Code[250];
      ItemFilter@1019 : Code[250];
      ValueType@1018 : 'Sales Amount,COGS Amount,Quantity';
      RoundingFactor@1028 : 'None,1,1000,1000000';
      LineDimOption@1001 : 'Item,Customer,Vendor,Period,Location,Global Dimension 1,Global Dimension 2,Budget Dimension 1,Budget Dimension 2,Budget Dimension 3';
      ColumnDimOption@1000 : 'Item,Customer,Vendor,Period,Location,Global Dimension 1,Global Dimension 2,Budget Dimension 1,Budget Dimension 2,Budget Dimension 3';
      PeriodType@1022 : 'Day,Week,Month,Quarter,Year,Accounting Period';
      GlobalDim1Filter@1024 : Code[250];
      GlobalDim2Filter@1023 : Code[250];
      BudgetDim1Filter@1009 : Code[250];
      BudgetDim2Filter@1008 : Code[250];
      BudgetDim3Filter@1007 : Code[250];
      LineDimCode@1012 : Text[30];
      ColumnDimCode@1011 : Text[30];
      DateFilter@1014 : Text[30];
      InternalDateFilter@1013 : Text[30];
      PeriodInitialized@1015 : Boolean;
      BudgetedAmount@1020 : Decimal;
      MatrixHeader@1021 : Text[50];
      ShowColumnName@1025 : Boolean;
      InputError@1026 : Boolean;
      InputErrorText@1027 : Text[250];
      NormalFormatString@1030 : Text[80];
      Text001@1032 : TextConst 'ENU=<Precision,';
      Text002@1031 : TextConst 'ENU=><Standard Format,0>';
      Text003@1034 : TextConst 'ENU=1,6,,Budget Dimension 1 Filter';
      Text004@1033 : TextConst 'ENU=1,6,,Budget Dimension 2 Filter';
      Text005@1004 : TextConst 'ENU=1,6,,Budget Dimension 3 Filter';
      Text100@1036 : TextConst 'ENU=Period';
      NewBudgetName@1037 : Code[10];
      MATRIX_Step@1029 : 'Initial,Previous,Same,Next,PreviousColumn,NextColumn';

    PROCEDURE MATRIX_GenerateColumnCaptions@1152(MATRIX_SetWanted@1000 : 'Initial,Previous,Same,Next,PreviousColumn,NextColumn');
    VAR
      CurrentMatrixRecordOrdinal@1001 : Integer;
      MatrixMgt@1002 : Codeunit 9200;
      MATRIX_PeriodRecords@1003 : ARRAY [32] OF Record 2000000007;
      i@1004 : Integer;
      Location@1005 : Record 14;
      RecRef@1006 : RecordRef;
      Item@1007 : Record 27;
      Customer@1008 : Record 18;
      Vendor@1009 : Record 23;
      FieldRef@1011 : FieldRef;
      ColumnCaptionValue@1010 : Integer;
    BEGIN
      CLEAR(MATRIX_CaptionSet);
      CurrentMatrixRecordOrdinal := 1;
      CLEAR(MATRIX_MatrixRecords);
      FirstColumn := '';
      LastColumn := '';
      MATRIX_CurrentNoOfColumns := 12;

      IF ShowColumnName THEN ColumnCaptionValue := 2
        ELSE ColumnCaptionValue := 1;

      IF ColumnDimCode = '' THEN
        EXIT;

      CASE ColumnDimCode OF
        Text100:  // Period
          BEGIN
            MatrixMgt.GeneratePeriodMatrixData(
              MATRIX_SetWanted,12,ShowColumnName,
              PeriodType,DateFilter,MATRIX_PrimKeyFirstCaptionInCu,
              MATRIX_CaptionSet,MATRIX_CaptionRange,MATRIX_CurrentNoOfColumns,MATRIX_PeriodRecords);
            FOR i := 1 TO 12 DO BEGIN
              MATRIX_MatrixRecords[i]."Period Start" := MATRIX_PeriodRecords[i]."Period Start";
              MATRIX_MatrixRecords[i]."Period End" := MATRIX_PeriodRecords[i]."Period End";
            END;
            FirstColumn := FORMAT(MATRIX_PeriodRecords[1]."Period Start");
            LastColumn := FORMAT(MATRIX_PeriodRecords[MATRIX_CurrentNoOfColumns]."Period End");
          END;

        Location.TABLECAPTION:
          BEGIN
            CLEAR(MATRIX_CaptionSet);
            RecRef.GETTABLE(Location);
            RecRef.SETTABLE(Location);
            MatrixMgt.GenerateMatrixData(
              RecRef,MATRIX_SetWanted,12,1,
              MATRIX_PrimKeyFirstCaptionInCu,MATRIX_CaptionSet,MATRIX_CaptionRange,MATRIX_CurrentNoOfColumns);
            FOR i := 1 TO MATRIX_CurrentNoOfColumns DO
              MATRIX_MatrixRecords[i].Code := MATRIX_CaptionSet[i];
            IF ShowColumnName THEN
              MatrixMgt.GenerateMatrixData(
                RecRef,MATRIX_SetWanted::Same,12,2,
                MATRIX_PrimKeyFirstCaptionInCu,MATRIX_CaptionSet,MATRIX_CaptionRange,MATRIX_CurrentNoOfColumns);
          END;
        Item.TABLECAPTION:
          BEGIN
            CLEAR(MATRIX_CaptionSet);
            RecRef.GETTABLE(Item);
            RecRef.SETTABLE(Item);
            IF ItemFilter <> '' THEN BEGIN
              FieldRef := RecRef.FIELDINDEX(1);
              FieldRef.SETFILTER(ItemFilter);
            END;
            MatrixMgt.GenerateMatrixData(
              RecRef,MATRIX_SetWanted,12,1,
              MATRIX_PrimKeyFirstCaptionInCu,MATRIX_CaptionSet,MATRIX_CaptionRange,MATRIX_CurrentNoOfColumns);
            FOR i := 1 TO MATRIX_CurrentNoOfColumns DO
              MATRIX_MatrixRecords[i].Code := MATRIX_CaptionSet[i];
            IF ShowColumnName THEN
              MatrixMgt.GenerateMatrixData(
                RecRef,MATRIX_SetWanted::Same,12,3,
                MATRIX_PrimKeyFirstCaptionInCu,MATRIX_CaptionSet,MATRIX_CaptionRange,MATRIX_CurrentNoOfColumns);
          END;
        Customer.TABLECAPTION:
          BEGIN
            CLEAR(MATRIX_CaptionSet);
            RecRef.GETTABLE(Customer);
            RecRef.SETTABLE(Customer);
            IF SourceNoFilter <> '' THEN BEGIN
              FieldRef := RecRef.FIELDINDEX(1);
              FieldRef.SETFILTER(SourceNoFilter);
            END;
            MatrixMgt.GenerateMatrixData(
              RecRef,MATRIX_SetWanted,12,1,
              MATRIX_PrimKeyFirstCaptionInCu,MATRIX_CaptionSet,MATRIX_CaptionRange,MATRIX_CurrentNoOfColumns);
            FOR i := 1 TO MATRIX_CurrentNoOfColumns DO
              MATRIX_MatrixRecords[i].Code := MATRIX_CaptionSet[i];
            IF ShowColumnName THEN
              MatrixMgt.GenerateMatrixData(
                RecRef,MATRIX_SetWanted::Same,12,2,
                MATRIX_PrimKeyFirstCaptionInCu,MATRIX_CaptionSet,MATRIX_CaptionRange,MATRIX_CurrentNoOfColumns);
          END;
        Vendor.TABLECAPTION:
          BEGIN
            CLEAR(MATRIX_CaptionSet);
            RecRef.GETTABLE(Vendor);
            RecRef.SETTABLE(Vendor);
            MatrixMgt.GenerateMatrixData(
              RecRef,MATRIX_SetWanted,12,1,
              MATRIX_PrimKeyFirstCaptionInCu,MATRIX_CaptionSet,MATRIX_CaptionRange,MATRIX_CurrentNoOfColumns);
            FOR i := 1 TO MATRIX_CurrentNoOfColumns DO
              MATRIX_MatrixRecords[i].Code := MATRIX_CaptionSet[i];
            IF ShowColumnName THEN
              MatrixMgt.GenerateMatrixData(
                RecRef,MATRIX_SetWanted::Same,12,2,
                MATRIX_PrimKeyFirstCaptionInCu,MATRIX_CaptionSet,MATRIX_CaptionRange,MATRIX_CurrentNoOfColumns);

          END;
        GLSetup."Global Dimension 1 Code":
          BEGIN
            MatrixMgt.SetDimColumnSet(
              GLSetup."Global Dimension 1 Code",
              GlobalDim1Filter,MATRIX_SetWanted,MATRIX_PrimKeyFirstCaptionInCu,FirstColumn,LastColumn,MATRIX_CurrentNoOfColumns);
            MatrixMgt.DimToCaptions(
              MATRIX_CaptionSet,MATRIX_MatrixRecords,ColumnDimCode,
              FirstColumn,LastColumn,MATRIX_CurrentNoOfColumns,ShowColumnName,MATRIX_CaptionRange);
          END;
        GLSetup."Global Dimension 2 Code":
          BEGIN
            MatrixMgt.SetDimColumnSet(
              GLSetup."Global Dimension 2 Code",
              GlobalDim2Filter,MATRIX_SetWanted,MATRIX_PrimKeyFirstCaptionInCu,FirstColumn,LastColumn,MATRIX_CurrentNoOfColumns);
            MatrixMgt.DimToCaptions(
              MATRIX_CaptionSet,MATRIX_MatrixRecords,ColumnDimCode,
              FirstColumn,LastColumn,MATRIX_CurrentNoOfColumns,ShowColumnName,MATRIX_CaptionRange);
          END;
        ItemBudgetName."Budget Dimension 1 Code":
          BEGIN
            MatrixMgt.SetDimColumnSet(
              ItemBudgetName."Budget Dimension 1 Code",
              BudgetDim1Filter,MATRIX_SetWanted,MATRIX_PrimKeyFirstCaptionInCu,FirstColumn,LastColumn,MATRIX_CurrentNoOfColumns);
            MatrixMgt.DimToCaptions(
              MATRIX_CaptionSet,MATRIX_MatrixRecords,ColumnDimCode,
              FirstColumn,LastColumn,MATRIX_CurrentNoOfColumns,ShowColumnName,MATRIX_CaptionRange);
          END;
        ItemBudgetName."Budget Dimension 2 Code":
          BEGIN
            MatrixMgt.SetDimColumnSet(
              ItemBudgetName."Budget Dimension 2 Code",
              BudgetDim2Filter,MATRIX_SetWanted,MATRIX_PrimKeyFirstCaptionInCu,FirstColumn,LastColumn,MATRIX_CurrentNoOfColumns);
            MatrixMgt.DimToCaptions(
              MATRIX_CaptionSet,MATRIX_MatrixRecords,ColumnDimCode,
              FirstColumn,LastColumn,MATRIX_CurrentNoOfColumns,ShowColumnName,MATRIX_CaptionRange);
          END;
        ItemBudgetName."Budget Dimension 3 Code":
          BEGIN
            MatrixMgt.SetDimColumnSet(
              ItemBudgetName."Budget Dimension 3 Code",
              BudgetDim3Filter,MATRIX_SetWanted,MATRIX_PrimKeyFirstCaptionInCu,FirstColumn,LastColumn,MATRIX_CurrentNoOfColumns);
            MatrixMgt.DimToCaptions(
              MATRIX_CaptionSet,MATRIX_MatrixRecords,ColumnDimCode,
              FirstColumn,LastColumn,MATRIX_CurrentNoOfColumns,ShowColumnName,MATRIX_CaptionRange);
          END;
      END;
      FOR i := 1 TO 12 DO
        IF MATRIX_CaptionSet[i] = '' THEN
          MATRIX_CaptionSet[i] := ' ';
    END;

    LOCAL PROCEDURE FindPeriod@2(SearchText@1000 : Code[10]);
    VAR
      Item@1001 : Record 27;
      Calendar@1002 : Record 2000000007;
      PeriodFormMgt@1003 : Codeunit 359;
    BEGIN
      IF DateFilter <> '' THEN BEGIN
        Calendar.SETFILTER("Period Start",DateFilter);
        IF NOT PeriodFormMgt.FindDate('+',Calendar,PeriodType) THEN
          PeriodFormMgt.FindDate('+',Calendar,PeriodType::Day);
        Calendar.SETRANGE("Period Start");
      END;
      PeriodFormMgt.FindDate(SearchText,Calendar,PeriodType);
      Item.SETRANGE("Date Filter",Calendar."Period Start",Calendar."Period End");
      IF Item.GETRANGEMIN("Date Filter") = Item.GETRANGEMAX("Date Filter") THEN
        Item.SETRANGE("Date Filter",Item.GETRANGEMIN("Date Filter"));
      InternalDateFilter := Item.GETFILTER("Date Filter");
      IF (LineDimOption <> LineDimOption::Period) AND (ColumnDimOption <> ColumnDimOption::Period) THEN
        DateFilter := InternalDateFilter;
    END;

    LOCAL PROCEDURE GetCaptionClass@13(BudgetDimType@1000 : Integer) : Text[250];
    BEGIN
      IF ItemBudgetName.Name <> CurrentBudgetName THEN
        ItemBudgetName.GET(CurrentAnalysisArea,CurrentBudgetName);
      CASE BudgetDimType OF
        1:
          BEGIN
            IF ItemBudgetName."Budget Dimension 1 Code" <> '' THEN
              EXIT('1,6,' + ItemBudgetName."Budget Dimension 1 Code");
            EXIT(Text003);
          END;
        2:
          BEGIN
            IF ItemBudgetName."Budget Dimension 2 Code" <> '' THEN
              EXIT('1,6,' + ItemBudgetName."Budget Dimension 2 Code");
            EXIT(Text004);
          END;
        3:
          BEGIN
            IF ItemBudgetName."Budget Dimension 3 Code" <> '' THEN
              EXIT('1,6,' + ItemBudgetName."Budget Dimension 3 Code");
            EXIT(Text005);
          END;
      END;
    END;

    LOCAL PROCEDURE LookUpDimFilter@57(Dim@1000 : Code[20];VAR Text@1001 : Text[250]) : Boolean;
    VAR
      DimVal@1002 : Record 349;
      DimValList@1003 : Form 560;
    BEGIN
      IF Dim = '' THEN
        EXIT(FALSE);
      DimVal.SETRANGE("Dimension Code",Dim);
      DimValList.SETTABLEVIEW(DimVal);
      DimValList.LOOKUPMODE(TRUE);
      IF DimValList.RUNMODAL = ACTION::LookupOK THEN BEGIN
        DimValList.GETRECORD(DimVal);
        Text := DimValList.GetSelectionFilter;
      END;
      EXIT(TRUE);
    END;

    LOCAL PROCEDURE UpdateDimCtrls@1();
    BEGIN
      CurrForm.BudgetDim1Filter.ENABLED := ItemBudgetName."Budget Dimension 1 Code" <> '';
      CurrForm.BudgetDim2Filter.ENABLED := ItemBudgetName."Budget Dimension 2 Code" <> '';
      CurrForm.BudgetDim3Filter.ENABLED := ItemBudgetName."Budget Dimension 3 Code" <> '';
      CurrForm.UPDATECONTROLS;
    END;

    PROCEDURE SetNewBudgetName@5(NewPurchBudgetName@1000 : Code[10]);
    BEGIN
      NewBudgetName := NewPurchBudgetName;
    END;

    LOCAL PROCEDURE UpdateMatrixSubForm@7();
    BEGIN
      CurrForm.MATRIX.FORM.SetFilters(
        DateFilter,ItemFilter,SourceNoFilter,
        GlobalDim1Filter,GlobalDim2Filter,
        BudgetDim1Filter,BudgetDim2Filter,BudgetDim3Filter);
      CurrForm.MATRIX.FORM.Load(
        MATRIX_CaptionSet,MATRIX_MatrixRecords,MATRIX_CurrentNoOfColumns,
        CurrentBudgetName,LineDimOption,ColumnDimOption,RoundingFactor,ValueType);
      CurrForm.UPDATE(FALSE);
    END;

    BEGIN
    END.
  }
}
