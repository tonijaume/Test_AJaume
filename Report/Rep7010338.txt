OBJECT Report 7010338 Estad¡sticas Clientes
{
  OBJECT-PROPERTIES
  {
    Date=05/10/10;
    Time=16:51:05;
    Version List=TRANSFER;
  }
  PROPERTIES
  {
    CaptionML=ESP=Estad¡sticas Clientes;
    ShowPrintStatus=Yes;
    UseReqForm=Yes;
    TopMargin=1000;
    BottomMargin=1000;
    LeftMargin=2100;
    RightMargin=400;
    Orientation=Landscape;
  }
  DATAITEMS
  {
    { PROPERTIES
      {
        DataItemTable=Table2000000026;
        DataItemTableView=SORTING(Number)
                          ORDER(Ascending);
        MaxIteration=1;
        DataItemVarName=Cabecera;
        OnPreDataItem=BEGIN
                        rParametros.FINDFIRST;
                      END;

        OnAfterGetRecord=VAR
                           rPar@1100244000 : Record 7010311;
                           cFunBas@1100244001 : Codeunit 7010310;
                           ERROR1@1100244002 : TextConst 'ESP=Falta asignar el identificador de C¢digo Entrada en la ficha de par metros';
                         BEGIN
                           vPrecision := cFunBas.ObtenerPrecisionDivisa(vDivisa);
                           vMostrarTotalGeneral := FALSE;

                           vTipoLinea := cFunBas.Tipo_Lineas_Estadisticas;
                           vTipoElemento:= cFunBas.MaletasyEstadisticas;

                           rPar.FINDFIRST;
                           IF vGarajeResult = rPar."Todos los garajes" THEN
                             vGarajeResult := '';

                           vCodEntrada := rPar."Codigo Entradas";
                           IF vCodEntrada = '' THEN
                             ERROR(ERROR1);
                         END;

      }
      SECTIONS
      {
      }
       }
    { PROPERTIES
      {
        DataItemTable=Table7010324;
        DataItemTableView=SORTING(Usuario,Cliente,TTOO)
                          ORDER(Ascending);
        NewPagePerGroup=No;
        NewPagePerRecord=No;
        DataItemVarName=ClienteTTOO;
        PrintOnlyIfDetail=No;
        OnPreDataItem=VAR
                        rPar@1100244000 : Record 7010311;
                        rAuxCT@1100244001 : Record 7010324;
                        cFunBas@1100244002 : Codeunit 7010310;
                      BEGIN
                        // calculo el primer y ultimo dia del mes que ha seleccionado el usuario.
                        // Hacemos vMes+1, porque si vMes=0 corresponde a Enero.
                        vIniMes  := DMY2DATE(1,vMes+1,vA¤o);
                        vFinMes  := cFunBas.ldom(vIniMes,0);
                        vFinAcum := vFinMes;

                        IF vDesglose THEN
                          Desglosar();

                        //CREAREMOS EL FILTRO APROPIADO.
                        //....................................................................
                        //....................................................................
                        RESET;
                        SETCURRENTKEY(Usuario,Cliente,TTOO);
                        SETRANGE(Usuario,USERID);

                        //Para saber donde se aplicar  el c lculo.
                        IF vGarajeResult = '' THEN
                          vFltGarajeResult := Text000
                        ELSE
                          vFltGarajeResult := vGarajeResult;


                        //Comprobaremos que no est‚ en la lista de vehiculos seleccionados.
                        IF vSeleccion=vSeleccion::"Seg£n Selecci¢n" THEN
                          SETRANGE(Selecci¢n,TRUE);
                        //....................................................................

                        IF vSoloConActividad THEN BEGIN
                          rAuxCT.RESET;
                          rAuxCT.COPYFILTERS(ClienteTTOO);
                          TestActividad(rAuxCT);
                          SETRANGE(Actividad,TRUE);
                        END;

                        //....................................................................
                        //FIN. SELECCION DEL FILTRO.
                      END;

        GroupTotalFields=Cliente;
      }
      SECTIONS
      {
        { PROPERTIES
          {
            SectionType=Header;
            PrintOnEveryPage=Yes;
            SectionWidth=25500;
            SectionHeight=2115;
            OnPreSection=BEGIN
                           vTextoNormal := '$$';
                           vTextoTotal  := '$$';
                           vPrimerTexto := TRUE;
                         END;

          }
          CONTROLS
          {
            { 1   ;Label        ;0    ;0    ;7500 ;423  ;FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Estadisticas de Clientes }
            { 2   ;TextBox      ;22350;0    ;3150 ;423  ;HorzAlign=Right;
                                                         SourceExpr=FORMAT(TODAY,0,4) }
            { 3   ;TextBox      ;0    ;423  ;7500 ;423  ;SourceExpr=COMPANYNAME }
            { 4   ;TextBox      ;25050;423  ;450  ;423  ;CaptionML=ESP=P gina;
                                                         SourceExpr=CurrReport.PAGENO }
            { 5   ;Label        ;24300;423  ;750  ;423  ;ParentControl=4 }
            { 6   ;TextBox      ;23250;846  ;2250 ;423  ;HorzAlign=Right;
                                                         SourceExpr=USERID }
            { 14  ;Label        ;0    ;1692 ;25500;423  ;CaptionML=ESP=____________________________________________________________________________________________________________________________________________________________________________________________________________________________________________ }
            { 36  ;Label        ;0    ;846  ;3000 ;423  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=ESP=Mes Pedido }
            { 38  ;TextBox      ;3150 ;846  ;3300 ;423  ;SourceExpr=FORMAT(vMes)+Text001+FORMAT(vA¤o) }
            { 50  ;Label        ;6600 ;846  ;150  ;423  ;CaptionML=ESP=/ }
            { 83  ;Label        ;0    ;1269 ;3000 ;423  ;ParentControl=90;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=ESP=Selecci¢n Clientes }
            { 90  ;TextBox      ;3150 ;1269 ;3300 ;423  ;VertAlign=Bottom;
                                                         SourceExpr=vSeleccion }
            { 91  ;Label        ;6600 ;1269 ;150  ;423  ;CaptionML=ESP=/ }
            { 102 ;Label        ;6900 ;1269 ;5100 ;423  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=ESP=S¢lo Vehiculos con Actividad }
            { 191 ;TextBox      ;12150;1269 ;2850 ;423  ;VertAlign=Bottom;
                                                         SourceExpr=vSoloConActividad }
            { 194 ;Label        ;6900 ;846  ;5100 ;423  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=ESP=Garaje a considerar en resultados }
            { 195 ;TextBox      ;12150;846  ;2850 ;423  ;VertAlign=Bottom;
                                                         SourceExpr=vFltGarajeResult }
            { 82  ;TextBox      ;17850;846  ;1800 ;423  ;VertAlign=Bottom;
                                                         SourceExpr=vDivisa }
            { 99  ;Label        ;15450;846  ;2250 ;423  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=ESP=C¢d. Divisa }
            { 100 ;Label        ;15150;846  ;150  ;423  ;CaptionML=ESP=/ }
            { 109 ;Label        ;15150;1269 ;150  ;423  ;CaptionML=ESP=/ }
            { 110 ;Label        ;15450;1269 ;2250 ;423  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=ESP=Zona Precio }
            { 113 ;TextBox      ;17850;1269 ;1800 ;423  ;VertAlign=Bottom;
                                                         SourceExpr=vZP }
          }
           }
        { PROPERTIES
          {
            SectionType=Header;
            PrintOnEveryPage=Yes;
            SectionWidth=25500;
            SectionHeight=1269;
          }
          CONTROLS
          {
            { 21  ;Label        ;0    ;0    ;4050 ;846  ;ParentControl=20;
                                                         HorzAlign=Left;
                                                         VertAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=ESP=Touroperador }
            { 19  ;Label        ;8400 ;0    ;2100 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Viajes }
            { 22  ;Label        ;8400 ;423  ;900  ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Mes }
            { 29  ;Label        ;9450 ;423  ;1050 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Acu }
            { 30  ;Label        ;13800;0    ;2400 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Transportados }
            { 31  ;Label        ;15000;423  ;1200 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Acum }
            { 32  ;Label        ;13800;423  ;1050 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Mes }
            { 33  ;Label        ;4350 ;0    ;3750 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Facturacion }
            { 34  ;Label        ;4350 ;423  ;1800 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Mes }
            { 35  ;Label        ;6300 ;423  ;1800 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Acum }
            { 40  ;Label        ;16500;0    ;2550 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Facturados }
            { 41  ;Label        ;16500;423  ;1200 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Mes }
            { 42  ;Label        ;17850;423  ;1200 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Acum }
            { 43  ;Label        ;19350;0    ;2250 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Fact/Pax }
            { 44  ;Label        ;19350;423  ;1050 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Mes }
            { 45  ;Label        ;20550;423  ;1050 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Acum }
            { 39  ;Label        ;21750;0    ;1950 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Pax/Viaje }
            { 56  ;Label        ;21750;423  ;900  ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Mes }
            { 57  ;Label        ;22800;423  ;900  ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Acu }
            { 101 ;Label        ;10800;0    ;2700 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Clientes entrados }
            { 103 ;Label        ;10800;423  ;1200 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Mes }
            { 104 ;Label        ;12150;423  ;1350 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Acum }
          }
           }
        { PROPERTIES
          {
            SectionType=GroupFooter;
            SectionWidth=25500;
            SectionHeight=423;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT(vAgrupacionCliente AND (NOT vMostrarTotalGeneral) AND (NOT vPrimerTexto));
                         END;

            OnPostSection=BEGIN
                            //Inicializamos las matrices para el siguiente grupo de vehiculos.
                            Inicializar(vPaxTransMes[1]);
                            Inicializar(vPaxTransAcum[1]);
                            vPaxTransTot[2] := 0;
                            vPaxTransTotAcum[2] := 0;

                            //Inicializamos las matrices para el siguiente grupo de vehiculos.
                            Inicializar(vEntTransMes[1]);
                            Inicializar(vEntTransAcum[1]);
                            vEntTransTot[2] := 0;
                            vEntTransTotAcum[2] := 0;

                            Inicializar(vViajesMes[1]);
                            Inicializar(vViajesAcum[1]);
                            vViajesTot[2]:=0;
                            vViajesTotAcum[2]:=0;

                            // Para los datos de la facturaci¢n.
                            Inicializar(vPaxFactMes[1]);
                            Inicializar(vPaxFactAcum[1]);
                            vPaxFactTot[2] := 0;
                            vPaxFactTotAcum[2] := 0;

                            Inicializar(vFactMes[1]);
                            Inicializar(vFactAcum[1]);
                            vFactTot[2]:=0;
                            vFactTotAcum[2]:=0;
                          END;

          }
          CONTROLS
          {
            { 1103350000;Shape  ;4350 ;0    ;19350;423  ;ShapeStyle=HorzLine }
          }
           }
      }
       }
    { PROPERTIES
      {
        DataItemIndent=1;
        DataItemTable=Table7010319;
        DataItemTableView=SORTING(Orden Listado)
                          ORDER(Ascending);
        DataItemVarName=Tipo Servicio;
        OnPreDataItem=BEGIN
                        ContaTS := 1;
                        //Inicializar las matrices que tienen el valor TOTAL para cada vehiculo.
                        vViajesTot[1]:=0;
                        vViajesTotAcum[1]:=0;
                        vPaxTransTot[1]:=0;
                        vPaxTransTotAcum[1]:=0;
                        vEntTransTot[1]:=0;
                        vEntTransTotAcum[1]:=0;

                        vFactTot[1]:=0;
                        vFactTotAcum[1]:=0;
                        vPaxFactTot[1]:=0;
                        vPaxFactTotAcum[1]:=0;

                        vTextoNormal:='$$';
                      END;

        OnAfterGetRecord=VAR
                           vMesViajes@1100244000 : Decimal;
                           vMesPaxTrans@1100244001 : Decimal;
                           vMesCliEntrados@1100244002 : Decimal;
                           vMesCantFact@1100244003 : Decimal;
                           vMesPaxFact@1100244004 : Decimal;
                           vAcuViajes@1100244005 : Decimal;
                           vAcuPaxTrans@1100244006 : Decimal;
                           vAcuCliEntrados@1100244007 : Decimal;
                           vAcuCantFact@1100244008 : Decimal;
                           vAcuPaxFact@1100244009 : Decimal;
                           rCli@1100244010 : Record 7010323;
                           ERROR_INCONSISTENCIA@1100244011 : TextConst 'ESP=Inconsitencia detectada en la selecci¢n de vehiculos';
                           cFunBas@1100244012 : Codeunit 7010310;
                         BEGIN
                           ContaTS := ContaTS + 1;

                           //Calculamos los acumulados del periodo especificado (en principio 1 mes)

                           rCli.RESET;
                           rCli.SETCURRENTKEY(Cliente,TTOO);
                           rCli.SETRANGE("Filtro Cliente",ClienteTTOO.Cliente);
                           rCli.SETRANGE("Filtro TTOO",ClienteTTOO.TTOO);
                           rCli.SETRANGE("Filtro Fecha",vIniMes,vFinMes);

                           IF vTipoLinea<>'' THEN
                             rCli.SETFILTER("Filtro Tipo Linea",vTipoLinea);

                           IF vTipoElemento<>'' THEN
                             rCli.SETFILTER("Filtro Tipo Elemento",vTipoElemento);


                           IF vGarajeResult<>'' THEN
                             rCli.SETRANGE("Filtro Garaje Resultados",vGarajeResult);

                           rCli.SETRANGE("Filtro Tipo Servicio",Codigo);

                           //Por si utilizamos el desglose de Cliente TTOO por Pax Transportado.
                           IF vDesglose AND (ClienteTTOO."Valor Desglose 2" > 0) THEN
                             rCli.SETRANGE("Filtro Pax Transportado",ClienteTTOO."Valor Desglose 1",
                                                                     ClienteTTOO."Valor Desglose 2");

                           IF vZP <> '' THEN
                             rCli.SETRANGE("Filtro Zona Precio",vZP);

                           IF rCli.FINDFIRST THEN
                             rCli.CALCFIELDS("N§ ViajesTTOOParte", "N§ Viajes2")
                           ELSE
                             ERROR(ERROR_INCONSISTENCIA);


                           vMesViajes   := rCli."N§ Viajes2";
                           vMesPaxTrans := rCli.TotalPaxTransportado;
                           vMesPaxFact  := rCli.TotalPaxFacturado;
                           vMesCantFact := rCli.TotalCantidadFacturada;

                           IF vDivisa <> '' THEN
                             vMesCantFact := cFunBas.DLaDESinRedondeo(vMesCantFact,vDivisa,TODAY);

                           //Calculamos las ptas(euros) por pasajero facturado.
                           vPtasPax     := 0;
                           IF vMesPaxFact <> 0 THEN
                             vPtasPax     := ROUND(vMesCantFact / vMesPaxFact,vPrecision);

                           //Calculo de los clientes entrados.
                           vMesCliEntrados := 0;
                           rCli.SETRANGE("Filtro Codigo Servicio",vCodEntrada);
                           IF rCli.FINDFIRST THEN BEGIN
                             vMesCliEntrados := rCli.TotalPaxTransportado;
                           END;
                           rCli.SETRANGE("Filtro Codigo Servicio");

                           //..................
                           //..................
                           //Calculamos los acumulados anuales.
                           rCli.SETRANGE("Filtro Fecha",vIniAcum,vFinAcum);
                           rCli.CALCFIELDS("N§ ViajesTTOOParte", "N§ Viajes2");

                           vAcuViajes   := rCli."N§ Viajes2";
                           vAcuPaxTrans := rCli.TotalPaxTransportado;
                           vAcuPaxFact  := rCli.TotalPaxFacturado;
                           vAcuCantFact := rCli.TotalCantidadFacturada;

                           IF vDivisa <> '' THEN
                             vAcuCantFact := cFunBas.DLaDESinRedondeo(vAcuCantFact,vDivisa,TODAY);

                           vAcumPtasPax  := 0;
                           IF vAcuPaxFact <> 0 THEN
                             vAcumPtasPax:= ROUND(vAcuCantFact / vAcuPaxFact,vPrecision);

                           //Calculo de los clientes entrados.
                           vAcuCliEntrados := 0;
                           rCli.SETRANGE("Filtro Codigo Servicio",vCodEntrada);
                           IF rCli.FINDFIRST THEN BEGIN
                             vAcuCliEntrados := rCli.TotalPaxTransportado ;
                           END;
                           rCli.SETRANGE("Filtro Codigo Servicio");


                           //................
                           //................
                           //Actualizaremos las matrices con los datos obtenidos.

                           //VIAJES.
                           ActualizarMatrices(vMesViajes,vAcuViajes,ContaTS,vViajesMes,vViajesAcum,
                                              vViajesTot,vViajesTotAcum);

                           //PASAJE TRANSPORTADO.
                           ActualizarMatrices(vMesPaxTrans,vAcuPaxTrans,ContaTS,vPaxTransMes,vPaxTransAcum,
                                              vPaxTransTot,vPaxTransTotAcum);
                           //PASAJE FACTURADO.
                           ActualizarMatrices(vMesPaxFact,vAcuPaxFact,ContaTS,vPaxFactMes,vPaxFactAcum,
                                              vPaxFactTot,vPaxFactTotAcum);
                           //FACTURACION.
                           ActualizarMatrices(vMesCantFact,vAcuCantFact,ContaTS,vFactMes,vFactAcum,
                                              vFactTot,vFactTotAcum);

                           //CLIENTES ENTRADOS.
                           ActualizarMatrices(vMesCliEntrados,vAcuCliEntrados,ContaTS,vEntTransMes,vEntTransAcum,
                                              vEntTransTot,vEntTransTotAcum);
                         END;

      }
      SECTIONS
      {
        { PROPERTIES
          {
            SectionType=Body;
            SectionWidth=25500;
            SectionHeight=423;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT(vMostrarTTOO);
                           vPrimerTexto := FALSE;
                         END;

          }
          CONTROLS
          {
            { 12  ;TextBox      ;24000;0    ;1500 ;423  ;SourceExpr=Codigo }
            { 10  ;TextBox      ;8400 ;0    ;900  ;423  ;DecimalPlaces=0:1;
                                                         SourceExpr=vViajesMes[1,1] }
            { 20  ;TextBox      ;0    ;0    ;4050 ;423  ;HorzAlign=Left;
                                                         SourceExpr=fTextoNormal }
            { 24  ;TextBox      ;9450 ;0    ;1050 ;423  ;DecimalPlaces=0:1;
                                                         SourceExpr=vViajesAcum[1,1] }
            { 25  ;TextBox      ;13800;0    ;1050 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vPaxTransMes[1,1] }
            { 26  ;TextBox      ;15000;0    ;1200 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vPaxTransAcum[1,1] }
            { 46  ;TextBox      ;20550;0    ;1050 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vAcumPtasPax }
            { 47  ;TextBox      ;19350;0    ;1050 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vPtasPax }
            { 132 ;TextBox      ;4350 ;0    ;1800 ;423  ;SourceExpr=ROUND(vFactMes[1,1],vPrecision) }
            { 145 ;TextBox      ;6300 ;0    ;1800 ;423  ;SourceExpr=ROUND(vFactAcum[1,1],vPrecision) }
            { 146 ;TextBox      ;16500;0    ;1200 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vPaxFactMes[1,1] }
            { 147 ;TextBox      ;17850;0    ;1200 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vPaxFactAcum[1,1] }
            { 60  ;TextBox      ;21750;0    ;900  ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=CalculaMediaPax(vPaxTransMes[1,1],vViajesMes[1,1]) }
            { 62  ;TextBox      ;22800;0    ;900  ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=CalculaMediaPax(vPaxTransAcum[1,1],vViajesAcum[1,1]) }
          }
           }
      }
       }
    { PROPERTIES
      {
        DataItemIndent=1;
        DataItemTable=Table2000000026;
        DataItemTableView=SORTING(Number)
                          ORDER(Ascending);
        MaxIteration=1;
        DataItemVarName=Entero;
        OnAfterGetRecord=BEGIN

                           vPtasPax := 0;
                           IF vPaxFactTot[1] <> 0 THEN
                             vPtasPax := ROUND(vFactTot[1]/vPaxFactTot[1],vPrecision);

                           vAcumPtasPax := 0;
                           IF vPaxFactTotAcum[1] <> 0 THEN
                             vAcumPtasPax := ROUND(vFactTotAcum[1]/vPaxFactTotAcum[1],vPrecision);
                         END;

      }
      SECTIONS
      {
        { PROPERTIES
          {
            SectionType=Body;
            SectionWidth=25500;
            SectionHeight=846;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT(vMostrarTTOO);
                           vPrimerTexto := FALSE;
                         END;

          }
          CONTROLS
          {
            { 149 ;TextBox      ;4350 ;0    ;1800 ;423  ;SourceExpr=ROUND(vFactTot[1],vPrecision) }
            { 148 ;TextBox      ;6300 ;0    ;1800 ;423  ;SourceExpr=ROUND(vFactTotAcum[1],vPrecision) }
            { 16  ;TextBox      ;8400 ;0    ;900  ;423  ;DecimalPlaces=0:1;
                                                         SourceExpr=vViajesTot[1] }
            { 23  ;TextBox      ;9450 ;0    ;1050 ;423  ;DecimalPlaces=0:1;
                                                         SourceExpr=vViajesTotAcum[1] }
            { 28  ;TextBox      ;13800;0    ;1050 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vPaxTransTot[1] }
            { 27  ;TextBox      ;15000;0    ;1200 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vPaxTransTotAcum[1] }
            { 150 ;TextBox      ;16500;0    ;1200 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vPaxFactTot[1] }
            { 151 ;TextBox      ;17850;0    ;1200 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vPaxFactTotAcum[1] }
            { 48  ;TextBox      ;19350;0    ;1050 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vPtasPax }
            { 49  ;TextBox      ;20550;0    ;1050 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vAcumPtasPax }
            { 15  ;Label        ;24000;0    ;1500 ;423  ;CaptionML=ESP=TOTAL }
            { 37  ;TextBox      ;0    ;0    ;4050 ;423  ;HorzAlign=Left;
                                                         SourceExpr=fTextoNormal }
            { 64  ;TextBox      ;22800;0    ;900  ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=CalculaMediaPax(vPaxTransTotAcum[1],vViajesTotAcum[1]) }
            { 71  ;TextBox      ;21750;0    ;900  ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=CalculaMediaPax(vPaxTransTot[1],vViajesTot[1]) }
            { 105 ;TextBox      ;10800;0    ;1200 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vEntTransTot[1] }
            { 106 ;TextBox      ;12150;0    ;1350 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vEntTransTotAcum[1] }
          }
           }
      }
       }
    { PROPERTIES
      {
        DataItemIndent=1;
        DataItemTable=Table7010319;
        DataItemTableView=SORTING(Orden Listado)
                          ORDER(Ascending);
        NewPagePerRecord=No;
        DataItemVarName=TipoServicio2;
        OnPreDataItem=BEGIN
                        ContaTS:=1;
                        vImprimirTotales := FALSE;
                        vTextoTotal := '$$';
                      END;

        OnAfterGetRecord=VAR
                           Regis@1100244000 : Record 7010324;
                         BEGIN
                           IF NOT vAgrupacionCliente THEN
                             CurrReport.SKIP;

                           IF ContaTS = 1 THEN BEGIN
                             Regis.COPYFILTERS(ClienteTTOO);
                             Regis.SETCURRENTKEY(Usuario,Cliente,TTOO);
                             Regis:=ClienteTTOO;

                             IF Regis.NEXT <> 0 THEN
                               IF Regis.Cliente = ClienteTTOO.Cliente THEN
                                 CurrReport.SKIP;
                           END;

                           vImprimirTotales := TRUE;

                           ContaTS := ContaTS + 1;

                           vPtasPax := 0;
                           IF vPaxFactMes[1,ContaTS] <> 0 THEN
                             vPtasPax := ROUND(vFactMes[1,ContaTS]/vPaxFactMes[1,ContaTS],vPrecision);

                           vAcumPtasPax := 0;
                           IF vPaxFactAcum[1,ContaTS] <> 0 THEN
                             vAcumPtasPax := ROUND(vFactAcum[1,ContaTS]/vPaxFactAcum[1,ContaTS],vPrecision);
                         END;

      }
      SECTIONS
      {
        { PROPERTIES
          {
            SectionType=Header;
            SectionWidth=25500;
            SectionHeight=423;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT(vMostrarTTOO AND vAgrupacionCliente AND (NOT vPrimerTexto) );
                         END;

          }
          CONTROLS
          {
            { 170 ;Label        ;4350 ;0    ;1800 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=---------------------- }
            { 171 ;Label        ;6300 ;0    ;1800 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=------------------------- }
            { 65  ;Label        ;8400 ;0    ;900  ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=------------- }
            { 69  ;Label        ;9450 ;0    ;1050 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=------------- }
            { 68  ;Label        ;13800;0    ;1050 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=------------- }
            { 67  ;Label        ;15000;0    ;1200 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=------------- }
            { 164 ;Label        ;16500;0    ;1200 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=------------- }
            { 165 ;Label        ;17850;0    ;1200 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=------------- }
            { 66  ;Label        ;19350;0    ;1050 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=------------- }
            { 70  ;Label        ;20550;0    ;1050 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=------------- }
            { 72  ;Label        ;21750;0    ;900  ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=------------- }
            { 73  ;Label        ;22800;0    ;900  ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=------------- }
            { 107 ;Label        ;10800;0    ;1200 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=------------- }
            { 108 ;Label        ;12150;0    ;1350 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=------------- }
          }
           }
        { PROPERTIES
          {
            SectionType=Body;
            SectionWidth=25500;
            SectionHeight=423;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT(vAgrupacionCliente);
                           vPrimerTexto := FALSE;
                         END;

          }
          CONTROLS
          {
            { 52  ;TextBox      ;8400 ;0    ;900  ;423  ;DecimalPlaces=0:1;
                                                         SourceExpr=vViajesMes[1,ContaTS] }
            { 53  ;TextBox      ;9450 ;0    ;1050 ;423  ;DecimalPlaces=0:1;
                                                         SourceExpr=vViajesAcum[1,ContaTS] }
            { 54  ;TextBox      ;13800;0    ;1050 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vPaxTransMes[1,ContaTS] }
            { 55  ;TextBox      ;15000;0    ;1200 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vPaxTransAcum[1,ContaTS] }
            { 63  ;TextBox      ;24000;0    ;1500 ;423  ;SourceExpr=Codigo }
            { 7   ;TextBox      ;0    ;0    ;4050 ;423  ;FontSize=8;
                                                         FontBold=Yes;
                                                         SourceExpr=fTextoTotal() }
            { 160 ;TextBox      ;16500;0    ;1200 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vPaxFactMes[1,ContaTS] }
            { 161 ;TextBox      ;17850;0    ;1200 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vPaxFactAcum[1,ContaTS] }
            { 172 ;TextBox      ;4350 ;0    ;1800 ;423  ;SourceExpr=ROUND(vFactMes[1,ContaTS],vPrecision) }
            { 173 ;TextBox      ;6300 ;0    ;1800 ;423  ;SourceExpr=ROUND(vFactAcum[1,ContaTS],vPrecision) }
            { 8   ;TextBox      ;19350;0    ;1050 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vPtasPax }
            { 17  ;TextBox      ;20550;0    ;1050 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vAcumPtasPax }
            { 78  ;TextBox      ;21750;0    ;900  ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=CalculaMediaPax(vPaxTransMes[1,ContaTS],vViajesMes[1,ContaTS]) }
            { 80  ;TextBox      ;22800;0    ;900  ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=CalculaMediaPax(vPaxTransAcum[1,ContaTS],vViajesAcum[1,ContaTS]) }
          }
           }
      }
       }
    { PROPERTIES
      {
        DataItemIndent=1;
        DataItemTable=Table2000000026;
        DataItemTableView=SORTING(Number)
                          ORDER(Ascending);
        MaxIteration=1;
        DataItemVarName=Entero2;
        OnAfterGetRecord=BEGIN
                           IF NOT vImprimirTotales THEN
                             CurrReport.SKIP;

                           vPtasPax := 0;
                           IF vPaxFactTot[2] <> 0 THEN
                             vPtasPax := ROUND(vFactTot[2]/vPaxFactTot[2],vPrecision);

                           vAcumPtasPax := 0;
                           IF vPaxFactTotAcum[2] <> 0 THEN
                             vAcumPtasPax := ROUND(vFactTotAcum[2]/vPaxFactTotAcum[2],vPrecision);
                         END;

      }
      SECTIONS
      {
        { PROPERTIES
          {
            SectionType=Body;
            SectionWidth=25500;
            SectionHeight=423;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT(vAgrupacionCliente);
                           vPrimerTexto := FALSE;
                         END;

          }
          CONTROLS
          {
            { 51  ;TextBox      ;8400 ;0    ;900  ;423  ;DecimalPlaces=0:1;
                                                         SourceExpr=vViajesTot[2] }
            { 58  ;TextBox      ;9450 ;0    ;1050 ;423  ;DecimalPlaces=0:1;
                                                         SourceExpr=vViajesTotAcum[2] }
            { 59  ;TextBox      ;13800;0    ;1050 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vPaxTransTot[2] }
            { 61  ;TextBox      ;15000;0    ;1200 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vPaxTransTotAcum[2] }
            { 79  ;Label        ;24000;0    ;1500 ;423  ;CaptionML=ESP=TOTAL }
            { 162 ;TextBox      ;16500;0    ;1200 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vPaxFactTot[2] }
            { 163 ;TextBox      ;17850;0    ;1200 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vPaxFactTotAcum[2] }
            { 174 ;TextBox      ;4350 ;0    ;1800 ;423  ;SourceExpr=ROUND(vFactTot[2],vPrecision) }
            { 175 ;TextBox      ;6300 ;0    ;1800 ;423  ;SourceExpr=ROUND(vFactTotAcum[2],vPrecision) }
            { 9   ;TextBox      ;19350;0    ;1050 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vPtasPax }
            { 13  ;TextBox      ;20550;0    ;1050 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vAcumPtasPax }
            { 18  ;TextBox      ;0    ;0    ;4050 ;423  ;FontSize=8;
                                                         FontBold=Yes;
                                                         SourceExpr=fTextoTotal }
            { 86  ;TextBox      ;21750;0    ;900  ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=CalculaMediaPax(vPaxTransTot[2],vViajesTot[2]) }
            { 94  ;TextBox      ;22800;0    ;900  ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=CalculaMediaPax(vPaxTransTotAcum[2],vViajesTotAcum[2]) }
            { 111 ;TextBox      ;10800;0    ;1200 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vEntTransTot[2] }
            { 112 ;TextBox      ;12150;0    ;1350 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vEntTransTotAcum[2] }
          }
           }
      }
       }
    { PROPERTIES
      {
        DataItemIndent=1;
        DataItemTable=Table7010319;
        DataItemTableView=SORTING(Orden Listado)
                          ORDER(Ascending);
        DataItemVarName=Tipo Servicio4;
        OnPreDataItem=VAR
                        rVehiculo@1100244000 : Record 7010346;
                      BEGIN
                        ContaTS := 1;
                      END;

        OnAfterGetRecord=VAR
                           Regis@1100244000 : Record 7010324;
                         BEGIN
                           IF NOT vAgrupacionGeneral THEN
                             CurrReport.SKIP;

                           IF ContaTS = 1 THEN BEGIN
                             Regis.COPYFILTERS(ClienteTTOO);
                             Regis.SETCURRENTKEY(Usuario,Cliente,TTOO);
                             Regis:=ClienteTTOO;

                             IF Regis.NEXT <> 0 THEN
                               CurrReport.SKIP
                             ELSE
                               vMostrarTotalGeneral := TRUE;
                             //Las agrupaciones generales, se ver n en una nueva p gina.
                             CurrReport.NEWPAGE;
                             vTextoTotal := Text002

                           END
                           ELSE
                             vTextoTotal := '';

                           ContaTS:=ContaTS + 1;

                           vPtasPax := 0;
                           IF vPaxFactMes[2,ContaTS] <> 0 THEN
                             vPtasPax := ROUND(vFactMes[2,ContaTS]/vPaxFactMes[2,ContaTS],vPrecision);

                           vAcumPtasPax := 0;
                           IF vPaxFactAcum[2,ContaTS] <> 0 THEN
                             vAcumPtasPax := ROUND(vFactAcum[2,ContaTS]/vPaxFactAcum[2,ContaTS],vPrecision);
                         END;

      }
      SECTIONS
      {
        { PROPERTIES
          {
            SectionType=Body;
            SectionWidth=25500;
            SectionHeight=423;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT(vAgrupacionGeneral);
                           vPrimerTexto := FALSE;
                         END;

          }
          CONTROLS
          {
            { 74  ;TextBox      ;8400 ;0    ;900  ;423  ;DecimalPlaces=0:1;
                                                         SourceExpr=vViajesMes[2,ContaTS] }
            { 75  ;TextBox      ;9450 ;0    ;1050 ;423  ;DecimalPlaces=0:1;
                                                         SourceExpr=vViajesAcum[2,ContaTS] }
            { 76  ;TextBox      ;13800;0    ;1050 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vPaxTransMes[2,ContaTS] }
            { 77  ;TextBox      ;15000;0    ;1200 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vPaxTransAcum[2,ContaTS] }
            { 84  ;TextBox      ;24000;0    ;1500 ;423  ;SourceExpr=Codigo }
            { 85  ;TextBox      ;150  ;0    ;3900 ;423  ;FontSize=8;
                                                         FontBold=No;
                                                         SourceExpr=vTextoTotal }
            { 152 ;TextBox      ;16500;0    ;1200 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vPaxFactMes[2,ContaTS] }
            { 153 ;TextBox      ;17850;0    ;1200 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vPaxFactAcum[2,ContaTS] }
            { 180 ;TextBox      ;4350 ;0    ;1800 ;423  ;SourceExpr=ROUND(vFactMes[2,ContaTS],vPrecision) }
            { 181 ;TextBox      ;6300 ;0    ;1800 ;423  ;SourceExpr=ROUND(vFactAcum[2,ContaTS],vPrecision) }
            { 137 ;TextBox      ;19350;0    ;1050 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vPtasPax }
            { 138 ;TextBox      ;20550;0    ;1050 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vAcumPtasPax }
            { 95  ;TextBox      ;21750;0    ;900  ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=CalculaMediaPax(vPaxTransMes[2,ContaTS],vViajesMes[2,ContaTS]) }
            { 96  ;TextBox      ;22800;0    ;900  ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=CalculaMediaPax(vPaxTransAcum[2,ContaTS],vViajesAcum[2,ContaTS]) }
          }
           }
      }
       }
    { PROPERTIES
      {
        DataItemIndent=1;
        DataItemTable=Table2000000026;
        DataItemTableView=SORTING(Number)
                          ORDER(Ascending);
        MaxIteration=1;
        DataItemVarName=Entero4;
        OnAfterGetRecord=BEGIN
                           IF NOT vAgrupacionGeneral THEN
                             CurrReport.SKIP;

                           IF NOT vMostrarTotalGeneral THEN
                             CurrReport.SKIP;

                           vPtasPax := 0;
                           IF vPaxFactTot[3] <> 0 THEN
                             vPtasPax := ROUND(vFactTot[3]/vPaxFactTot[3],vPrecision);

                           vAcumPtasPax := 0;
                           IF vPaxFactTotAcum[3] <> 0 THEN
                             vAcumPtasPax := ROUND(vFactTotAcum[3]/vPaxFactTotAcum[3],vPrecision);
                         END;

      }
      SECTIONS
      {
        { PROPERTIES
          {
            SectionType=Body;
            SectionWidth=25500;
            SectionHeight=423;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT(vAgrupacionGeneral);
                           vPrimerTexto := FALSE;
                         END;

          }
          CONTROLS
          {
            { 87  ;TextBox      ;8400 ;0    ;900  ;423  ;DecimalPlaces=0:1;
                                                         SourceExpr=vViajesTot[3] }
            { 88  ;TextBox      ;9450 ;0    ;1050 ;423  ;DecimalPlaces=0:1;
                                                         SourceExpr=vViajesTotAcum[3] }
            { 89  ;TextBox      ;13800;0    ;1050 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vPaxTransTot[3] }
            { 92  ;Label        ;24000;0    ;1500 ;423  ;CaptionML=ESP=TOTAL }
            { 93  ;TextBox      ;15000;0    ;1200 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vPaxTransTotAcum[3] }
            { 154 ;TextBox      ;16500;0    ;1200 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vPaxFactTot[3] }
            { 155 ;TextBox      ;17850;0    ;1200 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vPaxFactTotAcum[3] }
            { 186 ;TextBox      ;4350 ;0    ;1800 ;423  ;SourceExpr=ROUND(vFactTot[3],vPrecision) }
            { 187 ;TextBox      ;6300 ;0    ;1800 ;423  ;SourceExpr=ROUND(vFactTotAcum[3],vPrecision) }
            { 144 ;TextBox      ;20550;0    ;1050 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vAcumPtasPax }
            { 143 ;TextBox      ;19350;0    ;1050 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vPtasPax }
            { 97  ;TextBox      ;21750;0    ;900  ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=CalculaMediaPax(vPaxTransTot[3],vViajesTot[3]) }
            { 98  ;TextBox      ;22800;0    ;900  ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=CalculaMediaPax(vPaxTransTotAcum[3],vViajesTotAcum[3]) }
            { 115 ;TextBox      ;10800;0    ;1200 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vEntTransTot[3] }
            { 116 ;TextBox      ;12150;0    ;1350 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vEntTransTotAcum[3] }
          }
           }
      }
       }
  }
  REQUESTFORM
  {
    PROPERTIES
    {
      Width=12540;
      Height=6710;
      OnOpenForm=VAR
                   rConf@1100244000 : Record 98;
                   rPar@1100244001 : Record 7010311;
                   cFunEst@1100244002 : Codeunit 7010312;
                   cFunBas@1100244003 : Codeunit 7010310;
                 BEGIN
                   rPar.FINDFIRST;
                   vMes    := DATE2DMY(cFunBas.fdom(TODAY,-2),2);  //Ah¡ que poner un mes menos.
                   vA¤o    := DATE2DMY(cFunBas.fdom(TODAY,-1),3);
                   vGaraje := cFunBas.ObtenerGaraje();

                   //............
                   vSeleccion:=vSeleccion::"Todos los Clientes";
                   RequestOptionsForm.Seleccionar.VISIBLE:=FALSE;
                   //............
                   vDesglose:=FALSE;
                   RequestOptionsForm.Desglose.VISIBLE:=FALSE;
                   //............

                   vAgrupacionGeneral  :=TRUE;

                   //............
                   vAgrupacionCliente:=TRUE;
                   //............

                   vMostrarTTOO        :=TRUE;
                   vSoloConActividad   :=FALSE;
                   vIniAcum            :=rPar."Fecha Inicio Acumulados";

                   vGarajeResult:=cFunBas.ObtenerGaraje();
                   IF vGarajeResult<>'' THEN
                     RequestOptionsForm.FltGaraje.EDITABLE := FALSE;

                   //Actualizamos el temporal de selecci¢n de clientes.
                   cFunEst.Actualiza_Clientes_Usuario;

                   //Actualizamos el la tabla paralela de uso estad¡stico a Cliente/TTOO.
                   cFunEst.Actualizar_Temporal_Clientes;

                   //Inicializaci¢n de la divisa.
                   vDivisa:= '';
                 END;

    }
    CONTROLS
    {
      { 1   ;Label        ;220  ;220  ;6050 ;440  ;CaptionML=ESP=Mes / A¤o }
      { 4   ;TextBox      ;6380 ;220  ;2310 ;440  ;OptionString=Enero,Febrero,Marzo,Abril,Mayo,Junio,Julio,Agosto,Septiembre,Octubre,Noviembre,Diciembre,Marso;
                                                   NextControl=6;
                                                   SourceExpr=vMes }
      { 5   ;Label        ;8690 ;220  ;330  ;440  ;Visible=Yes;
                                                   LeaderDots=No;
                                                   CaptionML=ESP=/ }
      { 6   ;TextBox      ;9020 ;220  ;1100 ;440  ;NextControl=17;
                                                   SourceExpr=vA¤o }
      { 17  ;TextBox      ;6380 ;770  ;1430 ;440  ;ToolTipML=ESP="Fecha de inicio para el c lculo de los acumulados. ";
                                                   NotBlank=Yes;
                                                   SourceExpr=vIniAcum }
      { 18  ;Label        ;220  ;770  ;6050 ;440  ;CaptionML=ESP=Fecha Inicio (Acumulados) }
      { 7   ;CheckBox     ;6380 ;4290 ;440  ;440  ;ShowCaption=No;
                                                   SourceExpr=vMostrarTTOO }
      { 9   ;CheckBox     ;6380 ;4840 ;440  ;440  ;ShowCaption=No;
                                                   SourceExpr=vAgrupacionCliente }
      { 12  ;CheckBox     ;6380 ;5390 ;440  ;440  ;ShowCaption=No;
                                                   SourceExpr=vAgrupacionGeneral }
      { 15  ;CheckBox     ;6380 ;5940 ;440  ;440  ;ShowCaption=No;
                                                   NextControl=4;
                                                   SourceExpr=vSoloConActividad }
      { 16  ;Label        ;220  ;5940 ;6050 ;440  ;MultiLine=Yes;
                                                   CaptionML=ESP=Mostrar s¢lo Clientes con Actividad;
                                                   ToolTipML=ESP=Si se marca s¢lo se considerar n los clientes que han solicitado alg£n servicio. }
      { 13  ;Label        ;220  ;5390 ;6050 ;440  ;CaptionML=ESP=Mostrar Agrupaci¢n General }
      { 10  ;Label        ;220  ;4840 ;6050 ;440  ;CaptionML=ESP=Mostrar Totales del Cliente }
      { 8   ;Label        ;220  ;4290 ;6050 ;440  ;CaptionML=ESP=Mostrar TTOO }
      { 20  ;CommandButton;9680 ;1320 ;440  ;440  ;Name=Seleccionar;
                                                   HorzGlue=Left;
                                                   VertGlue=Top;
                                                   CaptionML=ESP=...;
                                                   ToolTipML=ESP=Seleccionar Vehiculos;
                                                   OnPush=VAR
                                                            rSel@1100244001 : Record 7010324;
                                                            fSel@1100244002 : Form 7010431;
                                                          BEGIN

                                                            rSel.RESET;
                                                            rSel.INIT;
                                                            rSel.SETCURRENTKEY(Usuario,Cliente,TTOO);
                                                            rSel.FILTERGROUP(2);
                                                            rSel.SETRANGE(Usuario,USERID);
                                                            rSel.FILTERGROUP(0);

                                                            CLEAR(fSel);
                                                            fSel.SETTABLEVIEW(rSel);
                                                            fSel.RUN;
                                                            CLEAR(fSel);
                                                            rSel.RESET;
                                                          END;
                                                           }
      { 11  ;TextBox      ;6380 ;1320 ;3300 ;440  ;SourceExpr=vSeleccion;
                                                   OnValidate=BEGIN
                                                                IF vSeleccion=vSeleccion::"Todos los Clientes" THEN
                                                                  RequestOptionsForm.Seleccionar.VISIBLE:=FALSE
                                                                ELSE
                                                                  RequestOptionsForm.Seleccionar.VISIBLE:=TRUE;
                                                              END;
                                                               }
      { 14  ;Label        ;220  ;1320 ;6050 ;440  ;CaptionML=ESP=Selecci¢n Clientes/TTOO }
      { 23  ;Label        ;220  ;2970 ;6050 ;440  ;MultiLine=Yes;
                                                   CaptionML=ESP=Garaje a considerar en resultados;
                                                   ToolTipML=ESP=Si se marca s¢lo se considerar n los vehiculos que han tenido actividad }
      { 24  ;TextBox      ;6380 ;2970 ;2310 ;440  ;Name=FltGaraje;
                                                   NextControl=21;
                                                   SourceExpr=vGarajeResult;
                                                   TableRelation=Garaje.Garaje;
                                                   OnValidate=VAR
                                                                cfunbas@1100244001 : Codeunit 7010310;
                                                              BEGIN
                                                                cfunbas.TestRestringido(vGaraje);
                                                              END;
                                                               }
      { 2   ;CheckBox     ;6380 ;1870 ;440  ;440  ;ShowCaption=No;
                                                   NextControl=25;
                                                   SourceExpr=vDesglose;
                                                   OnValidate=BEGIN
                                                                IF vDesglose THEN
                                                                  RequestOptionsForm.Desglose.VISIBLE:=TRUE
                                                                ELSE
                                                                  RequestOptionsForm.Desglose.VISIBLE:=FALSE;
                                                              END;
                                                               }
      { 3   ;Label        ;220  ;1870 ;6050 ;440  ;CaptionML=ESP=Desglosar Clientes por n§ pax transportados }
      { 19  ;CommandButton;6710 ;1870 ;440  ;440  ;Name=Desglose;
                                                   HorzGlue=Left;
                                                   VertGlue=Top;
                                                   CaptionML=ESP=...;
                                                   ToolTipML=ESP=Seleccionar Vehiculos;
                                                   OnPush=VAR
                                                            rSel@1100244001 : Record 7010324;
                                                            fSel@1100244002 : Form 7010432;
                                                          BEGIN

                                                            rSel.RESET;
                                                            rSel.INIT;
                                                            rSel.SETCURRENTKEY(Usuario,Cliente,TTOO);
                                                            rSel.FILTERGROUP(2);
                                                            rSel.SETRANGE(Usuario,USERID);
                                                            rSel.FILTERGROUP(0);

                                                            CLEAR(fSel);
                                                            fSel.SETTABLEVIEW(rSel);
                                                            fSel.RUN;
                                                            CLEAR(fSel);
                                                            rSel.RESET;
                                                          END;
                                                           }
      { 21  ;TextBox      ;6380 ;3520 ;1650 ;440  ;NextControl=7;
                                                   SourceExpr=vDivisa;
                                                   TableRelation=Currency;
                                                   OnValidate=VAR
                                                                cFunBas@1100244001 : Codeunit 7010310;
                                                              BEGIN
                                                              END;
                                                               }
      { 22  ;Label        ;220  ;3520 ;6050 ;440  ;CaptionML=ESP=C¢d. Divisa }
      { 25  ;TextBox      ;6380 ;2420 ;2310 ;440  ;NextControl=24;
                                                   SourceExpr=vZP;
                                                   TableRelation="Zona contrato"."Zona Precio" WHERE (Tipo contrato=CONST(Venta)) }
      { 26  ;Label        ;220  ;2420 ;6050 ;440  ;CaptionML=ESP=Zona de precios }
    }
  }
  REQUESTPAGE
  {
    PROPERTIES
    {
    }
    CONTROLS
    {
    }
  }
  CODE
  {
    VAR
      Text000@1100244054 : TextConst 'ESP=TODOS';
      Text001@1100244055 : TextConst 'ESP=" de "';
      Text002@1100244056 : TextConst 'ESP=Agrupaci¢n General';
      Text003@1100244057 : TextConst 'ESP="Total "';
      LastFieldNo@1100244000 : Integer;
      FooterPrinted@1100244001 : Boolean;
      vCodEntrada@1100244002 : Code[10];
      vA¤o@1100244003 : Integer;
      vMes@1100244004 : 'Enero,Febrero,Marzo,Abril,Mayo,Junio,Julio,Agosto,Septiembre,Octubre,Noviembre,Diciembre';
      vGaraje@1100244005 : Code[10];
      vIniMes@1100244006 : Date;
      vFinMes@1100244007 : Date;
      vIniAcum@1100244008 : Date;
      vFinAcum@1100244009 : Date;
      vPaxTransMes@1100244010 : ARRAY [2,10] OF Decimal;
      vPaxTransAcum@1100244011 : ARRAY [2,10] OF Decimal;
      vPaxTransTotAcum@1100244012 : ARRAY [3] OF Decimal;
      vPaxTransTot@1100244013 : ARRAY [3] OF Decimal;
      vEntTransMes@1100244014 : ARRAY [2,10] OF Decimal;
      vEntTransAcum@1100244015 : ARRAY [2,10] OF Decimal;
      vEntTransTotAcum@1100244016 : ARRAY [3] OF Decimal;
      vEntTransTot@1100244017 : ARRAY [3] OF Decimal;
      vPaxFactMes@1100244018 : ARRAY [2,10] OF Decimal;
      vPaxFactAcum@1100244019 : ARRAY [2,10] OF Decimal;
      vPaxFactTotAcum@1100244020 : ARRAY [3] OF Decimal;
      vPaxFactTot@1100244021 : ARRAY [3] OF Decimal;
      vViajesMes@1100244022 : ARRAY [2,10] OF Decimal;
      vViajesAcum@1100244023 : ARRAY [2,10] OF Decimal;
      vViajesTot@1100244024 : ARRAY [3] OF Decimal;
      vViajesTotAcum@1100244025 : ARRAY [3] OF Decimal;
      vFactMes@1100244026 : ARRAY [2,10] OF Decimal;
      vFactAcum@1100244027 : ARRAY [2,10] OF Decimal;
      vFactTot@1100244028 : ARRAY [3] OF Decimal;
      vFactTotAcum@1100244029 : ARRAY [3] OF Decimal;
      ContaTS@1100244030 : Integer;
      vPtasPax@1100244031 : Decimal;
      vAcumPtasPax@1100244032 : Decimal;
      vFltGaraje@1100244033 : Text[10];
      vAgrupacionCliente@1100244034 : Boolean;
      vAgrupacionGeneral@1100244035 : Boolean;
      vMostrarTTOO@1100244036 : Boolean;
      vSoloConActividad@1100244037 : Boolean;
      vFltGarajeResult@1100244038 : Text[30];
      vGarajeResult@1100244039 : Code[10];
      vSeleccion@1100244040 : 'Todos los Clientes,Seg£n Selecci¢n';
      vPrecision@1100244041 : Decimal;
      vTextoNormal@1100244042 : Text[60];
      vTextoTotal@1100244043 : Text[60];
      vMostrarTotales@1100244044 : Boolean;
      vImprimirTotales@1100244045 : Boolean;
      vPrimerTexto@1100244046 : Boolean;
      vMostrarTotalGeneral@1100244047 : Boolean;
      vDesglose@1100244048 : Boolean;
      vTipoLinea@1100244049 : Text[50];
      vTipoElemento@1100244050 : Text[50];
      vDivisa@1100244051 : Code[10];
      vZP@1100244052 : Code[10];
      rParametros@1100244053 : Record 7010311;

    PROCEDURE Inicializar@2(VAR vMatriz@1100244000 : ARRAY [10] OF Decimal);
    VAR
      i@1100244001 : Integer;
    BEGIN
      //Inicializar.
      //Las matrices tienen profundidad 10.
      FOR i:=1 TO 10 DO
        vMatriz[i]:=0;
    END;

    PROCEDURE TestActividad@9(VAR rCT@1100244000 : Record 7010324) : Boolean;
    VAR
      rIngreso@1100244001 : Record 7010414;
      rProd@1103355000 : Record 7035392;
      rTxP@1100244002 : Record 7010365;
      vConcepto@1100244003 : 'Ingreso';
    BEGIN
      //TestActividad(rVeh: Record Vehiculo).
      //El proposito es saber si para un determinado Cliente, para unas fechas determinadas,
      //ha habido actividad.

      rTxP.RESET;
      rTxP.SETCURRENTKEY(Confirmado,"Cliente estadistico",Touroperador,"Fecha Facturacion",Garaje);

      rIngreso.RESET;
      rIngreso.SETCURRENTKEY("Cliente estadistico",Touroperador,Fecha,"Tipo linea","Tipo elemento",Garaje);

      //Recorremos todos los vehiculos que se van a considerar en el informe.
      IF rCT.FINDSET(TRUE) THEN REPEAT
        rCT.Actividad := TRUE;
        rTxP.SETRANGE(Confirmado,TRUE);
        rTxP.SETRANGE("Cliente estadistico",rCT.Cliente);
        rTxP.SETRANGE(Touroperador,rCT.TTOO);
        // JPT - 21/11/01 Cambiamos los rangos de la fecha de actividad
        //rTxP.SETRANGE("Fecha Facturacion",vIniMes,vFinMes);
        rTxP.SETRANGE("Fecha Facturacion",rParametros."Fecha Inicio Acumulados",vFinMes);

        IF vGarajeResult <> '' THEN
          rTxP.SETRANGE(Garaje,vGarajeResult);

        IF NOT rTxP.FINDFIRST THEN BEGIN
          rIngreso.SETRANGE(Concepto,vConcepto::Ingreso);
          rIngreso.SETRANGE("Cliente estadistico",rCT.Cliente);
          rIngreso.SETRANGE(Touroperador,rCT.TTOO);
          // JPT - 21/11/01 Cambiamos los rangos de la fecha de actividad
          // rIngreso.SETRANGE(Fecha,vIniMes,vFinMes);
          rIngreso.SETRANGE(Fecha,rParametros."Fecha Inicio Acumulados",vFinMes);

          IF vGarajeResult <> '' THEN
            rIngreso.SETRANGE(Garaje,vGarajeResult);

          IF NOT rIngreso.FINDFIRST THEN BEGIN
            // JPT 16/10/06 Miramos tambien la produccion ahora
            CLEAR(rProd);
            //rProd.SETCURRENTKEY("Cliente estadistico",Touroperador,Fecha,Facturable,"N§ Prefactura");
            rProd.SETCURRENTKEY("Cliente estadistico", Touroperador, Fecha, "Tipo linea",
                                "Tipo elemento", Garaje, "Tipo servicio", "Codigo servicio",
                                "Pax Transportados", "Zona Precios", "Servicio propio", Vehiculo);
            rProd.SETRANGE("Cliente estadistico",rCT.Cliente);
            rProd.SETRANGE(Touroperador,rCT.TTOO);
            rProd.SETRANGE(Fecha,rParametros."Fecha Inicio Acumulados",vFinMes);
            IF NOT rProd.FINDFIRST THEN
              rCT.Actividad := FALSE;
          END;

        END;
        rCT.MODIFY;

      UNTIL rCT.NEXT=0;
    END;

    PROCEDURE ActualizarMatrices@1(pValorMes@1100244000 : Decimal;pValorAcum@1100244001 : Decimal;pContaTS@1100244002 : Integer;VAR aMes@1100244003 : ARRAY [2,10] OF Decimal;VAR aAcum@1100244004 : ARRAY [2,10] OF Decimal;VAR aTot@1100244005 : ARRAY [3] OF Decimal;VAR aTotAcum@1100244006 : ARRAY [3] OF Decimal);
    BEGIN
      //ActualizarMatrices();
      //Actualizar los totales obtenidos para viajes,pax.transportado,facturado e importe facturado.
      //Como las matrices son an logas: de tipo decimal y de las mismas dimensiones, nos aprovechamos
      //de la circunstancia.

      //EMPEZAMOS...

      //Para visualizar lo del Mes para un determinado tipo de Servicio / Vehiculo.
      aMes  [1,1]  := pValorMes;

      //Para visualizar el Total del mes para un determinado Vehiculo.
      aTot  [1]   := aTot[1]   + aMes[1,1];

      //Para visualizar lo del Mes para el Grupo de vehiculos con mismo numero de plazas teniendo en
      //cuenta el tipo de servicio.
      aMes  [1,pContaTS]:= aMes[1,pContaTS]+aMes[1,1];

      //Para visualizar lo del Mes considerando TODOS los vehiculos y un determinado tipo de servicio.
      aMes  [2,pContaTS]:= aMes[2,pContaTS]+aMes[1,1];

      //Para visualizar el Acumulado para un determinado tipo de Servicio / Vehiculo.
      aAcum[1,1]   := pValorAcum;

      //Para visualizar el Total Acumulado para un determinado Vehiculo.
      aTotAcum[1]  := aTotAcum[1]+aAcum[1,1];

      //Para visualizar el Acumulado para un Grupo de vehiculos con mismo numero de plazas teniendo en
      //cuenta el tipo de servicio.
      aAcum[1,pContaTS]:= aAcum[1,pContaTS]+aAcum[1,1];

      //Para visualizar el Acumulado considerando TODOS los vehiculos y un determinado tipo de servicio.
      aAcum[2,pContaTS]:= aAcum[2,pContaTS]+aAcum[1,1];

      //Preparamos los valores TOTALES para la agrupaci¢n por Num. Plazas.
      aTot[2]      := aTot[2]     + aMes[1,1];
      aTotAcum[2]  := aTotAcum[2] + aAcum[1,1];

      //Preparamos para el acumulado general (TOTAL) para MES y Acumulado.
      aTot[3]      := aTot[3] + aMes[1,1];
      aTotAcum[3]  := aTotAcum[3] + aAcum[1,1];
    END;

    PROCEDURE Desglosar@4();
    VAR
      rSel@1100244000 : Record 7010324;
      rSelAux@1100244001 : Record 7010324;
    BEGIN
      //Desglosar().
      IF vDesglose THEN BEGIN

        rSel.RESET;
        rSel.SETCURRENTKEY(Usuario,Cliente,TTOO,"N§ Desglose");
        rSel.SETRANGE(Usuario,USERID);
        rSel.SETRANGE("N§ Desglose",0);
        IF vSeleccion=vSeleccion::"Seg£n Selecci¢n" THEN
          rSel.SETRANGE(Selecci¢n,TRUE);

        IF rSel.FINDSET(TRUE) THEN REPEAT

          IF rSel."Desglose n§ 1 (Mayor que)" > 0 THEN BEGIN
            rSel."Valor Desglose 1" := 0;
            rSel."Valor Desglose 2" := rSel."Desglose n§ 1 (Mayor que)";
            rSel.MODIFY;

            rSelAux.INIT;
            rSelAux.Usuario            := USERID;
            rSelAux.Cliente            := rSel.Cliente;
            rSelAux.TTOO               := rSel.TTOO;
            rSelAux."N§ Desglose"      := 1;
            rSelAux."Valor Desglose 1" := rSel."Desglose n§ 1 (Mayor que)" + 1;
            rSelAux."Valor Desglose 2" := 999;
            rSelAux.Selecci¢n          := TRUE;
            rSelAux.INSERT;
          END;

          IF rSel."Desglose n§ 2 (Mayor que)" > 0 THEN BEGIN

            rSelAux."Valor Desglose 2" := rSel."Desglose n§ 2 (Mayor que)";
            rSelAux.MODIFY;

            rSelAux.INIT;
            rSelAux.Usuario            := USERID;
            rSelAux.Cliente            := rSel.Cliente;
            rSelAux.TTOO               := rSel.TTOO;
            rSelAux."N§ Desglose"      := 2;
            rSelAux."Valor Desglose 1" := rSel."Desglose n§ 2 (Mayor que)" + 1;
            rSelAux."Valor Desglose 2" := 999;
            rSelAux.Selecci¢n          := TRUE;
            rSelAux.INSERT;
          END;

        UNTIL rSel.NEXT=0;

        COMMIT;
      END;
    END;

    PROCEDURE fTextoNormal@5() : Text[60];
    BEGIN
      //fTextoNormal
      IF vTextoNormal = '$$' THEN BEGIN
        ClienteTTOO.CALCFIELDS("Nombre TTOO");
        vTextoNormal := ClienteTTOO."Nombre TTOO";
        IF vDesglose AND (ClienteTTOO."Valor Desglose 2" > 0) THEN BEGIN
          vTextoNormal := vTextoNormal + ' ('+ FORMAT(ClienteTTOO."Valor Desglose 1")+'..';

          IF (ClienteTTOO."Valor Desglose 2") <= 900 THEN
            vTextoNormal := vTextoNormal + FORMAT(ClienteTTOO."Valor Desglose 2")
          ELSE
            vTextoNormal := vTextoNormal + '   ';

          vTextoNormal := vTextoNormal + ')';
        END;
      END
      ELSE
        vTextoNormal := '';

      EXIT(vTextoNormal);
    END;

    PROCEDURE fTextoTotal@6() : Text[60];
    BEGIN
      //fTextoTotal
      IF vTextoTotal =  '$$' THEN BEGIN
        ClienteTTOO.CALCFIELDS("Nombre Cliente");
        vTextoTotal := Text003 + ClienteTTOO."Nombre Cliente"
      END
      ELSE
        vTextoTotal := '';

      EXIT(vTextoTotal);
    END;

    PROCEDURE CalculaMediaPax@15(pPax@1100244000 : Decimal;pViajes@1100244001 : Decimal) : Decimal;
    VAR
      vResult@1100244002 : Integer;
    BEGIN
      vResult := 0;
      IF pViajes <> 0 THEN
        vResult := ROUND(pPax / pViajes,1);
      EXIT(vResult);
    END;

    BEGIN
    END.
  }
  RDLDATA
  {
  }
}
