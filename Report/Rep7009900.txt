OBJECT Report 7009900 Proforma
{
  OBJECT-PROPERTIES
  {
    Date=28/10/14;
    Time=12:29:53;
    Modified=Yes;
    Version List=AIC2009;
  }
  PROPERTIES
  {
    CaptionML=[ENU=Pro-Forma;
               ESP=Proforma];
    TopMargin=1000;
    BottomMargin=1000;
    OnPreReport=BEGIN
                  InfoEmpresa.FIND('-');
                  InfoEmpresa.CALCFIELDS(Picture);

                  wNumCopias := 1;
                END;

    OnPostReport=VAR
                   lrProf@1103355000 : Record 7009866;
                 BEGIN
                 END;

  }
  DATAITEMS
  {
    { PROPERTIES
      {
        DataItemTable=Table7009866;
        DataItemTableView=SORTING(Num. Proforma);
        NewPagePerRecord=Yes;
        DataItemVarName=Cabecera;
        OnAfterGetRecord=VAR
                           lrLang@1103355000 : Record 8;
                         BEGIN

                           // AJF 22/01/09
                           // cambio el idioma dependiendo del LangID de la proforma.

                           IF lrLang.GET(LanguageID) AND
                             (lrLang."Windows Language ID" <> GLOBALLANGUAGE) AND
                             (lrLang."Windows Language ID" <> 0 )THEN
                             CurrReport.LANGUAGE := lrLang."Windows Language ID";

                           rCust.GET(Cliente);
                           FormatDire.Customer(DirClie, rCust);
                           wCIFNIF := rCust."VAT Registration No.";

                           // AJF 24/12/08
                           // Busco el banco gen‚rico del cliente para mostrar la info bancaria.
                           // AJF 26/01/09
                           // Ya que ahora el "Default Bank Acc. Code" apunta a la ficha de banco
                           // saco la informaci¢n directamente del banco.
                           // CLEAR(rBancoCli);
                           CLEAR(rBanco);

                           wTieneBanco := (rCust."Default Bank Acc. Code" <> '');
                           IF wTieneBanco THEN
                             rBanco.GET(rCust."Default Bank Acc. Code")
                           ELSE
                             IF NOT CurrReport.PREVIEW THEN
                               ImprimirDocs;

                           // AJF 22/12/08
                           // Actualizo Ultima impresion y usuario al imprimir
                           IF NOT CurrReport.PREVIEW THEN BEGIN
                             Cabecera."Ultima impresion"  := CURRENTDATETIME;
                             Cabecera."Usuario impresion" := USERID;
                             Cabecera.MODIFY;
                           END;
                         END;

        ReqFilterFields=Num. Proforma;
        GroupTotalFields=Num. Proforma;
      }
      SECTIONS
      {
      }
       }
    { PROPERTIES
      {
        DataItemIndent=1;
        DataItemTable=Table2000000026;
        DataItemTableView=SORTING(Number);
        NewPagePerRecord=Yes;
        DataItemVarName=BucleCopia;
        OnPreDataItem=BEGIN
                        BucleCopia.SETRANGE(Number, 1, wNumCopias);
                      END;

        OnAfterGetRecord=BEGIN
                           IF BucleCopia.Number = 1 THEN
                             wTextoCopias := ''
                           ELSE
                             wTextoCopias := 'COPIA';

                           CurrReport.PAGENO := 1;
                           wPrimerComentario := TRUE;
                           LinImporIVA.DELETEALL;
                         END;

      }
      SECTIONS
      {
      }
       }
    { PROPERTIES
      {
        DataItemIndent=2;
        DataItemTable=Table2000000026;
        DataItemTableView=SORTING(Number);
        MaxIteration=1;
        DataItemVarName=BuclePagina;
        OnAfterGetRecord=BEGIN
                           BuclePagina := BuclePagina;
                         END;

      }
      SECTIONS
      {
        { PROPERTIES
          {
            SectionType=Header;
            PrintOnEveryPage=Yes;
            SectionWidth=18300;
            SectionHeight=7614;
          }
          CONTROLS
          {
            { 1100244000;TextBox;14850;0    ;3450 ;423  ;HorzAlign=Right;
                                                         FontName=Arial;
                                                         FontSize=12;
                                                         FontBold=Yes;
                                                         SourceExpr=wTextoCopias }
            { 1100244001;Label  ;16200;423  ;1050 ;423  ;ParentControl=1100244002;
                                                         FontName=Arial;
                                                         FontSize=8;
                                                         LeaderDots=Yes }
            { 1100244002;TextBox;17400;423  ;900  ;423  ;FontName=Arial;
                                                         FontSize=8;
                                                         CaptionML=[ENU=Page;
                                                                    ESP=Pagina];
                                                         SourceExpr=CurrReport.PAGENO }
            { 1100244005;TextBox;3600 ;2538 ;3450 ;1269 ;HorzAlign=Left;
                                                         FontName=Arial;
                                                         FontSize=13;
                                                         SourceExpr=Cabecera."Num. Proforma" }
            { 1100244007;TextBox;15450;4653 ;2850 ;423  ;FontName=Arial;
                                                         FontSize=9;
                                                         SourceExpr=wCIFNIF }
            { 1100244009;TextBox;12000;2538 ;6300 ;423  ;FontName=Arial;
                                                         FontSize=9;
                                                         SourceExpr=DirClie[1] }
            { 1100244010;TextBox;12000;2961 ;6300 ;423  ;FontName=Arial;
                                                         FontSize=9;
                                                         SourceExpr=DirClie[2] }
            { 1100244011;TextBox;12000;3384 ;6300 ;423  ;FontName=Arial;
                                                         FontSize=9;
                                                         SourceExpr=DirClie[3] }
            { 1100244012;TextBox;12000;3807 ;6300 ;423  ;FontName=Arial;
                                                         FontSize=9;
                                                         SourceExpr=DirClie[4] }
            { 1100244008;Label  ;12000;4653 ;3300 ;423  ;VertAlign=Bottom;
                                                         FontName=Arial;
                                                         FontSize=9;
                                                         FontBold=Yes;
                                                         LeaderDots=Yes;
                                                         CaptionML=[ENU=Tax ID code;
                                                                    ESP=CIF/NIF] }
            { 1100244013;Label  ;0    ;3807 ;3450 ;423  ;VertAlign=Bottom;
                                                         FontName=Arial;
                                                         FontSize=9;
                                                         FontBold=Yes;
                                                         LeaderDots=Yes;
                                                         CaptionML=[ENU=Expiration date;
                                                                    ESP=Fecha vencimiento] }
            { 1100244014;Label  ;0    ;4230 ;3450 ;423  ;VertAlign=Bottom;
                                                         FontName=Arial;
                                                         FontSize=9;
                                                         FontBold=Yes;
                                                         LeaderDots=Yes;
                                                         CaptionML=[ENU=TourOperator;
                                                                    ESP=TourOperador] }
            { 1100244015;Label  ;0    ;4653 ;3450 ;423  ;VertAlign=Bottom;
                                                         FontName=Arial;
                                                         FontSize=9;
                                                         FontBold=Yes;
                                                         LeaderDots=Yes;
                                                         CaptionML=[ENU=Check-in Date;
                                                                    ESP=Fecha entrada] }
            { 1100244016;TextBox;3600 ;3807 ;2250 ;423  ;HorzAlign=Left;
                                                         FontName=Arial;
                                                         FontSize=9;
                                                         SourceExpr=Cabecera."Fecha vencimiento" }
            { 1100244017;TextBox;3600 ;4230 ;7950 ;423  ;HorzAlign=Left;
                                                         FontName=Arial;
                                                         FontSize=9;
                                                         SourceExpr=cNom.nom_touroperador(Cabecera.Touroperador) }
            { 1100244018;TextBox;3600 ;4653 ;2250 ;423  ;HorzAlign=Left;
                                                         FontName=Arial;
                                                         FontSize=9;
                                                         SourceExpr=Cabecera."Fecha llegada" }
            { 1100244022;Label  ;3900 ;6345 ;3450 ;846  ;VertAlign=Bottom;
                                                         FontName=Arial;
                                                         FontSize=9;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=[ENU=Description;
                                                                    ESP=Descripcion] }
            { 1100244036;Label  ;13500;6345 ;750  ;846  ;HorzAlign=Right;
                                                         VertAlign=Bottom;
                                                         FontName=Arial;
                                                         FontSize=9;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=[ENU=Days;
                                                                    ESP=Dias] }
            { 1100244038;Label  ;14400;6345 ;2850 ;846  ;HorzAlign=Right;
                                                         VertAlign=Bottom;
                                                         FontName=Arial;
                                                         FontSize=9;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=[ENU=Amount;
                                                                    ESP=Importe] }
            { 1100244044;Shape  ;0    ;7191 ;17250;423  ;BorderWidth=2pt;
                                                         ShapeStyle=HorzLine }
            { 1100244052;TextBox;12000;4230 ;6300 ;423  ;FontName=Arial;
                                                         FontSize=9;
                                                         SourceExpr=DirClie[5] }
            { 1100244059;PictureBox;0 ;0    ;7800 ;2115 ;SourceExpr=InfoEmpresa.Picture }
            { 1103355000;Label  ;0    ;2538 ;3450 ;1269 ;FontName=Arial;
                                                         FontSize=13;
                                                         FontBold=Yes;
                                                         LeaderDots=Yes;
                                                         CaptionML=[ENU=Pro-Forma;
                                                                    ESP=Proforma] }
            { 1103355006;Label  ;2250 ;6345 ;1500 ;846  ;ParentControl=1103355005;
                                                         VertAlign=Bottom;
                                                         FontName=arial;
                                                         FontSize=9;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=[ENU=Item Type;
                                                                    ESP=Tipo Producto] }
            { 1103355012;Label  ;0    ;6345 ;2100 ;846  ;ParentControl=1103355011;
                                                         VertAlign=Bottom;
                                                         FontName=arial;
                                                         FontSize=9;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=[ENU=Voucher;
                                                                    ESP=Bono] }
            { 1103355018;Label  ;7500 ;6345 ;4350 ;846  ;ParentControl=1103355017;
                                                         VertAlign=Bottom;
                                                         FontName=arial;
                                                         FontSize=9;
                                                         FontBold=Yes;
                                                         MultiLine=Yes }
            { 1103355022;Label  ;12000;6345 ;600  ;846  ;HorzAlign=Right;
                                                         VertAlign=Bottom;
                                                         FontName=arial;
                                                         FontSize=9;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=[ENU=AD;
                                                                    ESP=AD] }
            { 1103355023;Label  ;12750;6345 ;600  ;846  ;HorzAlign=Right;
                                                         VertAlign=Bottom;
                                                         FontName=arial;
                                                         FontSize=9;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=[ENU=CHD;
                                                                    ESP=NI] }
            { 1103355014;Label  ;0    ;5499 ;3450 ;423  ;VertAlign=Bottom;
                                                         FontName=Arial;
                                                         FontSize=9;
                                                         FontBold=Yes;
                                                         LeaderDots=Yes;
                                                         CaptionML=[ENU=Currency;
                                                                    ESP=Divisa] }
            { 1103355015;TextBox;3600 ;5499 ;2250 ;423  ;HorzAlign=Left;
                                                         FontName=Arial;
                                                         FontSize=9;
                                                         SourceExpr=Cabecera."Cod. Divisa" }
            { 1103355039;TextBox;3600 ;5076 ;2250 ;423  ;HorzAlign=Left;
                                                         FontName=Arial;
                                                         FontSize=9;
                                                         SourceExpr=Cabecera."Fecha salida" }
            { 1103355040;Label  ;0    ;5076 ;3450 ;423  ;VertAlign=Bottom;
                                                         FontName=Arial;
                                                         FontSize=9;
                                                         FontBold=Yes;
                                                         LeaderDots=Yes;
                                                         CaptionML=[ENU=Check-out Date;
                                                                    ESP=Fecha salida] }
          }
           }
        { PROPERTIES
          {
            SectionType=Footer;
            PlaceInBottom=Yes;
            SectionWidth=18300;
            SectionHeight=2538;
            OnPreSection=BEGIN
                           IF LinImporIVA.FIND('-') THEN
                             wTextoImpuestos := STRSUBSTNO(Text002, LinImporIVA."VAT %");
                         END;

          }
          CONTROLS
          {
            { 1100244061;TextBox;1950 ;1692 ;7980 ;423  ;FontName=Arial;
                                                         FontSize=9;
                                                         CaptionML=[ENU=Payment terms;
                                                                    ESP=T‚rminos pago];
                                                         SourceExpr=rBanco.IBAN }
            { 1100244067;Label  ;0    ;1692 ;1800 ;423  ;FontName=Arial;
                                                         LeaderDots=Yes;
                                                         CaptionML=[ENU=IBAN;
                                                                    ESP=IBAN] }
            { 1100244066;Label  ;0    ;1269 ;1800 ;423  ;FontName=Arial;
                                                         LeaderDots=Yes;
                                                         CaptionML=[ENU=Swift;
                                                                    ESP=Swift] }
            { 1100244062;TextBox;1950 ;1269 ;7980 ;423  ;FontName=Arial;
                                                         FontSize=9;
                                                         CaptionML=[ENU=Payment method code;
                                                                    ESP=C¢d. forma pago];
                                                         SourceExpr=rBanco."SWIFT Code" }
            { 1100244060;TextBox;1950 ;846  ;7980 ;423  ;FontName=Arial;
                                                         FontSize=9;
                                                         CaptionML=[ENU=Payment method code;
                                                                    ESP=C¢d. forma pago];
                                                         SourceExpr=rBanco."CCC No." }
            { 1100244065;Label  ;0    ;846  ;1800 ;423  ;FontName=Arial;
                                                         LeaderDots=Yes;
                                                         CaptionML=[ENU=G/L Account No.;
                                                                    ESP=N§ cuenta] }
            { 1100244064;Label  ;0    ;423  ;1800 ;423  ;FontName=Arial;
                                                         LeaderDots=Yes;
                                                         CaptionML=[ENU=Bank;
                                                                    ESP=Banco] }
            { 1100244055;TextBox;1950 ;423  ;7980 ;423  ;FontName=Arial;
                                                         FontSize=9;
                                                         CaptionML=[ENU=Payment terms;
                                                                    ESP=T‚rminos pago];
                                                         SourceExpr=rBanco.Name }
            { 1100244058;Shape  ;0    ;0    ;18300;423  ;BorderWidth=2pt;
                                                         ShapeStyle=HorzLine }
            { 1103355016;Label  ;0    ;2115 ;1800 ;423  ;FontName=Arial;
                                                         LeaderDots=Yes;
                                                         CaptionML=[ENU=ABA;
                                                                    ESP=ABA] }
            { 1103355029;TextBox;1950 ;2115 ;7980 ;423  ;HorzAlign=Left;
                                                         FontName=Arial;
                                                         FontSize=9;
                                                         CaptionML=[ENU=Payment terms;
                                                                    ESP=T‚rminos pago];
                                                         SourceExpr=rBanco.ABA }
            { 1103355030;Label  ;10350;846  ;4050 ;423  ;VertAlign=Bottom;
                                                         FontName=Arial;
                                                         FontSize=9;
                                                         FontBold=Yes;
                                                         LeaderDots=Yes;
                                                         CaptionML=[ENU=Balance;
                                                                    ESP=Saldo] }
            { 1103355031;TextBox;14550;846  ;2700 ;423  ;FontName=Arial;
                                                         FontSize=9;
                                                         SourceExpr=wImportePrepagos - wImporte }
            { 1103355036;TextBox;17400;846  ;900  ;423  ;FontName=arial;
                                                         FontSize=9;
                                                         SourceExpr=Cabecera."Cod. Divisa" }
          }
           }
      }
       }
    { PROPERTIES
      {
        DataItemIndent=3;
        DataItemTable=Table7009867;
        DataItemTableView=SORTING(Num. Proforma,Num. Linea);
        DataItemVarName=Lineas;
        OnAfterGetRecord=BEGIN
                           wDescripcion := Lineas.Descripcion;
                         END;

        OnPostDataItem=BEGIN

                         wImporte := Importe;
                       END;

        TotalFields=Importe;
        DataItemLinkReference=Cabecera;
        DataItemLink=Num. Proforma=FIELD(Num. Proforma);
      }
      SECTIONS
      {
        { PROPERTIES
          {
            SectionType=Body;
            SectionWidth=18300;
            SectionHeight=423;
          }
          CONTROLS
          {
            { 1103355002;TextBox;3900 ;0    ;3450 ;423  ;FontName=Arial;
                                                         FontSize=9;
                                                         SourceExpr=wDescripcion }
            { 1103355004;TextBox;14400;0    ;2850 ;423  ;FontName=Arial;
                                                         FontSize=9;
                                                         SourceExpr=Importe }
            { 1103355005;TextBox;2250 ;0    ;1500 ;423  ;FontName=arial;
                                                         FontSize=9;
                                                         SourceExpr="Tipo producto" }
            { 1103355011;TextBox;0    ;0    ;2100 ;423  ;FontName=arial;
                                                         FontSize=9;
                                                         SourceExpr=Bono }
            { 1103355017;TextBox;7500 ;0    ;4350 ;423  ;FontName=arial;
                                                         FontSize=9;
                                                         CaptionML=[ENU=Hotel;
                                                                    ESP=Hotel];
                                                         SourceExpr=cNom.nom_hotel(Lineas."Cod. Hotel") }
            { 1103355003;TextBox;13500;0    ;750  ;423  ;FontName=Arial;
                                                         FontSize=9;
                                                         DecimalPlaces=0:2;
                                                         SourceExpr=Lineas.Estancia }
            { 1103355024;TextBox;12000;0    ;600  ;423  ;FontName=arial;
                                                         FontSize=9;
                                                         SourceExpr=Adultos }
            { 1103355025;TextBox;12750;0    ;600  ;423  ;FontName=arial;
                                                         FontSize=9;
                                                         SourceExpr=Ni¤os }
          }
           }
        { PROPERTIES
          {
            SectionType=Body;
            SectionWidth=18300;
            SectionHeight=846;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT(Lineas."Tipo producto" = Lineas."Tipo producto"::Hotel);
                         END;

          }
          CONTROLS
          {
            { 1103355026;Label  ;2250 ;0    ;1950 ;423  ;VertAlign=Bottom;
                                                         FontName=Arial;
                                                         FontSize=9;
                                                         FontBold=Yes;
                                                         LeaderDots=Yes;
                                                         CaptionML=[ENU=Room;
                                                                    ESP=Habitacion] }
            { 1103355013;TextBox;4350 ;0    ;6000 ;423  ;FontName=arial;
                                                         FontSize=9;
                                                         SourceExpr=FORMAT(Lineas."N§ Habitaciones") + ' x ' + Lineas.Habitacion + ' ' + DescHabitacion2(Cabecera, Lineas) }
            { 1103355027;Label  ;10500;0    ;1650 ;423  ;VertAlign=Bottom;
                                                         FontName=Arial;
                                                         FontSize=9;
                                                         FontBold=Yes;
                                                         LeaderDots=Yes;
                                                         CaptionML=[ENU=Board;
                                                                    ESP=Regimen] }
            { 1103355028;TextBox;12300;0    ;4950 ;423  ;FontName=arial;
                                                         FontSize=9;
                                                         SourceExpr=Regimen + ' ' + cNom.nom_regimen(Regimen) }
          }
           }
        { PROPERTIES
          {
            SectionType=TransFooter;
            SectionWidth=18300;
            SectionHeight=846;
          }
          CONTROLS
          {
            { 1100244068;Label  ;10350;423  ;4050 ;423  ;VertAlign=Bottom;
                                                         FontName=Arial;
                                                         FontSize=9;
                                                         FontBold=Yes;
                                                         LeaderDots=Yes;
                                                         CaptionML=[ENU=Sum and continue;
                                                                    ESP=Suma y sigue] }
            { 1100244069;TextBox;14550;423  ;2700 ;423  ;FontName=Arial;
                                                         FontSize=9;
                                                         SourceExpr=Importe }
          }
           }
      }
       }
    { PROPERTIES
      {
        DataItemIndent=4;
        DataItemTable=Table2000000026;
        DataItemTableView=SORTING(Number)
                          WHERE(Number=FILTER(1..));
        DataItemVarName=Personas;
        OnPreDataItem=BEGIN
                        CLEAR(rResHotel);
                        CLEAR(rResTra);

                        CASE Lineas."Tipo producto" OF

                          Lineas."Tipo producto"::Hotel: BEGIN
                            rResHotel.SETCURRENTKEY(TourOperador, Bono, Nombre);
                            rResHotel.SETRANGE("TourOperador Venta", Cabecera.Touroperador);
                            rResHotel.SETRANGE(Bono                , Lineas.Bono);
                            rResHotel.SETRANGE("N§ Responsable"    , Lineas."Num. Reserva");
                          END;

                          Lineas."Tipo producto"::Transfer: BEGIN
                            rResTra.SETCURRENTKEY(Bono, "Fecha entrada", "Fecha salida");
                            rResTra.SETRANGE(Bono, Lineas.Bono);
                          END;

                        END;
                      END;

        OnAfterGetRecord=BEGIN
                           CASE Lineas."Tipo producto" OF

                             Lineas."Tipo producto"::Hotel:BEGIN

                               IF Number = 1 THEN BEGIN
                                 IF NOT rResHotel.FINDSET THEN
                                   CurrReport.BREAK
                               END
                               ELSE
                                 IF rResHotel.NEXT = 0 THEN
                                   CurrReport.BREAK;

                               wNombre      := rResHotel.Nombre;
                               wEdad        := rResHotel.Edad;
                               wTipoPersona := rResHotel."Tipo Persona";

                             END;

                             Lineas."Tipo producto"::Transfer:BEGIN

                               IF Number = 1 THEN BEGIN
                                 IF NOT rResTra.FINDSET THEN
                                   CurrReport.BREAK
                               END
                               ELSE
                                 IF rResTra.NEXT = 0 THEN
                                   CurrReport.BREAK;


                               wNombre      := rResTra.Nombre;
                               wEdad        := rResTra.Edad;
                               wTipoPersona := rResTra."Tipo Persona";

                             END;

                             ELSE
                               CurrReport.BREAK;
                           END;
                         END;

      }
      SECTIONS
      {
        { PROPERTIES
          {
            SectionType=Header;
            SectionWidth=18300;
            SectionHeight=423;
          }
          CONTROLS
          {
            { 1103355007;Label  ;3900 ;0    ;7350 ;423  ;ParentControl=1103355001;
                                                         VertAlign=Bottom;
                                                         FontName=arial;
                                                         FontSize=9;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=[ENU=Names;
                                                                    ESP=Nombres] }
            { 1103355009;Label  ;2250 ;0    ;1500 ;423  ;ParentControl=1103355008;
                                                         VertAlign=Bottom;
                                                         FontName=arial;
                                                         FontSize=9;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=[ENU=Type;
                                                                    ESP=Tipo] }
            { 1103355021;Label  ;11400;0    ;1500 ;423  ;ParentControl=1103355010;
                                                         VertAlign=Bottom;
                                                         FontName=arial;
                                                         FontSize=9;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=[ENU=Age;
                                                                    ESP=Edad] }
          }
           }
        { PROPERTIES
          {
            SectionType=Body;
            SectionWidth=18300;
            SectionHeight=423;
          }
          CONTROLS
          {
            { 1103355001;TextBox;3900 ;0    ;7350 ;423  ;VertAlign=Bottom;
                                                         FontName=arial;
                                                         FontSize=9;
                                                         SourceExpr=wNombre }
            { 1103355008;TextBox;2250 ;0    ;1500 ;423  ;VertAlign=Bottom;
                                                         FontName=arial;
                                                         FontSize=9;
                                                         SourceExpr=wTipoPersona }
            { 1103355010;TextBox;11400;0    ;1500 ;423  ;HorzAlign=Right;
                                                         VertAlign=Bottom;
                                                         FontName=arial;
                                                         FontSize=9;
                                                         BlankZero=Yes;
                                                         SourceExpr=wEdad }
          }
           }
        { PROPERTIES
          {
            SectionType=Footer;
            SectionWidth=18300;
            SectionHeight=423;
          }
          CONTROLS
          {
          }
           }
      }
       }
    { PROPERTIES
      {
        DataItemIndent=3;
        DataItemTable=Table7009868;
        DataItemTableView=SORTING(Estado)
                          WHERE(Estado=CONST(Registrado));
        DataItemVarName=Prepagos;
        OnPostDataItem=BEGIN

                         wImportePrepagos := Importe;
                       END;

        TotalFields=Importe;
        DataItemLinkReference=Cabecera;
        DataItemLink=Num. Proforma=FIELD(Num. Proforma);
      }
      SECTIONS
      {
        { PROPERTIES
          {
            SectionType=Footer;
            SectionWidth=18300;
            SectionHeight=1692;
          }
          CONTROLS
          {
            { 1103355032;Label  ;10350;423  ;4050 ;423  ;VertAlign=Bottom;
                                                         FontName=Arial;
                                                         FontSize=9;
                                                         FontBold=Yes;
                                                         LeaderDots=Yes;
                                                         CaptionML=[ENU=Total Pro - Form;
                                                                    ESP=Total Proforma] }
            { 1103355033;TextBox;14550;423  ;2700 ;423  ;FontName=Arial;
                                                         FontSize=9;
                                                         SourceExpr=wImporte }
            { 1103355034;Label  ;10350;846  ;4050 ;423  ;VertAlign=Bottom;
                                                         FontName=Arial;
                                                         FontSize=9;
                                                         FontBold=Yes;
                                                         LeaderDots=Yes;
                                                         CaptionML=[ENU=Total Advanced payments;
                                                                    ESP=Total Prepagos] }
            { 1103355035;TextBox;14550;846  ;2700 ;423  ;FontName=Arial;
                                                         FontSize=9;
                                                         SourceExpr=Importe }
            { 1103355019;TextBox;17400;423  ;900  ;423  ;FontName=arial;
                                                         FontSize=9;
                                                         SourceExpr=Cabecera."Cod. Divisa" }
            { 1103355020;TextBox;17400;846  ;900  ;423  ;FontName=arial;
                                                         FontSize=9;
                                                         SourceExpr=Cabecera."Cod. Divisa" }
          }
           }
      }
       }
  }
  REQUESTFORM
  {
    PROPERTIES
    {
      Width=9020;
      Height=3410;
      CaptionML=[ENU=Pro-Forma;
                 ESP=Proforma];
      OnOpenForm=BEGIN
                   wNumCopias := 1;
                 END;

    }
    CONTROLS
    {
      { 1100244000;TextBox;3190 ;220  ;770  ;440  ;CaptionML=[ENU=Printed copies;
                                                              ESP=Copias impresas];
                                                   SourceExpr=wNumCopias }
      { 1100244001;Label  ;220  ;220  ;2860 ;440  ;ParentControl=1100244000;
                                                   CaptionML=[ENU=Printed copies;
                                                              ESP=Copias impresas] }
      { 1103355000;CheckBox;3190;880  ;440  ;440  ;Name=Imp_Vouchers;
                                                   ShowCaption=No;
                                                   CaptionML=[ENU=Imp_Vouchers;
                                                              ESP=Imp_Vouchers];
                                                   SourceExpr=wImpVouchers }
      { 1103355001;Label  ;220  ;880  ;2860 ;440  ;ParentControl=1103355000;
                                                   CaptionML=[ENU=Print Vouchers;
                                                              ESP=Imprimir Vouchers] }
    }
  }
  REQUESTPAGE
  {
    PROPERTIES
    {
    }
    CONTROLS
    {
    }
  }
  CODE
  {
    VAR
      FormatDire@1100244005 : Codeunit 365;
      cNom@1100244011 : Codeunit 7009702;
      cVarias@1103355014 : Codeunit 7009720;
      InfoEmpresa@1100244019 : Record 79;
      rCust@1100244008 : Record 18;
      rMovCli@1100244010 : Record 21;
      rCabVenta@1100244009 : Record 36;
      rCodExtra@1100244012 : Record 7009760;
      LinImporIVA@1100244015 : Record 290;
      ConfGrupContabl@1100244016 : Record 325;
      rComentFiltro@1103355000 : Record 44;
      rCabAbo@1103355001 : Record 114;
      rBanco@1103355011 : Record 270;
      rBancoCli@1103355004 : Record 287;
      rResHotel@1103355005 : Record 7009743;
      rResTra@1103355006 : Record 7009744;
      DirClie@1100244004 : ARRAY [8] OF Text[50];
      wTextoCopias@1100244002 : Text[30];
      wTipodocumento@1100244001 : Text[30];
      wTextoImpuestos@1100244017 : Text[50];
      wNumDocumento@1100244003 : Code[20];
      wCIFNIF@1100244007 : Code[20];
      wNumCopias@1100244000 : Integer;
      wFechaVencimiento@1100244006 : Date;
      Text001@1100244013 : TextConst 'ENU=Handling Booking;ESP=Handling reserva';
      wPrimerComentario@1100244014 : Boolean;
      Text002@1100244018 : TextConst 'ENU=Applied type %1 %, tax amount;ESP=Tipo aplicado %1 %, Cuota impuestos';
      wDescripcion@1103355002 : Text[50];
      wImporte@1103355003 : Decimal;
      wTipoPersona@1103355007 : Code[10];
      wEdad@1103355008 : Integer;
      wNombre@1103355009 : Text[50];
      wImportePrepagos@1103355010 : Decimal;
      wImpVouchers@1103355012 : Boolean;
      wTieneBanco@1103355013 : Boolean;

    LOCAL PROCEDURE DescHabitacion@1103355002(VAR prCabecera@1103355001 : Record 7009866;VAR prLinea@1103355000 : Record 7009867) rvDesc : Text[60];
    VAR
      lrResHotel@1103355002 : Record 7009743;
      lrConvHab@1103355003 : Record 7009731;
    BEGIN
      // DescHabitacion

      lrResHotel.SETCURRENTKEY(Responsable, TourOperador, Bono, "N§ Responsable", "N§ Periodo");

      lrResHotel.SETRANGE(Responsable , TRUE);
      lrResHotel.SETRANGE(Bono        , prLinea.Bono);
      lrResHotel.SETRANGE("TourOperador Venta", prCabecera.Touroperador);

      IF lrResHotel.FINDFIRST THEN BEGIN
        lrConvHab.SETRANGE(Delegacion       , lrResHotel.Delegacion);
        lrConvHab.SETRANGE("N§ Contrato"    , lrResHotel."Contrato compra");
        lrConvHab.SETRANGE("Tipo contrato"  , lrConvHab."Tipo contrato"::Compra);

        IF  lrResHotel."Habitacion TO" <> '' THEN
          lrConvHab.SETRANGE("Habitacion TO"  , lrResHotel."Habitacion TO")
        ELSE
          lrConvHab.SETRANGE("Habitacion cupo", lrResHotel.Habitacion);

        IF lrConvHab.FINDFIRST THEN
          EXIT(lrConvHab.Descripcion);
      END;

      EXIT('');
    END;

    LOCAL PROCEDURE DescHabitacion2@1103355003(VAR prCabecera@1103355001 : Record 7009866;VAR prLinea@1103355000 : Record 7009867) rvDesc : Text[60];
    VAR
      lrResHotel@1103355002 : Record 7009743;
      lrConvHab@1103355003 : Record 7009731;
    BEGIN
      // DescHabitacion2
      // JPT 16/04/09

      IF prLinea."Tipo producto" = prLinea."Tipo producto"::Hotel THEN BEGIN
        CLEAR(lrResHotel);
        lrResHotel.SETRANGE("N§ Reserva", prLinea."Num. Reserva");

        IF lrResHotel.FINDFIRST THEN BEGIN
          lrConvHab.SETRANGE(Delegacion       , lrResHotel.Delegacion);
          lrConvHab.SETRANGE("N§ Contrato"    , lrResHotel."Contrato compra");
          lrConvHab.SETRANGE("Tipo contrato"  , lrConvHab."Tipo contrato"::Compra);
          lrConvHab.SETRANGE("Habitacion cupo", prLinea.Habitacion);

          IF lrConvHab.FINDFIRST THEN
            EXIT(lrConvHab.Descripcion);
        END;
      END;
    END;

    PROCEDURE SetParametros@1103355000(pwImpVouchers@1103355000 : Boolean;pwActOpVouchers@1103355001 : Boolean);
    BEGIN
      // SetParametros

      wImpVouchers := pwImpVouchers;
      RequestOptionsForm.Imp_Vouchers.ENABLED := pwActOpVouchers;
    END;

    PROCEDURE GetParametros@1103355001() : Boolean;
    BEGIN
      EXIT(wImpVouchers);
    END;

    PROCEDURE ImprimirDocs@1103355004();
    VAR
      lrPar@1103355000 : Record 7009700;
    BEGIN
      // ImprimirDocs
      lrPar.FINDFIRST;
      // me aseguro que la direcci¢n tenga la barra final
      cVarias.ImprimirDirectorio(DELCHR(lrPar."Carpeta Docs Proforma" , '>', '\') + '\');
    END;

    BEGIN
    {
      // AJS 07.09.2007
      // Los comentarios se perdian al registrarse la factura porque al imprimir filtrabamos por el numero de factura en borrador

      // AJS 10.09.2007
      // En la impresion de prefacturas no hay comentarios

      $001 AJS 28102014 Amplio la variable wNombre a Text50
    }
    END.
  }
  RDLDATA
  {
  }
}
