OBJECT Report 7010319 Estad¡sticas Vehiculos
{
  OBJECT-PROPERTIES
  {
    Date=16/10/09;
    Time=12:34:25;
    Version List=TRANSFER;
  }
  PROPERTIES
  {
    CaptionML=ESP=Estad¡sticas Vehiculos;
    ShowPrintStatus=Yes;
    UseReqForm=Yes;
    LeftMargin=1500;
    RightMargin=0;
    Orientation=Landscape;
  }
  DATAITEMS
  {
    { PROPERTIES
      {
        DataItemTable=Table2000000026;
        DataItemTableView=SORTING(Number)
                          ORDER(Ascending);
        MaxIteration=1;
        DataItemVarName=Cabecera;
        OnAfterGetRecord=VAR
                           cFunBas@1100244000 : Codeunit 7010310;
                         BEGIN
                           //Calcularemos las Agrupaciones que tenemos que poner en el campo Agrupacion de la
                           //Tabla Seleccion Vehiculo.
                           IF vTipoAgrupacion=vTipoAgrupacion::"Grupo Veh¡culos" THEN
                             Agrupar1()
                           ELSE
                             Agrupar2();

                           vTipoLinea   := cFunBas.Tipo_Lineas_Estadisticas;
                           vTipoElemento:= cFunBas.MaletasyEstadisticas;

                           COMMIT;
                         END;

      }
      SECTIONS
      {
      }
       }
    { PROPERTIES
      {
        DataItemTable=Table7010352;
        DataItemTableView=SORTING(Usuario,Garaje,Agrupacion,Numero)
                          ORDER(Ascending);
        NewPagePerGroup=No;
        DataItemVarName=SelVehiculo;
        PrintOnlyIfDetail=No;
        OnPreDataItem=VAR
                        rPar@1100244000 : Record 7010311;
                        rAuxSelVeh@1100244001 : Record 7010352;
                        cFunBas@1100244002 : Codeunit 7010310;
                      BEGIN
                        // calculo el primer y ultimo dia del mes que ha seleccionado el usuario.
                        // Hacemos vMes+1, porque si vMes=0 corresponde a Enero.
                        vIniMes  := DMY2DATE(1,vMes+1,vA¤o);
                        vFinMes  := cFunBas.ldom(vIniMes,0);
                        vFinAcum := vFinMes;


                        //CREAREMOS EL FILTRO APROPIADO.
                        //....................................................................
                        //....................................................................
                        rPar.FINDFIRST;

                        IF vGarajeResult = rPar."Todos los garajes" THEN
                          vGarajeResult := '';

                        RESET;
                        SETCURRENTKEY(Usuario,Garaje,Agrupacion,Numero);
                        SETRANGE(Usuario,USERID);
                        IF (vGaraje<>'') AND (vGaraje<>rPar."Todos los garajes") THEN BEGIN
                          SETRANGE(Garaje,vGaraje);
                          vFltGaraje:=vGaraje
                        END
                        ELSE
                          vFltGaraje:=Text000;

                        //Para saber donde se aplicar  el c lculo.
                        IF vGarajeResult = '' THEN
                          vFltGarajeResult := Text000
                        ELSE
                          vFltGarajeResult := vGarajeResult;

                        //Si agrupamos por plazas no mostraremos los vehiculos que se hayan quedado sin c¢digo
                        //de agrupaci¢n.
                        IF vAgrupacionporPlazas THEN
                          SETFILTER(Agrupacion,'<>%1','');  //Por si las moscas.

                        //Comprobaremos que no est‚ en la lista de vehiculos seleccionados.
                        IF vVehiculos=vVehiculos::"Seg£n Selecci¢n" THEN
                          SETRANGE(Seleccion,TRUE);

                        //Comprobaremos si queremos ver s¢lo los vehiculos ajenos o propios.
                        IF vPropiedad<>vPropiedad::Todos THEN BEGIN
                          IF vPropiedad=vPropiedad::"S¢lo Propios" THEN
                            SETRANGE("Vehiculo propio",TRUE)
                          ELSE
                            SETRANGE("Vehiculo propio",FALSE)
                        END;

                        IF NOT vVerBloqueados THEN
                          SETRANGE(Bloqueado,FALSE);

                        //....................................................................
                        IF vSoloConActividad THEN BEGIN
                          rAuxSelVeh.RESET;
                          rAuxSelVeh.COPYFILTERS(SelVehiculo);
                          TestActividad(rAuxSelVeh);
                          SETRANGE(Actividad,TRUE);
                        END;

                        //....................................................................
                        //FIN. SELECCION DEL FILTRO.

                        //Hacemos una comprobaci¢n.
                        SETRANGE(Plazas,0);
                        IF COUNT > 0 THEN
                          ERROR(Text001);
                        SETRANGE(Plazas);

                        //Precision de la Divisa Local.
                        vPrecision:= cFunBas.ObtenerPrecisionDivisa(vDivisa);

                        //Inicializacion de Variables.
                        vTotalPlazasGrupo := 0;
                        vNumeroTotalPlazas:= 0;
                        vNumTotalVehiculos:= 0;
                        vAntGaraje:='';
                      END;

        OnAfterGetRecord=BEGIN

                           vTotalPlazasGrupo  := vTotalPlazasGrupo+SelVehiculo.Plazas;
                           vNumeroTotalPlazas := vNumeroTotalPlazas+SelVehiculo.Plazas;

                           //Si estamos tratando un garaje diferente, provocaremos un salto de p gina.
                           IF (vAntGaraje<>'') AND (vAntGaraje<>SelVehiculo.Garaje) THEN
                             CurrReport.NEWPAGE;
                           IF vAntGaraje<> SelVehiculo.Garaje THEN
                             vAntGaraje:=SelVehiculo.Garaje;
                         END;

        GroupTotalFields=Agrupacion;
      }
      SECTIONS
      {
        { PROPERTIES
          {
            SectionType=Header;
            PrintOnEveryPage=Yes;
            SectionWidth=25650;
            SectionHeight=2538;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT(vMostrarDetalle OR vAgrupacionporPlazas);
                         END;

          }
          CONTROLS
          {
            { 1   ;Label        ;0    ;0    ;5250 ;423  ;FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Estadisticas de vehiculos }
            { 2   ;TextBox      ;22500;0    ;3150 ;423  ;HorzAlign=Right;
                                                         SourceExpr=FORMAT(TODAY,0,4) }
            { 3   ;TextBox      ;0    ;423  ;5250 ;423  ;SourceExpr=COMPANYNAME }
            { 4   ;TextBox      ;25200;423  ;450  ;423  ;CaptionML=ESP=P gina;
                                                         SourceExpr=CurrReport.PAGENO }
            { 5   ;Label        ;24450;423  ;750  ;423  ;ParentControl=4 }
            { 6   ;TextBox      ;23400;846  ;2250 ;423  ;HorzAlign=Right;
                                                         SourceExpr=USERID }
            { 8   ;TextBox      ;8850 ;846  ;2850 ;423  ;VertAlign=Bottom;
                                                         SourceExpr=vFltGaraje }
            { 9   ;Label        ;5700 ;846  ;3000 ;423  ;ParentControl=8;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=ESP=Filtro Garaje }
            { 36  ;Label        ;0    ;846  ;3000 ;423  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=ESP=Mes Pedido }
            { 38  ;TextBox      ;3150 ;846  ;2100 ;423  ;SourceExpr=FORMAT(vMes)+Text002+FORMAT(vA¤o) }
            { 50  ;Label        ;5400 ;846  ;150  ;423  ;CaptionML=ESP=/ }
            { 56  ;Label        ;11850;846  ;150  ;423  ;CaptionML=ESP=/ }
            { 57  ;Label        ;5700 ;423  ;3000 ;423  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=ESP=Garaje Actual }
            { 60  ;TextBox      ;8850 ;423  ;2850 ;423  ;VertAlign=Bottom;
                                                         SourceExpr=SelVehiculo.Garaje }
            { 17  ;TextBox      ;3150 ;1269 ;2100 ;423  ;VertAlign=Bottom;
                                                         SourceExpr=vTipoAgrupacion }
            { 82  ;Label        ;0    ;1269 ;3000 ;423  ;ParentControl=17;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=ESP=Tipo Agrupacion }
            { 83  ;Label        ;5700 ;1269 ;3000 ;423  ;ParentControl=90;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=ESP=Selecci¢n Vehiculos }
            { 90  ;TextBox      ;8850 ;1269 ;2850 ;423  ;VertAlign=Bottom;
                                                         SourceExpr=vVehiculos }
            { 91  ;Label        ;5400 ;1269 ;150  ;423  ;CaptionML=ESP=/ }
            { 102 ;Label        ;12150;1269 ;5100 ;423  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=ESP=S¢lo Vehiculos con Actividad }
            { 190 ;Label        ;11850;1269 ;150  ;423  ;CaptionML=ESP=/ }
            { 191 ;TextBox      ;17400;1269 ;2850 ;423  ;VertAlign=Bottom;
                                                         SourceExpr=vSoloConActividad }
            { 194 ;Label        ;12150;846  ;5100 ;423  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=ESP=Garaje a considerar en resultados }
            { 195 ;TextBox      ;17400;846  ;2850 ;423  ;VertAlign=Bottom;
                                                         SourceExpr=vFltGarajeResult }
            { 210 ;Label        ;5400 ;423  ;150  ;423  ;CaptionML=ESP=/ }
            { 215 ;Label        ;11850;423  ;150  ;423  ;CaptionML=ESP=/ }
            { 233 ;Label        ;12150;423  ;5100 ;423  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=ESP=Filtro Propiedad del Vehiculo }
            { 234 ;TextBox      ;17400;423  ;2850 ;423  ;VertAlign=Bottom;
                                                         SourceExpr=vPropiedad }
            { 14  ;TextBox      ;3150 ;1692 ;1050 ;423  ;VertAlign=Bottom;
                                                         SourceExpr=vVerBloqueados }
            { 237 ;Label        ;0    ;1692 ;3000 ;423  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=ESP=Ver Bloqueados }
            { 238 ;Shape        ;0    ;2115 ;25650;423  ;ShapeStyle=HorzLine }
            { 239 ;TextBox      ;8850 ;1692 ;2850 ;423  ;VertAlign=Bottom;
                                                         SourceExpr=vDivisa }
            { 240 ;Label        ;5700 ;1692 ;3000 ;423  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=ESP=C¢d. Divisa }
            { 241 ;Label        ;5400 ;1692 ;150  ;423  ;CaptionML=ESP=/ }
          }
           }
        { PROPERTIES
          {
            SectionType=Header;
            PrintOnEveryPage=Yes;
            SectionWidth=25650;
            SectionHeight=846;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT(vMostrarDetalle OR vAgrupacionporPlazas);
                         END;

          }
          CONTROLS
          {
            { 18  ;Label        ;750  ;0    ;1500 ;846  ;HorzAlign=Center;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=ESP=Numero Vehiculo }
            { 21  ;Label        ;2400 ;0    ;1200 ;846  ;ParentControl=20;
                                                         HorzAlign=Center;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=ESP=N§ Plazas }
            { 19  ;Label        ;8550 ;0    ;2700 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Viajes }
            { 22  ;Label        ;8550 ;423  ;1050 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Mes }
            { 29  ;Label        ;9900 ;423  ;1350 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Acum }
            { 30  ;Label        ;11400;0    ;2700 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Pax Transpor. }
            { 31  ;Label        ;12900;423  ;1200 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Acum }
            { 32  ;Label        ;11400;423  ;1350 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Mes }
            { 33  ;Label        ;4650 ;0    ;3600 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Facturacion }
            { 34  ;Label        ;4650 ;423  ;1650 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Mes }
            { 35  ;Label        ;6450 ;423  ;1800 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Acum }
            { 40  ;Label        ;14250;0    ;2700 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Pax Facturados }
            { 41  ;Label        ;14250;423  ;1200 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Mes }
            { 42  ;Label        ;15600;423  ;1350 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Acum }
            { 43  ;Label        ;17100;0    ;2100 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=% Ocupacion }
            { 44  ;Label        ;17100;423  ;900  ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Mes }
            { 45  ;Label        ;18150;423  ;1050 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Acum }
            { 37  ;Label        ;19650;0    ;1650 ;846  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=ESP=Ingr. x But Acum. }
            { 62  ;Label        ;21750;0    ;2100 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=ESP=Pax / Viaje }
            { 99  ;Label        ;21750;423  ;900  ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Mes }
            { 100 ;Label        ;22800;423  ;1050 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Acum }
          }
           }
        { PROPERTIES
          {
            SectionType=Body;
            SectionWidth=25650;
            SectionHeight=0;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT(vMostrarDetalle);
                         END;

          }
          CONTROLS
          {
          }
           }
        { PROPERTIES
          {
            SectionType=GroupFooter;
            SectionWidth=25650;
            SectionHeight=423;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT(vAgrupacionporPlazas);
                         END;

            OnPostSection=BEGIN
                            vTotalPlazasGrupo:=0;

                            //Inicializamos las matrices para el siguiente grupo de vehiculos.
                            Inicializar(vPaxTransMes[1]);
                            Inicializar(vPaxTransAcum[1]);
                            vPaxTransTot[2] := 0;
                            vPaxTransTotAcum[2] := 0;

                            Inicializar(vViajesMes[1]);
                            Inicializar(vViajesAcum[1]);
                            vViajesTot[2]:=0;
                            vViajesTotAcum[2]:=0;

                            // Para los datos de la facturaci¢n.
                            Inicializar(vPaxFactMes[1]);
                            Inicializar(vPaxFactAcum[1]);
                            vPaxFactTot[2] := 0;
                            vPaxFactTotAcum[2] := 0;

                            Inicializar(vFactMes[1]);
                            Inicializar(vFactAcum[1]);
                            vFactTot[2]:=0;
                            vFactTotAcum[2]:=0;
                          END;

          }
          CONTROLS
          {
            { 260 ;Shape        ;4650 ;0    ;19200;423  ;ShapeStyle=HorzLine }
          }
           }
      }
       }
    { PROPERTIES
      {
        DataItemIndent=1;
        DataItemTable=Table7010319;
        DataItemTableView=SORTING(Orden Listado)
                          ORDER(Ascending);
        DataItemVarName=Tipo Servicio;
        OnPreDataItem=BEGIN
                        ContaTS := 1;
                        //Inicializar las matrices que tienen el valor TOTAL para cada vehiculo.
                        vViajesTot[1]:=0;
                        vViajesTotAcum[1]:=0;
                        vPaxTransTot[1]:=0;
                        vPaxTransTotAcum[1]:=0;

                        vFactTot[1]:=0;
                        vFactTotAcum[1]:=0;
                        vPaxFactTot[1]:=0;
                        vPaxFactTotAcum[1]:=0;

                        vOldPlazas  :='';
                        vOldNumero  :='';
                        vTextoNormal:='';
                      END;

        OnAfterGetRecord=VAR
                           vMesViajes@1100244000 : Decimal;
                           vMesPaxTrans@1100244001 : Decimal;
                           vMesCantFact@1100244002 : Decimal;
                           vMesPaxFact@1100244003 : Decimal;
                           vAcuViajes@1100244004 : Decimal;
                           vAcuPaxTrans@1100244005 : Decimal;
                           vAcuCantFact@1100244006 : Decimal;
                           vAcuPaxFact@1100244007 : Decimal;
                           rVeh@1100244008 : Record 7010346;
                           ERROR_INCONSISTENCIA@1100244009 : TextConst 'ESP=Inconsitencia detectada en la selecci¢n de vehiculos';
                           cFunBas@1100244010 : Codeunit 7010310;
                         BEGIN
                           //El siguiente c¢digo es para que el n§vehiculo y de plazas no se repita en cada linea.
                           IF (vOldPlazas<>SelVehiculo.Agrupacion) AND (vOldNumero<>SelVehiculo.Numero) THEN BEGIN
                             vTextoNormal := FORMAT(SelVehiculo.Numero,10)+'    '+FORMAT(SelVehiculo.Plazas);
                             vOldPlazas   := SelVehiculo.Agrupacion;
                             vOldNumero   := SelVehiculo.Numero;
                           END
                           ELSE BEGIN
                             vTextoNormal:= '';
                           END;


                           ContaTS := ContaTS + 1;

                           //Calculamos los acumulados del periodo especificado (en principio 1 mes)

                           rVeh.RESET;
                           rVeh.SETCURRENTKEY(Matricula);
                           rVeh.SETRANGE(Matricula,SelVehiculo.Matricula);
                           rVeh.SETRANGE("Filtro Fecha",vIniMes,vFinMes);
                           rVeh.SETRANGE("Filtro Servicio",Codigo);
                           IF vGarajeResult<>'' THEN
                             rVeh.SETRANGE("Filtro Garaje Resultados",vGarajeResult);

                           IF vTipoLinea<>'' THEN
                             rVeh.SETFILTER("Filtro Tipo Linea",vTipoLinea);

                           IF vTipoElemento<>'' THEN
                             rVeh.SETFILTER("Filtro Tipo elemento",vTipoElemento);


                           IF rVeh.FINDFIRST THEN
                             rVeh.CALCFIELDS("N§ Viajes","AD Transportados","NI Transportados")
                           ELSE
                             ERROR(ERROR_INCONSISTENCIA);

                           vMesViajes   := rVeh."N§ Viajes";
                           vMesPaxTrans := rVeh."AD Transportados" + rVeh."NI Transportados";
                           vMesPaxFact  := rVeh.TotalPaxFacturado;
                           IF vDivisa = '' THEN
                             vMesCantFact := rVeh.TotalCantidadFacturada
                           ELSE
                             vMesCantFact := cFunBas.DLaDESinRedondeo(rVeh.TotalCantidadFacturada,vDivisa,TODAY);


                           //Calculamos la ocupaci¢n.
                           vOcupMes     := ObtenerOcupacion(vMesPaxTrans,rVeh.Plazas*vMesViajes,0.01);

                           //Calculamos los acumulados anuales.
                           rVeh.SETRANGE("Filtro Fecha",vIniAcum,vFinAcum);
                           rVeh.CALCFIELDS("N§ Viajes","AD Transportados","NI Transportados");

                           vAcuViajes   := rVeh."N§ Viajes";
                           vAcuPaxTrans := rVeh."AD Transportados" + rVeh."NI Transportados";
                           vAcuPaxFact  := rVeh.TotalPaxFacturado;

                           IF vDivisa = '' THEN
                             vAcuCantFact := ROUND(rVeh.TotalCantidadFacturada,vPrecision)
                           ELSE
                             vAcuCantFact := cFunBas.CambiarDLaDE(rVeh.TotalCantidadFacturada,vDivisa,TODAY);


                           //Calculamos la ocupaci¢n, considerando los acumulados.
                           vOcupAcum    := ObtenerOcupacion(vAcuPaxTrans,rVeh.Plazas*vAcuViajes,0.01);
                           vIngPorButaca:= ROUND(vAcuCantFact/rVeh.Plazas,vPrecision);

                           //Actualizaremos las matrices con los datos obtenidos.
                           //VIAJES.
                           ActualizarMatrices(vMesViajes,vAcuViajes,ContaTS,vViajesMes,vViajesAcum,
                                              vViajesTot,vViajesTotAcum);
                           //PASAJE TRANSPORTADO.
                           ActualizarMatrices(vMesPaxTrans,vAcuPaxTrans,ContaTS,vPaxTransMes,vPaxTransAcum,
                                              vPaxTransTot,vPaxTransTotAcum);
                           //PASAJE FACTURADO.
                           ActualizarMatrices(vMesPaxFact,vAcuPaxFact,ContaTS,vPaxFactMes,vPaxFactAcum,
                                              vPaxFactTot,vPaxFactTotAcum);
                           //FACTURACION.
                           ActualizarMatrices(vMesCantFact,vAcuCantFact,ContaTS,vFactMes,vFactAcum,
                                              vFactTot,vFactTotAcum);
                         END;

      }
      SECTIONS
      {
        { PROPERTIES
          {
            SectionType=Body;
            SectionWidth=25650;
            SectionHeight=423;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT(vMostrarDetalle);
                         END;

          }
          CONTROLS
          {
            { 12  ;TextBox      ;24150;0    ;1500 ;423  ;SourceExpr=Codigo }
            { 10  ;TextBox      ;8550 ;0    ;1200 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vViajesMes[1,1] }
            { 20  ;TextBox      ;750  ;0    ;2850 ;423  ;HorzAlign=Center;
                                                         SourceExpr=vTextoNormal }
            { 24  ;TextBox      ;9900 ;0    ;1350 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vViajesAcum[1,1] }
            { 25  ;TextBox      ;11400;0    ;1350 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vPaxTransMes[1,1] }
            { 26  ;TextBox      ;12900;0    ;1200 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vPaxTransAcum[1,1] }
            { 46  ;TextBox      ;18150;0    ;1050 ;423  ;SourceExpr=vOcupAcum }
            { 47  ;TextBox      ;17100;0    ;900  ;423  ;SourceExpr=vOcupMes }
            { 132 ;TextBox      ;4650 ;0    ;1650 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=ROUND(vFactMes[1,1],vPrecision) }
            { 145 ;TextBox      ;6450 ;0    ;1800 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=ROUND(vFactAcum[1,1],vPrecision) }
            { 146 ;TextBox      ;14250;0    ;1200 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vPaxFactMes[1,1] }
            { 147 ;TextBox      ;15600;0    ;1350 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vPaxFactAcum[1,1] }
            { 110 ;TextBox      ;19650;0    ;1650 ;423  ;SourceExpr=vIngPorButaca }
            { 218 ;TextBox      ;21750;0    ;900  ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=CalcularMediaPax(vPaxTransMes[1,1],vViajesMes[1,1]) }
            { 221 ;TextBox      ;22800;0    ;1050 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=CalcularMediaPax(vPaxTransAcum[1,1],vViajesAcum[1,1]) }
          }
           }
      }
       }
    { PROPERTIES
      {
        DataItemIndent=1;
        DataItemTable=Table2000000026;
        DataItemTableView=SORTING(Number)
                          ORDER(Ascending);
        MaxIteration=1;
        DataItemVarName=Entero;
        OnAfterGetRecord=BEGIN
                           vOcupMes           := ObtenerOcupacion(vPaxTransTot[1],SelVehiculo.Plazas*vViajesTot[1],0.01);
                           vOcupAcum          := ObtenerOcupacion(vPaxTransTotAcum[1],SelVehiculo.Plazas*vViajesTotAcum[1],0.01);
                           vIngPorButaca      := ROUND(vFactTotAcum[1]/SelVehiculo.Plazas,vPrecision);
                         END;

      }
      SECTIONS
      {
        { PROPERTIES
          {
            SectionType=Body;
            SectionWidth=25650;
            SectionHeight=846;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT(vMostrarDetalle);
                         END;

          }
          CONTROLS
          {
            { 15  ;Label        ;24150;0    ;1500 ;423  ;CaptionML=ESP=TOTAL }
            { 16  ;TextBox      ;8550 ;0    ;1200 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vViajesTot[1] }
            { 23  ;TextBox      ;9900 ;0    ;1350 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vViajesTotAcum[1] }
            { 27  ;TextBox      ;12900;0    ;1200 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vPaxTransTotAcum[1] }
            { 28  ;TextBox      ;11400;0    ;1350 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vPaxTransTot[1] }
            { 48  ;TextBox      ;17100;0    ;900  ;423  ;SourceExpr=vOcupMes }
            { 49  ;TextBox      ;18150;0    ;1050 ;423  ;SourceExpr=vOcupAcum }
            { 148 ;TextBox      ;6450 ;0    ;1800 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=ROUND(vFactTotAcum[1],vPrecision) }
            { 149 ;TextBox      ;4650 ;0    ;1650 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=ROUND(vFactTot[1],vPrecision) }
            { 150 ;TextBox      ;14250;0    ;1200 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vPaxFactTot[1] }
            { 151 ;TextBox      ;15600;0    ;1350 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vPaxFactTotAcum[1] }
            { 182 ;TextBox      ;19650;0    ;1650 ;423  ;SourceExpr=vIngPorButaca }
            { 219 ;TextBox      ;21750;0    ;900  ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=CalcularMediaPax(vPaxTransTot[1],vViajesTot[1]) }
            { 220 ;TextBox      ;22800;0    ;1050 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=CalcularMediaPax(vPaxTransTotAcum[1],vViajesTotAcum[1]) }
          }
           }
      }
       }
    { PROPERTIES
      {
        DataItemIndent=1;
        DataItemTable=Table7010319;
        DataItemTableView=SORTING(Orden Listado)
                          ORDER(Ascending);
        NewPagePerRecord=No;
        DataItemVarName=TipoServicio2;
        OnPreDataItem=BEGIN
                        //S¢lo ejecutaremos este DATAITEM y el siguiente, en caso de que vayamos a cambiar de grupo.
                        vImpTotalGrupo := FALSE;
                        vAntMat := '';
                        ContaTS:=1;
                      END;

        OnAfterGetRecord=VAR
                           rSelVeh@1100244000 : Record 7010352;
                         BEGIN
                           vTextoTotal := '';
                           //La siguiente comprobaci¢n es para no ir accediendo innecesariamente a la tabla vehiculos
                           //a traves de rVeh, cuando ya hemos ejecutado la comprobaci¢n.
                           IF (vAntMat=SelVehiculo.Numero) AND (NOT vImpTotalGrupo) THEN
                             CurrReport.SKIP
                           ELSE
                             vAntMat:=SelVehiculo.Numero;

                           //Miramos si se trata del £ltimo vehiculo de la agrupaci¢n por plazas.
                           //En tal caso, realizamos los c lculos, SINO salimos del bloque mediante CurrReport.SKIP,

                           //Para el primer registro de Tipo Servicio que debamos considerar, actualizaremos la variable
                           //de texto vTextoTotal que es en realidad una leyenda para poner en el informe.
                           //Llevamos el control, para que s¢lo aparezca una vez.

                           IF NOT vImpTotalGrupo THEN BEGIN
                             rSelVeh.RESET;
                             rSelVeh.SETCURRENTKEY(Usuario,Garaje,Agrupacion,Numero);
                             rSelVeh.SETRANGE(Usuario,USERID);
                             rSelVeh.SETRANGE(Garaje,SelVehiculo.Garaje);
                             rSelVeh.SETRANGE(Agrupacion,SelVehiculo.Agrupacion);

                             IF vVehiculos=vVehiculos::"Seg£n Selecci¢n" THEN
                               rSelVeh.SETRANGE(Seleccion,TRUE);

                             IF vSoloConActividad THEN
                               rSelVeh.SETRANGE(Actividad,TRUE);

                             IF vPropiedad = vPropiedad::"S¢lo Propios" THEN
                               rSelVeh.SETRANGE("Vehiculo propio",TRUE)
                             ELSE
                               IF vPropiedad = vPropiedad::"S¢lo Ajenos" THEN
                                 rSelVeh.SETRANGE("Vehiculo propio",FALSE);

                             IF (rSelVeh.FINDLAST AND (rSelVeh.Numero=SelVehiculo.Numero)) THEN BEGIN
                               //De paso obtenemos el n£mero de vehiculos de este grupo.
                               vVehiculosDelGrupo := rSelVeh.COUNT;
                               vNumTotalVehiculos := vNumTotalVehiculos + vVehiculosDelGrupo;
                               vImpTotalGrupo := TRUE;
                               //.....
                               IF vTipoAgrupacion=vTipoAgrupacion::"Agrupaci¢n Plazas" THEN
                                 vTextoTotal    := Text003+FORMAT(SelVehiculo.Agrupacion)+Text004
                               ELSE
                                 vTextoTotal    := Text005+FORMAT(SelVehiculo.Agrupacion);
                               //.....
                             END
                             ELSE
                               CurrReport.SKIP;
                           END;

                           ContaTS := ContaTS + 1;
                         END;

      }
      SECTIONS
      {
        { PROPERTIES
          {
            SectionType=Header;
            SectionWidth=25650;
            SectionHeight=423;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT(vAgrupacionporPlazas);
                         END;

          }
          CONTROLS
          {
            { 247 ;Shape        ;4650 ;0    ;1650 ;423  ;ShapeStyle=HorzLine }
            { 248 ;Shape        ;6450 ;0    ;1800 ;423  ;ShapeStyle=HorzLine }
            { 249 ;Shape        ;8550 ;0    ;1200 ;423  ;ShapeStyle=HorzLine }
            { 250 ;Shape        ;9900 ;0    ;1350 ;423  ;ShapeStyle=HorzLine }
            { 251 ;Shape        ;11400;0    ;1350 ;423  ;ShapeStyle=HorzLine }
            { 252 ;Shape        ;12900;0    ;1200 ;423  ;ShapeStyle=HorzLine }
            { 253 ;Shape        ;14250;0    ;1200 ;423  ;ShapeStyle=HorzLine }
            { 254 ;Shape        ;15600;0    ;1350 ;423  ;ShapeStyle=HorzLine }
            { 255 ;Shape        ;17100;0    ;900  ;423  ;ShapeStyle=HorzLine }
            { 256 ;Shape        ;18150;0    ;1050 ;423  ;ShapeStyle=HorzLine }
            { 257 ;Shape        ;19650;0    ;1650 ;423  ;ShapeStyle=HorzLine }
            { 258 ;Shape        ;21750;0    ;900  ;423  ;ShapeStyle=HorzLine }
            { 259 ;Shape        ;22800;0    ;1050 ;423  ;ShapeStyle=HorzLine }
          }
           }
        { PROPERTIES
          {
            SectionType=Body;
            SectionWidth=25650;
            SectionHeight=423;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT(vAgrupacionporPlazas);
                         END;

          }
          CONTROLS
          {
            { 52  ;TextBox      ;8550 ;0    ;1200 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vViajesMes[1,ContaTS] }
            { 53  ;TextBox      ;9900 ;0    ;1350 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vViajesAcum[1,ContaTS] }
            { 54  ;TextBox      ;11400;0    ;1350 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vPaxTransMes[1,ContaTS] }
            { 55  ;TextBox      ;12900;0    ;1200 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vPaxTransAcum[1,ContaTS] }
            { 63  ;TextBox      ;24150;0    ;1500 ;423  ;SourceExpr=Codigo }
            { 7   ;TextBox      ;150  ;0    ;4200 ;423  ;FontSize=8;
                                                         FontBold=Yes;
                                                         SourceExpr=vTextoTotal }
            { 160 ;TextBox      ;14250;0    ;1200 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vPaxFactMes[1,ContaTS] }
            { 161 ;TextBox      ;15600;0    ;1350 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vPaxFactAcum[1,ContaTS] }
            { 172 ;TextBox      ;4650 ;0    ;1650 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=ROUND(vFactMes[1,ContaTS],vPrecision) }
            { 173 ;TextBox      ;6450 ;0    ;1800 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=ROUND(vFactAcum[1,ContaTS],vPrecision) }
          }
           }
      }
       }
    { PROPERTIES
      {
        DataItemIndent=1;
        DataItemTable=Table2000000026;
        DataItemTableView=SORTING(Number)
                          ORDER(Ascending);
        MaxIteration=1;
        DataItemVarName=Entero2;
        OnAfterGetRecord=BEGIN
                           IF NOT vImpTotalGrupo THEN
                             CurrReport.SKIP;

                           //vOcupMes  := ObtenerOcupacion(vPaxTransTot[2],vTotalPlazasGrupo*vViajesTot[2],0.01);
                           //vOcupAcum := ObtenerOcupacion(vPaxTransTotAcum[2],vTotalPlazasGrupo*vViajesTotAcum[2],0.01);
                           //vIngPorButaca:= ROUND(vFactTotAcum[2]/vTotalPlazasGrupo,vPrecision);
                         END;

      }
      SECTIONS
      {
        { PROPERTIES
          {
            SectionType=Body;
            SectionWidth=25650;
            SectionHeight=846;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT(vAgrupacionporPlazas);
                         END;

          }
          CONTROLS
          {
            { 51  ;TextBox      ;8550 ;0    ;1200 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vViajesTot[2] }
            { 58  ;TextBox      ;9900 ;0    ;1350 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vViajesTotAcum[2] }
            { 59  ;TextBox      ;11400;0    ;1350 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vPaxTransTot[2] }
            { 61  ;TextBox      ;12900;0    ;1200 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vPaxTransTotAcum[2] }
            { 79  ;Label        ;24150;0    ;1500 ;423  ;CaptionML=ESP=TOTAL }
            { 162 ;TextBox      ;14250;0    ;1200 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vPaxFactTot[2] }
            { 163 ;TextBox      ;15600;0    ;1350 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vPaxFactTotAcum[2] }
            { 174 ;TextBox      ;4650 ;0    ;1650 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=ROUND(vFactTot[2],vPrecision) }
            { 175 ;TextBox      ;6450 ;0    ;1800 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=ROUND(vFactTotAcum[2],vPrecision) }
          }
           }
      }
       }
    { PROPERTIES
      {
        DataItemIndent=1;
        DataItemTable=Table7010319;
        DataItemTableView=SORTING(Orden Listado)
                          ORDER(Ascending);
        DataItemVarName=Tipo Servicio3;
        OnPreDataItem=BEGIN
                        ContaTS:=1;
                        vTextoMedia:='$$';
                      END;

        OnAfterGetRecord=VAR
                           vMediaPlazas@1100244000 : Decimal;
                         BEGIN
                           IF NOT vImpTotalGrupo THEN
                             CurrReport.SKIP;

                           IF vTextoMedia='$$' THEN BEGIN
                               IF vTipoAgrupacion=vTipoAgrupacion::"Agrupaci¢n Plazas" THEN
                                 vTextoMedia := Text006+FORMAT(SelVehiculo.Agrupacion)+Text004
                               ELSE
                                 vTextoMedia := Text007+FORMAT(SelVehiculo.Agrupacion);
                           END
                           ELSE
                             vTextoMedia := '';


                           //Vamos a calcular las medias. Usamos los mismos totales.
                           ContaTS := ContaTS + 1;

                           //Calculamos las medias del grupo de vehiculos, con mismo n£mero de plazas.
                           CalcularMedias(vViajesMes[1,ContaTS],vViajesAcum[1,ContaTS],vVehiculosDelGrupo);
                           CalcularMedias(vPaxTransMes[1,ContaTS],vPaxTransAcum[1,ContaTS],vVehiculosDelGrupo);
                           CalcularMedias(vPaxFactMes[1,ContaTS],vPaxFactAcum[1,ContaTS],vVehiculosDelGrupo);
                           CalcularMedias(vFactMes[1,ContaTS],vFactAcum[1,ContaTS],vVehiculosDelGrupo);


                           //Y la ocupacion.
                           IF vVehiculosDelGrupo <> 0 THEN BEGIN
                             vMediaPlazas := vTotalPlazasGrupo/vVehiculosDelGrupo;
                             vIngPorButaca:= ROUND(vFactAcum[1,ContaTS]/vMediaPlazas,vPrecision);
                           END
                           ELSE BEGIN
                             vMediaPlazas := 0;
                             vIngPorButaca:= 0;
                           END;

                           vOcupMes  := ObtenerOcupacion(vPaxTransMes[1,ContaTS],vMediaPlazas*vViajesMes[1,ContaTS],0.01);
                           vOcupAcum := ObtenerOcupacion(vPaxTransAcum[1,ContaTS],vMediaPlazas*vViajesAcum[1,ContaTS],0.01);
                         END;

      }
      SECTIONS
      {
        { PROPERTIES
          {
            SectionType=Body;
            SectionWidth=25650;
            SectionHeight=423;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT(vAgrupacionporPlazas);
                         END;

          }
          CONTROLS
          {
            { 13  ;TextBox      ;8550 ;0    ;1200 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=ROUND(vViajesMes[1,ContaTS],1) }
            { 71  ;TextBox      ;9900 ;0    ;1350 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=ROUND(vViajesAcum[1,ContaTS],1) }
            { 72  ;TextBox      ;11400;0    ;1350 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=ROUND(vPaxTransMes[1,ContaTS],1) }
            { 73  ;TextBox      ;12900;0    ;1200 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=ROUND(vPaxTransAcum[1,ContaTS],1) }
            { 78  ;TextBox      ;150  ;0    ;4200 ;423  ;FontSize=8;
                                                         FontBold=Yes;
                                                         SourceExpr=vTextoMedia }
            { 39  ;TextBox      ;24150;0    ;1500 ;423  ;SourceExpr=Codigo }
            { 80  ;TextBox      ;17100;0    ;900  ;423  ;SourceExpr=vOcupMes }
            { 81  ;TextBox      ;18150;0    ;1050 ;423  ;SourceExpr=vOcupAcum }
            { 166 ;TextBox      ;14250;0    ;1200 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=ROUND(vPaxFactMes[1,ContaTS],1) }
            { 167 ;TextBox      ;15600;0    ;1350 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=ROUND(vPaxFactAcum[1,ContaTS],1) }
            { 176 ;TextBox      ;4650 ;0    ;1650 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=ROUND(vFactMes[1,ContaTS],vPrecision) }
            { 177 ;TextBox      ;6450 ;0    ;1800 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=ROUND(vFactAcum[1,ContaTS],vPrecision) }
            { 192 ;TextBox      ;19650;0    ;1650 ;423  ;SourceExpr=vIngPorButaca }
            { 222 ;TextBox      ;21750;0    ;900  ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=CalcularMediaPax(vPaxTransMes[1,ContaTS],vViajesMes[1,ContaTS]) }
            { 223 ;TextBox      ;22800;0    ;1050 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=CalcularMediaPax(vPaxTransAcum[1,ContaTS],vViajesAcum[1,ContaTS]) }
          }
           }
      }
       }
    { PROPERTIES
      {
        DataItemIndent=1;
        DataItemTable=Table2000000026;
        DataItemTableView=SORTING(Number)
                          ORDER(Ascending);
        MaxIteration=1;
        DataItemVarName=Entero3;
        OnAfterGetRecord=VAR
                           vMediaPlazas@1100244000 : Decimal;
                         BEGIN
                           IF NOT vImpTotalGrupo THEN
                             CurrReport.SKIP;

                           //Calculamos las medias del grupo de vehiculos, con mismo n£mero de plazas.
                           CalcularMedias(vViajesTot[2],vViajesTotAcum[2],vVehiculosDelGrupo);
                           CalcularMedias(vPaxTransTot[2],vPaxTransTotAcum[2],vVehiculosDelGrupo);
                           CalcularMedias(vPaxFactTot[2],vPaxFactTotAcum[2],vVehiculosDelGrupo);
                           CalcularMedias(vFactTot[2],vFactTotAcum[2],vVehiculosDelGrupo);

                           //Y la ocupacion.
                           IF vVehiculosDelGrupo <> 0 THEN BEGIN
                             vMediaPlazas := vTotalPlazasGrupo/vVehiculosDelGrupo;
                             vIngPorButaca:= ROUND(vFactTotAcum[2]/vMediaPlazas,vPrecision);
                           END
                           ELSE BEGIN
                             vMediaPlazas := 0;
                             vIngPorButaca:= 0;
                           END;

                           //Y como no, la ocupaci¢n...
                           vOcupMes  := ObtenerOcupacion(vPaxTransTot[2],vMediaPlazas*vViajesTot[2],0.01);
                           vOcupAcum := ObtenerOcupacion(vPaxTransTotAcum[2],vMediaPlazas*vViajesTotAcum[2],0.01);
                         END;

      }
      SECTIONS
      {
        { PROPERTIES
          {
            SectionType=Body;
            SectionWidth=25650;
            SectionHeight=846;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT(vAgrupacionporPlazas);
                         END;

          }
          CONTROLS
          {
            { 64  ;Label        ;24150;0    ;1500 ;423  ;CaptionML=ESP=TOTAL }
            { 94  ;TextBox      ;8550 ;0    ;1200 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=ROUND(vViajesTot[2],1) }
            { 95  ;TextBox      ;9900 ;0    ;1350 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=ROUND(vViajesTotAcum[2],1) }
            { 96  ;TextBox      ;11400;0    ;1350 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=ROUND(vPaxTransTot[2],1) }
            { 127 ;TextBox      ;12900;0    ;1200 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=ROUND(vPaxTransTotAcum[2],1) }
            { 128 ;TextBox      ;17100;0    ;900  ;423  ;SourceExpr=vOcupMes }
            { 129 ;TextBox      ;18150;0    ;1050 ;423  ;SourceExpr=vOcupAcum }
            { 168 ;TextBox      ;14250;0    ;1200 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=ROUND(vPaxFactTot[2],1) }
            { 169 ;TextBox      ;15600;0    ;1350 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=ROUND(vPaxFactTotAcum[2],1) }
            { 178 ;TextBox      ;4650 ;0    ;1650 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=ROUND(vFactTot[2],vPrecision) }
            { 179 ;TextBox      ;6450 ;0    ;1800 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=ROUND(vFactTotAcum[2],vPrecision) }
            { 193 ;TextBox      ;19650;0    ;1650 ;423  ;SourceExpr=vIngPorButaca }
            { 224 ;TextBox      ;21750;0    ;900  ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=CalcularMediaPax(vPaxTransTot[2],vViajesTot[2]) }
            { 225 ;TextBox      ;22800;0    ;1050 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=CalcularMediaPax(vPaxTransTotAcum[2],vViajesTotAcum[2]) }
          }
           }
      }
       }
    { PROPERTIES
      {
        DataItemTable=Table7010319;
        DataItemTableView=SORTING(Orden Listado)
                          ORDER(Ascending);
        DataItemVarName=Tipo Servicio4;
        OnPreDataItem=VAR
                        rVehiculo@1100244000 : Record 7010346;
                      BEGIN
                        //Las agrupaciones generales, se ver n en una nueva p gina.
                        CurrReport.NEWPAGE;
                        ContaTS:=1;
                        vTextoTotal:='$$';
                      END;

        OnAfterGetRecord=VAR
                           rVehiculo@1100244000 : Record 7010346;
                         BEGIN
                           IF vTextoTotal='$$' THEN
                             vTextoTotal := Text008
                           ELSE
                             vTextoTotal := '';

                           ContaTS:=ContaTS + 1;
                           //vOcupMes := ObtenerOcupacion(vPaxTransMes[2,ContaTS],vNumeroTotalPlazas*vViajesMes[2,ContaTS],0.01);
                           //vOcupAcum:= ObtenerOcupacion(vPaxTransAcum[2,ContaTS],vNumeroTotalPlazas*vViajesAcum[2,ContaTS],0.01);
                           //vIngPorButaca:= ROUND(vFactAcum[2,ContaTS]/vNumeroTotalPlazas,vPrecision);
                         END;

      }
      SECTIONS
      {
        { PROPERTIES
          {
            SectionType=Header;
            SectionWidth=25650;
            SectionHeight=2538;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT(vAgrupacionGeneral  AND (vNumTotalVehiculos>0));
                         END;

          }
          CONTROLS
          {
            { 97  ;Label        ;0    ;0    ;7500 ;423  ;FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Estadisticas de Vehiculos (Agrupaci¢n General) }
            { 98  ;TextBox      ;0    ;423  ;7500 ;423  ;SourceExpr=COMPANYNAME }
            { 105 ;TextBox      ;22500;0    ;3150 ;423  ;HorzAlign=Right;
                                                         SourceExpr=FORMAT(TODAY,0,4) }
            { 106 ;Label        ;24450;423  ;750  ;423  ;ParentControl=107 }
            { 107 ;TextBox      ;25200;423  ;450  ;423  ;CaptionML=ESP=P gina;
                                                         SourceExpr=CurrReport.PAGENO }
            { 108 ;TextBox      ;23400;846  ;2250 ;423  ;HorzAlign=Right;
                                                         SourceExpr=USERID }
            { 198 ;Label        ;0    ;846  ;3000 ;423  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=ESP=Mes Pedido }
            { 199 ;Label        ;0    ;1269 ;3000 ;423  ;ParentControl=201;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=ESP=Tipo Agrupacion }
            { 200 ;TextBox      ;3150 ;846  ;2100 ;423  ;SourceExpr=FORMAT(vMes)+Text002+FORMAT(vA¤o) }
            { 201 ;TextBox      ;3150 ;1269 ;2100 ;423  ;VertAlign=Bottom;
                                                         SourceExpr=vTipoAgrupacion }
            { 202 ;Label        ;5400 ;846  ;150  ;423  ;CaptionML=ESP=/ }
            { 203 ;Label        ;5400 ;1269 ;150  ;423  ;CaptionML=ESP=/ }
            { 204 ;Label        ;5700 ;846  ;3000 ;423  ;ParentControl=206;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=ESP=Filtro Garaje }
            { 205 ;Label        ;5700 ;1269 ;3000 ;423  ;ParentControl=207;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=ESP=Selecci¢n Vehiculos }
            { 206 ;TextBox      ;8850 ;846  ;2850 ;423  ;VertAlign=Bottom;
                                                         SourceExpr=vFltGaraje }
            { 207 ;TextBox      ;8850 ;1269 ;2850 ;423  ;VertAlign=Bottom;
                                                         SourceExpr=vVehiculos }
            { 208 ;Label        ;11850;1269 ;150  ;423  ;CaptionML=ESP=/ }
            { 209 ;Label        ;11850;846  ;150  ;423  ;CaptionML=ESP=/ }
            { 211 ;Label        ;12150;846  ;5100 ;423  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=ESP=Garaje a considerar en resultados }
            { 212 ;Label        ;12150;1269 ;5100 ;423  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=ESP=S¢lo Vehiculos con Actividad }
            { 213 ;TextBox      ;17400;1269 ;2850 ;423  ;VertAlign=Bottom;
                                                         SourceExpr=vSoloConActividad }
            { 214 ;TextBox      ;17400;846  ;2850 ;423  ;VertAlign=Bottom;
                                                         SourceExpr=vFltGarajeResult }
            { 235 ;TextBox      ;17400;423  ;2850 ;423  ;VertAlign=Bottom;
                                                         SourceExpr=vPropiedad }
            { 236 ;Label        ;12150;423  ;5100 ;423  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=ESP=Filtro Propiedad del Vehiculo }
            { 104 ;TextBox      ;8850 ;1692 ;2850 ;423  ;VertAlign=Bottom;
                                                         SourceExpr=vDivisa }
            { 242 ;Label        ;5700 ;1692 ;3000 ;423  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=ESP=C¢d. Divisa }
            { 243 ;Label        ;5400 ;1692 ;150  ;423  ;CaptionML=ESP=/ }
            { 244 ;TextBox      ;3150 ;1692 ;1050 ;423  ;VertAlign=Bottom;
                                                         SourceExpr=vVerBloqueados }
            { 245 ;Label        ;0    ;1692 ;3000 ;423  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=ESP=Ver Bloqueados }
            { 246 ;Shape        ;0    ;2115 ;25650;423  ;ShapeStyle=HorzLine }
          }
           }
        { PROPERTIES
          {
            SectionType=Header;
            SectionWidth=25650;
            SectionHeight=1269;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT(vAgrupacionGeneral AND (vNumTotalVehiculos>0) );
                         END;

          }
          CONTROLS
          {
            { 101 ;Label        ;750  ;0    ;1500 ;846  ;HorzAlign=Center;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=ESP=Numero Vehiculo }
            { 103 ;Label        ;2400 ;0    ;1200 ;846  ;HorzAlign=Center;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=ESP=N§ Plazas }
            { 111 ;Label        ;4650 ;0    ;3600 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Facturacion }
            { 112 ;Label        ;4650 ;423  ;1650 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Mes }
            { 113 ;Label        ;6450 ;423  ;1800 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Acum }
            { 114 ;Label        ;8700 ;0    ;2550 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Viajes }
            { 115 ;Label        ;8700 ;423  ;1050 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Mes }
            { 116 ;Label        ;9900 ;423  ;1350 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Acum }
            { 117 ;Label        ;11700;0    ;2250 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Pax Transpor. }
            { 118 ;Label        ;11700;423  ;1050 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Mes }
            { 119 ;Label        ;12900;423  ;1050 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Acum }
            { 120 ;Label        ;14250;0    ;2400 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Pax Facturados }
            { 121 ;Label        ;14250;423  ;1050 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Mes }
            { 122 ;Label        ;15450;423  ;1200 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Acum }
            { 123 ;Label        ;17100;0    ;2100 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=% Ocupacion }
            { 124 ;Label        ;17100;423  ;900  ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Mes }
            { 125 ;Label        ;18150;423  ;1050 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Acum }
            { 126 ;Label        ;19650;0    ;1650 ;846  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=ESP=Ingr. x But Acum. }
            { 183 ;Label        ;21750;0    ;2100 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=ESP=Pax / Viajes }
            { 216 ;Label        ;21750;423  ;900  ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Mes }
            { 217 ;Label        ;22800;423  ;1050 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Acum }
          }
           }
        { PROPERTIES
          {
            SectionType=Body;
            SectionWidth=25650;
            SectionHeight=423;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT(vAgrupacionGeneral AND (vNumTotalVehiculos>0) );
                         END;

          }
          CONTROLS
          {
            { 74  ;TextBox      ;8700 ;0    ;1050 ;423  ;SourceExpr=vViajesMes[2,ContaTS] }
            { 75  ;TextBox      ;9900 ;0    ;1350 ;423  ;SourceExpr=vViajesAcum[2,ContaTS] }
            { 76  ;TextBox      ;11700;0    ;1050 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vPaxTransMes[2,ContaTS] }
            { 77  ;TextBox      ;12900;0    ;1050 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vPaxTransAcum[2,ContaTS] }
            { 84  ;TextBox      ;24150;0    ;1500 ;423  ;SourceExpr=Codigo }
            { 85  ;TextBox      ;150  ;0    ;3600 ;423  ;FontSize=8;
                                                         FontBold=Yes;
                                                         SourceExpr=vTextoTotal }
            { 152 ;TextBox      ;14250;0    ;1050 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vPaxFactMes[2,ContaTS] }
            { 153 ;TextBox      ;15450;0    ;1200 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vPaxFactAcum[2,ContaTS] }
            { 180 ;TextBox      ;4650 ;0    ;1650 ;423  ;SourceExpr=ROUND(vFactMes[2,ContaTS],vPrecision) }
            { 181 ;TextBox      ;6450 ;0    ;1800 ;423  ;SourceExpr=ROUND(vFactAcum[2,ContaTS],vPrecision) }
          }
           }
      }
       }
    { PROPERTIES
      {
        DataItemTable=Table2000000026;
        DataItemTableView=SORTING(Number)
                          ORDER(Ascending);
        MaxIteration=1;
        DataItemVarName=Entero4;
        OnAfterGetRecord=BEGIN

                           //vOcupMes := ObtenerOcupacion(vPaxTransTot[3],vNumeroTotalPlazas*vViajesTot[3],0.01);
                           //vOcupAcum:= ObtenerOcupacion(vPaxTransTotAcum[3],vNumeroTotalPlazas*vViajesTotAcum[3],0.01);
                           //vIngPorButaca:= ROUND(vFactTotAcum[3]/vNumeroTotalPlazas,vPrecision);
                         END;

      }
      SECTIONS
      {
        { PROPERTIES
          {
            SectionType=Body;
            SectionWidth=25650;
            SectionHeight=846;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT(vAgrupacionGeneral  AND (vNumTotalVehiculos>0) );
                         END;

          }
          CONTROLS
          {
            { 87  ;TextBox      ;8700 ;0    ;1050 ;423  ;SourceExpr=vViajesTot[3] }
            { 88  ;TextBox      ;9900 ;0    ;1350 ;423  ;SourceExpr=vViajesTotAcum[3] }
            { 89  ;TextBox      ;11700;0    ;1050 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vPaxTransTot[3] }
            { 92  ;Label        ;24150;0    ;1500 ;423  ;CaptionML=ESP=TOTAL }
            { 93  ;TextBox      ;12900;0    ;1050 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vPaxTransTotAcum[3] }
            { 154 ;TextBox      ;14250;0    ;1050 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vPaxFactTot[3] }
            { 155 ;TextBox      ;15450;0    ;1200 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=vPaxFactTotAcum[3] }
            { 186 ;TextBox      ;4650 ;0    ;1650 ;423  ;SourceExpr=ROUND(vFactTot[3],vPrecision) }
            { 187 ;TextBox      ;6450 ;0    ;1800 ;423  ;SourceExpr=ROUND(vFactTotAcum[3],vPrecision) }
          }
           }
      }
       }
    { PROPERTIES
      {
        DataItemTable=Table7010319;
        DataItemTableView=SORTING(Orden Listado)
                          ORDER(Ascending);
        DataItemVarName=Tipo Servicio5;
        OnPreDataItem=BEGIN
                        ContaTS:=1;
                        vTextoMedia:='$$';
                      END;

        OnAfterGetRecord=VAR
                           vMediaPlazas@1100244000 : Decimal;
                         BEGIN
                           IF vTextoMedia='$$' THEN
                             vTextoMedia := Text009
                           ELSE
                             vTextoMedia := '';


                           //Vamos a calcular las medias. Usamos los mismos totales.
                           ContaTS := ContaTS + 1;

                           //Calculamos las medias del grupo de vehiculos, con mismo n£mero de plazas.
                           CalcularMedias(vViajesMes[2,ContaTS],vViajesAcum[2,ContaTS],vNumTotalVehiculos);
                           CalcularMedias(vPaxTransMes[2,ContaTS],vPaxTransAcum[2,ContaTS],vNumTotalVehiculos);
                           CalcularMedias(vPaxFactMes[2,ContaTS],vPaxFactAcum[2,ContaTS],vNumTotalVehiculos);
                           CalcularMedias(vFactMes[2,ContaTS],vFactAcum[2,ContaTS],vNumTotalVehiculos);

                           //Falta el contador de plazas.
                           IF vNumTotalVehiculos <> 0 THEN BEGIN
                             vMediaPlazas := vNumeroTotalPlazas / vNumTotalVehiculos;
                             vIngPorButaca:= ROUND(vFactAcum[2,ContaTS]/vMediaPlazas,vPrecision);
                           END
                           ELSE BEGIN
                             vMediaPlazas := 0;
                             vIngPorButaca:= 0;
                           END;

                           vOcupMes  := ObtenerOcupacion(vPaxTransMes[2,ContaTS],vMediaPlazas*vViajesMes[2,ContaTS],0.01);
                           vOcupAcum := ObtenerOcupacion(vPaxTransAcum[2,ContaTS],vMediaPlazas*vViajesAcum[2,ContaTS],0.01);
                         END;

      }
      SECTIONS
      {
        { PROPERTIES
          {
            SectionType=Body;
            SectionWidth=25650;
            SectionHeight=423;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT(vAgrupacionGeneral  AND (vNumTotalVehiculos>0) );
                         END;

          }
          CONTROLS
          {
            { 86  ;TextBox      ;150  ;0    ;3600 ;423  ;FontSize=8;
                                                         FontBold=Yes;
                                                         SourceExpr=vTextoMedia }
            { 130 ;TextBox      ;24150;0    ;1500 ;423  ;SourceExpr=Codigo }
            { 133 ;TextBox      ;8700 ;0    ;1050 ;423  ;SourceExpr=ROUND(vViajesMes[2,ContaTS],1) }
            { 134 ;TextBox      ;9900 ;0    ;1350 ;423  ;SourceExpr=ROUND(vViajesAcum[2,ContaTS],1) }
            { 135 ;TextBox      ;11700;0    ;1050 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=ROUND(vPaxTransMes[2,ContaTS],1) }
            { 136 ;TextBox      ;12900;0    ;1050 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=ROUND(vPaxTransAcum[2,ContaTS],1) }
            { 137 ;TextBox      ;17100;0    ;900  ;423  ;SourceExpr=vOcupMes }
            { 138 ;TextBox      ;18150;0    ;1050 ;423  ;SourceExpr=vOcupAcum }
            { 156 ;TextBox      ;14250;0    ;1050 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=ROUND(vPaxFactMes[2,ContaTS],1) }
            { 157 ;TextBox      ;15450;0    ;1200 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=ROUND(vPaxFactAcum[2,ContaTS],1) }
            { 184 ;TextBox      ;4650 ;0    ;1650 ;423  ;SourceExpr=ROUND(vFactMes[2,ContaTS],vPrecision) }
            { 185 ;TextBox      ;6450 ;0    ;1800 ;423  ;SourceExpr=ROUND(vFactAcum[2,ContaTS],vPrecision) }
            { 196 ;TextBox      ;19650;0    ;1650 ;423  ;SourceExpr=vIngPorButaca }
            { 228 ;TextBox      ;21750;0    ;900  ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=CalcularMediaPax(vPaxTransMes[2,ContaTS],vViajesMes[2,ContaTS]) }
            { 229 ;TextBox      ;22800;0    ;1050 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=CalcularMediaPax(vPaxTransAcum[1,ContaTS],vViajesAcum[1,ContaTS]) }
          }
           }
      }
       }
    { PROPERTIES
      {
        DataItemTable=Table2000000026;
        DataItemTableView=SORTING(Number)
                          ORDER(Ascending);
        MaxIteration=1;
        DataItemVarName=Entero5;
        OnAfterGetRecord=VAR
                           vMediaPlazas@1100244000 : Decimal;
                         BEGIN
                           //Calculamos las medias generales.
                           CalcularMedias(vViajesTot[3],vViajesTotAcum[3],vNumTotalVehiculos);
                           CalcularMedias(vPaxTransTot[3],vPaxTransTotAcum[3],vNumTotalVehiculos);
                           CalcularMedias(vPaxFactTot[3],vPaxFactTotAcum[3],vNumTotalVehiculos);
                           CalcularMedias(vFactTot[3],vFactTotAcum[3],vNumTotalVehiculos);

                           //Y la ocupacion.
                           IF vNumTotalVehiculos <> 0 THEN BEGIN
                             vMediaPlazas := vNumeroTotalPlazas/vNumTotalVehiculos;
                             vIngPorButaca:= ROUND(vFactTotAcum[3]/vMediaPlazas,vPrecision);
                           END
                           ELSE BEGIN
                             vMediaPlazas := 0;
                             vIngPorButaca:= 0;
                           END;

                           vOcupMes := ObtenerOcupacion(vPaxTransTot[3],vMediaPlazas*vViajesTot[3],0.01);
                           vOcupAcum:= ObtenerOcupacion(vPaxTransTotAcum[3],vMediaPlazas*vViajesTotAcum[3],0.01);
                         END;

      }
      SECTIONS
      {
        { PROPERTIES
          {
            SectionType=Body;
            SectionWidth=25650;
            SectionHeight=846;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT(vAgrupacionGeneral  AND (vNumTotalVehiculos>0) );
                         END;

          }
          CONTROLS
          {
            { 131 ;Label        ;24150;0    ;1500 ;423  ;CaptionML=ESP=TOTAL }
            { 139 ;TextBox      ;8700 ;0    ;1050 ;423  ;SourceExpr=ROUND(vViajesTot[3],1) }
            { 140 ;TextBox      ;9900 ;0    ;1350 ;423  ;SourceExpr=ROUND(vViajesTotAcum[3],1) }
            { 141 ;TextBox      ;11700;0    ;1050 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=ROUND(vPaxTransTot[3],1) }
            { 142 ;TextBox      ;12900;0    ;1050 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=ROUND(vPaxTransTotAcum[3],1) }
            { 143 ;TextBox      ;17100;0    ;900  ;423  ;SourceExpr=vOcupMes }
            { 144 ;TextBox      ;18150;0    ;1050 ;423  ;SourceExpr=vOcupAcum }
            { 158 ;TextBox      ;15450;0    ;1200 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=ROUND(vPaxFactTotAcum[3],1) }
            { 159 ;TextBox      ;14250;0    ;1050 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=ROUND(vPaxFactTot[3],1) }
            { 188 ;TextBox      ;4650 ;0    ;1650 ;423  ;SourceExpr=ROUND(vFactTot[3],vPrecision) }
            { 189 ;TextBox      ;6450 ;0    ;1800 ;423  ;SourceExpr=ROUND(vFactTotAcum[3],vPrecision) }
            { 197 ;TextBox      ;19650;0    ;1650 ;423  ;SourceExpr=vIngPorButaca }
            { 226 ;TextBox      ;21750;0    ;900  ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=CalcularMediaPax(vPaxTransTot[3],vViajesTot[3]) }
            { 227 ;TextBox      ;22800;0    ;1050 ;423  ;DecimalPlaces=0:2;
                                                         SourceExpr=CalcularMediaPax(vPaxTransTotAcum[3],vViajesTotAcum[3]) }
          }
           }
      }
       }
  }
  REQUESTFORM
  {
    PROPERTIES
    {
      Width=10340;
      Height=7590;
      OnOpenForm=VAR
                   rConf@1100244000 : Record 98;
                   rPar@1100244001 : Record 7010311;
                   cFunBas@1100244002 : Codeunit 7010310;
                   cVeh@1100244003 : Codeunit 7010317;
                   vAuxGaraje@1100244004 : Code[10];
                 BEGIN
                   rPar.FINDFIRST;
                   vMes    := DATE2DMY(cFunBas.fdom(TODAY,-2),2);  //Ah¡ que poner un mes menos.
                   vA¤o    := DATE2DMY(cFunBas.fdom(TODAY,-1),3);
                   vGaraje := cFunBas.ObtenerGaraje();

                   //............
                   vVehiculos:=vVehiculos::"Todos los Veh¡culos";
                   RequestOptionsForm.Seleccionar.VISIBLE:=FALSE;
                   //............

                   vAgrupacionGeneral  := TRUE;
                   vPropiedad          := vPropiedad::Todos;
                   //............
                   vAgrupacionporPlazas:=TRUE;
                   vTipoAgrupacion     :=vTipoAgrupacion::"Grupo Veh¡culos";
                   RequestOptionsForm.Agrupar.VISIBLE:= FALSE;
                   //............

                   vMostrarDetalle     :=TRUE;
                   vSoloConActividad   :=FALSE;
                   vIniAcum            :=rPar."Fecha Inicio Acumulados";

                   //Actualizamos la selecci¢n de Vehiculos.
                   cVeh.ActualizarSeleccionVehiculos();

                   vAuxGaraje:=cFunBas.ObtenerGaraje();
                   IF vAuxGaraje<>'' THEN
                     RequestOptionsForm.FltGaraje.EDITABLE := FALSE;

                   vVerBloqueados := FALSE;

                   //Inicializaci¢n de la divisa.
                   vDivisa:= '';
                 END;

    }
    CONTROLS
    {
      { 1   ;Label        ;220  ;770  ;6050 ;440  ;InPage=-1;
                                                   CaptionML=ESP=Mes / A¤o }
      { 2   ;Label        ;220  ;220  ;6050 ;440  ;InPage=-1;
                                                   CaptionML=ESP=Garaje }
      { 3   ;TextBox      ;6380 ;220  ;2310 ;440  ;Name=FltGaraje;
                                                   InPage=-1;
                                                   NextControl=4;
                                                   SourceExpr=vGaraje;
                                                   TableRelation=Garaje.Garaje;
                                                   OnValidate=VAR
                                                                cfunbas@1100244001 : Codeunit 7010310;
                                                              BEGIN
                                                                cfunbas.TestRestringido(vGaraje);
                                                              END;
                                                               }
      { 4   ;TextBox      ;6380 ;770  ;2310 ;440  ;InPage=-1;
                                                   OptionString=Enero,Febrero,Marzo,Abril,Mayo,Junio,Julio,Agosto,Septiembre,Octubre,Noviembre,Diciembre,Marso;
                                                   NextControl=6;
                                                   SourceExpr=vMes }
      { 5   ;Label        ;8690 ;770  ;330  ;440  ;Visible=Yes;
                                                   InPage=-1;
                                                   LeaderDots=No;
                                                   CaptionML=ESP=/ }
      { 6   ;TextBox      ;9020 ;770  ;1100 ;440  ;InPage=-1;
                                                   NextControl=17;
                                                   SourceExpr=vA¤o }
      { 17  ;TextBox      ;6380 ;1320 ;1430 ;440  ;InPage=-1;
                                                   ToolTipML=ESP="Fecha de inicio para el c lculo de los acumulados. ";
                                                   NotBlank=Yes;
                                                   SourceExpr=vIniAcum }
      { 18  ;Label        ;220  ;1320 ;6050 ;440  ;InPage=-1;
                                                   CaptionML=ESP=Fecha Inicio (Acumulados) }
      { 7   ;CheckBox     ;6380 ;4730 ;440  ;440  ;InPage=-1;
                                                   ShowCaption=No;
                                                   SourceExpr=vMostrarDetalle }
      { 9   ;CheckBox     ;6380 ;5280 ;440  ;440  ;InPage=-1;
                                                   ShowCaption=No;
                                                   SourceExpr=vAgrupacionporPlazas }
      { 12  ;CheckBox     ;6380 ;5830 ;440  ;440  ;InPage=-1;
                                                   ShowCaption=No;
                                                   SourceExpr=vAgrupacionGeneral }
      { 15  ;CheckBox     ;6380 ;6380 ;440  ;440  ;InPage=-1;
                                                   ShowCaption=No;
                                                   NextControl=3;
                                                   SourceExpr=vSoloConActividad }
      { 16  ;Label        ;220  ;6380 ;6050 ;440  ;InPage=-1;
                                                   MultiLine=Yes;
                                                   CaptionML=ESP=Mostrar s¢lo Veh¡culos con Actividad;
                                                   ToolTipML=ESP=Si se marca s¢lo se considerar n los vehiculos que han tenido actividad }
      { 13  ;Label        ;220  ;5830 ;6050 ;440  ;InPage=-1;
                                                   CaptionML=ESP=Mostrar Agrupaci¢n Total }
      { 10  ;Label        ;220  ;5280 ;6050 ;440  ;InPage=-1;
                                                   CaptionML=ESP=Mostrar Totales por Tipo de Agrupaci¢n }
      { 8   ;Label        ;220  ;4730 ;6050 ;440  ;InPage=-1;
                                                   CaptionML=ESP=Mostrar Detalle }
      { 19  ;CommandButton;9680 ;2420 ;440  ;440  ;Name=Agrupar;
                                                   InPage=-1;
                                                   ForeColor=0;
                                                   BackColor=12632256;
                                                   Border=Yes;
                                                   CaptionML=ESP=...;
                                                   ToolTipML=ESP=Agrupaci¢n de plazas;
                                                   OnPush=VAR
                                                            rSel@1100244001 : Record 7010354;
                                                            fSel@1100244002 : Form 7010389;
                                                            cVeh@1100244003 : Codeunit 7010317;
                                                            rPar@1100244005 : Record 7010311;
                                                            rUsr@1103355001 : Record 7010420;
                                                          BEGIN
                                                            rSel.RESET;
                                                            rSel.SETCURRENTKEY("Id. Usuario");
                                                            rSel.SETRANGE("Id. Usuario",USERID);

                                                            IF rSel.COUNT=0 THEN
                                                              //Actualizamos la selecci¢n de Vehiculos.
                                                              cVeh.ActualizarRangos();

                                                            rSel.RESET;
                                                            rSel.SETCURRENTKEY("Id. Usuario",Garaje);
                                                            rSel.FILTERGROUP(2);
                                                            rPar.FINDFIRST;

                                                            rSel.SETRANGE("Id. Usuario",USERID);
                                                            IF rUsr.GET(USERID) AND (rUsr."Garaje de trabajo"<>rPar."Todos los garajes") THEN
                                                              rSel.SETRANGE(Garaje,rUsr."Garaje de trabajo");

                                                            rSel.FILTERGROUP(0);

                                                            CLEAR(fSel);
                                                            fSel.SETTABLEVIEW(rSel);
                                                            fSel.RUN;
                                                            CLEAR(fSel);
                                                            rSel.RESET;
                                                          END;
                                                           }
      { 20  ;CommandButton;9680 ;1870 ;440  ;440  ;Name=Seleccionar;
                                                   HorzGlue=Left;
                                                   VertGlue=Top;
                                                   InPage=-1;
                                                   CaptionML=ESP=...;
                                                   ToolTipML=ESP=Seleccionar Vehiculos;
                                                   OnPush=VAR
                                                            rSel@1100244001 : Record 7010352;
                                                            fSel@1100244002 : Form 7010386;
                                                            rPar@1100244003 : Record 7010311;
                                                          BEGIN
                                                            rPar.FINDFIRST;

                                                            rSel.RESET;
                                                            rSel.INIT;
                                                            rSel.SETCURRENTKEY(Usuario,Garaje, Numero);
                                                            rSel.FILTERGROUP(2);
                                                            rSel.SETRANGE(Usuario,USERID);

                                                            IF (vGaraje<>'') AND (vGaraje<>rPar."Todos los garajes") THEN
                                                              rSel.SETRANGE(Garaje, vGaraje);

                                                            rSel.FILTERGROUP(0);

                                                            CLEAR(fSel);
                                                            fSel.SETTABLEVIEW(rSel);
                                                            fSel.RUN;
                                                            CLEAR(fSel);
                                                            rSel.RESET;
                                                          END;
                                                           }
      { 11  ;TextBox      ;6380 ;1870 ;3300 ;440  ;InPage=-1;
                                                   SourceExpr=vVehiculos;
                                                   OnValidate=BEGIN
                                                                IF vVehiculos=vVehiculos::"Todos los Veh¡culos" THEN
                                                                  RequestOptionsForm.Seleccionar.VISIBLE:=FALSE
                                                                ELSE
                                                                  RequestOptionsForm.Seleccionar.VISIBLE:=TRUE;
                                                              END;
                                                               }
      { 14  ;Label        ;220  ;1870 ;6050 ;440  ;InPage=-1;
                                                   CaptionML=ESP=Selecci¢n Veh¡culos }
      { 21  ;TextBox      ;6380 ;2420 ;3300 ;440  ;Name=TipoAgrupacion;
                                                   InPage=-1;
                                                   SourceExpr=vTipoAgrupacion;
                                                   OnValidate=BEGIN
                                                                IF vTipoAgrupacion=vTipoAgrupacion::"Agrupaci¢n Plazas" THEN
                                                                  RequestOptionsForm.Agrupar.VISIBLE:= TRUE
                                                                ELSE
                                                                  RequestOptionsForm.Agrupar.VISIBLE:= FALSE;
                                                              END;
                                                               }
      { 22  ;Label        ;220  ;2420 ;6050 ;440  ;InPage=-1;
                                                   CaptionML=ESP=Tipo de Agrupaci¢n }
      { 23  ;Label        ;220  ;3520 ;6050 ;440  ;ParentControl=24;
                                                   InPage=-1;
                                                   MultiLine=Yes;
                                                   CaptionML=ESP=Garaje a considerar en resultados;
                                                   ToolTipML=ESP=Si se marca s¢lo se considerar n los vehiculos que han tenido actividad }
      { 24  ;TextBox      ;6380 ;3520 ;2310 ;440  ;Name=FltGaraje;
                                                   InPage=-1;
                                                   NextControl=7;
                                                   SourceExpr=vGarajeResult;
                                                   TableRelation=Garaje.Garaje;
                                                   OnValidate=VAR
                                                                cfunbas@1100244001 : Codeunit 7010310;
                                                              BEGIN
                                                                cfunbas.TestRestringido(vGaraje);
                                                              END;
                                                               }
      { 26  ;Label        ;220  ;2970 ;6050 ;440  ;ParentControl=27;
                                                   InPage=-1;
                                                   MultiLine=Yes;
                                                   CaptionML=ESP=Selecci¢n seg£n la propiedad del Vehiculo;
                                                   ToolTipML=ESP=Si se marca s¢lo se considerar n los vehiculos que han tenido actividad }
      { 27  ;TextBox      ;6380 ;2970 ;2200 ;440  ;InPage=-1;
                                                   NextControl=24;
                                                   SourceExpr=vPropiedad }
      { 25  ;CheckBox     ;6380 ;6930 ;440  ;440  ;InPage=-1;
                                                   ShowCaption=No;
                                                   NextControl=3;
                                                   SourceExpr=vVerBloqueados }
      { 28  ;Label        ;220  ;6930 ;6050 ;440  ;InPage=-1;
                                                   MultiLine=Yes;
                                                   CaptionML=ESP=Mostrar vehiculos bloqueados;
                                                   ToolTipML=ESP=Si se marca s¢lo se considerar n los vehiculos que han tenido actividad }
      { 29  ;TextBox      ;6380 ;4070 ;1650 ;440  ;InPage=-1;
                                                   SourceExpr=vDivisa;
                                                   TableRelation=Currency;
                                                   OnValidate=VAR
                                                                cFunBas@1100244001 : Codeunit 7010310;
                                                              BEGIN
                                                              END;
                                                               }
      { 30  ;Label        ;220  ;4070 ;6050 ;440  ;InPage=-1;
                                                   CaptionML=ESP=C¢d. Divisa }
    }
  }
  REQUESTPAGE
  {
    PROPERTIES
    {
    }
    CONTROLS
    {
    }
  }
  CODE
  {
    VAR
      Text000@1100244057 : TextConst 'ESP=TODOS';
      Text001@1100244058 : TextConst 'ESP=Hay vehiculos que no tienen definido el n£mero de plazas. Rev¡selo.';
      Text002@1100244059 : TextConst 'ESP=" de "';
      Text003@1100244060 : TextConst 'ESP="Total Vehic. "';
      Text004@1100244061 : TextConst 'ESP=" plazas"';
      Text005@1100244062 : TextConst 'ESP="Total Grupo "';
      Text006@1100244063 : TextConst 'ESP="Media Vehic. "';
      Text007@1100244064 : TextConst 'ESP="Media Grupo "';
      Text008@1100244065 : TextConst 'ESP=Total General';
      Text009@1100244066 : TextConst 'ESP=Media General';
      LastFieldNo@1100244000 : Integer;
      FooterPrinted@1100244001 : Boolean;
      vOldPlazas@1100244002 : Code[10];
      vOldNumero@1100244003 : Text[10];
      vA¤o@1100244004 : Integer;
      vMes@1100244005 : 'Enero,Febrero,Marzo,Abril,Mayo,Junio,Julio,Agosto,Septiembre,Octubre,Noviembre,Diciembre';
      vGaraje@1100244006 : Code[10];
      vIniMes@1100244007 : Date;
      vFinMes@1100244008 : Date;
      vIniAcum@1100244009 : Date;
      vFinAcum@1100244010 : Date;
      vPaxTransMes@1100244011 : ARRAY [2,10] OF Decimal;
      vPaxTransAcum@1100244012 : ARRAY [2,10] OF Decimal;
      vPaxTransTotAcum@1100244013 : ARRAY [3] OF Decimal;
      vPaxTransTot@1100244014 : ARRAY [3] OF Decimal;
      vPaxFactMes@1100244015 : ARRAY [2,10] OF Decimal;
      vPaxFactAcum@1100244016 : ARRAY [2,10] OF Decimal;
      vPaxFactTotAcum@1100244017 : ARRAY [3] OF Decimal;
      vPaxFactTot@1100244018 : ARRAY [3] OF Decimal;
      vViajesMes@1100244019 : ARRAY [2,10] OF Decimal;
      vViajesAcum@1100244020 : ARRAY [2,10] OF Decimal;
      vViajesTot@1100244021 : ARRAY [3] OF Decimal;
      vViajesTotAcum@1100244022 : ARRAY [3] OF Decimal;
      vFactMes@1100244023 : ARRAY [2,10] OF Decimal;
      vFactAcum@1100244024 : ARRAY [2,10] OF Decimal;
      vFactTot@1100244025 : ARRAY [3] OF Decimal;
      vFactTotAcum@1100244026 : ARRAY [3] OF Decimal;
      vOcupMes@1100244027 : Decimal;
      vOcupAcum@1100244028 : Decimal;
      ContaTS@1100244029 : Integer;
      vImpTotalGrupo@1100244030 : Boolean;
      vTextoTotal@1100244031 : Text[30];
      vTextoMedia@1100244032 : Text[30];
      vAntMat@1100244033 : Code[10];
      vTotalPlazasGrupo@1100244034 : Integer;
      vVehiculosDelGrupo@1100244035 : Integer;
      vNumeroTotalPlazas@1100244036 : Integer;
      vNumTotalVehiculos@1100244037 : Integer;
      vIngPorButaca@1100244038 : Decimal;
      vPrecision@1100244039 : Decimal;
      vAntGaraje@1100244040 : Code[10];
      vFltGaraje@1100244041 : Text[10];
      vAgrupacionGeneral@1100244042 : Boolean;
      vAgrupacionporPlazas@1100244043 : Boolean;
      vMostrarDetalle@1100244044 : Boolean;
      vTextoNormal@1100244045 : Text[20];
      vSoloConActividad@1100244046 : Boolean;
      vVehiculos@1100244047 : 'Todos los Veh¡culos,Seg£n Selecci¢n';
      vTipoAgrupacion@1100244048 : 'Grupo Veh¡culos,Agrupaci¢n Plazas';
      vGarajeResult@1100244049 : Code[10];
      vFltGarajeResult@1100244050 : Text[30];
      vTipoLinea@1100244051 : Text[50];
      vTipoElemento@1100244052 : Text[50];
      vPropiedad@1100244053 : 'Todos,S¢lo Propios,S¢lo Ajenos';
      vVerBloqueados@1100244054 : Boolean;
      vDivisa@1100244055 : Code[10];
      rParametros@1100244056 : Record 7010311;

    PROCEDURE ObtenerOcupacion@1(p1@1100244000 : Decimal;p2@1100244001 : Decimal;pPrecision@1100244002 : Decimal) : Decimal;
    VAR
      Result@1100244003 : Decimal;
    BEGIN
      IF (p2 = 0) THEN
        Result := 0
      ELSE
        Result := ROUND(100 * (p1 / p2) ,pPrecision);

      EXIT(Result);
    END;

    PROCEDURE Inicializar@2(VAR vMatriz@1100244000 : ARRAY [10] OF Decimal);
    VAR
      i@1100244001 : Integer;
    BEGIN
      //Inicializar.
      //Inicializamos la matriz para el cambio de grupo de vehiculo.
      //Las matrices tienen profundidad 10.
      FOR i:=1 TO 10 DO
        vMatriz[i]:=0;
    END;

    PROCEDURE ActualizarMatrices@3(pValorMes@1100244000 : Decimal;pValorAcum@1100244001 : Decimal;pContaTS@1100244002 : Integer;VAR aMes@1100244003 : ARRAY [2,10] OF Decimal;VAR aAcum@1100244004 : ARRAY [2,10] OF Decimal;VAR aTot@1100244005 : ARRAY [3] OF Decimal;VAR aTotAcum@1100244006 : ARRAY [3] OF Decimal);
    BEGIN
      //ActualizarMatrices();
      //Actualizar los totales obtenidos para viajes,pax.transportado,facturado e importe facturado.
      //Como las matrices son an logas: de tipo decimal y de las mismas dimensiones, nos aprovechamos
      //de la circunstancia.

      //EMPEZAMOS...

      //Para visualizar lo del Mes para un determinado tipo de Servicio / Vehiculo.
      aMes  [1,1]  := pValorMes;

      //Para visualizar el Total del mes para un determinado Vehiculo.
      aTot  [1]   := aTot[1]   + aMes[1,1];

      //Para visualizar lo del Mes para el Grupo de vehiculos con mismo numero de plazas teniendo en
      //cuenta el tipo de servicio.
      aMes  [1,pContaTS]:= aMes[1,pContaTS]+aMes[1,1];

      //Para visualizar lo del Mes considerando TODOS los vehiculos y un determinado tipo de servicio.
      aMes  [2,pContaTS]:= aMes[2,pContaTS]+aMes[1,1];

      //Para visualizar el Acumulado para un determinado tipo de Servicio / Vehiculo.
      aAcum[1,1]   := pValorAcum;

      //Para visualizar el Total Acumulado para un determinado Vehiculo.
      aTotAcum[1]  := aTotAcum[1]+aAcum[1,1];

      //Para visualizar el Acumulado para un Grupo de vehiculos con mismo numero de plazas teniendo en
      //cuenta el tipo de servicio.
      aAcum[1,pContaTS]:= aAcum[1,pContaTS]+aAcum[1,1];

      //Para visualizar el Acumulado considerando TODOS los vehiculos y un determinado tipo de servicio.
      aAcum[2,pContaTS]:= aAcum[2,pContaTS]+aAcum[1,1];

      //Preparamos los valores TOTALES para la agrupaci¢n por Num. Plazas.
      aTot[2]      := aTot[2]     + aMes[1,1];
      aTotAcum[2]  := aTotAcum[2] + aAcum[1,1];

      //Preparamos para el acumulado general (TOTAL) para MES y Acumulado.
      aTot[3]      := aTot[3] + aMes[1,1];
      aTotAcum[3]  := aTotAcum[3] + aAcum[1,1];
    END;

    PROCEDURE CalcularMedias@5(VAR aTot@1100244000 : Decimal;VAR aTotAcum@1100244001 : Decimal;NumeroElementos@1100244002 : Integer);
    BEGIN
      //CalcularMedias(aTot,aTotAcum,NumeroElementos);
      //Sobreescribiremos la matriz para el c lculo de las medias.
      //Ponemos una precision total, para que los c lculos de ocupaci¢n,.., no pierdan precisi¢n.
      //En la salida por pantalla, ya redondearemos.

      IF NumeroElementos <> 0 THEN
        aTot  := ROUND(aTot / NumeroElementos,0.00001,'=')
      ELSE
        aTot  := 0;

      IF NumeroElementos <> 0 THEN
        aTotAcum := ROUND(aTotAcum / NumeroElementos,0.00001,'=')
      ELSE
        aTotAcum := 0;

      rParametros.FINDFIRST;
    END;

    PROCEDURE TestActividad@9(VAR rVeh@1100244000 : Record 7010352) : Boolean;
    VAR
      rIngreso@1100244001 : Record 7010414;
      rParte@1100244002 : Record 7010360;
      vConcepto@1100244003 : 'Ingreso';
    BEGIN
      //TestActividad(rVeh: Record Vehiculo).
      //El proposito es saber si para un vehiculo, para unas fechas determinadas, ha habido actividad.

      rParte.RESET;
      rParte.SETCURRENTKEY(Confirmado,Vehiculo,"Fecha facturacion");

      rIngreso.RESET;
      rIngreso.SETCURRENTKEY(Vehiculo,Fecha);

      //Recorremos todos los vehiculos que se van a considerar en el informe.
      IF rVeh.FINDSET(TRUE) THEN REPEAT
        rVeh.Actividad := TRUE;
        rParte.SETRANGE(Confirmado,TRUE);
        rParte.SETRANGE(Vehiculo,rVeh.Matricula);

      // JPT 21/11/01 Cambiamos la consideraciones del rango de fechas, tendremos en cuenta la fecha Parametros.Fecha Inicio Acumulados
        //rParte.SETRANGE(Fecha,vIniMes,vFinMes);
        rParte.SETRANGE(Fecha,rParametros."Fecha Inicio Acumulados",vFinMes);
        //
        IF NOT rParte.FINDFIRST THEN BEGIN
          rIngreso.SETRANGE(Vehiculo,rVeh.Matricula);
          // JPT 21/11/01
          rIngreso.SETRANGE(Fecha,rParametros."Fecha Inicio Acumulados",vFinMes);
          //rIngreso.SETRANGE(Fecha,vIniMes,vFinMes);
          IF NOT rIngreso.FINDFIRST THEN
            rVeh.Actividad := FALSE;
        END;
        rVeh.MODIFY;

      UNTIL rVeh.NEXT=0;
    END;

    PROCEDURE Agrupar1@6();
    VAR
      rSelVeh@1100244000 : Record 7010352;
    BEGIN
      //Agrupar1().
      //Como la agrupaci¢n ser  por tipo de Vehiculo, entonces asignaremos al campo Agrupacion
      //el valor del Tipo Vehiculo.
      rSelVeh.RESET;
      rSelVeh.SETCURRENTKEY(Usuario);
      rSelVeh.SETRANGE(Usuario,USERID);
      IF rSelVeh.FINDSET(TRUE) THEN REPEAT
        rSelVeh.Agrupacion := rSelVeh."Tipo Vehiculo";
        rSelVeh.MODIFY;
      UNTIL rSelVeh.NEXT=0;
    END;

    PROCEDURE Agrupar2@7();
    VAR
      cFunVeh@1100244000 : Codeunit 7010317;
      Contador@1100244001 : Integer;
      vGrupo@1100244002 : Code[10];
      aRangos@1100244003 : ARRAY [100,3] OF Integer;
      aRGaraje@1100244004 : ARRAY [100] OF Code[10];
      rSelVeh@1100244005 : Record 7010352;
    BEGIN
      //Agrupar2().
      //Este caso ya es m s complicado: Hay que ir buscando los rangos.
      //Usaremos una matriz para ir m s r pidos.
      cFunVeh.CrearAgrupacionRangos(aRangos,aRGaraje,Contador);

      //Una vez cargada la matriz ya podemos empezar a agrupar.
      rSelVeh.RESET;
      rSelVeh.SETCURRENTKEY(Usuario);
      rSelVeh.SETRANGE(Usuario,USERID);
      IF rSelVeh.FINDSET(TRUE) THEN REPEAT
        vGrupo := cFunVeh.ObtenerAgrupacionRango(rSelVeh.Garaje,aRangos,aRGaraje,Contador,rSelVeh.Plazas);

        //Si no obtenemos el c¢digo de agrupaci¢n PERO resulta que no estamos agrupando por plazas
        //entonces le asignamos como grupo, el n£mero de plazas.(siguientes 2 lineas de c¢digo).
        //Si no hicieramos esto, el vehiculo no saldr¡a en el informe.
        //Ser¡a una anomal¡a peque¤a, pero anomal¡a al fin y al cabo.

        IF (vGrupo='') AND (NOT vAgrupacionporPlazas) THEN
          vGrupo := FORMAT(rSelVeh.Plazas);

        rSelVeh.Agrupacion := vGrupo;
        rSelVeh.MODIFY;

      UNTIL rSelVeh.NEXT=0;
    END;

    PROCEDURE CalcularMediaPax@8(pPax@1100244000 : Decimal;pViajes@1100244001 : Decimal) : Decimal;
    VAR
      vResult@1100244002 : Decimal;
    BEGIN
      vResult := 0;
      IF pViajes <> 0 THEN
        vResult := ROUND(pPax / pViajes,1);
      EXIT(vResult);
    END;

    BEGIN
    {
       //Las referencias a Vehiculo.Plazas deber n sustituirse, por otro valor, ya que este
       //no creo que sea el valor indicado para agrupar.
    }
    END.
  }
  RDLDATA
  {
  }
}
