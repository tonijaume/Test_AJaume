OBJECT Report 7010360 Pref. Resumen  Zona-Dia-Codigo
{
  OBJECT-PROPERTIES
  {
    Date=12/02/15;
    Time=11:54:01;
    Modified=Yes;
    Version List=TRANSFER,INV;
  }
  PROPERTIES
  {
    CaptionML=ESP=Pref. Resumen  Zona-Dia-Codigo;
    TopMargin=0;
    BottomMargin=0;
    LeftMargin=0;
  }
  DATAITEMS
  {
    { PROPERTIES
      {
        DataItemTable=Table7010415;
        DataItemTableView=SORTING(N§ Prefactura)
                          WHERE(Desactivada=CONST(No));
        NewPagePerGroup=Yes;
        OnPreDataItem=BEGIN
                        rInf.RESET; rInf.INIT;
                        rInf.FINDFIRST;
                      END;

        OnAfterGetRecord=BEGIN
                           rCon.RESET; rCon.INIT;
                           rCon.GET(Garaje, "N§ Contrato");

                           // AJF 13/03/08 - DRF 07002
                           IF rCon."Descuento sobre maletas" THEN
                             w_dto_maletas := "% Dto"
                           ELSE
                             w_dto_maletas := 0;

                           // JPT 30/07/09 Si no est  reordenado (campo Orden) lo reordena
                           CompOrden(TRUE);

                           _GetVATPosting;
                         END;

        ReqFilterFields=N§ Prefactura;
        GroupTotalFields=N§ Prefactura;
      }
      SECTIONS
      {
        { PROPERTIES
          {
            SectionType=Header;
            PrintOnEveryPage=Yes;
            SectionWidth=19050;
            SectionHeight=3384;
            KeepWithNext=No;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT("Imprime Mail");
                         END;

          }
          CONTROLS
          {
            { 1103355028;Image  ;2290 ;1745 ;11130;846  ;Bitmap=C:\logos\logo_fac_3.bmp }
            { 1103355029;Image  ;0    ;0    ;2310 ;3384 ;Bitmap=C:\logos\logo_fac_1.bmp }
            { 1103355030;Image  ;2275 ;805  ;5460 ;1269 ;Bitmap=C:\logos\logo_fac_2.bmp }
            { 1103355031;Image  ;7710 ;805  ;5670 ;1269 ;Bitmap=C:\logos\logo_fac_4.bmp }
          }
           }
        { PROPERTIES
          {
            SectionType=Header;
            PrintOnEveryPage=Yes;
            SectionWidth=19050;
            SectionHeight=3384;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT(NOT "Imprime Mail");
                         END;

          }
          CONTROLS
          {
          }
           }
        { PROPERTIES
          {
            SectionType=TransHeader;
            SectionWidth=19050;
            SectionHeight=2538;
          }
          CONTROLS
          {
            { 43  ;Label        ;2100 ;846  ;2250 ;423  ;ParentControl=68;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         LeaderDots=Yes }
            { 44  ;Label        ;2100 ;1269 ;2250 ;423  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         LeaderDots=Yes;
                                                         CaptionML=ESP=Cliente }
            { 64  ;Label        ;2100 ;1692 ;2250 ;423  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         LeaderDots=Yes;
                                                         CaptionML=ESP=Touroperador }
            { 65  ;Label        ;11550;846  ;2250 ;423  ;ParentControl=69;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         LeaderDots=Yes }
            { 66  ;Label        ;11550;1269 ;2250 ;423  ;ParentControl=70;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         LeaderDots=Yes }
            { 67  ;Label        ;11550;1692 ;2250 ;423  ;ParentControl=71;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         LeaderDots=Yes }
            { 68  ;TextBox      ;4500 ;846  ;1800 ;423  ;HorzAlign=Left;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         SourceExpr="N§ Prefactura" }
            { 69  ;TextBox      ;13950;846  ;1650 ;423  ;HorzAlign=Left;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         SourceExpr="Fecha desde" }
            { 70  ;TextBox      ;13950;1269 ;1650 ;423  ;HorzAlign=Left;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         SourceExpr="Fecha hasta" }
            { 71  ;TextBox      ;13950;1692 ;4350 ;423  ;HorzAlign=Left;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         SourceExpr="Tipos Servicio" }
            { 72  ;TextBox      ;4500 ;1269 ;4950 ;423  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         SourceExpr=NomClienteFacturacion }
            { 73  ;TextBox      ;4500 ;1692 ;4950 ;423  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         SourceExpr=nom_touroperador }
            { 86  ;TextBox      ;2100 ;0    ;4950 ;423  ;FontSize=8;
                                                         SourceExpr=rInf.Name }
            { 87  ;TextBox      ;17550;0    ;750  ;423  ;FontSize=8;
                                                         SourceExpr=CurrReport.PAGENO }
            { 88  ;Label        ;16050;0    ;1350 ;423  ;FontSize=8;
                                                         LeaderDots=Yes;
                                                         CaptionML=ESP=Pagina }
          }
           }
        { PROPERTIES
          {
            SectionType=GroupHeader;
            SectionWidth=19050;
            SectionHeight=2115;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT :=
                             CurrReport.TOTALSCAUSEDBY = "Prefactura ingreso".FIELDNO("N§ Prefactura");
                           CurrReport.PAGENO := 1;
                         END;

          }
          CONTROLS
          {
            { 42  ;TextBox      ;2100 ;0    ;4950 ;423  ;FontSize=8;
                                                         SourceExpr=rInf.Name }
            { 8   ;TextBox      ;17550;0    ;750  ;423  ;FontSize=8;
                                                         SourceExpr=CurrReport.PAGENO }
            { 9   ;Label        ;16050;0    ;1350 ;423  ;FontSize=8;
                                                         LeaderDots=Yes;
                                                         CaptionML=ESP=Pagina }
            { 1   ;Label        ;2100 ;846  ;2250 ;423  ;ParentControl=3;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         LeaderDots=Yes }
            { 2   ;Label        ;2100 ;1269 ;2250 ;423  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         LeaderDots=Yes;
                                                         CaptionML=ESP=Cliente }
            { 3   ;TextBox      ;4500 ;846  ;1800 ;423  ;HorzAlign=Left;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         SourceExpr="N§ Prefactura" }
            { 4   ;TextBox      ;4500 ;1269 ;4950 ;423  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         SourceExpr=NomClienteFacturacion }
            { 5   ;Label        ;2100 ;1692 ;2250 ;423  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         LeaderDots=Yes;
                                                         CaptionML=ESP=Touroperador }
            { 6   ;TextBox      ;4500 ;1692 ;4950 ;423  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         SourceExpr=nom_touroperador }
            { 18  ;Label        ;11550;846  ;2250 ;423  ;ParentControl=30;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         LeaderDots=Yes }
            { 22  ;Label        ;11550;1269 ;2250 ;423  ;ParentControl=32;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         LeaderDots=Yes }
            { 24  ;Label        ;11550;1692 ;2250 ;423  ;ParentControl=34;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         LeaderDots=Yes }
            { 30  ;TextBox      ;13950;846  ;1650 ;423  ;HorzAlign=Left;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         SourceExpr="Fecha desde" }
            { 32  ;TextBox      ;13950;1269 ;1650 ;423  ;HorzAlign=Left;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         SourceExpr="Fecha hasta" }
            { 34  ;TextBox      ;13950;1692 ;4350 ;423  ;HorzAlign=Left;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         SourceExpr="Tipos Servicio" }
          }
           }
        { PROPERTIES
          {
            SectionType=Body;
            SectionWidth=19050;
            SectionHeight=0;
          }
          CONTROLS
          {
          }
           }
        { PROPERTIES
          {
            SectionType=GroupFooter;
            SectionWidth=19050;
            SectionHeight=3807;
            OnPreSection=BEGIN
                           IF w_maletas <> 0 THEN
                             w_texto_maletas := Text000
                           ELSE
                             w_texto_maletas := '';

                           wDTO := 1 + ROUND("% Dto" / 100); //+$003
                           //+$002 <
                           IF "Impuesto Incluidos" THEN
                           BEGIN
                             w_base_net := ROUND(w_base_con / wIVA);
                             w_maletas_net := ROUND(w_maletas_con / wIVA);
                             w_total_net := ROUND(w_total_con / wIVA);

                             w_base := ROUND(w_base_net / wDTO);
                             w_maletas := ROUND(w_maletas_net / wDTO);
                             w_total := ROUND(w_total_net / wDTO);
                           END
                           ELSE
                           BEGIN
                             w_base_con := ROUND(w_base_net * wIVA);
                             w_maletas_con := ROUND(w_maletas_net * wIVA);
                             w_total_con := ROUND(w_total_net * wIVA);
                           END;
                           //+$002 >
                         END;

          }
          CONTROLS
          {
            { 45  ;Label        ;11700;423  ;2700 ;423  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         LeaderDots=Yes;
                                                         CaptionML=ESP=Totales }
            { 46  ;TextBox      ;14550;423  ;750  ;423  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         DecimalPlaces=0:2;
                                                         SourceExpr=w_tot_paxes }
            { 47  ;TextBox      ;16500;423  ;1800 ;423  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         SourceExpr=w_total_impresion;
                                                         AutoFormatType=1;
                                                         AutoFormatExpr=rDiv.Code }
            { 48  ;Shape        ;14550;0    ;3750 ;423  ;ShapeStyle=HorzLine }
            { 1103355000;Label  ;6450 ;846  ;1800 ;846  ;HorzAlign=Right;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=ESP=BASE IMPONIBLE }
            { 1103355001;Label  ;8400 ;846  ;750  ;846  ;HorzAlign=Right;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=ESP=% DTO }
            { 1103355002;Label  ;9300 ;846  ;1800 ;846  ;HorzAlign=Right;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=ESP=IMPORTE DESCUENTO }
            { 1103355003;Label  ;11250;846  ;1800 ;846  ;HorzAlign=Right;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=ESP=BASE NETA }
            { 1103355004;Label  ;13200;846  ;1800 ;846  ;HorzAlign=Right;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=ESP=IVA/IGIC }
            { 1103355005;Shape  ;6450 ;1692 ;10500;423  ;ShapeStyle=HorzLine }
            { 1103355006;Label  ;15150;846  ;1800 ;846  ;HorzAlign=Right;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=ESP=TOTAL }
            { 1103355007;TextBox;6450 ;2115 ;1800 ;423  ;FontSize=8;
                                                         SourceExpr=w_base;
                                                         AutoFormatType=1;
                                                         AutoFormatExpr=rDiv.Code }
            { 1103355008;TextBox;13200;2115 ;1800 ;423  ;FontSize=8;
                                                         SourceExpr=w_base_con - w_base_net;
                                                         AutoFormatType=1;
                                                         AutoFormatExpr=rDiv.Code }
            { 1103355009;TextBox;15150;2115 ;1800 ;423  ;FontSize=8;
                                                         SourceExpr=w_base_con;
                                                         AutoFormatType=1;
                                                         AutoFormatExpr=rDiv.Code }
            { 1103355010;TextBox;3000 ;2115 ;3300 ;423  ;HorzAlign=Left;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         SourceExpr="Tipos Servicio" }
            { 1103355011;TextBox;9300 ;2115 ;1800 ;423  ;FontSize=8;
                                                         SourceExpr=w_base_net - w_base;
                                                         AutoFormatType=1;
                                                         AutoFormatExpr=rDiv.Code }
            { 1103355012;TextBox;11250;2115 ;1800 ;423  ;FontSize=8;
                                                         SourceExpr=w_base_net;
                                                         AutoFormatType=1;
                                                         AutoFormatExpr=rDiv.Code }
            { 1103355013;TextBox;8400 ;2115 ;750  ;423  ;FontSize=8;
                                                         SourceExpr="% Dto";
                                                         AutoFormatType=1;
                                                         AutoFormatExpr=rDiv.Code }
            { 1103355014;TextBox;6450 ;2538 ;1800 ;423  ;FontSize=8;
                                                         BlankZero=Yes;
                                                         SourceExpr=w_maletas;
                                                         AutoFormatType=1;
                                                         AutoFormatExpr=rDiv.Code }
            { 1103355015;TextBox;13200;2538 ;1800 ;423  ;FontSize=8;
                                                         BlankZero=Yes;
                                                         SourceExpr=[w_maletas_con - w_maletas_net ];
                                                         AutoFormatType=1;
                                                         AutoFormatExpr=rDiv.Code }
            { 1103355016;TextBox;15150;2538 ;1800 ;423  ;FontSize=8;
                                                         BlankZero=Yes;
                                                         SourceExpr=w_maletas_con;
                                                         AutoFormatType=1;
                                                         AutoFormatExpr=rDiv.Code }
            { 1103355017;TextBox;3000 ;2538 ;3300 ;423  ;HorzAlign=Left;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         SourceExpr=w_texto_maletas }
            { 1103355018;TextBox;9300 ;2538 ;1800 ;423  ;FontSize=8;
                                                         BlankZero=Yes;
                                                         SourceExpr=[w_maletas_net - w_maletas ];
                                                         AutoFormatType=1;
                                                         AutoFormatExpr=rDiv.Code }
            { 1103355019;TextBox;11250;2538 ;1800 ;423  ;FontSize=8;
                                                         BlankZero=Yes;
                                                         SourceExpr=w_maletas_net;
                                                         AutoFormatType=1;
                                                         AutoFormatExpr=rDiv.Code }
            { 1103355020;TextBox;8400 ;2538 ;750  ;423  ;FontSize=8;
                                                         BlankZero=Yes;
                                                         SourceExpr=w_dto_maletas;
                                                         AutoFormatType=1;
                                                         AutoFormatExpr=rDiv.Code }
            { 1103355021;Shape  ;6450 ;2961 ;10500;423  ;ShapeStyle=HorzLine }
            { 1103355022;TextBox;6450 ;3384 ;1800 ;423  ;FontSize=8;
                                                         SourceExpr=w_total;
                                                         AutoFormatType=1;
                                                         AutoFormatExpr=rDiv.Code }
            { 1103355023;TextBox;13200;3384 ;1800 ;423  ;FontSize=8;
                                                         SourceExpr=w_total_con - w_total_net;
                                                         AutoFormatType=1;
                                                         AutoFormatExpr=rDiv.Code }
            { 1103355024;TextBox;15150;3384 ;1800 ;423  ;FontSize=8;
                                                         SourceExpr=w_total_con;
                                                         AutoFormatType=1;
                                                         AutoFormatExpr=rDiv.Code }
            { 1103355025;Label  ;3000 ;3384 ;3150 ;423  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         LeaderDots=Yes;
                                                         CaptionML=ESP=TOTAL PREFACTURA }
            { 1103355026;TextBox;9300 ;3384 ;1800 ;423  ;FontSize=8;
                                                         SourceExpr=w_total_net - w_total;
                                                         AutoFormatType=1;
                                                         AutoFormatExpr=rDiv.Code }
            { 1103355027;TextBox;11250;3384 ;1800 ;423  ;FontSize=8;
                                                         SourceExpr=w_total_net;
                                                         AutoFormatType=1;
                                                         AutoFormatExpr=rDiv.Code }
          }
           }
        { PROPERTIES
          {
            SectionType=Footer;
            PrintOnEveryPage=Yes;
            PlaceInBottom=Yes;
            SectionWidth=19050;
            SectionHeight=3807;
            KeepWithNext=No;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT("Imprime Mail");
                         END;

          }
          CONTROLS
          {
            { 1103355032;Image  ;2250 ;0    ;4620 ;1269 ;Bitmap=C:\logos\ibizatours.bmp }
            { 1103355033;Label  ;2250 ;1692 ;2940 ;423  ;HorzAlign=Right;
                                                         FontSize=7;
                                                         FontBold=Yes;
                                                         CaptionML=ESP="Base de operaciones: " }
            { 1103355034;Label  ;5190 ;1692 ;13860;423  ;HorzAlign=Left;
                                                         FontSize=7;
                                                         CaptionML=ESP=Ctra. de San Antonio, km. 2.5 - B§ Can Negre - Tel. 971 31 43 62 - Fax 971 31 16 11 - Apdo. de Correos 343 - 07800 Ibiza }
            { 1103355035;Image  ;8130 ;0    ;5040 ;1269 ;Bitmap=C:\logos\islandbus2.bmp }
            { 1103355036;Image  ;14640;0    ;4410 ;1269 ;Bitmap=C:\logos\unionexpress2.bmp }
            { 1103355037;Label  ;2250 ;2115 ;16800;423  ;HorzAlign=Center;
                                                         FontSize=7;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=www.ibizatours.es / www.islandbus.com }
            { 1103355038;Shape  ;2250 ;2538 ;16800;423  ;ShapeStyle=HorzLine }
            { 1103355039;Label  ;2250 ;2961 ;7560 ;423  ;HorzAlign=Right;
                                                         FontSize=7;
                                                         FontBold=Yes;
                                                         CaptionML=ESP="Domicilio social y administrativo: " }
            { 1103355040;Label  ;9810 ;2961 ;9240 ;423  ;HorzAlign=Left;
                                                         FontSize=7;
                                                         CaptionML=ESP="C/. Vicente Cuervo, 9 - 07800 Ibiza - Tel. 971 31 15 00 " }
            { 1103355041;Label  ;2250 ;3384 ;16800;423  ;HorzAlign=Center;
                                                         FontSize=7;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=INSCRITA EN EL REGISTRO MERCANTIL DE EIVISSA - TOMO 160, LIBRO 159, FOLIO 56, HOJA IB-7171, INSCRIPCIàN 1¦ - C.I.F. B-57271553 }
          }
           }
        { PROPERTIES
          {
            SectionType=Footer;
            PrintOnEveryPage=Yes;
            PlaceInBottom=Yes;
            SectionWidth=19050;
            SectionHeight=846;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT(NOT "Imprime Mail");
                         END;

          }
          CONTROLS
          {
          }
           }
      }
       }
    { PROPERTIES
      {
        DataItemIndent=1;
        DataItemTable=Table7010417;
        DataItemTableView=SORTING(N§ Prefactura,Orden);
        OnPreDataItem=BEGIN
                        w_base := 0;
                        w_base_net := 0;            // AJF 13/03/08 - DRF 07002
                        w_base_con := 0;
                        w_maletas := 0;
                        w_maletas_net := 0;         // AJF 13/03/08 - DRF 07002
                        w_maletas_con := 0;
                        w_total := 0;
                        w_total_net := 0;           // AJF 13/03/08 - DRF 07002
                        w_total_con := 0;
                        w_plazas := 0;
                        w_importe_con := 0;
                        w_total_impresion := 0;

                        _BuscaTipoServicio; //+$001
                      END;

        OnAfterGetRecord=VAR
                           "rTipoCam.Divisas"@1100244000 : Record 330;
                           lw_Importe_Con_Impuestos@1100244001 : Decimal;
                           lw_Importe_Sin_Impuestos@1100244002 : Decimal;
                           lw_Precio_Con_Impuestos@1100244003 : Decimal;
                           lw_Precio_Sin_Impuestos@1100244004 : Decimal;
                           lw_Impo_Sin_Impu_Sin_Dto@1103355000 : Decimal;
                         BEGIN
                           wPrimeraLinea := "Lineas Prefactura".Parte <> wNoParte;
                           IF wPrimeraLinea THEN
                             wNoParte := "Lineas Prefactura".Parte;


                           IF w_ImpDivisaLocal THEN BEGIN
                             CLEAR(rDiv);
                            // AJF 13/03/08 - DRF 07002
                             lw_Impo_Sin_Impu_Sin_Dto := "rTipoCam.Divisas".ExchangeAmtFCYToFCY("Prefactura ingreso"."Fecha desde",
                                                                          "Cod. Divisa",'',"Importe Sin IVA Sin Dto");
                             lw_Importe_Con_Impuestos := "rTipoCam.Divisas".ExchangeAmtFCYToFCY("Prefactura ingreso".Fecha,
                                                                          "Cod. Divisa",'',"Importe con impuestos");
                             lw_Importe_Sin_Impuestos := "rTipoCam.Divisas".ExchangeAmtFCYToFCY("Prefactura ingreso".Fecha,
                                                                          "Cod. Divisa",'',"Importe sin impuestos");
                             lw_Precio_Con_Impuestos  := "rTipoCam.Divisas".ExchangeAmtFCYToFCY("Prefactura ingreso".Fecha,
                                                                          "Cod. Divisa",'',"Precio con impuestos");
                             lw_Precio_Sin_Impuestos  := "rTipoCam.Divisas".ExchangeAmtFCYToFCY("Prefactura ingreso".Fecha,
                                                                          "Cod. Divisa",'',"Precio sin impuestos");
                           END
                           ELSE BEGIN
                             IF "Cod. Divisa" <> '' THEN
                               rDiv.GET("Cod. Divisa");
                             lw_Impo_Sin_Impu_Sin_Dto := "Importe Sin IVA Sin Dto";     // AJF 13/03/08 - DRF 07002
                             lw_Importe_Con_Impuestos := "Importe con impuestos";
                             lw_Importe_Sin_Impuestos := "Importe sin impuestos";
                             lw_Precio_Con_Impuestos  := "Precio con impuestos";
                             lw_Precio_Sin_Impuestos  := "Precio sin impuestos";
                           END;

                           // ---- En funcion del contrato se muestra el importe con impuestos o sin ellos   ----

                           IF rCon."Impuestos incluidos" THEN BEGIN
                             w_importe_impresion := lw_Importe_Con_Impuestos;
                             w_precio_impresion  := lw_Precio_Con_Impuestos;
                           END
                           ELSE BEGIN
                             w_importe_impresion := lw_Importe_Sin_Impuestos;
                             w_precio_impresion  := lw_Precio_Sin_Impuestos;
                           END;

                           IF (Tipo = Tipo::Base) OR (Tipo = Tipo::Zona) OR (Tipo = Tipo::Suplemento) OR (Tipo = Tipo::Extra)  THEN BEGIN
                             w_base            := w_base + lw_Importe_Sin_Impuestos;
                             w_base_net        := w_base_net + lw_Impo_Sin_Impu_Sin_Dto;     // AJF 13/03/08 - DRF 07002
                             w_base_con        := w_base_con + lw_Importe_Con_Impuestos;
                             w_tot_paxes       := w_tot_paxes + Pax;
                             w_total           := w_total + lw_Importe_Sin_Impuestos;
                             w_total_net       := w_total_net + lw_Impo_Sin_Impu_Sin_Dto;    // AJF 13/03/08 - DRF 07002
                             w_total_con       := w_total_con + lw_Importe_Con_Impuestos;
                             w_total_impresion := w_total_impresion + w_importe_impresion
                           END;

                           IF Tipo = Tipo::Maletas THEN BEGIN
                             w_maletas     := w_maletas + lw_Importe_Sin_Impuestos;
                             w_maletas_net := w_maletas_net + lw_Impo_Sin_Impu_Sin_Dto;      // AJF 13/03/08 - DRF 07002
                             w_maletas_con := w_maletas_con + lw_Importe_Con_Impuestos;

                             // ---- Si las maletas estaban incluidas en el precio base hay que descontar a la hora ----
                             // ---- de mostrar el total base                                                       ----

                             IF NOT rCon."Maletas incluidas" THEN BEGIN
                               w_total           := w_total + lw_Importe_Sin_Impuestos;
                               w_total_net       := w_total_net + lw_Impo_Sin_Impu_Sin_Dto;  // AJF 13/03/08 - DRF 07002
                               w_total_con       := w_total_con + lw_Importe_Con_Impuestos;
                             END
                             ELSE BEGIN
                               w_base     := w_base - lw_Importe_Sin_Impuestos;
                               w_base_net := w_base_net - lw_Impo_Sin_Impu_Sin_Dto;          // AJF 13/03/08 - DRF 07002
                               w_base_con := w_base_con - lw_Importe_Con_Impuestos;
                             END;
                           END;

                           IF Tipo <> Tipo::"Resumen Zona" THEN BEGIN
                             w_primera_zona := TRUE;
                             w_pax_zona  := 0;
                             w_importe_zona := 0;
                           END
                           ELSE BEGIN
                             w_pax_zona  := w_pax_zona + Pax;
                             w_importe_zona := w_importe_zona + w_importe_impresion;

                             IF rLin.Plazas>0 THEN
                               w_plazas_impresion := STRSUBSTNO('%1/%2',rLin.Plazas - rLin."Ni¤os Facturados" , rLin."Ni¤os Facturados")
                             ELSE
                               w_plazas_impresion :='';

                           END;
                           // Creada variable auxiliar para controlar cuando hacer el total del resumen x zona
                           //
                           rLin.COPY("Lineas Prefactura");
                           IF rLin.NEXT = 0 THEN
                             rLin.INIT;

                           _GetDescripciones; //+$001
                         END;

        DataItemLink=N§ Prefactura=FIELD(N§ Prefactura);
      }
      SECTIONS
      {
        { PROPERTIES
          {
            SectionType=Header;
            SectionWidth=19050;
            SectionHeight=846;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT(rTipoServicio."Tipo fijo" = rTipoServicio."Tipo fijo"::Excursion); //+$001
                         END;

          }
          CONTROLS
          {
            { 74  ;Label        ;2100 ;0    ;1200 ;846  ;ParentControl=15;
                                                         HorzAlign=Right;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes }
            { 75  ;Label        ;3450 ;0    ;5100 ;846  ;ParentControl=17;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=ESP=Servicio }
            { 80  ;Label        ;8700 ;0    ;750  ;846  ;ParentControl=27;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes }
            { 81  ;Label        ;9600 ;0    ;1500 ;846  ;ParentControl=29;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes }
            { 82  ;Label        ;11250;0    ;3150 ;846  ;ParentControl=31;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes }
            { 84  ;Label        ;14550;0    ;750  ;846  ;ParentControl=33;
                                                         HorzAlign=Right;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes }
            { 85  ;Label        ;15450;0    ;900  ;846  ;ParentControl=35;
                                                         HorzAlign=Right;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes }
            { 76  ;Label        ;16500;0    ;1800 ;846  ;HorzAlign=Right;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=ESP=Importe }
          }
           }
        { PROPERTIES
          {
            SectionType=Header;
            SectionWidth=19050;
            SectionHeight=846;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT(rTipoServicio."Tipo fijo" = rTipoServicio."Tipo fijo"::Traslado); //+$001
                         END;

          }
          CONTROLS
          {
            { 40  ;Label        ;16500;0    ;1800 ;846  ;HorzAlign=Right;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=ESP=Importe }
            { 38  ;Label        ;15450;0    ;900  ;846  ;ParentControl=35;
                                                         HorzAlign=Right;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes }
            { 36  ;Label        ;14550;0    ;750  ;846  ;ParentControl=33;
                                                         HorzAlign=Right;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes }
            { 26  ;Label        ;11250;0    ;1500 ;846  ;ParentControl=31;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes }
            { 28  ;Label        ;12900;0    ;1500 ;846  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=ESP=Destino }
            { 14  ;Label        ;8700 ;0    ;750  ;846  ;ParentControl=27;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes }
            { 16  ;Label        ;9600 ;0    ;1500 ;846  ;ParentControl=29;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes }
            { 11  ;Label        ;6300 ;0    ;1500 ;846  ;ParentControl=23;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes }
            { 13  ;Label        ;7950 ;0    ;600  ;846  ;ParentControl=25;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes }
            { 12  ;Label        ;5100 ;0    ;1050 ;846  ;ParentControl=39;
                                                         HorzAlign=Right;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes }
            { 10  ;Label        ;3450 ;0    ;1500 ;846  ;ParentControl=17;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes }
            { 7   ;Label        ;2100 ;0    ;1200 ;846  ;ParentControl=15;
                                                         HorzAlign=Right;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes }
          }
           }
        { PROPERTIES
          {
            SectionType=Body;
            SectionWidth=19050;
            SectionHeight=423;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT((Tipo = Tipo::Base) AND
                                                 (rTipoServicio."Tipo fijo" = rTipoServicio."Tipo fijo"::Excursion)
                                                ); //+$001
                         END;

          }
          CONTROLS
          {
            { 1000000000;TextBox;2100 ;0    ;1200 ;423  ;FontSize=8;
                                                         SourceExpr=Fecha }
            { 1000000001;TextBox;3450 ;0    ;5100 ;423  ;FontSize=8;
                                                         SourceExpr=DescriServicio }
            { 1000000005;TextBox;8700 ;0    ;750  ;423  ;HorzAlign=Left;
                                                         FontSize=8;
                                                         SourceExpr=Bus }
            { 1000000006;TextBox;9600 ;0    ;1500 ;423  ;FontSize=8;
                                                         SourceExpr=Parte }
            { 1000000008;TextBox;11250;0    ;3150 ;423  ;FontSize=8;
                                                         SourceExpr=DescriDestino }
            { 1000000009;TextBox;14550;0    ;750  ;423  ;FontSize=8;
                                                         SourceExpr=Pax }
            { 1000000010;TextBox;15450;0    ;900  ;423  ;FontSize=8;
                                                         SourceExpr=Plazas }
            { 1000000011;TextBox;16500;0    ;1800 ;423  ;FontSize=8;
                                                         SourceExpr=w_importe_impresion;
                                                         AutoFormatType=1;
                                                         AutoFormatExpr=rDiv.Code }
          }
           }
        { PROPERTIES
          {
            SectionType=Body;
            SectionWidth=19050;
            SectionHeight=423;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT((Tipo = Tipo::Base) AND
                                                 (rTipoServicio."Tipo fijo" = rTipoServicio."Tipo fijo"::Traslado)
                                                ); //+$001
                         END;

          }
          CONTROLS
          {
            { 15  ;TextBox      ;2100 ;0    ;1200 ;423  ;FontSize=8;
                                                         SourceExpr=Fecha }
            { 17  ;TextBox      ;3450 ;0    ;1500 ;423  ;FontSize=8;
                                                         SourceExpr="Codigo Servicio" }
            { 23  ;TextBox      ;6300 ;0    ;1500 ;423  ;FontSize=8;
                                                         SourceExpr=Vuelo }
            { 25  ;TextBox      ;7950 ;0    ;600  ;423  ;FontSize=8;
                                                         SourceExpr=Letra }
            { 27  ;TextBox      ;8700 ;0    ;750  ;423  ;HorzAlign=Left;
                                                         FontSize=8;
                                                         SourceExpr=Bus }
            { 29  ;TextBox      ;9600 ;0    ;1500 ;423  ;FontSize=8;
                                                         SourceExpr=Parte }
            { 31  ;TextBox      ;11250;0    ;1500 ;423  ;FontSize=8;
                                                         SourceExpr=Origen }
            { 33  ;TextBox      ;14550;0    ;750  ;423  ;FontSize=8;
                                                         SourceExpr=Pax }
            { 35  ;TextBox      ;15450;0    ;900  ;423  ;FontSize=8;
                                                         SourceExpr=Plazas }
            { 37  ;TextBox      ;12900;0    ;1500 ;423  ;FontSize=8;
                                                         SourceExpr=Destino }
            { 39  ;TextBox      ;5100 ;0    ;1050 ;423  ;FontSize=8;
                                                         SourceExpr=Hora;
                                                         Format=<Hours24,2>:<Minutes,2> }
            { 21  ;TextBox      ;16500;0    ;1800 ;423  ;FontSize=8;
                                                         SourceExpr=w_importe_impresion;
                                                         AutoFormatType=1;
                                                         AutoFormatExpr=rDiv.Code }
          }
           }
        { PROPERTIES
          {
            SectionType=Body;
            SectionWidth=19050;
            SectionHeight=423;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT((Tipo = Tipo::Base) AND
                                                 (ReferenciaLinea <> '')); //+$001
                         END;

          }
          CONTROLS
          {
            { 1000000012;TextBox;2100 ;0    ;6450 ;423  ;FontSize=8;
                                                         SourceExpr=ReferenciaLinea }
          }
           }
        { PROPERTIES
          {
            SectionType=Body;
            SectionWidth=19050;
            SectionHeight=423;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT(Tipo = Tipo::Zona);
                         END;

          }
          CONTROLS
          {
            { 89  ;TextBox      ;12900;0    ;1500 ;423  ;FontSize=8;
                                                         SourceExpr=Destino }
            { 90  ;TextBox      ;14550;0    ;750  ;423  ;FontSize=8;
                                                         SourceExpr=Pax }
            { 91  ;TextBox      ;15450;0    ;900  ;423  ;FontSize=8;
                                                         SourceExpr=Plazas }
            { 92  ;TextBox      ;16500;0    ;1800 ;423  ;FontSize=8;
                                                         SourceExpr=w_importe_impresion;
                                                         AutoFormatType=1;
                                                         AutoFormatExpr=rDiv.Code }
            { 114 ;TextBox      ;11250;0    ;1500 ;423  ;FontSize=8;
                                                         SourceExpr=Origen }
          }
           }
        { PROPERTIES
          {
            SectionType=Body;
            SectionWidth=19050;
            SectionHeight=423;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT(((Tipo = Tipo::Suplemento) OR (Tipo = Tipo::Extra)) AND (NOT wPrimeraLinea));
                         END;

          }
          CONTROLS
          {
            { 41  ;TextBox      ;12900;0    ;3450 ;423  ;FontSize=8;
                                                         SourceExpr=Descripcion }
            { 113 ;TextBox      ;16500;0    ;1800 ;423  ;FontSize=8;
                                                         SourceExpr=w_importe_impresion;
                                                         AutoFormatType=1;
                                                         AutoFormatExpr=rDiv.Code }
          }
           }
        { PROPERTIES
          {
            SectionType=Body;
            SectionWidth=19050;
            SectionHeight=423;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT(((Tipo = Tipo::Suplemento) OR (Tipo = Tipo::Extra)) AND  wPrimeraLinea);
                         END;

          }
          CONTROLS
          {
            { 115 ;TextBox      ;12900;0    ;3450 ;423  ;FontSize=8;
                                                         SourceExpr=Descripcion }
            { 116 ;TextBox      ;16500;0    ;1800 ;423  ;FontSize=8;
                                                         SourceExpr=w_importe_impresion;
                                                         AutoFormatType=1;
                                                         AutoFormatExpr=rDiv.Code }
            { 117 ;TextBox      ;9600 ;0    ;1500 ;423  ;FontSize=8;
                                                         SourceExpr=Parte }
            { 118 ;TextBox      ;8700 ;0    ;750  ;423  ;HorzAlign=Left;
                                                         FontSize=8;
                                                         SourceExpr=Bus }
            { 122 ;TextBox      ;3450 ;0    ;1500 ;423  ;FontSize=8;
                                                         SourceExpr="Codigo Servicio" }
            { 123 ;TextBox      ;2100 ;0    ;1200 ;423  ;FontSize=8;
                                                         SourceExpr=Fecha }
          }
           }
        { PROPERTIES
          {
            SectionType=Body;
            SectionWidth=19050;
            SectionHeight=1269;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT((Tipo = Tipo::"Resumen Zona") AND (w_primera_zona));
                         END;

          }
          CONTROLS
          {
            { 93  ;Label        ;2700 ;0    ;2550 ;423  ;HorzAlign=Left;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         LeaderDots=Yes;
                                                         CaptionML=ESP=Resumen }
            { 94  ;Label        ;6000 ;0    ;2250 ;846  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=ESP=Zona }
            { 95  ;Label        ;8400 ;0    ;750  ;846  ;HorzAlign=Right;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=ESP=Pax }
            { 96  ;Label        ;9300 ;0    ;1200 ;846  ;HorzAlign=Right;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=ESP=Fact. }
            { 97  ;Label        ;10650;0    ;1800 ;846  ;HorzAlign=Right;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=ESP=Precio }
            { 98  ;Label        ;12600;0    ;1800 ;846  ;HorzAlign=Right;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=ESP=Importe }
            { 99  ;TextBox      ;8400 ;846  ;750  ;423  ;FontSize=8;
                                                         BlankZero=Yes;
                                                         SourceExpr=Pax }
            { 100 ;TextBox      ;9300 ;846  ;1200 ;423  ;HorzAlign=Right;
                                                         FontSize=8;
                                                         DecimalPlaces=0:2;
                                                         BlankZero=Yes;
                                                         SourceExpr=w_plazas_impresion }
            { 101 ;TextBox      ;12600;846  ;1800 ;423  ;FontSize=8;
                                                         SourceExpr=w_importe_impresion;
                                                         AutoFormatType=1;
                                                         AutoFormatExpr=rDiv.Code }
            { 102 ;TextBox      ;6000 ;846  ;2250 ;423  ;FontSize=8;
                                                         SourceExpr=Zona }
            { 104 ;TextBox      ;10650;846  ;1800 ;423  ;FontSize=8;
                                                         BlankZero=Yes;
                                                         SourceExpr=w_precio_impresion;
                                                         AutoFormatType=2;
                                                         AutoFormatExpr=rDiv.Code }
          }
           }
        { PROPERTIES
          {
            SectionType=Body;
            SectionWidth=19050;
            SectionHeight=423;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT((Tipo = Tipo::"Resumen Zona") AND (NOT w_primera_zona));
                           IF Tipo = Tipo::"Resumen Zona" THEN
                             w_primera_zona := FALSE;
                         END;

          }
          CONTROLS
          {
            { 106 ;TextBox      ;12600;0    ;1800 ;423  ;FontSize=8;
                                                         SourceExpr=w_importe_impresion;
                                                         AutoFormatType=1;
                                                         AutoFormatExpr=rDiv.Code }
            { 108 ;TextBox      ;9300 ;0    ;1200 ;423  ;HorzAlign=Right;
                                                         FontSize=8;
                                                         DecimalPlaces=0:2;
                                                         BlankZero=Yes;
                                                         SourceExpr=w_plazas_impresion }
            { 109 ;TextBox      ;8400 ;0    ;750  ;423  ;FontSize=8;
                                                         BlankZero=Yes;
                                                         SourceExpr=Pax }
            { 110 ;TextBox      ;6000 ;0    ;2250 ;423  ;FontSize=8;
                                                         SourceExpr=Zona }
            { 103 ;TextBox      ;10650;0    ;1800 ;423  ;FontSize=8;
                                                         BlankZero=Yes;
                                                         SourceExpr=w_precio_impresion;
                                                         AutoFormatType=2;
                                                         AutoFormatExpr=rDiv.Code }
          }
           }
        { PROPERTIES
          {
            SectionType=Body;
            SectionWidth=19050;
            SectionHeight=1269;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT((Tipo = Tipo::"Resumen Zona") AND
                                                 (rLin.Tipo <> rLin.Tipo::"Resumen Zona"));
                         END;

          }
          CONTROLS
          {
            { 105 ;Label        ;5850 ;423  ;2400 ;423  ;HorzAlign=Left;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         LeaderDots=Yes;
                                                         CaptionML=ESP=Total Resumen }
            { 107 ;TextBox      ;8400 ;423  ;750  ;423  ;FontSize=8;
                                                         DecimalPlaces=0:2;
                                                         BlankZero=Yes;
                                                         SourceExpr=w_pax_zona }
            { 111 ;TextBox      ;12600;423  ;1800 ;423  ;FontSize=8;
                                                         SourceExpr=w_importe_zona;
                                                         AutoFormatType=1;
                                                         AutoFormatExpr=rDiv.Code }
            { 112 ;Shape        ;8400 ;0    ;6000 ;423  ;ShapeStyle=HorzLine }
          }
           }
      }
       }
  }
  REQUESTFORM
  {
    PROPERTIES
    {
      Width=9020;
      Height=3410;
    }
    CONTROLS
    {
      { 1   ;Label        ;220  ;220  ;3300 ;440  ;ParentControl=2;
                                                   CaptionML=ESP=Imprime Divisa Local }
      { 2   ;CheckBox     ;3080 ;220  ;440  ;440  ;ShowCaption=No;
                                                   SourceExpr=w_ImpDivisaLocal }
    }
  }
  REQUESTPAGE
  {
    PROPERTIES
    {
    }
    CONTROLS
    {
    }
  }
  CODE
  {
    VAR
      Text000@1100244024 : TextConst 'ESP=MALETAS';
      rCon@1100244000 : Record 7010403;
      rLin@1100244001 : Record 7010417;
      rInf@1100244002 : Record 79;
      rTipoServicio@1000000004 : Record 7010319;
      w_base@1100244003 : Decimal;
      w_base_con@1100244004 : Decimal;
      w_maletas@1100244005 : Decimal;
      w_maletas_con@1100244006 : Decimal;
      w_total@1100244007 : Decimal;
      w_total_con@1100244008 : Decimal;
      w_plazas@1100244009 : Decimal;
      w_importe_con@1100244010 : Decimal;
      w_texto_maletas@1100244011 : Text[30];
      w_primera_zona@1100244012 : Boolean;
      w_tot_paxes@1100244013 : Decimal;
      w_pax_zona@1100244014 : Decimal;
      w_importe_zona@1100244015 : Decimal;
      w_importe_impresion@1100244016 : Decimal;
      w_total_impresion@1100244017 : Decimal;
      w_precio_impresion@1100244018 : Decimal;
      w_ImpDivisaLocal@1100244019 : Boolean;
      rDiv@1100244020 : Record 4;
      wNoParte@1100244021 : Code[10];
      wPrimeraLinea@1100244022 : Boolean;
      w_plazas_impresion@1100244023 : Text[30];
      w_base_net@1103355003 : Decimal;
      w_maletas_net@1103355002 : Decimal;
      w_total_net@1103355001 : Decimal;
      w_dto_maletas@1103355000 : Decimal;
      Text011@1000000000 : TextConst 'ESP=REGRESO';
      DescriServicio@1000000003 : Text[100];
      DescriDestino@1000000002 : Text[100];
      ReferenciaLinea@1000000001 : Code[30];
      wIVA@1000000005 : Decimal;
      wDTO@1000000006 : Decimal;

    LOCAL PROCEDURE _BuscaTipoServicio@1000000003();
    VAR
      lrLinPre@1000000000 : Record 7010417;
      lrParte@1000000003 : Record 7010360;
    BEGIN
      // _BuscaTipoServicio

      lrLinPre.COPYFILTERS("Lineas Prefactura");
      lrLinPre.SETFILTER(Parte, '<>%1', '');
      IF lrLinPre.FINDFIRST THEN
      BEGIN
        lrParte.GET(lrLinPre.Parte);

        rTipoServicio.GET(lrParte."Tipo Servicio");
      END;
    END;

    LOCAL PROCEDURE _GetDescripciones@1000000006();
    VAR
      lrParte@1000000000 : Record 7010360;
      lrCodigoServicio@1000000001 : Record 7010320;
      lrPunto@1000000002 : Record 7010315;
      lrParte2@1000000003 : Record 7010360;
    BEGIN
      // _GetDescripciones

      DescriServicio := '';
      DescriDestino   := '';
      ReferenciaLinea := '';

      IF NOT lrParte.GET(wNoParte) THEN
        EXIT;

      ReferenciaLinea := lrParte.Referencia;

      IF NOT lrCodigoServicio.GET("Lineas Prefactura"."Codigo Servicio") THEN
        EXIT;

      IF lrParte."Origen creacion" = lrParte."Origen creacion"::"Recogida Automatica" THEN BEGIN
        DescriServicio := Text011;
        lrParte2.RESET;
        lrParte2.SETRANGE(lrParte2."Recogida Generada",lrParte."N§ Parte");
        IF lrParte2.FIND('-') THEN BEGIN
          IF lrCodigoServicio.GET(lrParte2."Codigo Servicio") THEN
            DescriServicio := DescriServicio + ' ' + lrCodigoServicio.Descripcion;
        END;
      END ELSE
        DescriServicio := lrCodigoServicio.Descripcion;

      DescriDestino := "Lineas Prefactura".Destino;
      IF lrPunto.GET("Lineas Prefactura".Destino) AND
         (lrParte."Origen creacion" <> lrParte."Origen creacion"::"Recogida Automatica") THEN
        DescriDestino := lrPunto.Descripci¢n;
    END;

    LOCAL PROCEDURE _GetVATPosting@1000000000();
    VAR
      lrCustomer@1000000000 : Record 18;
      lrVATSetup@1000000001 : Record 325;
    BEGIN
      // _GetVATPosting

      lrCustomer.GET("Prefactura ingreso".Cliente);

      lrVATSetup.GET(lrCustomer."VAT Bus. Posting Group", rCon."Grupo Registro IVA Producto");

      wIVA := ROUND(1 + (lrVATSetup."VAT+EC %" / 100));
    END;

    BEGIN
    {
      JPT 30/07/09 Sustituyo clave SORTING(N§ Prefactura,Fecha,Codigo Servicio,Hora,Parte) por SORTING(N§ Prefactura,Orden)

      $001 ARM 12112014 Vamos a crear un formato distinto si estamos facturado excursiones o traslados

      $002 AJS 10022015 Cambio el calculo del IVA para que se haga en el GroupFooter de Prefactura ingreso sobre el total

      $003 AJS 12022015 Corrijo para contemplar el caso de impuestos incluidos y agregar el descuento
    }
    END.
  }
  RDLDATA
  {
  }
}
