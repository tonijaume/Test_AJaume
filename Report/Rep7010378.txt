OBJECT Report 7010378 Estad. Fact. Vehic. Comp
{
  OBJECT-PROPERTIES
  {
    Date=16/10/09;
    Time=12:34:36;
    Version List=TRANSFER,INV;
  }
  PROPERTIES
  {
    CaptionML=ESP=Estad. Fact. Vehic. Comp;
    ShowPrintStatus=Yes;
    UseReqForm=Yes;
    LeftMargin=500;
    RightMargin=0;
    OnPreReport=BEGIN
                  // Limpia el temporal
                  rTemp.RESET;
                  rTemp.SETRANGE(Usuario,USERID);
                  IF rTemp.FINDFIRST THEN
                    rTemp.DELETEALL;
                  wAcum :=0;
                END;

    Orientation=Landscape;
  }
  DATAITEMS
  {
    { PROPERTIES
      {
        DataItemTable=Table2000000026;
        DataItemTableView=SORTING(Number)
                          ORDER(Ascending);
        MaxIteration=1;
        DataItemVarName=Cabecera;
        OnPreDataItem=BEGIN
                        IF  (wFiltroFecha[1]='') AND  (wFiltroFecha[2]='') THEN
                          ERROR(ERROR2);

                        wFiltraGaraje := (vGaraje <> '') AND (vGaraje <> rParametros."Todos los garajes");
                        IF wFiltraGaraje  THEN
                          vFltGaraje:=vGaraje
                        ELSE
                          vFltGaraje:=Text50000;

                        IF vGarajeResult = '' THEN
                          vFltGarajeResult := Text50000
                        ELSE
                          vFltGarajeResult := vGarajeResult;
                      END;

        OnAfterGetRecord=VAR
                           cFunBas@1100253000 : Codeunit 7010310;
                         BEGIN
                           //Calcularemos las Agrupaciones que tenemos que poner en el campo Agrupacion de la
                           //Tabla Seleccion Vehiculo.
                           IF vTipoAgrupacion=vTipoAgrupacion::"Grupo Veh¡culos" THEN
                             Agrupar1()
                           ELSE
                             Agrupar2();

                           vTipoLinea   := cFunBas.Tipo_Lineas_Estadisticas;
                           vTipoElemento:= cFunBas.MaletasyEstadisticas;

                           COMMIT;
                         END;

      }
      SECTIONS
      {
        { PROPERTIES
          {
            SectionType=Header;
            PrintOnEveryPage=Yes;
            SectionWidth=25800;
            SectionHeight=3384;
          }
          CONTROLS
          {
            { 1   ;Label        ;18900;0    ;6900 ;423  ;HorzAlign=Right;
                                                         FontSize=9;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Estadisticas Fact. Vehiculos Comparadas }
            { 3   ;TextBox      ;0    ;0    ;5250 ;423  ;FontSize=9;
                                                         FontBold=Yes;
                                                         SourceExpr=COMPANYNAME }
            { 8   ;TextBox      ;9300 ;1269 ;2850 ;423  ;VertAlign=Bottom;
                                                         SourceExpr=vFltGaraje }
            { 9   ;Label        ;6150 ;1269 ;3000 ;423  ;ParentControl=8;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=ESP=Filtro Garaje }
            { 50  ;Label        ;6000 ;1692 ;150  ;423  ;CaptionML=ESP=/ }
            { 56  ;Label        ;12450;1692 ;150  ;423  ;CaptionML=ESP=/ }
            { 17  ;TextBox      ;3150 ;2115 ;2100 ;423  ;VertAlign=Bottom;
                                                         SourceExpr=vTipoAgrupacion }
            { 82  ;Label        ;0    ;2115 ;3000 ;423  ;ParentControl=17;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=ESP=Tipo Agrupacion }
            { 90  ;TextBox      ;9300 ;1692 ;2850 ;423  ;VertAlign=Bottom;
                                                         SourceExpr=vVehiculos }
            { 83  ;Label        ;6150 ;1692 ;3000 ;423  ;ParentControl=90;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=ESP=Selecci¢n Vehiculos }
            { 91  ;Label        ;6000 ;2115 ;150  ;423  ;CaptionML=ESP=/ }
            { 102 ;Label        ;12750;2115 ;5100 ;423  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=ESP=S¢lo Vehiculos con Actividad }
            { 190 ;Label        ;12450;2115 ;150  ;423  ;CaptionML=ESP=/ }
            { 191 ;TextBox      ;18000;2115 ;2850 ;423  ;VertAlign=Bottom;
                                                         SourceExpr=vSoloConActividad }
            { 194 ;Label        ;12750;1692 ;5100 ;423  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=ESP=Garaje a considerar en resultados }
            { 195 ;TextBox      ;18000;1692 ;2850 ;423  ;VertAlign=Bottom;
                                                         SourceExpr=vFltGarajeResult }
            { 210 ;Label        ;6000 ;1269 ;150  ;423  ;CaptionML=ESP=/ }
            { 215 ;Label        ;12450;1269 ;150  ;423  ;CaptionML=ESP=/ }
            { 233 ;Label        ;12750;1269 ;5100 ;423  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=ESP=Filtro Propiedad del Vehiculo }
            { 234 ;TextBox      ;18000;1269 ;2850 ;423  ;VertAlign=Bottom;
                                                         SourceExpr=vPropiedad }
            { 14  ;TextBox      ;3150 ;2538 ;1050 ;423  ;VertAlign=Bottom;
                                                         SourceExpr=vVerBloqueados }
            { 237 ;Label        ;0    ;2538 ;3000 ;423  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=ESP=Ver Bloqueados }
            { 238 ;Shape        ;0    ;2961 ;25800;423  ;ShapeStyle=HorzLine }
            { 239 ;TextBox      ;9300 ;2115 ;2850 ;423  ;VertAlign=Bottom;
                                                         SourceExpr=vDivisa }
            { 240 ;Label        ;6150 ;2115 ;3000 ;423  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=ESP=C¢d. Divisa }
            { 241 ;Label        ;6000 ;2538 ;150  ;423  ;CaptionML=ESP=/ }
            { 18  ;TextBox      ;3150 ;1269 ;2700 ;423  ;SourceExpr=wFiltroFecha[1] }
            { 21  ;Label        ;0    ;1269 ;3000 ;423  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=ESP=Periodo Actual }
            { 84  ;Label        ;0    ;1692 ;3000 ;423  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=ESP=Periodo Anterior }
            { 92  ;TextBox      ;3150 ;1692 ;2700 ;423  ;SourceExpr=wFiltroFecha[2] }
          }
           }
        { PROPERTIES
          {
            SectionType=Header;
            PrintOnEveryPage=Yes;
            SectionWidth=25800;
            SectionHeight=1269;
          }
          CONTROLS
          {
            { 39  ;Label        ;0    ;846  ;1650 ;423  ;HorzAlign=Right;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=P. Act. }
            { 64  ;Label        ;1800 ;846  ;1650 ;423  ;HorzAlign=Right;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=P. Ant. }
            { 71  ;Label        ;6750 ;846  ;1650 ;423  ;HorzAlign=Right;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=P. Act. }
            { 72  ;Label        ;8550 ;846  ;1650 ;423  ;HorzAlign=Right;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=P. Ant. }
            { 73  ;Label        ;3600 ;846  ;1650 ;423  ;HorzAlign=Right;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Dif. }
            { 78  ;Label        ;10350;846  ;1650 ;423  ;HorzAlign=Right;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Dif. }
            { 80  ;Label        ;5400 ;846  ;1200 ;423  ;HorzAlign=Right;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=% Dif. }
            { 81  ;Label        ;12150;846  ;1200 ;423  ;HorzAlign=Right;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=% Dif. }
            { 86  ;Label        ;18900;846  ;1200 ;423  ;HorzAlign=Right;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=P. Act. }
            { 94  ;Label        ;17550;846  ;1200 ;423  ;HorzAlign=Right;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=% Dif. }
            { 95  ;Label        ;16200;846  ;1200 ;423  ;HorzAlign=Right;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Dif. }
            { 96  ;Label        ;14850;846  ;1200 ;423  ;HorzAlign=Right;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=P. Ant. }
            { 127 ;Label        ;13500;846  ;1200 ;423  ;HorzAlign=Right;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=P. Act. }
            { 128 ;Label        ;20250;846  ;1200 ;423  ;HorzAlign=Right;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=P. Ant. }
            { 129 ;Label        ;21600;846  ;1200 ;423  ;HorzAlign=Right;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Dif. }
            { 130 ;Label        ;22950;846  ;1200 ;423  ;HorzAlign=Right;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=% Dif. }
            { 133 ;Label        ;18900;423  ;5250 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Acumulados }
            { 135 ;Shape        ;13500;0    ;10650;846   }
            { 137 ;Shape        ;18900;423  ;5250 ;423   }
            { 140 ;Label        ;13500;423  ;5250 ;423  ;HorzAlign=Center;
                                                         VertAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=ESP=Periodos }
            { 142 ;Label        ;0    ;0    ;13350;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Facturacion }
            { 143 ;Label        ;13500;0    ;10650;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=N§ Viajes }
            { 139 ;Label        ;0    ;423  ;6600 ;423  ;HorzAlign=Center;
                                                         VertAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=ESP=Periodos }
            { 131 ;Label        ;6750 ;423  ;6600 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Acumulados }
            { 141 ;Shape        ;13500;423  ;5250 ;423   }
            { 138 ;Shape        ;0    ;423  ;6600 ;423   }
            { 136 ;Shape        ;6750 ;423  ;6600 ;423   }
            { 134 ;Shape        ;0    ;0    ;13350;846   }
          }
           }
        { PROPERTIES
          {
            SectionType=Footer;
            PrintOnEveryPage=Yes;
            PlaceInBottom=Yes;
            SectionWidth=25800;
            SectionHeight=846;
          }
          CONTROLS
          {
            { 175 ;TextBox      ;7650 ;423  ;4500 ;423  ;HorzAlign=Center;
                                                         SourceExpr=FORMAT(TODAY,0,4) + '-' + USERID }
            { 176 ;TextBox      ;25050;423  ;600  ;423  ;CaptionML=ESP=P gina;
                                                         SourceExpr=CurrReport.PAGENO }
            { 177 ;Label        ;24000;423  ;900  ;423  ;ParentControl=176 }
            { 178 ;Shape        ;0    ;0    ;25800;423  ;ShapeStyle=HorzLine }
          }
           }
      }
       }
    { PROPERTIES
      {
        DataItemIndent=1;
        DataItemTable=Table7010352;
        DataItemTableView=SORTING(Usuario,Garaje,Agrupacion,Numero)
                          ORDER(Ascending);
        NewPagePerGroup=No;
        DataItemVarName=SelVehiculo;
        PrintOnlyIfDetail=Yes;
        OnPreDataItem=VAR
                        rPar@1100253000 : Record 7010311;
                        rAuxSelVeh@1100253001 : Record 7010352;
                        cFunBas@1100253002 : Codeunit 7010310;
                        lrCI@1100253003 : Record 7010414;
                      BEGIN


                        //Contador de vehiculos correspondientes a un grupo.
                        vContaVG := 0;

                        //CREAREMOS EL FILTRO APROPIADO.
                        //....................................................................
                        //....................................................................
                        rPar.FINDFIRST;

                        IF vGarajeResult = rPar."Todos los garajes" THEN
                          vGarajeResult := '';

                        RESET;

                        IF vGaraje = rParametros."Todos los garajes" THEN
                          SETCURRENTKEY(Usuario,Agrupacion,Numero)
                        ELSE
                          SETCURRENTKEY(Usuario,Garaje,Agrupacion,Numero);

                        SETRANGE(Usuario,USERID);

                        IF wFiltraGaraje THEN BEGIN
                          SETRANGE(Garaje,vGaraje);
                          vFltGaraje:=vGaraje
                        END
                        ELSE
                          vFltGaraje:=Text50000;

                        //Para saber donde se aplicar  el c lculo.
                        IF vGarajeResult = '' THEN
                          vFltGarajeResult := Text50000
                        ELSE
                          vFltGarajeResult := vGarajeResult;

                        //Si agrupamos por plazas no mostraremos los vehiculos que se hayan quedado sin c¢digo
                        //de agrupaci¢n.
                        IF vAgrupacionporPlazas THEN
                          SETFILTER(Agrupacion,'<>%1','');  //Por si las moscas.

                        //Comprobaremos que no est en la lista de vehiculos seleccionados.
                        IF vVehiculos=vVehiculos::"Seg£n Selecci¢n" THEN
                          SETRANGE(Seleccion,TRUE);

                        //Comprobaremos si queremos ver s¢lo los vehiculos ajenos o propios.
                        IF vPropiedad<>vPropiedad::Todos THEN BEGIN
                          IF vPropiedad=vPropiedad::"S¢lo Propios" THEN
                            SETRANGE("Vehiculo propio",TRUE)
                          ELSE
                            SETRANGE("Vehiculo propio",FALSE)
                        END;

                        IF NOT vVerBloqueados THEN
                          SETRANGE(Bloqueado,FALSE);

                        //....................................................................
                        IF lrCI.FINDFIRST THEN;   // JPT-25/02/02 Ya se que aparentemente esto no sirve para nada, pero no quitarlo
                                                  // o el rendimiento del listado se ver  reducido drasticamente ¨?


                        IF vSoloConActividad THEN BEGIN
                          rAuxSelVeh.RESET;
                          rAuxSelVeh.COPYFILTERS(SelVehiculo);
                          TestActividad(rAuxSelVeh);
                          SETRANGE(Actividad,TRUE);
                        END;

                        //....................................................................
                        //FIN. SELECCION DEL FILTRO.

                        //Hacemos una comprobaci¢n.
                        SETRANGE(Plazas,0);
                        IF COUNT > 0 THEN
                          ERROR(Text50001);
                        SETRANGE(Plazas);

                        //Precision de la Divisa Local.
                        vPrecision:= cFunBas.ObtenerPrecisionDivisa(vDivisa);

                        wTotal := COUNT;
                        wCont  := 0;
                        wVentana1.OPEN(Text50002);
                      END;

        OnAfterGetRecord=BEGIN




                           //Si estamos tratando un garaje diferente, provocaremos un salto de p gina.
                           IF (vAntGaraje<>'') AND (SelVehiculo.Garaje <>'') AND (vAntGaraje<>SelVehiculo.Garaje)
                              AND (vGaraje <> rParametros."Todos los garajes") THEN
                             CurrReport.NEWPAGE;
                           IF vAntGaraje<> SelVehiculo.Garaje THEN
                             vAntGaraje:=SelVehiculo.Garaje;

                           wCont +=1;
                           wVentana1.UPDATE(1, ROUND(((wCont/wTotal ) * 10000),1));
                           //Contador de vehiculos del grupo.
                           vContaVG := vContaVG + 1;
                         END;

        OnPostDataItem=BEGIN
                         wVentana1.CLOSE;
                       END;

        GroupTotalFields=Agrupacion;
      }
      SECTIONS
      {
        { PROPERTIES
          {
            SectionType=Header;
            PrintOnEveryPage=Yes;
            SectionWidth=25800;
            SectionHeight=423;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT(vGaraje ='');
                         END;

          }
          CONTROLS
          {
            { 57  ;Label        ;0    ;0    ;2100 ;423  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=ESP=Garaje Actual }
            { 60  ;TextBox      ;2100 ;0    ;2850 ;423  ;HorzAlign=Left;
                                                         VertAlign=Bottom;
                                                         SourceExpr=SelVehiculo.Garaje }
          }
           }
        { PROPERTIES
          {
            SectionType=Body;
            SectionWidth=25800;
            SectionHeight=423;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT(vMostrarDetalle);
                         END;

          }
          CONTROLS
          {
            { 10  ;TextBox      ;1950 ;0    ;1800 ;423  ;VertAlign=Bottom;
                                                         FontSize=9;
                                                         SourceExpr=Numero }
            { 13  ;Label        ;150  ;0    ;1650 ;423  ;ParentControl=10;
                                                         VertAlign=Bottom;
                                                         FontSize=9;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=ESP=Numero: }
            { 16  ;TextBox      ;5700 ;0    ;2850 ;423  ;VertAlign=Bottom;
                                                         FontSize=9;
                                                         SourceExpr=Matricula }
            { 19  ;Label        ;3900 ;0    ;1650 ;423  ;ParentControl=16;
                                                         VertAlign=Bottom;
                                                         FontSize=9;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=ESP=Matricula: }
            { 20  ;Shape        ;0    ;0    ;8700 ;423   }
          }
           }
        { PROPERTIES
          {
            SectionType=GroupFooter;
            SectionWidth=25800;
            SectionHeight=423;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT(vAgrupacionporPlazas);
                         END;

          }
          CONTROLS
          {
            { 11  ;Label        ;0    ;0    ;25800;423  ;Visible=Yes;
                                                         HorzAlign=Center;
                                                         CaptionML=ESP=---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- }
          }
           }
      }
       }
    { PROPERTIES
      {
        DataItemIndent=2;
        DataItemTable=Table7010319;
        DataItemTableView=SORTING(Orden Listado)
                          ORDER(Ascending);
        DataItemVarName=Tipo Servicio;
        OnPreDataItem=BEGIN

                        vTextoNormal:='';
                        CurrReport.CREATETOTALS(wVentas,wViajes);
                      END;

        OnAfterGetRecord=BEGIN
                           { JPT 30/11/06 Esto no se puede hacer as¡ ya que no se muestran los totales
                           IF vMostrarDetalle=FALSE THEN
                             CurrReport.SKIP;
                           }


                           ContaTS := ContaTS + 1;

                           //-------------------------------------
                           // Realiza los distintos calculos de:
                           //CLEAR(wVentas);
                           //CLEAR(wViajes);

                           // Periodo1
                           Calcula(SelVehiculo.Matricula,Codigo,1);
                           // Periodo2
                           Calcula(SelVehiculo.Matricula,Codigo,2);

                           CalcDif;
                         END;

      }
      SECTIONS
      {
        { PROPERTIES
          {
            SectionType=Body;
            SectionWidth=25800;
            SectionHeight=423;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT(vMostrarDetalle);
                         END;

          }
          CONTROLS
          {
            { 23  ;TextBox      ;6750 ;0    ;1650 ;423  ;FontSize=6;
                                                         SourceExpr=wVentas[1,2] }
            { 24  ;TextBox      ;8550 ;0    ;1650 ;423  ;FontSize=6;
                                                         SourceExpr=wVentas[2,2] }
            { 25  ;TextBox      ;1800 ;0    ;1650 ;423  ;FontSize=6;
                                                         SourceExpr=wVentas[2,1] }
            { 26  ;TextBox      ;24300;0    ;1500 ;423  ;FontSize=7;
                                                         SourceExpr=Codigo }
            { 27  ;TextBox      ;3600 ;0    ;1650 ;423  ;FontSize=6;
                                                         SourceExpr=wDiferencia[1,1] }
            { 28  ;TextBox      ;10350;0    ;1650 ;423  ;FontSize=6;
                                                         SourceExpr=wDiferencia[2,1] }
            { 29  ;TextBox      ;5400 ;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=ROUND("w%Dif"[1,1],0.01) }
            { 30  ;TextBox      ;12150;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=ROUND("w%Dif"[2,1],0.01) }
            { 31  ;TextBox      ;22950;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=ROUND("w%Dif"[2,2],0.01) }
            { 32  ;TextBox      ;13500;0    ;1200 ;423  ;SourceExpr=wViajes[1,1] }
            { 33  ;TextBox      ;14850;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=wViajes[2,1] }
            { 34  ;TextBox      ;16200;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=wDiferencia[1,2] }
            { 35  ;TextBox      ;17550;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=ROUND("w%Dif"[1,2],0.01) }
            { 36  ;TextBox      ;18900;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=wViajes[1,2] }
            { 37  ;TextBox      ;20250;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=wViajes[2,2] }
            { 38  ;TextBox      ;21600;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=wDiferencia[2,2] }
            { 2   ;TextBox      ;0    ;0    ;1650 ;423  ;FontSize=6;
                                                         SourceExpr=wVentas[1,1] }
          }
           }
        { PROPERTIES
          {
            SectionType=Footer;
            SectionWidth=25800;
            SectionHeight=423;
            OnPreSection=BEGIN
                           CalcDif;
                         END;

          }
          CONTROLS
          {
            { 40  ;TextBox      ;8550 ;0    ;1650 ;423  ;FontSize=6;
                                                         SourceExpr=wVentas[2,2] }
            { 41  ;TextBox      ;6750 ;0    ;1650 ;423  ;FontSize=6;
                                                         SourceExpr=wVentas[1,2] }
            { 42  ;TextBox      ;1800 ;0    ;1650 ;423  ;FontSize=6;
                                                         SourceExpr=wVentas[2,1] }
            { 43  ;TextBox      ;0    ;0    ;1650 ;423  ;FontSize=6;
                                                         SourceExpr=wVentas[1,1] }
            { 44  ;Label        ;24300;0    ;1500 ;423  ;FontSize=7;
                                                         CaptionML=ESP=TOTAL }
            { 45  ;TextBox      ;3600 ;0    ;1650 ;423  ;FontSize=6;
                                                         SourceExpr=wDiferencia[1,1] }
            { 46  ;TextBox      ;10350;0    ;1650 ;423  ;FontSize=6;
                                                         SourceExpr=wDiferencia[2,1] }
            { 47  ;TextBox      ;5400 ;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=ROUND("w%Dif"[1,1],0.01) }
            { 48  ;TextBox      ;12150;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=ROUND("w%Dif"[2,1],0.01) }
            { 49  ;TextBox      ;22950;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=ROUND("w%Dif"[2,2],0.01) }
            { 51  ;TextBox      ;21600;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=wDiferencia[2,2] }
            { 52  ;TextBox      ;20250;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=wViajes[2,2] }
            { 53  ;TextBox      ;18900;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=wViajes[1,2] }
            { 54  ;TextBox      ;17550;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=ROUND("w%Dif"[1,2],0.01) }
            { 55  ;TextBox      ;16200;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=wDiferencia[1,2] }
            { 58  ;TextBox      ;14850;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=wViajes[2,1] }
            { 59  ;TextBox      ;13500;0    ;1200 ;423  ;SourceExpr=wViajes[1,1] }
          }
           }
      }
       }
    { PROPERTIES
      {
        DataItemIndent=2;
        DataItemTable=Table2000000026;
        DataItemTableView=SORTING(Number)
                          WHERE(Number=FILTER(>0));
        MaxIteration=3;
        DataItemVarName=Subtotaliza;
        OnPreDataItem=BEGIN

                        // Se encarga de dar tantas pasados como subtotales existan
                        rSelVeh2.RESET;
                        rSelVeh2.COPY(SelVehiculo);
                        IF rSelVeh2.NEXT = 0 THEN
                          CLEAR(rSelVeh2);
                      END;

        OnAfterGetRecord=BEGIN

                           // La primera vuelta ser  para totalizar agrupaciones
                           // la segunda para totalizar garajes
                           IF ((Number = 1) AND (rSelVeh2.Agrupacion = SelVehiculo.Agrupacion)) OR
                              ((Number = 2) AND (rSelVeh2.Agrupacion = SelVehiculo.Agrupacion)) OR
                              ((Number = 3) AND (rSelVeh2.Garaje = SelVehiculo.Garaje))  THEN
                              CurrReport.SKIP;

                           IF (Number = 3) AND (vGaraje = rParametros."Todos los garajes") THEN
                             CurrReport.SKIP;

                           CASE Number OF
                             1: BEGIN
                                 IF vTipoAgrupacion=vTipoAgrupacion::"Agrupaci¢n Plazas" THEN
                                   vTextoTotal    := Text50003+FORMAT(SelVehiculo.Agrupacion)+Text50004
                                 ELSE
                                   vTextoTotal    := Text50005+FORMAT(SelVehiculo.Agrupacion);
                                END;
                             2: BEGIN
                                 IF vTipoAgrupacion=vTipoAgrupacion::"Agrupaci¢n Plazas" THEN
                                   vTextoTotal    := Text50006+FORMAT(SelVehiculo.Agrupacion)+Text50004
                                 ELSE
                                   vTextoTotal    := Text50007+FORMAT(SelVehiculo.Agrupacion);
                                END;

                             3: vTextoTotal    := Text50008 + SelVehiculo.Garaje;
                           END;
                         END;

      }
      SECTIONS
      {
        { PROPERTIES
          {
            SectionType=Body;
            SectionWidth=25800;
            SectionHeight=0;
          }
          CONTROLS
          {
          }
           }
      }
       }
    { PROPERTIES
      {
        DataItemIndent=3;
        DataItemTable=Table7010319;
        DataItemTableView=SORTING(Orden Listado)
                          ORDER(Ascending);
        NewPagePerRecord=No;
        DataItemVarName=TS_Subtotal;
        OnPreDataItem=BEGIN
                        CurrReport.CREATETOTALS(wVentas,wViajes);
                      END;

        OnAfterGetRecord=VAR
                           lrSelVeh3@1100253000 : Record 7010352;
                           lwGaraje@1100253001 : Code[10];
                           lwAgrupacion@1100253002 : Code[10];
                         BEGIN
                           IF vAgrupacionporPlazas= FALSE THEN
                             CurrReport.SKIP;

                           // Realiza los distintos calculos de:
                           CLEAR(wVentas);
                           CLEAR(wViajes);
                           CLEAR(lwGaraje);
                           CLEAR(lwAgrupacion);

                           lrSelVeh3.RESET;
                           lrSelVeh3.COPY(SelVehiculo);
                           CASE Subtotaliza.Number OF
                             1: lwAgrupacion := SelVehiculo.Agrupacion;
                             2: lwAgrupacion := SelVehiculo.Agrupacion;
                             //3: lwGaraje     := SelVehiculo.Garaje;
                           END;
                           IF vGaraje <> rParametros."Todos los garajes" THEN
                             lwGaraje     := SelVehiculo.Garaje;

                           // Periodo1
                           CalculaTotal(Codigo,1, lwGaraje, lwAgrupacion);
                           // Periodo2
                           CalculaTotal(Codigo,2, lwGaraje, lwAgrupacion);

                           CalcDif;
                           //**********************************************************
                         END;

      }
      SECTIONS
      {
        { PROPERTIES
          {
            SectionType=Header;
            SectionWidth=25800;
            SectionHeight=846;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT(vAgrupacionporPlazas);
                         END;

          }
          CONTROLS
          {
            { 65  ;Label        ;3600 ;0    ;1650 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=------------- }
            { 66  ;Label        ;13500;0    ;1200 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=------------- }
            { 67  ;Label        ;8550 ;0    ;1650 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=------------- }
            { 68  ;Label        ;6750 ;0    ;1650 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=------------- }
            { 69  ;Label        ;5400 ;0    ;1200 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=------------- }
            { 70  ;Label        ;14850;0    ;1200 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=------------- }
            { 164 ;Label        ;10350;0    ;1650 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=------------- }
            { 165 ;Label        ;12150;0    ;1200 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=------------- }
            { 170 ;Label        ;0    ;0    ;1650 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=---------------------- }
            { 171 ;Label        ;1800 ;0    ;1650 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=------------------------- }
            { 230 ;Label        ;16200;0    ;1200 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=------------- }
            { 231 ;Label        ;17550;0    ;1200 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=------------- }
            { 232 ;Label        ;18900;0    ;1200 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=------------- }
            { 61  ;Label        ;20250;0    ;1200 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=------------- }
            { 62  ;Label        ;21600;0    ;1200 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=------------- }
            { 7   ;TextBox      ;0    ;423  ;3900 ;423  ;FontSize=8;
                                                         FontBold=Yes;
                                                         SourceExpr=vTextoTotal }
            { 4   ;Label        ;22950;0    ;1200 ;423  ;HorzAlign=Center;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=---------------------- }
          }
           }
        { PROPERTIES
          {
            SectionType=Body;
            SectionWidth=25800;
            SectionHeight=423;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT(vAgrupacionporPlazas AND (Subtotaliza.Number<>2));
                         END;

          }
          CONTROLS
          {
            { 12  ;TextBox      ;0    ;0    ;1650 ;423  ;FontSize=6;
                                                         SourceExpr=wVentas[1,1] }
            { 15  ;TextBox      ;1800 ;0    ;1650 ;423  ;FontSize=6;
                                                         SourceExpr=wVentas[2,1] }
            { 74  ;TextBox      ;3600 ;0    ;1650 ;423  ;FontSize=6;
                                                         SourceExpr=wDiferencia[1,1] }
            { 75  ;TextBox      ;5400 ;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=ROUND("w%Dif"[1,1],0.01) }
            { 76  ;TextBox      ;6750 ;0    ;1650 ;423  ;FontSize=6;
                                                         SourceExpr=wVentas[1,2] }
            { 77  ;TextBox      ;8550 ;0    ;1650 ;423  ;FontSize=6;
                                                         SourceExpr=wVentas[2,2] }
            { 87  ;TextBox      ;10350;0    ;1650 ;423  ;FontSize=6;
                                                         SourceExpr=wDiferencia[2,1] }
            { 88  ;TextBox      ;12150;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=ROUND("w%Dif"[2,1],0.01) }
            { 89  ;TextBox      ;13500;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=wViajes[1,1] }
            { 93  ;TextBox      ;14850;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=wViajes[2,1] }
            { 97  ;TextBox      ;16200;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=wDiferencia[1,2] }
            { 98  ;TextBox      ;17550;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=ROUND("w%Dif"[1,2],0.01) }
            { 99  ;TextBox      ;18900;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=wViajes[1,2] }
            { 100 ;TextBox      ;20250;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=wViajes[2,2] }
            { 101 ;TextBox      ;21600;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=wDiferencia[2,2] }
            { 103 ;TextBox      ;22950;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=ROUND("w%Dif"[2,2],0.01) }
            { 104 ;TextBox      ;24300;0    ;1500 ;423  ;FontSize=7;
                                                         SourceExpr=Codigo }
          }
           }
        { PROPERTIES
          {
            SectionType=Body;
            SectionWidth=25800;
            SectionHeight=423;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT(vAgrupacionporPlazas AND (Subtotaliza.Number=2));
                           CalcMedias(vContaVG);
                         END;

          }
          CONTROLS
          {
            { 6   ;TextBox      ;0    ;0    ;1650 ;423  ;FontSize=6;
                                                         SourceExpr=xVentas[1,1] }
            { 22  ;TextBox      ;1800 ;0    ;1650 ;423  ;FontSize=6;
                                                         SourceExpr=xVentas[2,1] }
            { 109 ;TextBox      ;3600 ;0    ;1650 ;423  ;FontSize=6;
                                                         SourceExpr=xDiferencia[1,1] }
            { 179 ;TextBox      ;5400 ;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=ROUND("w%Dif"[1,1],0.01) }
            { 180 ;TextBox      ;6750 ;0    ;1650 ;423  ;FontSize=6;
                                                         SourceExpr=xVentas[1,2] }
            { 181 ;TextBox      ;8550 ;0    ;1650 ;423  ;FontSize=6;
                                                         SourceExpr=xVentas[2,2] }
            { 182 ;TextBox      ;10350;0    ;1650 ;423  ;FontSize=6;
                                                         SourceExpr=xDiferencia[2,1] }
            { 183 ;TextBox      ;12150;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=ROUND("w%Dif"[2,1],0.01) }
            { 184 ;TextBox      ;13500;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=xViajes[1,1] }
            { 185 ;TextBox      ;14850;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=xViajes[2,1] }
            { 186 ;TextBox      ;16200;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=xDiferencia[1,2] }
            { 187 ;TextBox      ;17550;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=ROUND("w%Dif"[1,2],0.01) }
            { 188 ;TextBox      ;18900;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=xViajes[1,2] }
            { 189 ;TextBox      ;20250;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=xViajes[2,2] }
            { 192 ;TextBox      ;21600;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=xDiferencia[2,2] }
            { 193 ;TextBox      ;22950;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=ROUND("w%Dif"[2,2],0.01) }
            { 196 ;TextBox      ;24300;0    ;1500 ;423  ;FontSize=7;
                                                         SourceExpr=Codigo }
          }
           }
        { PROPERTIES
          {
            SectionType=Footer;
            SectionWidth=25800;
            SectionHeight=423;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT(Subtotaliza.Number<>2);

                           CalcDif;
                         END;

          }
          CONTROLS
          {
            { 105 ;TextBox      ;8550 ;0    ;1650 ;423  ;FontSize=6;
                                                         SourceExpr=wVentas[2,2] }
            { 106 ;TextBox      ;6750 ;0    ;1650 ;423  ;FontSize=6;
                                                         SourceExpr=wVentas[1,2] }
            { 107 ;TextBox      ;1800 ;0    ;1650 ;423  ;FontSize=6;
                                                         SourceExpr=wVentas[2,1] }
            { 108 ;TextBox      ;0    ;0    ;1650 ;423  ;FontSize=6;
                                                         SourceExpr=wVentas[1,1] }
            { 110 ;Label        ;24300;0    ;1500 ;423  ;FontSize=7;
                                                         CaptionML=ESP=TOTAL }
            { 111 ;TextBox      ;3600 ;0    ;1650 ;423  ;FontSize=6;
                                                         SourceExpr=wDiferencia[1,1] }
            { 112 ;TextBox      ;10350;0    ;1650 ;423  ;FontSize=6;
                                                         SourceExpr=wDiferencia[2,1] }
            { 113 ;TextBox      ;5400 ;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=ROUND("w%Dif"[1,1],0.01) }
            { 114 ;TextBox      ;12150;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=ROUND("w%Dif"[2,1],0.01) }
            { 115 ;TextBox      ;22950;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=ROUND("w%Dif"[2,2],0.01) }
            { 116 ;TextBox      ;21600;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=wDiferencia[2,2] }
            { 117 ;TextBox      ;20250;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=wViajes[2,2] }
            { 118 ;TextBox      ;18900;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=wViajes[1,2] }
            { 119 ;TextBox      ;17550;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=ROUND("w%Dif"[1,2],0.01) }
            { 120 ;TextBox      ;16200;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=wDiferencia[1,2] }
            { 121 ;TextBox      ;14850;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=wViajes[2,1] }
            { 122 ;TextBox      ;13500;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=wViajes[1,1] }
          }
           }
        { PROPERTIES
          {
            SectionType=Footer;
            SectionWidth=25800;
            SectionHeight=423;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT(Subtotaliza.Number=2);
                           CalcMedias(vContaVG);
                         END;

          }
          CONTROLS
          {
            { 260 ;TextBox      ;0    ;0    ;1650 ;423  ;FontSize=6;
                                                         SourceExpr=xVentas[1,1] }
            { 261 ;TextBox      ;1800 ;0    ;1650 ;423  ;FontSize=6;
                                                         SourceExpr=xVentas[2,1] }
            { 262 ;TextBox      ;3600 ;0    ;1650 ;423  ;FontSize=6;
                                                         SourceExpr=xDiferencia[1,1] }
            { 263 ;TextBox      ;5400 ;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=ROUND("w%Dif"[1,1],0.01) }
            { 264 ;TextBox      ;6750 ;0    ;1650 ;423  ;FontSize=6;
                                                         SourceExpr=xVentas[1,2] }
            { 265 ;TextBox      ;8550 ;0    ;1650 ;423  ;FontSize=6;
                                                         SourceExpr=xVentas[2,2] }
            { 266 ;TextBox      ;10350;0    ;1650 ;423  ;FontSize=6;
                                                         SourceExpr=xDiferencia[2,1] }
            { 267 ;TextBox      ;12150;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=ROUND("w%Dif"[2,1],0.01) }
            { 268 ;TextBox      ;13500;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=xViajes[1,1] }
            { 269 ;TextBox      ;14850;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=xViajes[2,1] }
            { 270 ;TextBox      ;16200;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=xDiferencia[1,2] }
            { 271 ;TextBox      ;17550;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=ROUND("w%Dif"[1,2],0.01) }
            { 272 ;TextBox      ;18900;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=xViajes[1,2] }
            { 273 ;TextBox      ;20250;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=xViajes[2,2] }
            { 274 ;TextBox      ;21600;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=xDiferencia[2,2] }
            { 275 ;TextBox      ;22950;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=ROUND("w%Dif"[2,2],0.01) }
            { 276 ;TextBox      ;24300;0    ;1500 ;423  ;FontSize=7;
                                                         SourceExpr=Codigo }
          }
           }
        { PROPERTIES
          {
            SectionType=Footer;
            SectionWidth=25800;
            SectionHeight=0;
            OnPreSection=BEGIN
                           IF Subtotaliza.Number = 2 THEN
                             vContaVG := 0;
                         END;

          }
          CONTROLS
          {
          }
           }
      }
       }
    { PROPERTIES
      {
        DataItemIndent=1;
        DataItemTable=Table7010319;
        DataItemTableView=SORTING(Orden Listado)
                          ORDER(Ascending);
        DataItemVarName=TS-Total;
        OnPreDataItem=VAR
                        rVehiculo@1100253000 : Record 7010346;
                      BEGIN
                        //Las agrupaciones generales, se ver n en una nueva p gina.
                        IF vAgrupacionGeneral THEN BEGIN
                          CurrReport.NEWPAGE;
                          CurrReport.CREATETOTALS(wVentas,wViajes);
                        END;
                      END;

        OnAfterGetRecord=BEGIN
                           IF vAgrupacionGeneral = FALSE THEN
                             CurrReport.SKIP;

                           vTextoTotal := Text50009;

                           // Realiza los distintos calculos de:
                           CLEAR(wVentas);
                           CLEAR(wViajes);

                           // Periodo1
                           CalculaTotal(Codigo,1,'','');
                           // Periodo2
                           CalculaTotal(Codigo,2,'','');

                           CalcDif;
                         END;

      }
      SECTIONS
      {
        { PROPERTIES
          {
            SectionType=Header;
            SectionWidth=25800;
            SectionHeight=423;
          }
          CONTROLS
          {
            { 63  ;Label        ;0    ;0    ;3300 ;423  ;FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Total General }
          }
           }
        { PROPERTIES
          {
            SectionType=Body;
            SectionWidth=25800;
            SectionHeight=423;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT(vAgrupacionGeneral);
                         END;

          }
          CONTROLS
          {
            { 79  ;TextBox      ;0    ;0    ;1650 ;423  ;FontSize=6;
                                                         SourceExpr=wVentas[1,1] }
            { 85  ;TextBox      ;1800 ;0    ;1650 ;423  ;FontSize=6;
                                                         SourceExpr=wVentas[2,1] }
            { 123 ;TextBox      ;3600 ;0    ;1650 ;423  ;FontSize=6;
                                                         SourceExpr=wDiferencia[1,1] }
            { 124 ;TextBox      ;5400 ;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=ROUND("w%Dif"[1,1],0.01) }
            { 125 ;TextBox      ;6750 ;0    ;1650 ;423  ;FontSize=6;
                                                         SourceExpr=wVentas[1,2] }
            { 126 ;TextBox      ;8550 ;0    ;1650 ;423  ;FontSize=6;
                                                         SourceExpr=wVentas[2,2] }
            { 132 ;TextBox      ;10350;0    ;1650 ;423  ;FontSize=6;
                                                         SourceExpr=wDiferencia[2,1] }
            { 144 ;TextBox      ;12150;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=ROUND("w%Dif"[2,1],0.01) }
            { 145 ;TextBox      ;13500;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=wViajes[1,1] }
            { 146 ;TextBox      ;14850;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=wViajes[2,1] }
            { 147 ;TextBox      ;16200;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=wDiferencia[1,2] }
            { 148 ;TextBox      ;17550;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=ROUND("w%Dif"[1,2],0.01) }
            { 149 ;TextBox      ;18900;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=wViajes[1,2] }
            { 150 ;TextBox      ;20250;0    ;1200 ;423  ;SourceExpr=wViajes[2,2] }
            { 151 ;TextBox      ;21600;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=wDiferencia[2,2] }
            { 152 ;TextBox      ;22950;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=ROUND("w%Dif"[2,2],0.01) }
            { 153 ;TextBox      ;24300;0    ;1500 ;423  ;FontSize=7;
                                                         SourceExpr=Codigo }
          }
           }
        { PROPERTIES
          {
            SectionType=Footer;
            SectionWidth=25800;
            SectionHeight=423;
            OnPreSection=BEGIN
                           CalcDif;
                         END;

          }
          CONTROLS
          {
            { 154 ;TextBox      ;8550 ;0    ;1650 ;423  ;FontSize=6;
                                                         SourceExpr=wVentas[2,2] }
            { 155 ;TextBox      ;6750 ;0    ;1650 ;423  ;FontSize=6;
                                                         SourceExpr=wVentas[1,2] }
            { 156 ;TextBox      ;1800 ;0    ;1650 ;423  ;FontSize=6;
                                                         SourceExpr=wVentas[2,1] }
            { 157 ;TextBox      ;0    ;0    ;1650 ;423  ;FontSize=6;
                                                         SourceExpr=wVentas[1,1] }
            { 158 ;Label        ;24300;0    ;1500 ;423  ;FontSize=7;
                                                         CaptionML=ESP=TOTAL }
            { 159 ;TextBox      ;3600 ;0    ;1650 ;423  ;FontSize=6;
                                                         SourceExpr=wDiferencia[1,1] }
            { 160 ;TextBox      ;10350;0    ;1650 ;423  ;FontSize=6;
                                                         SourceExpr=wDiferencia[2,1] }
            { 161 ;TextBox      ;5400 ;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=ROUND("w%Dif"[1,1],0.01) }
            { 162 ;TextBox      ;12150;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=ROUND("w%Dif"[2,1],0.01) }
            { 163 ;TextBox      ;22950;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=ROUND("w%Dif"[2,2],0.01) }
            { 166 ;TextBox      ;21600;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=wDiferencia[2,2] }
            { 167 ;TextBox      ;20250;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=wViajes[2,2] }
            { 168 ;TextBox      ;18900;0    ;1200 ;423  ;SourceExpr=wViajes[1,2] }
            { 169 ;TextBox      ;17550;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=ROUND("w%Dif"[1,2],0.01) }
            { 172 ;TextBox      ;16200;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=wDiferencia[1,2] }
            { 173 ;TextBox      ;14850;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=wViajes[2,1] }
            { 174 ;TextBox      ;13500;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=wViajes[1,1] }
          }
           }
      }
       }
    { PROPERTIES
      {
        DataItemIndent=1;
        DataItemTable=Table7010319;
        DataItemTableView=SORTING(Orden Listado)
                          ORDER(Ascending);
        DataItemVarName=TS-Media;
        OnPreDataItem=BEGIN
                        CurrReport.CREATETOTALS(wVentas,wViajes);
                      END;

        OnAfterGetRecord=BEGIN
                           IF vAgrupacionGeneral = FALSE THEN
                             CurrReport.SKIP;

                           vTextoTotal := Text50010;

                           // Realiza los distintos calculos de:
                           CLEAR(wVentas);
                           CLEAR(wViajes);

                           // Periodo1
                           CalculaTotal(Codigo,1,'','');
                           // Periodo2
                           CalculaTotal(Codigo,2,'','');

                           CalcDif;
                         END;

      }
      SECTIONS
      {
        { PROPERTIES
          {
            SectionType=Header;
            SectionWidth=25800;
            SectionHeight=846;
          }
          CONTROLS
          {
            { 5   ;Label        ;0    ;423  ;3300 ;423  ;FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=ESP=Media General }
          }
           }
        { PROPERTIES
          {
            SectionType=Body;
            SectionWidth=25800;
            SectionHeight=423;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT(vAgrupacionGeneral);
                           CalcMedias(wCont);
                         END;

          }
          CONTROLS
          {
            { 197 ;TextBox      ;0    ;0    ;1650 ;423  ;FontSize=6;
                                                         SourceExpr=xVentas[1,1] }
            { 198 ;TextBox      ;1800 ;0    ;1650 ;423  ;FontSize=6;
                                                         SourceExpr=xVentas[2,1] }
            { 199 ;TextBox      ;3600 ;0    ;1650 ;423  ;FontSize=6;
                                                         SourceExpr=xDiferencia[1,1] }
            { 200 ;TextBox      ;5400 ;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=ROUND("w%Dif"[1,1],0.01) }
            { 201 ;TextBox      ;6750 ;0    ;1650 ;423  ;FontSize=6;
                                                         SourceExpr=xVentas[1,2] }
            { 202 ;TextBox      ;8550 ;0    ;1650 ;423  ;FontSize=6;
                                                         SourceExpr=xVentas[2,2] }
            { 203 ;TextBox      ;10350;0    ;1650 ;423  ;FontSize=6;
                                                         SourceExpr=xDiferencia[2,1] }
            { 204 ;TextBox      ;12150;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=ROUND("w%Dif"[2,1],0.01) }
            { 205 ;TextBox      ;13500;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=xViajes[1,1] }
            { 206 ;TextBox      ;14850;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=xViajes[2,1] }
            { 207 ;TextBox      ;16200;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=xDiferencia[1,2] }
            { 208 ;TextBox      ;17550;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=ROUND("w%Dif"[1,2],0.01) }
            { 209 ;TextBox      ;18900;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=xViajes[1,2] }
            { 211 ;TextBox      ;20250;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=xViajes[2,2] }
            { 212 ;TextBox      ;21600;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=xDiferencia[2,2] }
            { 213 ;TextBox      ;22950;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=ROUND("w%Dif"[2,2],0.01) }
            { 214 ;TextBox      ;24300;0    ;1500 ;423  ;FontSize=7;
                                                         SourceExpr=Codigo }
          }
           }
        { PROPERTIES
          {
            SectionType=Footer;
            SectionWidth=25800;
            SectionHeight=423;
            OnPreSection=BEGIN
                           CalcMedias(wCont);
                           CalcDif;
                         END;

          }
          CONTROLS
          {
            { 216 ;TextBox      ;0    ;0    ;1650 ;423  ;FontSize=6;
                                                         SourceExpr=xVentas[1,1] }
            { 217 ;TextBox      ;1800 ;0    ;1650 ;423  ;FontSize=6;
                                                         SourceExpr=xVentas[2,1] }
            { 218 ;TextBox      ;3600 ;0    ;1650 ;423  ;FontSize=6;
                                                         SourceExpr=xDiferencia[1,1] }
            { 219 ;TextBox      ;5400 ;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=ROUND("w%Dif"[1,1],0.01) }
            { 220 ;TextBox      ;6750 ;0    ;1650 ;423  ;FontSize=6;
                                                         SourceExpr=xVentas[1,2] }
            { 221 ;TextBox      ;8550 ;0    ;1650 ;423  ;FontSize=6;
                                                         SourceExpr=xVentas[2,2] }
            { 222 ;TextBox      ;10350;0    ;1650 ;423  ;FontSize=6;
                                                         SourceExpr=xDiferencia[2,1] }
            { 223 ;TextBox      ;12150;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=ROUND("w%Dif"[2,1],0.01) }
            { 224 ;TextBox      ;13500;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=xViajes[1,1] }
            { 225 ;TextBox      ;14850;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=xViajes[2,1] }
            { 226 ;TextBox      ;16200;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=xDiferencia[1,2] }
            { 227 ;TextBox      ;17550;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=ROUND("w%Dif"[1,2],0.01) }
            { 228 ;TextBox      ;18900;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=xViajes[1,2] }
            { 229 ;TextBox      ;20250;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=xViajes[2,2] }
            { 235 ;TextBox      ;21600;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=xDiferencia[2,2] }
            { 236 ;TextBox      ;22950;0    ;1200 ;423  ;FontSize=6;
                                                         SourceExpr=ROUND("w%Dif"[2,2],0.01) }
            { 242 ;TextBox      ;24300;0    ;1500 ;423  ;FontSize=7;
                                                         SourceExpr=Codigo }
          }
           }
      }
       }
  }
  REQUESTFORM
  {
    PROPERTIES
    {
      Width=10560;
      Height=8690;
      OnOpenForm=VAR
                   rConf@1100253000 : Record 98;
                   cFunBas@1100253001 : Codeunit 7010310;
                   cVeh@1100253002 : Codeunit 7010317;
                   vAuxGaraje@1100253003 : Code[10];
                 BEGIN
                   rParametros.FINDFIRST;
                   vGaraje := cFunBas.ObtenerGaraje();

                   //............
                   vVehiculos:=vVehiculos::"Todos los Veh¡culos";
                   RequestOptionsForm.Seleccionar.VISIBLE:=FALSE;
                   //............

                   vAgrupacionGeneral  := TRUE;

                   wIniAcum[1]         := rParametros."Fecha Inicio Acumulados";
                   wIniAcum[2]         := wIniAcum[1];

                   vPropiedad          := vPropiedad::Todos;
                   //............
                   vAgrupacionporPlazas:=TRUE;
                   vTipoAgrupacion     :=vTipoAgrupacion::"Grupo Veh¡culos";
                   RequestOptionsForm.Agrupar.VISIBLE:= FALSE;
                   //............

                   vMostrarDetalle     :=TRUE;
                   vSoloConActividad   :=FALSE;


                   //Actualizamos la selecci¢n de Vehiculos.
                   cVeh.ActualizarSeleccionVehiculos();

                   vAuxGaraje:=cFunBas.ObtenerGaraje();
                   IF vAuxGaraje<>'' THEN
                     RequestOptionsForm.FltGaraje.EDITABLE := FALSE;

                   vVerBloqueados := FALSE;

                   //Inicializaci¢n de la divisa.
                   vDivisa:= '';
                 END;

    }
    CONTROLS
    {
      { 2   ;Label        ;220  ;220  ;6050 ;440  ;InPage=-1;
                                                   CaptionML=ESP=Garaje }
      { 3   ;TextBox      ;6380 ;220  ;2310 ;440  ;Name=FltGaraje;
                                                   InPage=-1;
                                                   NextControl=4;
                                                   SourceExpr=vGaraje;
                                                   TableRelation=Garaje.Garaje;
                                                   OnValidate=VAR
                                                                cfunbas@1100253001 : Codeunit 7010310;
                                                              BEGIN
                                                                cfunbas.TestRestringido(vGaraje);
                                                              END;
                                                               }
      { 7   ;CheckBox     ;6380 ;3630 ;440  ;440  ;InPage=-1;
                                                   ShowCaption=No;
                                                   SourceExpr=vMostrarDetalle }
      { 9   ;CheckBox     ;6380 ;4180 ;440  ;440  ;InPage=-1;
                                                   ShowCaption=No;
                                                   SourceExpr=vAgrupacionporPlazas }
      { 12  ;CheckBox     ;6380 ;4730 ;440  ;440  ;InPage=-1;
                                                   ShowCaption=No;
                                                   SourceExpr=vAgrupacionGeneral }
      { 15  ;CheckBox     ;6380 ;5280 ;440  ;440  ;InPage=-1;
                                                   ShowCaption=No;
                                                   NextControl=3;
                                                   SourceExpr=vSoloConActividad }
      { 16  ;Label        ;220  ;5280 ;6050 ;440  ;InPage=-1;
                                                   MultiLine=Yes;
                                                   CaptionML=ESP=Mostrar s¢lo Veh¡culos con Actividad;
                                                   ToolTipML=ESP=Si se marca s¢lo se considerar n los vehiculos que han tenido actividad }
      { 13  ;Label        ;220  ;4730 ;6050 ;440  ;InPage=-1;
                                                   CaptionML=ESP=Mostrar Agrupaci¢n Total }
      { 10  ;Label        ;220  ;4180 ;6050 ;440  ;InPage=-1;
                                                   CaptionML=ESP=Mostrar Totales por Tipo de Agrupaci¢n }
      { 8   ;Label        ;220  ;3630 ;6050 ;440  ;InPage=-1;
                                                   CaptionML=ESP=Mostrar Detalle }
      { 19  ;CommandButton;9680 ;1320 ;440  ;440  ;Name=Agrupar;
                                                   InPage=-1;
                                                   ForeColor=0;
                                                   BackColor=12632256;
                                                   Border=Yes;
                                                   CaptionML=ESP=...;
                                                   ToolTipML=ESP=Agrupaci¢n de plazas;
                                                   OnPush=VAR
                                                            rSel@1100253001 : Record 7010354;
                                                            fSel@1100253002 : Form 7010389;
                                                            cVeh@1100253003 : Codeunit 7010317;
                                                            rUsr@1100253004 : Record 7010420;
                                                            rPar@1100253005 : Record 7010311;
                                                          BEGIN
                                                            rSel.RESET;
                                                            rSel.SETCURRENTKEY("Id. Usuario");
                                                            rSel.SETRANGE("Id. Usuario",USERID);

                                                            IF rSel.COUNT=0 THEN
                                                              //Actualizamos la selecci¢n de Vehiculos.
                                                              cVeh.ActualizarRangos();

                                                            rSel.RESET;
                                                            rSel.SETCURRENTKEY("Id. Usuario",Garaje);
                                                            rSel.FILTERGROUP(2);
                                                            rPar.FINDFIRST;

                                                            rSel.SETRANGE("Id. Usuario",USERID);
                                                            IF rUsr.GET(USERID) AND (rUsr."Garaje de trabajo"<>rPar."Todos los garajes") THEN
                                                              rSel.SETRANGE(Garaje,rUsr."Garaje de trabajo");

                                                            rSel.FILTERGROUP(0);

                                                            CLEAR(fSel);
                                                            fSel.SETTABLEVIEW(rSel);
                                                            fSel.RUN;
                                                            CLEAR(fSel);
                                                            rSel.RESET;
                                                          END;
                                                           }
      { 20  ;CommandButton;9680 ;770  ;440  ;440  ;Name=Seleccionar;
                                                   HorzGlue=Left;
                                                   VertGlue=Top;
                                                   InPage=-1;
                                                   CaptionML=ESP=...;
                                                   ToolTipML=ESP=Seleccionar Vehiculos;
                                                   OnPush=VAR
                                                            rSel@1100253001 : Record 7010352;
                                                            fSel@1100253002 : Form 7010386;
                                                            rPar@1100253003 : Record 7010311;
                                                          BEGIN
                                                            rPar.FINDFIRST;

                                                            rSel.RESET;
                                                            rSel.INIT;
                                                            rSel.SETCURRENTKEY(Usuario,Garaje, Numero);
                                                            rSel.FILTERGROUP(2);
                                                            rSel.SETRANGE(Usuario,USERID);

                                                            IF (vGaraje<>'') AND (vGaraje<>rPar."Todos los garajes") THEN
                                                              rSel.SETRANGE(Garaje, vGaraje);

                                                            rSel.FILTERGROUP(0);

                                                            CLEAR(fSel);
                                                            fSel.SETTABLEVIEW(rSel);
                                                            fSel.RUN;
                                                            CLEAR(fSel);
                                                            rSel.RESET;
                                                          END;
                                                           }
      { 11  ;TextBox      ;6380 ;770  ;3300 ;440  ;InPage=-1;
                                                   SourceExpr=vVehiculos;
                                                   OnValidate=BEGIN
                                                                IF vVehiculos=vVehiculos::"Todos los Veh¡culos" THEN
                                                                  RequestOptionsForm.Seleccionar.VISIBLE:=FALSE
                                                                ELSE
                                                                  RequestOptionsForm.Seleccionar.VISIBLE:=TRUE;
                                                              END;
                                                               }
      { 14  ;Label        ;220  ;770  ;6050 ;440  ;InPage=-1;
                                                   CaptionML=ESP=Selecci¢n Veh¡culos }
      { 21  ;TextBox      ;6380 ;1320 ;3300 ;440  ;Name=TipoAgrupacion;
                                                   InPage=-1;
                                                   SourceExpr=vTipoAgrupacion;
                                                   OnValidate=BEGIN
                                                                IF vTipoAgrupacion=vTipoAgrupacion::"Agrupaci¢n Plazas" THEN
                                                                  RequestOptionsForm.Agrupar.VISIBLE:= TRUE
                                                                ELSE
                                                                  RequestOptionsForm.Agrupar.VISIBLE:= FALSE;
                                                              END;
                                                               }
      { 22  ;Label        ;220  ;1320 ;6050 ;440  ;InPage=-1;
                                                   CaptionML=ESP=Tipo de Agrupaci¢n }
      { 23  ;Label        ;220  ;2420 ;6050 ;440  ;ParentControl=24;
                                                   InPage=-1;
                                                   MultiLine=Yes;
                                                   CaptionML=ESP=Garaje a considerar en resultados;
                                                   ToolTipML=ESP=Si se marca s¢lo se considerar n los vehiculos que han tenido actividad }
      { 24  ;TextBox      ;6380 ;2420 ;2310 ;440  ;Name=FltGaraje;
                                                   InPage=-1;
                                                   NextControl=7;
                                                   SourceExpr=vGarajeResult;
                                                   TableRelation=Garaje.Garaje;
                                                   OnValidate=VAR
                                                                cfunbas@1100253001 : Codeunit 7010310;
                                                              BEGIN
                                                                cfunbas.TestRestringido(vGaraje);
                                                              END;
                                                               }
      { 26  ;Label        ;220  ;1870 ;6050 ;440  ;ParentControl=27;
                                                   InPage=-1;
                                                   MultiLine=Yes;
                                                   CaptionML=ESP=Selecci¢n seg£n la propiedad del Vehiculo;
                                                   ToolTipML=ESP=Si se marca s¢lo se considerar n los vehiculos que han tenido actividad }
      { 27  ;TextBox      ;6380 ;1870 ;2200 ;440  ;InPage=-1;
                                                   NextControl=24;
                                                   SourceExpr=vPropiedad }
      { 25  ;CheckBox     ;6380 ;5830 ;440  ;440  ;InPage=-1;
                                                   ShowCaption=No;
                                                   NextControl=3;
                                                   SourceExpr=vVerBloqueados }
      { 28  ;Label        ;220  ;5830 ;6050 ;440  ;InPage=-1;
                                                   MultiLine=Yes;
                                                   CaptionML=ESP=Mostrar vehiculos bloqueados;
                                                   ToolTipML=ESP=Si se marca s¢lo se considerar n los vehiculos que han tenido actividad }
      { 29  ;TextBox      ;6380 ;2970 ;1650 ;440  ;InPage=-1;
                                                   SourceExpr=vDivisa;
                                                   TableRelation=Currency;
                                                   OnValidate=VAR
                                                                cFunBas@1100253001 : Codeunit 7010310;
                                                              BEGIN
                                                              END;
                                                               }
      { 30  ;Label        ;220  ;2970 ;6050 ;440  ;InPage=-1;
                                                   CaptionML=ESP=C¢d. Divisa }
      { 31  ;TextBox      ;6380 ;7480 ;2310 ;440  ;InPage=-1;
                                                   SourceExpr=wIniAcum[1];
                                                   OnValidate=BEGIN
                                                                IF (wIniAcum[1] =0D) OR (wIniAcum[2] = 0D ) THEN
                                                                  ERROR(err3)
                                                              END;
                                                               }
      { 32  ;TextBox      ;6380 ;8030 ;2310 ;440  ;InPage=-1;
                                                   SourceExpr=wIniAcum[2];
                                                   OnValidate=BEGIN
                                                                IF (wIniAcum[1] =0D) OR (wIniAcum[2] = 0D ) THEN
                                                                  ERROR(err3)
                                                              END;
                                                               }
      { 33  ;Label        ;220  ;7480 ;6050 ;440  ;InPage=-1;
                                                   CaptionML=ESP=Inicio Acumulados Periodo 1 }
      { 34  ;Label        ;220  ;8030 ;6050 ;440  ;InPage=-1;
                                                   CaptionML=ESP=Inicio Acumulados Periodo 2 }
      { 35  ;TextBox      ;6380 ;6380 ;3960 ;440  ;Name=ff11;
                                                   InPage=-1;
                                                   SourceExpr=wFiltroFecha[1];
                                                   OnValidate=VAR
                                                                lcGestApl@1100253001 : Codeunit 1;
                                                              BEGIN
                                                                FormatoFiltro(wFiltroFecha[1]);
                                                              END;
                                                               }
      { 36  ;TextBox      ;6380 ;6930 ;3960 ;440  ;Name=ff11;
                                                   InPage=-1;
                                                   SourceExpr=wFiltroFecha[2];
                                                   OnValidate=BEGIN
                                                                FormatoFiltro(wFiltroFecha[2]);
                                                              END;
                                                               }
      { 37  ;Label        ;220  ;6380 ;6050 ;440  ;InPage=-1;
                                                   CaptionML=ESP=Periodo 1 }
      { 38  ;Label        ;220  ;6930 ;6050 ;440  ;InPage=-1;
                                                   CaptionML=ESP=Periodo 2 }
    }
  }
  REQUESTPAGE
  {
    PROPERTIES
    {
    }
    CONTROLS
    {
    }
  }
  CODE
  {
    VAR
      Text50000@1103355000 : TextConst 'ESP=TODOS';
      Text50001@1103355001 : TextConst 'ESP=Hay vehiculos que no tienen definido el n£mero de plazas. Rev¡selo.';
      Text50002@1103355002 : TextConst 'ESP=Procesando  @1@@@@@@@@@\';
      Text50003@1103355003 : TextConst 'ESP="Total Vehic. "';
      Text50004@1103355004 : TextConst 'ESP=" plazas"';
      Text50005@1103355005 : TextConst 'ESP="Total Grupo "';
      Text50006@1103355006 : TextConst 'ESP="Media Vehic. "';
      Text50007@1103355007 : TextConst 'ESP="Media Grupo "';
      Text50008@1103355008 : TextConst 'ESP="Total Garaje "';
      Text50009@1103355009 : TextConst 'ESP=Total General';
      Text50010@1103355010 : TextConst 'ESP=Media General';
      LastFieldNo@1100253000 : Integer;
      FooterPrinted@1100253001 : Boolean;
      vGaraje@1100253002 : Code[10];
      ContaTS@1100253003 : Integer;
      vImpTotalGrupo@1100253004 : Boolean;
      vTextoTotal@1100253005 : Text[30];
      vPrecision@1100253006 : Decimal;
      vAntGaraje@1100253007 : Code[10];
      vFltGaraje@1100253008 : Text[10];
      vAgrupacionGeneral@1100253009 : Boolean;
      vAgrupacionporPlazas@1100253010 : Boolean;
      vMostrarDetalle@1100253011 : Boolean;
      vTextoNormal@1100253012 : Text[20];
      vSoloConActividad@1100253013 : Boolean;
      vVehiculos@1100253014 : 'Todos los Veh¡culos,Seg£n Selecci¢n';
      vTipoAgrupacion@1100253015 : 'Grupo Veh¡culos,Agrupaci¢n Plazas';
      vGarajeResult@1100253016 : Code[10];
      vFltGarajeResult@1100253017 : Text[30];
      vTipoLinea@1100253018 : Text[50];
      vTipoElemento@1100253019 : Text[50];
      vPropiedad@1100253020 : 'Todos,S¢lo Propios,S¢lo Ajenos';
      vVerBloqueados@1100253021 : Boolean;
      vDivisa@1100253022 : Code[10];
      rParametros@1100253023 : Record 7010311;
      wFiltroFecha@1100253024 : ARRAY [2] OF Text[250];
      wIniAcum@1100253025 : ARRAY [2] OF Date;
      err1@1100253026 : TextConst 'ESP=%1 No es un filtro v lido';
      err2@1100253027 : TextConst 'ESP=%1 no puede ser superior a %2';
      err3@1100253028 : TextConst 'ESP=Los Inicios de Acumulados no pueden permanecer en blanco';
      ERROR1@1100253029 : TextConst 'ESP=Falta asignar el identificador de C¢digo Entrada en la ficha de par metros';
      ERROR2@1100253030 : TextConst 'ESP=No se ha asignado nin£n periodo';
      wVentas@1100253031 : ARRAY [2,2] OF Decimal;
      wViajes@1100253032 : ARRAY [2,2] OF Decimal;
      ERROR_INCONSISTENCIA@1100253033 : TextConst 'ESP=Inconsitencia detectada en la selecci¢n de vehiculos';
      wDiferencia@1100253034 : ARRAY [2,2] OF Decimal;
      "w%Dif"@1100253035 : ARRAY [2,2] OF Decimal;
      rSelVeh2@1100253036 : Record 7010352;
      wVentana1@1100253037 : Dialog;
      wTotal@1100253038 : Integer;
      wCont@1100253039 : Integer;
      rTemp@1100253040 : Record 7010390;
      wAcum@1100253041 : Integer;
      wFiltraGaraje@1100253042 : Boolean;
      vContaVG@1100253043 : Integer;
      xVentas@1100253044 : ARRAY [2,2] OF Decimal;
      xViajes@1100253045 : ARRAY [2,2] OF Decimal;
      xDiferencia@1100253046 : ARRAY [2,2] OF Decimal;

    PROCEDURE TestActividad@9(VAR rVeh@1100253000 : Record 7010352) : Boolean;
    VAR
      rIngreso@1100253001 : Record 7010414;
      lrProd@1103355000 : Record 7035392;
      rParte@1100253002 : Record 7010360;
      vConcepto@1100253003 : 'Ingreso';
      lwPeriodo@1100253004 : Integer;
      lwAct@1100253005 : ARRAY [2] OF Boolean;
    BEGIN
      //TestActividad(rVeh: Record Vehiculo).
      //El proposito es saber si para un vehiculo, para unas fechas determinadas, ha habido actividad.

      rParte.RESET;
      rParte.SETCURRENTKEY(Confirmado,Vehiculo,"Fecha facturacion");

      rIngreso.RESET;
      rIngreso.SETCURRENTKEY(Vehiculo, Fecha);

      //Recorremos todos los vehiculos que se van a considerar en el informe.
      IF rVeh.FINDSET(TRUE) THEN BEGIN

        REPEAT
          FOR lwPeriodo := 1 TO 2 DO BEGIN

            rParte.SETRANGE(Confirmado,TRUE);
            rParte.SETRANGE(Vehiculo,rVeh.Matricula);

            IF wFiltroFecha[lwPeriodo] <> '' THEN BEGIN
              rParte.SETFILTER(Fecha,wFiltroFecha[lwPeriodo]);
              IF wIniAcum[lwPeriodo] < rParte.GETRANGEMIN(Fecha) THEN
                rParte.SETFILTER(Fecha,'%1..%2',wIniAcum[lwPeriodo],rParte.GETRANGEMAX(Fecha));
            END ELSE
              rParte.SETFILTER(Fecha,'%1..',wIniAcum[lwPeriodo]);

            IF NOT rParte.FINDFIRST THEN BEGIN
              rIngreso.SETRANGE(Vehiculo,rVeh.Matricula);

              rParte.COPYFILTER(Fecha , rIngreso.Fecha);

              lwAct[lwPeriodo] := rIngreso.FINDFIRST;

              // JPT 16/10/06 Ahora miramos tambien la produccion
              IF NOT lwAct[lwPeriodo] THEN BEGIN
                CLEAR(lrProd);
                lrProd.SETCURRENTKEY("Servicio Regular",Fecha);
                lrProd.SETRANGE(Vehiculo,rVeh.Matricula);
                rParte.COPYFILTER(Fecha , lrProd.Fecha);
                lwAct[lwPeriodo] := lrProd.FINDFIRST;
              END;

            END
            ELSE
              lwAct[lwPeriodo] := TRUE;
          END;
          rVeh.Actividad := lwAct[1] OR lwAct[2];
          rVeh.MODIFY;

        UNTIL rVeh.NEXT=0;
      END;
    END;

    PROCEDURE Agrupar1@6();
    VAR
      rSelVeh@1100253000 : Record 7010352;
    BEGIN
      //Agrupar1().
      //Como la agrupaci¢n ser  por tipo de Vehiculo, entonces asignaremos al campo Agrupacion
      //el valor del Tipo Vehiculo.
      rSelVeh.RESET;
      rSelVeh.SETCURRENTKEY(Usuario);
      rSelVeh.SETRANGE(Usuario,USERID);
      IF rSelVeh.FINDSET(TRUE) THEN REPEAT
        rSelVeh.Agrupacion := rSelVeh."Tipo Vehiculo";
        rSelVeh.MODIFY;
      UNTIL rSelVeh.NEXT=0;
    END;

    PROCEDURE Agrupar2@7();
    VAR
      cFunVeh@1100253000 : Codeunit 7010317;
      Contador@1100253001 : Integer;
      vGrupo@1100253002 : Code[10];
      aRangos@1100253003 : ARRAY [100,3] OF Integer;
      aRGaraje@1100253004 : ARRAY [100] OF Code[10];
      rSelVeh@1100253005 : Record 7010352;
    BEGIN
      //Agrupar2().
      //Este caso ya es m s complicado: Hay que ir buscando los rangos.
      //Usaremos una matriz para ir m s r pidos.
      cFunVeh.CrearAgrupacionRangos(aRangos,aRGaraje,Contador);

      //Una vez cargada la matriz ya podemos empezar a agrupar.
      rSelVeh.RESET;
      rSelVeh.SETCURRENTKEY(Usuario);
      rSelVeh.SETRANGE(Usuario,USERID);
      IF rSelVeh.FINDSET(TRUE) THEN REPEAT
        vGrupo := cFunVeh.ObtenerAgrupacionRango(rSelVeh.Garaje,aRangos,aRGaraje,Contador,rSelVeh.Plazas);

        //Si no obtenemos el c¢digo de agrupaci¢n PERO resulta que no estamos agrupando por plazas
        //entonces le asignamos como grupo, el n£mero de plazas.(siguientes 2 lineas de c¢digo).
        //Si no hicieramos esto, el vehiculo no saldr¡a en el informe.
        //Ser¡a una anomal¡a peque¤a, pero anomal¡a al fin y al cabo.

        IF (vGrupo='') AND (NOT vAgrupacionporPlazas) THEN
          vGrupo := FORMAT(rSelVeh.Plazas);

        rSelVeh.Agrupacion := vGrupo;
        rSelVeh.MODIFY;

      UNTIL rSelVeh.NEXT=0;
    END;

    PROCEDURE FormatoFiltro@4(VAR TextFiltroFech@1100253000 : Text[250]);
    VAR
      wFecha1@1100253001 : Date;
      wFecha2@1100253002 : Date;
      PosicionCadena@1100253003 : Integer;
      i@1100253004 : Integer;
      lcGestApl@1100253005 : Codeunit 1;
      Text1@1100253006 : Text[250];
      Text2@1100253007 : Text[250];
    BEGIN
      lcGestApl.MakeDateFilter(TextFiltroFech);

      PosicionCadena := STRPOS(TextFiltroFech,'..');

      IF PosicionCadena = 0 THEN BEGIN
        IF EVALUATE(wFecha1,TextFiltroFech) THEN
          TextFiltroFech := FORMAT(wFecha1)
        ELSE
          ERROR(err1,TextFiltroFech);
      END
      ELSE
      BEGIN
        Text1 := COPYSTR(TextFiltroFech,1,PosicionCadena - 1);
        Text2 := COPYSTR(TextFiltroFech,PosicionCadena + 2, STRLEN(TextFiltroFech));
        IF (EVALUATE(wFecha1,Text1)) AND (EVALUATE(wFecha2,Text2))   THEN BEGIN
          TextFiltroFech := FORMAT(wFecha1)+'..'+FORMAT(wFecha2);
          IF wFecha1 > wFecha2 THEN
            ERROR(err2,wFecha1,wFecha2);
        END
        ELSE
          ERROR(err1,TextFiltroFech);

      END;
    END;

    PROCEDURE Calcula@11(pwMatricula@1100253000 : Code[10];pwCodTipoServicio@1100253001 : Code[10];pwPeriodo@1100253002 : Integer);
    VAR
      lwVentas@1100253003 : Decimal;
      cFunBas@1100253004 : Codeunit 7010310;
      lwVentasAcum@1100253005 : Decimal;
      lrConductores@1100253006 : Record 7010327;
      lwViajes@1100253007 : Decimal;
      lwViajesAcum@1100253008 : Decimal;
      lrVehiculo@1100253009 : Record 7010346;
    BEGIN
      // Calcula
      // Calcula El N§Viajes y Pasajeros

      IF NOT lrVehiculo.GET(pwMatricula) THEN
        ERROR(ERROR_INCONSISTENCIA);

      IF wFiltroFecha[pwPeriodo] <> '' THEN
        lrVehiculo.SETFILTER("Filtro Fecha",wFiltroFecha[pwPeriodo]);


      IF pwCodTipoServicio <> '' THEN
        lrVehiculo.SETRANGE("Filtro Servicio",pwCodTipoServicio);

      IF vGarajeResult<>'' THEN
        lrVehiculo.SETRANGE("Filtro Garaje Resultados",vGarajeResult);

      IF vTipoLinea<>'' THEN
        lrVehiculo.SETFILTER("Filtro Tipo Linea",vTipoLinea);

      IF vTipoElemento<>'' THEN
        lrVehiculo.SETFILTER("Filtro Tipo elemento",vTipoElemento);

      lrVehiculo.CALCFIELDS("N§ Viajes");

      IF vDivisa = '' THEN

        lwVentas := ROUND(lrVehiculo.TotalCantidadFacturada,vPrecision)
      ELSE
        lwVentas := cFunBas.CambiarDLaDE(lrVehiculo.TotalCantidadFacturada,vDivisa,TODAY);

      lwViajes   := lrVehiculo."N§ Viajes";

      //Calculamos los acumulados anuales.
      IF wFiltroFecha[pwPeriodo] <> '' THEN BEGIN
        lrVehiculo.SETRANGE("Filtro Fecha", wIniAcum[pwPeriodo] , lrVehiculo.GETRANGEMAX("Filtro Fecha"));
        lrVehiculo.CALCFIELDS("N§ Viajes");


      IF vDivisa = '' THEN
        lwVentasAcum := ROUND(lrVehiculo.TotalCantidadFacturada,vPrecision)
      ELSE
        lwVentasAcum := cFunBas.CambiarDLaDE(lrVehiculo.TotalCantidadFacturada,vDivisa,TODAY);

        lwViajesAcum   := lrVehiculo."N§ Viajes";
      END;

      // Asigna las cantidades de periodo y acumulados
      IF wFiltroFecha[pwPeriodo] <> '' THEN BEGIN
        wVentas [pwPeriodo,1]  := lwVentas;
        wVentas [pwPeriodo,2]  := lwVentasAcum;
        wViajes  [pwPeriodo,1] := lwViajes;
        wViajes  [pwPeriodo,2] := lwViajesAcum;
      END;

      // Ahora graba en el temporal los resultado

      WITH rTemp DO BEGIN
        RESET;
        SETCURRENTKEY(Code3,Ent2);
        SETRANGE(Usuario , USERID);
        SETRANGE(Ent2    , pwPeriodo);
        SETRANGE(Code1   , "Tipo Servicio".Codigo);
        SETRANGE(Code2   , SelVehiculo.Garaje);
        SETRANGE(Code3   , SelVehiculo.Agrupacion);
        IF NOT FINDFIRST THEN BEGIN
          wAcum += 1;
          INIT;
          Usuario := USERID;
          Ent1    := wAcum;
          Ent2    := pwPeriodo;
          Code1   := "Tipo Servicio".Codigo;
          Code2   := SelVehiculo.Garaje;
          Code3   := SelVehiculo.Agrupacion;
          INSERT;
        END;
        Dec1 := Dec1 + lwVentas;
        Dec2 := Dec2 + lwVentasAcum;
        Dec3 := Dec3 + lwViajes;
        Dec4 := Dec4 + lwViajesAcum;
        MODIFY;
      END;
    END;

    PROCEDURE CalculaTotal@10(pwCodTipoServicio@1100253000 : Code[10];pwPeriodo@1100253001 : Integer;pwGaraje@1100253002 : Code[10];pwAgrupacion@1100253003 : Code[10]);
    VAR
      lwTotalImporte@1100253004 : ARRAY [2] OF Decimal;
      lwTotalViajes@1100253005 : ARRAY [2] OF Decimal;
    BEGIN
      CLEAR(lwTotalImporte);
      CLEAR(lwTotalViajes);

      WITH rTemp DO BEGIN
        RESET;
        SETCURRENTKEY(Code3,Ent2);

        SETRANGE(Usuario , USERID);
        IF pwCodTipoServicio <> '' THEN
          SETRANGE(Code1, pwCodTipoServicio);
        IF pwGaraje <> ''THEN
          SETRANGE(Code2, pwGaraje);
        IF pwAgrupacion <> '' THEN
          SETRANGE(Code3, pwAgrupacion);

        SETRANGE(Ent2 , pwPeriodo);
        IF FINDFIRST THEN
          CALCSUMS(Dec1,Dec2,Dec3,Dec4)
        ELSE
          INIT;

        wVentas[pwPeriodo,1] := Dec1;
        wVentas[pwPeriodo,2] := Dec2;
        wViajes[pwPeriodo,1]   := Dec3;
        wViajes[pwPeriodo,2]   := Dec4;

      END;
    END;

    PROCEDURE CalcDif@16();
    BEGIN
      // CalcDif
      // Calcula las diferencias entre periodos, as¡ como el % de dicha diferencia

      wDiferencia[1,1] := wVentas[1,1] - wVentas[2,1];
      wDiferencia[2,1] := wVentas[1,2] - wVentas[2,2];

      wDiferencia[1,2] := wViajes[1,1] - wViajes[2,1];
      wDiferencia[2,2] := wViajes[1,2] - wViajes[2,2];


      CLEAR("w%Dif");
      IF wVentas[2,1] <>0 THEN
        "w%Dif"[1,1] :=wDiferencia[1,1] * 100 / wVentas[2,1];
      IF wVentas[2,2] <>0 THEN
        "w%Dif"[2,1] :=wDiferencia[2,1] * 100 / wVentas[2,2];

      IF wViajes[2,1] <>0 THEN
        "w%Dif"[1,2] :=wDiferencia[1,2] * 100 / wViajes[2,1];
      IF wViajes[2,2] <>0 THEN
        "w%Dif"[2,2] :=wDiferencia[2,2] * 100 / wViajes[2,2];
    END;

    PROCEDURE GetAverage@1(pNumerador@1100253000 : Decimal;pDivisor@1100253001 : Decimal) : Decimal;
    VAR
      vResult@1100253002 : Decimal;
    BEGIN
      IF pDivisor = 0 THEN
        EXIT(0);

      vResult := pNumerador / pDivisor;
      EXIT(vResult);
    END;

    PROCEDURE CalcMedias@8(pDivisor@1100253000 : Decimal);
    VAR
      i@1100253001 : Integer;
      j@1100253002 : Integer;
    BEGIN
      //CalcMedias;
      CLEAR(xVentas);
      CLEAR(xViajes);
      CLEAR(xDiferencia);
      FOR i:=1 TO 2 DO BEGIN
        FOR j:=1 TO 2 DO BEGIN
          xVentas[i,j]     := GetAverage(wVentas[i,j],pDivisor);
          xViajes[i,j]     := GetAverage(wViajes[i,j],pDivisor);
        END;
      END;

      xDiferencia[1,1] := xVentas[1,1] - xVentas[2,1];
      xDiferencia[2,1] := xVentas[1,2] - xVentas[2,2];
      xDiferencia[1,2] := xViajes[1,1] - xViajes[2,1];
      xDiferencia[2,2] := xViajes[1,2] - xViajes[2,2];
    END;

    BEGIN
    {
      RRT, <23.08.02> --> Incluir medias.
    }
    END.
  }
  RDLDATA
  {
  }
}
