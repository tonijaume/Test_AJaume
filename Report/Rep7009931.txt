OBJECT Report 7009931 Personas x agrupacion salida
{
  OBJECT-PROPERTIES
  {
    Date=22/06/15;
    Time=18:08:32;
    Modified=Yes;
    Version List=AIC2009;
  }
  PROPERTIES
  {
    CaptionML=[ENU=People x check-out group;
               ESP=Personas x agrupacion salida];
    OnPreReport=BEGIN
                  rInf.FINDFIRST;
                  rPar.FINDFIRST;

                  primera_pagina := TRUE;
                END;

  }
  DATAITEMS
  {
    { PROPERTIES
      {
        DataItemTable=Table2000000026;
        DataItemTableView=SORTING(Number);
        MaxIteration=1;
      }
      SECTIONS
      {
        { PROPERTIES
          {
            SectionType=Footer;
            PrintOnEveryPage=Yes;
            PlaceInBottom=Yes;
            SectionWidth=18150;
            SectionHeight=846;
          }
          CONTROLS
          {
            { 41  ;TextBox      ;6000 ;423  ;7050 ;423  ;HorzAlign=Center;
                                                         SourceExpr=FORMAT(TODAY,0,4) + ' / ' + FORMAT(TIME,0,0) + ' / ' + USERID }
            { 42  ;Shape        ;0    ;0    ;18150;423  ;ShapeStyle=HorzLine }
            { 43  ;TextBox      ;15000;423  ;3150 ;423  ;HorzAlign=Right;
                                                         SourceExpr=Text002 + FORMAT(CurrReport.PAGENO) }
            { 44  ;TextBox      ;0    ;423  ;3600 ;423  ;SourceExpr=cNom.nom_delegacion(rPar.Delegacion) }
          }
           }
      }
       }
    { PROPERTIES
      {
        DataItemIndent=1;
        DataItemTable=Table7009796;
        DataItemTableView=SORTING(Fecha,Zona,N§ Agrupacion)
                          WHERE(Tipo transfer=CONST(Salida));
        PrintOnlyIfDetail=Yes;
        OnAfterGetRecord=VAR
                           rRsv@1103355000 : Record 7009744;
                           rPlan@1103355001 : Record 7009754;
                           rHotAgr@1103355002 : Record 7009798;
                           cCodTra@1103355003 : Codeunit 7009733;
                         BEGIN
                           paxes_agrupacion := 0;
                           adultos_agrupacion := 0;
                           ni¤os_agrupacion := 0;
                           CLEAR(tab_vuelo);
                           CLEAR(tab_hora);
                           CLEAR(tab_destino);

                           // ----  Refrescar la hora de salida de las reservas con la hora del plan de vuelo  ----

                           rRsv.RESET;
                           rRsv.SETCURRENTKEY("Agrupacion salida");
                           rRsv.SETRANGE("Agrupacion salida", "N§ Agrupacion");
                           IF rRsv.FIND('-') THEN BEGIN
                             REPEAT
                               IF rPlan.GET(rRsv."Fecha salida", rRsv."Compa¤ia salida", rRsv."Vuelo salida",
                                            rRsv."IATA origen salida", rRsv."IATA destino salida") THEN BEGIN
                                 rRsv."Hora salida" := rPlan."Hora Salida";
                                 rRsv.MODIFY;
                               END;
                             UNTIL rRsv.NEXT = 0;
                           END;

                           // ----  Comprobamos si existe algun fichero de Hotel x Agrupacion y sino llamar al proceso  ----
                           // ----  de creacion de ficheros auxiliares                                                  ----

                           rHotAgr.RESET;
                           rHotAgr.SETRANGE("N§ Agrupacion", "N§ Agrupacion");
                           IF NOT rHotAgr.FIND('-') THEN
                             cCodTra.Crea_Ficheros_Agr(Agrupacion);
                         END;

        ReqFilterFields=Fecha,N§ Agrupacion,Origen/Destino transfer;
      }
      SECTIONS
      {
        { PROPERTIES
          {
            SectionType=Header;
            PrintOnEveryPage=Yes;
            SectionWidth=18150;
            SectionHeight=846;
          }
          CONTROLS
          {
            { 1   ;Label        ;13950;0    ;4200 ;423  ;HorzAlign=Right;
                                                         FontSize=9;
                                                         FontBold=Yes;
                                                         CaptionML=[ENU=People x group;
                                                                    ESP=Personas x agrupacion] }
            { 2   ;TextBox      ;0    ;0    ;5400 ;423  ;FontSize=9;
                                                         FontBold=Yes;
                                                         SourceExpr=rInf.Name }
            { 3   ;Shape        ;0    ;423  ;18150;423  ;ShapeStyle=HorzLine }
            { 13  ;TextBox      ;7950 ;0    ;3600 ;423  ;HorzAlign=Left;
                                                         FontSize=9;
                                                         SourceExpr=Zonas }
          }
           }
        { PROPERTIES
          {
            SectionType=Body;
            SectionWidth=18150;
            SectionHeight=1269;
            OnPreSection=BEGIN
                           IF NOT primera_pagina THEN
                             CurrReport.NEWPAGE
                           ELSE
                             primera_pagina := FALSE;
                         END;

          }
          CONTROLS
          {
            { 11  ;TextBox      ;2400 ;0    ;2100 ;423  ;HorzAlign=Right;
                                                         FontSize=9;
                                                         SourceExpr="N§ Agrupacion" }
            { 14  ;TextBox      ;8850 ;0    ;1650 ;423  ;HorzAlign=Left;
                                                         FontSize=9;
                                                         SourceExpr="Tipo transfer" }
            { 17  ;TextBox      ;15150;0    ;3000 ;423  ;HorzAlign=Right;
                                                         FontSize=9;
                                                         SourceExpr=Fecha;
                                                         Format=<Weekday Text> <Day>/<Month>/<Year> }
            { 9   ;Label        ;0    ;0    ;2250 ;423  ;FontSize=9;
                                                         FontBold=Yes;
                                                         CaptionML=[ENU=Service;
                                                                    ESP=Servicio] }
            { 10  ;Label        ;13950;0    ;1050 ;423  ;FontSize=9;
                                                         FontBold=Yes;
                                                         CaptionML=[ENU=Date;
                                                                    ESP=Fecha] }
            { 27  ;Label        ;6750 ;0    ;1950 ;423  ;FontSize=9;
                                                         FontBold=Yes;
                                                         CaptionML=[ENU=Transfer from:;
                                                                    ESP=Traslado de] }
            { 1100253000;TextBox;2400 ;846  ;7200 ;423  ;HorzAlign=Left;
                                                         FontSize=9;
                                                         SourceExpr=cNom.nom_transportista(Agrupacion.Transportista) }
            { 1100253001;Label  ;0    ;846  ;2250 ;423  ;FontSize=9;
                                                         FontBold=Yes;
                                                         CaptionML=[ENU=Carrier;
                                                                    ESP=Transportista] }
          }
           }
        { PROPERTIES
          {
            SectionType=Body;
            SectionWidth=18150;
            SectionHeight=846;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT( transfer_privado <> '' );
                         END;

          }
          CONTROLS
          {
            { 1103355000;TextBox;0    ;0    ;18150;846  ;HorzAlign=Center;
                                                         FontSize=16;
                                                         FontBold=Yes;
                                                         SourceExpr=transfer_privado }
            { 1103355001;Shape  ;0    ;0    ;18150;846   }
          }
           }
        { PROPERTIES
          {
            SectionType=Body;
            SectionWidth=18150;
            SectionHeight=846;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT("Lugar presentacion" <> '');
                         END;

          }
          CONTROLS
          {
            { 1100217000;Shape  ;0    ;0    ;18150;846   }
            { 1100217001;TextBox;0    ;0    ;18150;846  ;HorzAlign=Center;
                                                         FontSize=16;
                                                         FontBold=Yes;
                                                         SourceExpr=Agrupacion."Lugar presentacion" }
          }
           }
      }
       }
    { PROPERTIES
      {
        DataItemIndent=2;
        DataItemTable=Table7009798;
        DataItemTableView=SORTING(N§ Agrupacion,Fecha,Orden zona,Orden recogida,Hotel,Compa¤ia,Vuelo,IATA)
                          WHERE(Primer Hotel=CONST(Yes));
        PrintOnlyIfDetail=Yes;
        OnAfterGetRecord=BEGIN
                           CLEAR(rHorAgr);
                           rHorAgr.SETRANGE("N§ Agrupacion", "N§ Agrupacion");
                           rHorAgr.SETRANGE(Hotel          , Hotel);
                           IF rHorAgr.FIND('-') THEN
                             ;
                           paxes_hotel := 0;
                           adultos_hotel := 0;
                           ni¤os_hotel := 0;
                         END;

        DataItemLink=N§ Agrupacion=FIELD(N§ Agrupacion);
      }
      SECTIONS
      {
        { PROPERTIES
          {
            SectionType=Body;
            SectionWidth=18150;
            SectionHeight=846;
          }
          CONTROLS
          {
            { 8   ;Label        ;0    ;423  ;1350 ;423  ;FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=[ENU=Hotel;
                                                                    ESP=Hotel] }
            { 12  ;TextBox      ;1500 ;423  ;6150 ;423  ;FontSize=12;
                                                         FontBold=Yes;
                                                         SourceExpr=cNom.nom_hotel(Hotel) }
            { 15  ;Label        ;8700 ;423  ;2850 ;423  ;FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=[ENU=Picking up time;
                                                                    ESP=Hora de recogida] }
            { 16  ;TextBox      ;11700;423  ;1500 ;423  ;FontSize=8;
                                                         SourceExpr=rHorAgr."Hora recogida" }
          }
           }
        { PROPERTIES
          {
            SectionType=Body;
            SectionWidth=18150;
            SectionHeight=846;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT(NOT w_listadocomprimido);
                         END;

          }
          CONTROLS
          {
            { 18  ;Label        ;300  ;0    ;1500 ;846  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=[ENU=Voucher;
                                                                    ESP=Bono] }
            { 20  ;Label        ;1950 ;0    ;6600 ;846  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=[ENU=Name;
                                                                    ESP=Nombre] }
            { 22  ;Label        ;8700 ;0    ;1650 ;846  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=[ENU=Agency;
                                                                    ESP=Agencia] }
            { 47  ;Label        ;10500;0    ;7650 ;846  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=[ENU=Comments;
                                                                    ESP=Comentarios] }
          }
           }
        { PROPERTIES
          {
            SectionType=Body;
            SectionWidth=18150;
            SectionHeight=423;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT(w_listadocomprimido);
                         END;

          }
          CONTROLS
          {
          }
           }
      }
       }
    { PROPERTIES
      {
        DataItemIndent=3;
        DataItemTable=Table7009744;
        DataItemTableView=SORTING(Agrupacion salida,Hotel salida,Bono,Vuelo salida,Tipo Persona,Nombre)
                          WHERE(Salida=CONST(1));
        OnPreDataItem=BEGIN
                        paxes_reserva        := 0;
                        adultos_reserva      := 0;
                        ni¤os_reserva        := 0;
                        w_primerapersonabono := TRUE;
                        w_bonoant            := '';
                        CLEAR(tab_elemento);
                        CLEAR(tab_cantidad);
                      END;

        OnAfterGetRecord=VAR
                           rRsv@1103355000 : Record 7009744;
                         BEGIN
                           IF w_bonoant = '' THEN
                             w_bonoant := Bono;

                           adultos_reserva := adultos_reserva + ("N§ Personas" - "N§ Ni¤os");
                           ni¤os_reserva := ni¤os_reserva + "N§ Ni¤os";

                           busca_vuelo("Reserva Transfer");
                           suma_elementos("Reserva Transfer");

                           paxes_hotel := paxes_hotel + "N§ Personas";
                           adultos_hotel := adultos_hotel + ("N§ Personas" - "N§ Ni¤os");
                           ni¤os_hotel := ni¤os_hotel + "N§ Ni¤os";

                           paxes_agrupacion := paxes_agrupacion + "N§ Personas";
                           adultos_agrupacion := adultos_agrupacion + ("N§ Personas" - "N§ Ni¤os");
                           ni¤os_agrupacion := ni¤os_agrupacion + "N§ Ni¤os";

                           IF w_bonoant <> Bono THEN BEGIN
                             w_primerapersonabono := TRUE;
                             w_bonoant := Bono;
                           END;

                           IF w_primerapersonabono THEN BEGIN
                             w_responsable := "N§ Reserva";
                             suma_paxes;
                           END;
                         END;

        GroupTotalFields=Vuelo salida;
        DataItemLink=Agrupacion salida=FIELD(N§ Agrupacion),
                     Hotel salida=FIELD(Hotel);
      }
      SECTIONS
      {
        { PROPERTIES
          {
            SectionType=Body;
            SectionWidth=18150;
            SectionHeight=423;
            OnPreSection=BEGIN

                           //IF ("N§ Responsable" = "N§ Reserva") OR (w_primerapersonabono) THEN BEGIN
                           IF w_primerapersonabono THEN BEGIN
                             text_paxes := STRSUBSTNO(Text003, paxes_reserva);
                             text_vuelo := DELCHR("Compa¤ia salida", '<>') + DELCHR("Vuelo salida");
                             texto_elementos;
                             montar_texto_comentarios;
                           END;

                           //CurrReport.SHOWOUTPUT(("N§ Responsable" = "N§ Reserva") OR (w_primerapersonabono));

                           CurrReport.SHOWOUTPUT(w_primerapersonabono);
                         END;

          }
          CONTROLS
          {
            { 59  ;TextBox      ;300  ;0    ;1500 ;423  ;HorzAlign=Left;
                                                         FontSize=8;
                                                         SourceExpr=Bono }
            { 60  ;TextBox      ;1950 ;0    ;5550 ;423  ;FontSize=8;
                                                         SourceExpr=Nombre }
            { 61  ;TextBox      ;8700 ;0    ;1650 ;423  ;FontSize=8;
                                                         SourceExpr="TourOperador facturacion" }
            { 66  ;TextBox      ;10500;0    ;7650 ;423  ;FontSize=8;
                                                         SourceExpr=w_texto_comentarios }
            { 54  ;TextBox      ;7500 ;0    ;1050 ;423  ;FontSize=8;
                                                         SourceExpr=text_paxes }
          }
           }
        { PROPERTIES
          {
            SectionType=GroupFooter;
            SectionWidth=18150;
            SectionHeight=0;
            OnPostSection=BEGIN
                            paxes_reserva := 0;
                            adultos_reserva := 0;
                            ni¤os_reserva := 0;
                            CLEAR(tab_elemento);
                            CLEAR(tab_cantidad);
                          END;

          }
          CONTROLS
          {
          }
           }
      }
       }
    { PROPERTIES
      {
        DataItemIndent=4;
        DataItemTable=Table7009744;
        DataItemTableView=SORTING(Agrupacion salida,Hotel salida,Bono,Vuelo salida,Tipo Persona,Nombre)
                          WHERE(Salida=CONST(1));
        DataItemVarName=Acompa¤antes;
        OnPostDataItem=BEGIN
                         w_primerapersonabono := FALSE;
                       END;

        DataItemLink=Agrupacion salida=FIELD(Agrupacion salida),
                     Hotel salida=FIELD(Hotel salida),
                     Bono=FIELD(Bono);
      }
      SECTIONS
      {
        { PROPERTIES
          {
            SectionType=Body;
            SectionWidth=18150;
            SectionHeight=423;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT(("N§ Reserva" <> w_responsable) AND (NOT w_solo_responsables) AND
                                                 (w_primerapersonabono));
                         END;

          }
          CONTROLS
          {
            { 49  ;TextBox      ;1950 ;0    ;6600 ;423  ;FontSize=8;
                                                         SourceExpr=Nombre }
          }
           }
      }
       }
    { PROPERTIES
      {
        DataItemIndent=3;
        DataItemTable=Table2000000026;
        DataItemTableView=SORTING(Number);
        MaxIteration=1;
        DataItemVarName=Subtotal;
      }
      SECTIONS
      {
        { PROPERTIES
          {
            SectionType=Body;
            SectionWidth=18150;
            SectionHeight=846;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT( (paxes_hotel <>0) AND NOT w_listadocomprimido);
                           text_paxes_hotel := STRSUBSTNO('%1 (%2/%3)', paxes_hotel, adultos_hotel, ni¤os_hotel);
                         END;

          }
          CONTROLS
          {
            { 35  ;Label        ;0    ;423  ;3600 ;423  ;FontSize=8;
                                                         FontBold=Yes;
                                                         LeaderDots=Yes;
                                                         CaptionML=[ENU=Total Hotel;
                                                                    ESP=Total Hotel] }
            { 36  ;TextBox      ;3750 ;423  ;1500 ;423  ;FontSize=8;
                                                         SourceExpr=text_paxes_hotel }
          }
           }
      }
       }
    { PROPERTIES
      {
        DataItemIndent=2;
        DataItemTable=Table2000000026;
        DataItemTableView=SORTING(Number);
        MaxIteration=1;
        DataItemVarName=Total;
      }
      SECTIONS
      {
        { PROPERTIES
          {
            SectionType=Body;
            SectionWidth=18150;
            SectionHeight=423;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT(paxes_agrupacion <>0);
                           text_paxes_agrupacion := STRSUBSTNO('%1 (%2/%3)', paxes_agrupacion, adultos_agrupacion, ni¤os_agrupacion);
                         END;

          }
          CONTROLS
          {
            { 37  ;Label        ;0    ;0    ;3600 ;423  ;FontSize=8;
                                                         FontBold=Yes;
                                                         LeaderDots=Yes;
                                                         CaptionML=[ENU=Grouping Total;
                                                                    ESP=Total Agrupacion] }
            { 38  ;TextBox      ;3750 ;0    ;1500 ;423  ;FontSize=8;
                                                         SourceExpr=text_paxes_agrupacion }
          }
           }
      }
       }
    { PROPERTIES
      {
        DataItemIndent=2;
        DataItemTable=Table2000000026;
        DataItemTableView=SORTING(Number);
        MaxIteration=4;
        DataItemVarName=Vuelos;
        OnPreDataItem=BEGIN
                        indice := 0;
                      END;

        OnAfterGetRecord=BEGIN
                           indice := indice + 1;
                         END;

      }
      SECTIONS
      {
        { PROPERTIES
          {
            SectionType=Header;
            SectionWidth=18150;
            SectionHeight=846;
          }
          CONTROLS
          {
            { 30  ;Label        ;450  ;0    ;1500 ;846  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=[ENU=Flight;
                                                                    ESP=Vuelo] }
            { 32  ;Label        ;2100 ;0    ;1350 ;846  ;HorzAlign=Right;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=[ENU=Time;
                                                                    ESP=Hora] }
            { 33  ;Label        ;3600 ;0    ;1500 ;846  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=[ENU=Destination;
                                                                    ESP=Destino] }
            { 34  ;Label        ;5850 ;0    ;1500 ;846  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=[ENU=Flight;
                                                                    ESP=Vuelo] }
            { 39  ;Label        ;7500 ;0    ;1350 ;846  ;HorzAlign=Right;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=[ENU=Time;
                                                                    ESP=Hora] }
            { 40  ;Label        ;9000 ;0    ;1500 ;846  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=[ENU=Destination;
                                                                    ESP=Destino] }
            { 19  ;Label        ;11250;0    ;1500 ;846  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=[ENU=Flight;
                                                                    ESP=Vuelo] }
            { 21  ;Label        ;12900;0    ;1350 ;846  ;HorzAlign=Right;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=[ENU=Time;
                                                                    ESP=Hora] }
            { 24  ;Label        ;14400;0    ;1500 ;846  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=[ENU=Destination;
                                                                    ESP=Destino] }
          }
           }
        { PROPERTIES
          {
            SectionType=Body;
            SectionWidth=18150;
            SectionHeight=423;
          }
          CONTROLS
          {
            { 45  ;TextBox      ;450  ;0    ;1500 ;423  ;FontSize=8;
                                                         SourceExpr=tab_vuelo[indice] }
            { 4   ;TextBox      ;2100 ;0    ;1350 ;423  ;FontSize=8;
                                                         SourceExpr=tab_hora[indice];
                                                         Format=<Hours24>:<Minutes,2> }
            { 5   ;TextBox      ;3600 ;0    ;1500 ;423  ;FontSize=8;
                                                         SourceExpr=tab_destino[indice] }
            { 6   ;TextBox      ;9000 ;0    ;1500 ;423  ;FontSize=8;
                                                         SourceExpr=tab_destino[indice+4] }
            { 7   ;TextBox      ;5850 ;0    ;1500 ;423  ;FontSize=8;
                                                         SourceExpr=tab_vuelo[indice+4] }
            { 46  ;TextBox      ;7500 ;0    ;1350 ;423  ;FontSize=8;
                                                         SourceExpr=tab_hora[indice+4];
                                                         Format=<Hours24>:<Minutes,2> }
            { 26  ;TextBox      ;11250;0    ;1500 ;423  ;FontSize=8;
                                                         SourceExpr=tab_vuelo[indice+8] }
            { 29  ;TextBox      ;12900;0    ;1350 ;423  ;FontSize=8;
                                                         SourceExpr=tab_hora[indice+8];
                                                         Format=<Hours24>:<Minutes,2> }
            { 31  ;TextBox      ;14400;0    ;1500 ;423  ;FontSize=8;
                                                         SourceExpr=tab_destino[indice+8] }
          }
           }
      }
       }
    { PROPERTIES
      {
        DataItemIndent=2;
        DataItemTable=Table7009813;
        DataItemTableView=SORTING(Agrupacion,N§ Comentario);
        DataItemLink=Agrupacion=FIELD(N§ Agrupacion);
      }
      SECTIONS
      {
        { PROPERTIES
          {
            SectionType=Header;
            SectionWidth=18150;
            SectionHeight=423;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT(w_comentarios);
                         END;

          }
          CONTROLS
          {
            { 48  ;Label        ;450  ;0    ;3900 ;423  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=[ENU=Grouping comments;
                                                                    ESP=Comentarios agrupacion] }
          }
           }
        { PROPERTIES
          {
            SectionType=Body;
            SectionWidth=18150;
            SectionHeight=423;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT(w_comentarios);
                         END;

          }
          CONTROLS
          {
            { 57  ;TextBox      ;900  ;0    ;6900 ;423  ;FontSize=8;
                                                         SourceExpr=Comentario }
          }
           }
      }
       }
    { PROPERTIES
      {
        DataItemIndent=2;
        DataItemTable=Table2000000026;
        DataItemVarName=Observaciones;
      }
      SECTIONS
      {
        { PROPERTIES
          {
            SectionType=Body;
            SectionWidth=18150;
            SectionHeight=1692;
          }
          CONTROLS
          {
            { 1000000000;Label  ;0    ;0    ;3900 ;423  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=[ENU=Notes;
                                                                    ESP=Observaciones] }
            { 1000000001;Label  ;12000;0    ;3900 ;423  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=[ENU=Signature;
                                                                    ESP=Firma] }
            { 1000000002;Label  ;6900 ;0    ;3900 ;423  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=[ENU=Hotel;
                                                                    ESP=Hotel] }
          }
           }
      }
       }
  }
  REQUESTFORM
  {
    PROPERTIES
    {
      Width=4290;
      Height=2200;
      CaptionML=[ENU=People x check-out group;
                 ESP=Personas x agrupacion salida];
      OnOpenForm=BEGIN
                   w_comentarios := TRUE;
                   w_solo_responsables := TRUE;
                   w_listadocomprimido := TRUE;
                 END;

    }
    CONTROLS
    {
      { 2   ;Label        ;220  ;220  ;3300 ;440  ;CaptionML=[ENU=Print comments;
                                                              ESP=Imprimir comentarios] }
      { 3   ;CheckBox     ;3630 ;220  ;440  ;440  ;ShowCaption=No;
                                                   SourceExpr=w_comentarios }
      { 1   ;Label        ;220  ;770  ;3300 ;440  ;CaptionML=[ENU=Only reponsibles;
                                                              ESP=Solo Responsables] }
      { 4   ;CheckBox     ;3630 ;770  ;440  ;440  ;Name=solo_responsables;
                                                   ShowCaption=No;
                                                   CaptionML=[ENU=solo_responsables;
                                                              ESP=solo_responsables];
                                                   SourceExpr=w_solo_responsables }
      { 5   ;Label        ;220  ;1320 ;3300 ;440  ;CaptionML=[ENU=Compressed list;
                                                              ESP=Listado comprimido] }
      { 6   ;CheckBox     ;3630 ;1320 ;440  ;440  ;ShowCaption=No;
                                                   SourceExpr=w_listadocomprimido }
    }
  }
  REQUESTPAGE
  {
    PROPERTIES
    {
    }
    CONTROLS
    {
    }
  }
  CODE
  {
    VAR
      Text002@1103355036 : TextConst 'ENU=page;ESP=P gina';
      Text003@1103355037 : TextConst 'ENU=x %1;ESP=x %1';
      rInf@1103355000 : Record 79;
      rPar@1103355001 : Record 7009700;
      rHorAgr@1103355002 : Record 7009800;
      rPlan@1103355003 : Record 7009754;
      cNom@1103355004 : Codeunit 7009702;
      paxes_reserva@1103355005 : Integer;
      adultos_reserva@1103355006 : Integer;
      ni¤os_reserva@1103355007 : Integer;
      paxes_hotel@1103355008 : Integer;
      adultos_hotel@1103355009 : Integer;
      ni¤os_hotel@1103355010 : Integer;
      paxes_agrupacion@1103355011 : Integer;
      adultos_agrupacion@1103355012 : Integer;
      w_responsable@1103355013 : Integer;
      ni¤os_agrupacion@1103355014 : Integer;
      tab_cantidad@1103355015 : ARRAY [5] OF Integer;
      ind_elem@1103355016 : Integer;
      indice@1103355017 : Integer;
      text_vuelo@1103355018 : Text[30];
      text_paxes@1103355019 : Text[30];
      text_paxes_hotel@1103355020 : Text[30];
      text_paxes_agrupacion@1103355021 : Text[30];
      text_elementos@1103355022 : Text[250];
      tab_vuelo@1103355023 : ARRAY [12] OF Text[30];
      tab_destino@1103355024 : ARRAY [12] OF Text[10];
      tab_elemento@1103355025 : ARRAY [5] OF Text[30];
      w_texto_comentarios@1103355026 : Text[250];
      w_solo_responsables@1103355027 : Boolean;
      w_primerapersonabono@1103355028 : Boolean;
      primera_pagina@1103355029 : Boolean;
      w_comentarios@1103355030 : Boolean;
      w_listadocomprimido@1103355031 : Boolean;
      w_bonoant@1103355032 : Code[10];
      tab_hora@1103355033 : ARRAY [12] OF Time;
      Text004@1103355038 : TextConst 'ENU=Private transfer;ESP=Transfer Privado';

    PROCEDURE busca_vuelo@2(par_rsv@1103355000 : Record 7009744);
    VAR
      aux_vuelo@1103355001 : Text[30];
    BEGIN
      // busca_vuelo

      aux_vuelo := DELCHR(par_rsv."Compa¤ia salida", '<>') +
                   DELCHR(par_rsv."Vuelo salida");
      indice := 0;
      REPEAT
        indice := indice + 1;
        IF tab_vuelo[indice] = '' THEN
          tab_vuelo[indice] := aux_vuelo;
      UNTIL tab_vuelo[indice] = aux_vuelo;

      CLEAR(rPlan);
      rPlan.SETRANGE(Fecha   , par_rsv."Fecha salida");
      rPlan.SETRANGE(Compa¤ia, par_rsv."Compa¤ia salida");
      rPlan.SETRANGE(Vuelo   , par_rsv."Vuelo salida");
      rPlan.SETRANGE(Origen  , par_rsv."IATA origen salida");
      rPlan.SETRANGE(Destino , par_rsv."IATA destino salida");
      IF rPlan.FINDFIRST THEN
        tab_hora[indice] := rPlan."Hora Salida"
      ELSE
        tab_hora[indice] := par_rsv."Hora salida";
      tab_destino[indice] := par_rsv."IATA destino salida";
    END;

    PROCEDURE suma_elementos@3(par_rsv@1103355000 : Record 7009744);
    VAR
      lrElem@1103355001 : Record 7009792;
      lrTipo@1103355002 : Record 7009715;
    BEGIN
      // texto_elementos

      CLEAR(lrElem);
      lrElem.SETRANGE(Delegacion  , par_rsv.Delegacion);
      lrElem.SETRANGE("N§ Reserva", par_rsv."N§ Reserva");
      lrElem.SETRANGE(Humano      , FALSE);
      IF lrElem.FINDSET THEN
      BEGIN
        REPEAT
          lrTipo.RESET;
          IF lrTipo.GET(lrElem."Tipo elemento") AND (lrTipo.Imprimir) THEN
          BEGIN
            ind_elem := 0;
            REPEAT
              ind_elem := ind_elem + 1;
              IF tab_elemento[ind_elem] = '' THEN
                tab_elemento[ind_elem] := lrElem."Tipo elemento";
            UNTIL tab_elemento[ind_elem] = lrElem."Tipo elemento";
            tab_cantidad[ind_elem] := tab_cantidad[ind_elem] + lrElem."Numero elementos";
          END;
        UNTIL lrElem.NEXT = 0;
      END;
    END;

    PROCEDURE texto_elementos@1();
    BEGIN
      // texto_elementos

      text_elementos := '';
      ind_elem := 1;
      WHILE tab_elemento[ind_elem] <> '' DO
      BEGIN
        IF text_elementos = '' THEN
          text_elementos := STRSUBSTNO('#1', tab_cantidad[ind_elem]) + ' ' + tab_elemento[ind_elem]
        ELSE
          text_elementos := text_elementos + ', ' + STRSUBSTNO('#1', tab_cantidad[ind_elem]) + ' ' +
                            tab_elemento[ind_elem];
        ind_elem := ind_elem + 1;
      END;
    END;

    PROCEDURE montar_texto_comentarios@5();
    VAR
      rCom@1103355000 : Record 7009762;
      aux_texto@1103355001 : Text[80];
      w_num1@1103355002 : Integer;
      w_num2@1103355003 : Integer;
    BEGIN
      // montar_texto_comentarios

      w_texto_comentarios := '';

      rCom.RESET;
      rCom.SETRANGE(Delegacion     , "Reserva Transfer".Delegacion);
      rCom.SETRANGE("N§ Interno"   , "Reserva Transfer"."N§ Interno");
      rCom.SETFILTER("Tipo Reserva", '%1|%2', rCom."Tipo Reserva"::Cabecera, rCom."Tipo Reserva"::Transfer);
      IF rCom.FINDSET THEN
      BEGIN
        REPEAT
          IF w_texto_comentarios = '' THEN
            w_texto_comentarios := DELCHR(rCom.Texto, '<>')
          ELSE
          BEGIN
            IF (STRLEN(w_texto_comentarios) + STRLEN(DELCHR(rCom.Texto, '<>'))) < 247 THEN
              w_texto_comentarios := w_texto_comentarios + ' - ' + DELCHR(rCom.Texto, '<>');
          END;
        UNTIL rCom.NEXT = 0;
      END;
    END;

    PROCEDURE suma_paxes@4();
    VAR
      rRsv@1103355000 : Record 7009744;
    BEGIN
      // suma_paxes

      rRsv.RESET;
      rRsv.SETCURRENTKEY(Delegacion,
                         "Agrupacion entrada",
                         "Agrupacion salida",
                         Bono);
      rRsv.SETRANGE(Delegacion         , "Reserva Transfer".Delegacion);
      rRsv.SETRANGE("Agrupacion salida", "Reserva Transfer"."Agrupacion salida");
      rRsv.SETRANGE("Hotel salida"     , "Reserva Transfer"."Hotel salida");
      rRsv.SETRANGE(Bono               , "Reserva Transfer".Bono);
      rRsv.SETRANGE(Salida             , 1); // +$007
      paxes_reserva := 0;
      IF rRsv.FINDSET THEN
      BEGIN
        REPEAT
          paxes_reserva += rRsv."N§ Personas";
        UNTIL rRsv.NEXT = 0;
      END;
    END;

    PROCEDURE transfer_privado@1103355000() : Text[250];
    VAR
      lrRsv@1103355000 : Record 7009744;
    BEGIN
      // transfer_privado

      //+$004 <
      IF Agrupacion."Transfer Privado" THEN
        EXIT(Text004);
      //+$004 >

      //-$004lrRsv.RESET;
      //-$004lrRsv.SETCURRENTKEY("Agrupacion salida");
      //-$004lrRsv.SETRANGE("Agrupacion salida", Agrupacion."N§ Agrupacion");
      //-$004IF lrRsv.FINDFIRST THEN BEGIN
      //-$004  IF lrRsv."Transfer Privado Salida" THEN
      //-$004    EXIT(Text004);
      //-$004END;
    END;

    BEGIN
    {
      ## AJS 29.10.2008

        .- Incluir un nuevo Body de Agrupacion para mostrar la etiqueta de Transfer privado

      $001 AJS 09102012 Nuevo Body de Agrupacion para mostrar el campo "Punto inicio/final servicio"

      $002 AJS 14042014 La tabla Elementos transportar transfer se utiliza solo para los suplementos

      $003 AJS 29052014 Modifico la funcion transfer_privado para tener en cuenta el nuevo campo en Reserva Transfer

      $004 AJS 29052014 Modifico la funcion transfer_privado para que trabaje con la marca de la agrupacion

      $005 AJS 11032015 Agrego una seccion para observaciones y firma en el pie de pagina

      $006 AJS 14032015 Agrego una etiqueta para poner el hotel

      $007 ARM 22062015 CNT-CAR-14122 Se ¤ade el filtro por el campo Salida
    }
    END.
  }
  RDLDATA
  {
  }
}
