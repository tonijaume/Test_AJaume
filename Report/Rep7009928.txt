OBJECT Report 7009928 Factura transfers detallada
{
  OBJECT-PROPERTIES
  {
    Date=13/03/15;
    Time=[ 9:37:30];
    Modified=Yes;
    Version List=AIC2009,GOC,COM;
  }
  PROPERTIES
  {
    CaptionML=[ENU=Detailed transfers invoice;
               ESP=Factura transfers detallada];
    OnPreReport=BEGIN
                  rPar.FIND('-');
                  ConfConta.FIND('-');
                  InfoEmpresa.FIND('-');
                END;

    PaperSize=Letter 8 1/2 x 11 in;
    HorzGrid=210;
  }
  DATAITEMS
  {
    { PROPERTIES
      {
        DataItemTable=Table7009908;
        DataItemTableView=WHERE(Modulo=CONST(Transfer));
        NewPagePerRecord=Yes;
        DataItemVarName=CabFra;
        OnAfterGetRecord=BEGIN
                           IF NOT Clie.GET(Cliente) THEN
                             CLEAR(Clie);

                           CurrReport.LANGUAGE := Language.GetLanguageID(Clie."Language Code");

                           IF "CIF/NIF" = '' THEN
                             TextoCIF := ''
                           ELSE
                             TextoCIF := FIELDCAPTION("CIF/NIF");

                           IF "C¢d. divisa" = '' THEN BEGIN
                             TotalTexto := Text000;
                             TextoTotIVAIncl := Text001;
                           END ELSE BEGIN
                             TotalTexto := STRSUBSTNO(Text002,"C¢d. divisa");
                             TextoTotIVAIncl := STRSUBSTNO(Text003,"C¢d. divisa");
                           END;

                           CIF_Cliente := Clie."VAT Registration No.";

                           FormatDire.Company(DirEmpresa,InfoEmpresa);

                           InfoEmpresa.CALCFIELDS(Picture);

                           wDesglose:=TRUE;
                           InsertaiVA;

                           // AJS 23.02.2005
                           // Obtener el contrato para mostrar el texto indicado bajo las lineas de precios x vehiculo

                           rContVenta.SETRANGE (Cliente                , CabFra.Cliente);
                           rContVenta.SETRANGE (TourOperador           , CabFra.Touroperador);
                           rContVenta.SETFILTER("Fecha inicio contrato", '<=%1', CabFra."Fecha servicio");
                           rContVenta.SETFILTER("Fecha final contrato" , '>=%1', CabFra."Fecha servicio");
                           rContVenta.SETRANGE (Comercializadora       , FALSE); //+$007
                           rContVenta.SETRANGE (Confirmado             , TRUE);
                           IF NOT rContVenta.FINDFIRST THEN
                             CLEAR(rContVenta);

                           // AJS 23.02.2007
                           // Mostrar la descripcion del grupo de NCF de la factura

                           IF NOT rCodNCF.GET(rCodNCF."Tipo grupo"::Ventas, DevuelveGrupoNCF) THEN
                             CLEAR(rCodNCF);

                           // $002
                           CLEAR(wDescrpNCF);
                           CASE CabFra."Tipo documento" OF
                             CabFra."Tipo documento"::Factura : wDescrpNCF := rCodNCF."Descripcion Factura";
                             CabFra."Tipo documento"::Abono   : wDescrpNCF := rCodNCF."Descripcion Abonos";
                           END;
                         END;

        ReqFilterFields=Tipo documento,No.,Fecha Registro,Touroperador;
      }
      SECTIONS
      {
      }
       }
    { PROPERTIES
      {
        DataItemIndent=1;
        DataItemTable=Table2000000026;
        DataItemTableView=SORTING(Number);
        NewPagePerRecord=Yes;
        DataItemVarName=BucleCopia;
        OnPreDataItem=BEGIN
                        NoBucles := ABS(NoCopias) + Clie."Invoice Copies" + 1;
                        IF NoBucles <= 0 THEN
                          NoBucles := 1;

                        TextoCopia := '';

                        SETRANGE(Number, 1, NoBucles);
                      END;

        OnAfterGetRecord=BEGIN
                           IF Number > 1 THEN
                             TextoCopia := Text004;

                           CurrReport.PAGENO := 1;
                         END;

      }
      SECTIONS
      {
      }
       }
    { PROPERTIES
      {
        DataItemIndent=2;
        DataItemTable=Table2000000026;
        DataItemTableView=SORTING(Number)
                          WHERE(Number=CONST(1));
        DataItemVarName=BuclePag;
      }
      SECTIONS
      {
        { PROPERTIES
          {
            SectionType=Header;
            PrintOnEveryPage=Yes;
            SectionWidth=18690;
            SectionHeight=8460;
            OnPreSection=BEGIN
                           rPar := rPar;
                         END;

          }
          CONTROLS
          {
            { 25  ;Shape        ;0    ;8037 ;18690;423  ;ShapeStyle=HorzLine }
            { 15  ;TextBox      ;0    ;7614 ;18690;423  ;HorzAlign=Center;
                                                         FontSize=9;
                                                         SourceExpr=CabFra."Texto de registro" }
            { 20  ;Label        ;10080;5076 ;2310 ;423  ;FontSize=9;
                                                         FontBold=Yes;
                                                         LeaderDots=Yes;
                                                         CaptionML=[ENU=Date;
                                                                    ESP=Fecha] }
            { 54  ;TextBox      ;12600;5076 ;3990 ;423  ;FontSize=9;
                                                         SourceExpr=FORMAT(CabFra."Fecha Registro",0,4) }
            { 46  ;TextBox      ;10080;5499 ;2310 ;423  ;FontSize=9;
                                                         FontBold=Yes;
                                                         LeaderDots=Yes;
                                                         SourceExpr=CabFra."Tipo documento" }
            { 36  ;TextBox      ;12600;5499 ;2520 ;423  ;HorzAlign=Left;
                                                         FontSize=9;
                                                         SourceExpr=CabFra."No." }
            { 62  ;TextBox      ;0    ;5922 ;6300 ;423  ;FontSize=9;
                                                         FontBold=Yes;
                                                         SourceExpr=CIF_Cliente }
            { 74  ;TextBox      ;7140 ;5499 ;1890 ;423  ;FontSize=9;
                                                         FontBold=Yes;
                                                         SourceExpr=CabFra."Cod. pa¡s" }
            { 75  ;TextBox      ;2310 ;5499 ;4700 ;423  ;FontSize=9;
                                                         FontBold=Yes;
                                                         SourceExpr=CabFra.Provincia }
            { 4   ;TextBox      ;2310 ;6768 ;3990 ;423  ;FontSize=9;
                                                         SourceExpr=CabFra.Cliente }
            { 6   ;Label        ;0    ;6768 ;2100 ;423  ;ParentControl=4;
                                                         VertAlign=Bottom;
                                                         FontSize=9;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         LeaderDots=Yes;
                                                         CaptionML=[ENU=Client;
                                                                    ESP=Cliente] }
            { 77  ;TextBox      ;0    ;5499 ;2100 ;423  ;FontSize=9;
                                                         FontBold=Yes;
                                                         SourceExpr=CabFra."C.P." }
            { 72  ;TextBox      ;0    ;5076 ;9000 ;423  ;FontSize=9;
                                                         FontBold=Yes;
                                                         SourceExpr=CabFra.Poblacion }
            { 73  ;TextBox      ;0    ;4653 ;9000 ;423  ;FontSize=9;
                                                         FontBold=Yes;
                                                         SourceExpr=CabFra.Direccion }
            { 65  ;TextBox      ;0    ;3807 ;9000 ;423  ;FontSize=9;
                                                         FontBold=Yes;
                                                         SourceExpr=CabFra."Nombre Cliente" }
            { 2   ;TextBox      ;17010;4230 ;1680 ;423  ;FontSize=9;
                                                         SourceExpr=STRSUBSTNO(Text005,FORMAT(CurrReport.PAGENO)) }
            { 1   ;TextBox      ;12810;3807 ;5880 ;423  ;FontSize=10;
                                                         FontBold=Yes;
                                                         SourceExpr=STRSUBSTNO('%1', TextoCopia) }
            { 5   ;Shape        ;0    ;3384 ;18690;423  ;ShapeStyle=HorzLine }
            { 7   ;TextBox      ;16590;2961 ;2100 ;423  ;FontSize=9;
                                                         CaptionML=[ENU=VAT Registration No.;
                                                                    ESP=CIF/NIF];
                                                         SourceExpr=InfoEmpresa."VAT Registration No." }
            { 9   ;Label        ;15750;2961 ;840  ;423  ;ParentControl=7;
                                                         FontSize=9;
                                                         CaptionML=[ENU=RNC;
                                                                    ESP=RNC.] }
            { 11  ;TextBox      ;13230;2961 ;2310 ;423  ;FontSize=9;
                                                         CaptionML=[ENU=No. Fax;
                                                                    ESP=N§ fax];
                                                         SourceExpr=InfoEmpresa."Fax No." }
            { 32  ;Label        ;12390;2961 ;840  ;423  ;ParentControl=11;
                                                         FontSize=9;
                                                         CaptionML=[ENU=Fax.;
                                                                    ESP=Fax.] }
            { 34  ;TextBox      ;9870 ;2961 ;2310 ;423  ;FontSize=9;
                                                         CaptionML=[ENU=Phone No.;
                                                                    ESP=N§ tel‚fono];
                                                         SourceExpr=InfoEmpresa."Phone No." }
            { 37  ;Label        ;9240 ;2961 ;630  ;423  ;ParentControl=34;
                                                         FontSize=9;
                                                         CaptionML=[ENU=Phone;
                                                                    ESP=Tel.] }
            { 38  ;TextBox      ;0    ;2961 ;9030 ;423  ;FontSize=9;
                                                         SourceExpr=DirEmpresa[2]+' '+DirEmpresa[3]+' '+DirEmpresa[4] }
            { 49  ;PictureBox   ;0    ;0    ;8820 ;2538 ;SourceExpr=InfoEmpresa.Picture }
            { 27  ;TextBox      ;0    ;4230 ;9000 ;423  ;FontSize=9;
                                                         FontBold=Yes;
                                                         SourceExpr=Clie."Name 2" }
            { 1103355000;Label  ;10080;5922 ;2310 ;423  ;FontSize=9;
                                                         FontBold=Yes;
                                                         LeaderDots=Yes;
                                                         CaptionML=[ENU=NCF;
                                                                    ESP=NCF] }
            { 1103355001;TextBox;12600;5922 ;5670 ;423  ;HorzAlign=Left;
                                                         FontSize=9;
                                                         SourceExpr=CabFra."Comprobante fiscal" }
            { 1103355002;TextBox;10080;6768 ;8610 ;423  ;HorzAlign=Left;
                                                         FontSize=9;
                                                         SourceExpr=wDescrpNCF }
          }
           }
      }
       }
    { PROPERTIES
      {
        DataItemIndent=3;
        DataItemTable=Table7009909;
        DataItemTableView=SORTING(Tipo Linea,Fecha,Hotel,Bono,Tipo Pax);
        DataItemVarName=Lin Bono;
        OnPreDataItem=BEGIN
                        CurrReport.CREATETOTALS(wImporte);
                      END;

        OnAfterGetRecord=BEGIN
                           IF (wBono[2] <> Bono) OR (wAgrupacion <> Agrupacion) THEN BEGIN
                             wBono[1]         := Bono;
                             wFechaEntrada[2] := 0D;
                           END
                           ELSE
                             wBono[1] := '';
                           wBono[2] := Bono;
                           wAgrupacion := Agrupacion;

                           IF "Lin Bono"."Tipo Linea"= "Lin Bono"."Tipo Linea"::Abono THEN
                             wBono[1] := Text006;

                           IF (wFechaEntrada[2] <> Fecha) OR (wBono[1] = Text006) THEN
                             wFechaEntrada[1] := Fecha
                           ELSE
                             wFechaEntrada[1] :=0D;

                           wFechaEntrada[2] := Fecha;

                           //wImporte := ImporteConIVA;

                           wImporte += "Importe sin IVA";
                         END;

        DataItemLinkReference=CabFra;
        DataItemLink=Tipo documento=FIELD(Tipo documento),
                     N§ documento=FIELD(No.);
      }
      SECTIONS
      {
        { PROPERTIES
          {
            SectionType=Header;
            SectionWidth=18690;
            SectionHeight=1269;
          }
          CONTROLS
          {
            { 21  ;Label        ;0    ;0    ;2100 ;846  ;ParentControl=3;
                                                         HorzAlign=Left;
                                                         VertAlign=Bottom;
                                                         FontSize=9;
                                                         FontBold=Yes;
                                                         MultiLine=Yes }
            { 23  ;Label        ;4620 ;0    ;1470 ;846  ;ParentControl=22;
                                                         HorzAlign=Right;
                                                         VertAlign=Bottom;
                                                         FontSize=9;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=[ENU=Service date;
                                                                    ESP=Fecha servicio] }
            { 28  ;Label        ;6300 ;0    ;1680 ;846  ;ParentControl=24;
                                                         VertAlign=Bottom;
                                                         FontSize=9;
                                                         FontBold=Yes;
                                                         MultiLine=Yes }
            { 39  ;Label        ;8190 ;0    ;2100 ;846  ;ParentControl=29;
                                                         VertAlign=Bottom;
                                                         FontSize=9;
                                                         FontBold=Yes;
                                                         MultiLine=Yes }
            { 42  ;Label        ;12390;0    ;1470 ;846  ;ParentControl=41;
                                                         HorzAlign=Right;
                                                         VertAlign=Bottom;
                                                         FontSize=9;
                                                         FontBold=Yes;
                                                         MultiLine=Yes }
            { 58  ;Label        ;14070;0    ;1680 ;846  ;ParentControl=45;
                                                         HorzAlign=Right;
                                                         VertAlign=Bottom;
                                                         FontSize=9;
                                                         FontBold=Yes;
                                                         MultiLine=Yes }
            { 63  ;Label        ;15960;0    ;2730 ;846  ;ParentControl=61;
                                                         HorzAlign=Right;
                                                         VertAlign=Bottom;
                                                         FontSize=9;
                                                         FontBold=Yes;
                                                         MultiLine=Yes }
            { 40  ;Shape        ;0    ;846  ;18690;423  ;ShapeStyle=HorzLine }
            { 12  ;Label        ;10500;0    ;1680 ;846  ;VertAlign=Bottom;
                                                         FontSize=9;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=[ENU=Vehicle type;
                                                                    ESP=Tipo vehiculo] }
            { 1100217002;Label  ;2310 ;0    ;2100 ;846  ;ParentControl=1100217000;
                                                         VertAlign=Bottom;
                                                         FontSize=9;
                                                         FontBold=Yes;
                                                         MultiLine=Yes }
          }
           }
        { PROPERTIES
          {
            SectionType=TransHeader;
            SectionWidth=18690;
            SectionHeight=1269;
          }
          CONTROLS
          {
            { 43  ;Label        ;0    ;0    ;2100 ;846  ;HorzAlign=Left;
                                                         VertAlign=Bottom;
                                                         FontSize=9;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=[ENU=Booking;
                                                                    ESP=Booking] }
            { 44  ;Label        ;4620 ;0    ;1470 ;846  ;HorzAlign=Right;
                                                         VertAlign=Bottom;
                                                         FontSize=9;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=[ENU=Service date;
                                                                    ESP=Fecha servicio] }
            { 47  ;Label        ;6300 ;0    ;1680 ;846  ;VertAlign=Bottom;
                                                         FontSize=9;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=[ENU=Pax type;
                                                                    ESP=Tipo Pax] }
            { 48  ;Label        ;8190 ;0    ;2100 ;846  ;VertAlign=Bottom;
                                                         FontSize=9;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=[ENU=Hotel;
                                                                    ESP=Hotel] }
            { 55  ;Label        ;12390;0    ;1470 ;846  ;HorzAlign=Right;
                                                         VertAlign=Bottom;
                                                         FontSize=9;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=[ENU=Amount;
                                                                    ESP=Cantidad] }
            { 56  ;Label        ;14070;0    ;1680 ;846  ;HorzAlign=Right;
                                                         VertAlign=Bottom;
                                                         FontSize=9;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=[ENU=Price;
                                                                    ESP=Precio] }
            { 57  ;Label        ;15960;0    ;2730 ;846  ;HorzAlign=Right;
                                                         VertAlign=Bottom;
                                                         FontSize=9;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=[ENU=Amount;
                                                                    ESP=Importe] }
            { 64  ;Shape        ;0    ;846  ;18690;423  ;ShapeStyle=HorzLine }
            { 16  ;Label        ;10500;0    ;1680 ;846  ;VertAlign=Bottom;
                                                         FontSize=9;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=[ENU=Vehicle type;
                                                                    ESP=Tipo vehiculo] }
            { 1100217001;Label  ;2310 ;0    ;2100 ;846  ;ParentControl=1100217000;
                                                         VertAlign=Bottom;
                                                         FontSize=9;
                                                         FontBold=Yes;
                                                         MultiLine=Yes }
          }
           }
        { PROPERTIES
          {
            SectionType=Body;
            SectionWidth=18690;
            SectionHeight=423;
          }
          CONTROLS
          {
            { 3   ;TextBox      ;0    ;0    ;2100 ;423  ;HorzAlign=Left;
                                                         CaptionML=[ENU=Booking;
                                                                    ESP=Booking];
                                                         SourceExpr=wBono[1] }
            { 22  ;TextBox      ;4620 ;0    ;1470 ;423  ;CaptionML=[ENU=Arrival Date;
                                                                    ESP=Fecha entrada];
                                                         SourceExpr=wFechaEntrada[1] }
            { 24  ;TextBox      ;6300 ;0    ;1680 ;423  ;SourceExpr="Tipo Pax" }
            { 29  ;TextBox      ;8190 ;0    ;2100 ;423  ;CaptionML=[ENU=Hotel;
                                                                    ESP=Hotel];
                                                         SourceExpr=Hotel }
            { 41  ;TextBox      ;12390;0    ;1470 ;423  ;BlankNumbers=BlankZero;
                                                         SourceExpr=Cantidad }
            { 45  ;TextBox      ;14070;0    ;1680 ;423  ;HorzAlign=General;
                                                         CaptionML=[ENU=Price;
                                                                    ESP=Precio];
                                                         BlankNumbers=BlankZero;
                                                         SourceExpr=PrecioSinIVA;
                                                         AutoFormatType=1;
                                                         AutoFormatExpr=CabFra."C¢d. divisa" }
            { 61  ;TextBox      ;15960;0    ;2730 ;423  ;CaptionML=[ENU=Amount;
                                                                    ESP=Importe];
                                                         BlankNumbers=BlankZero;
                                                         SourceExpr=wImporte;
                                                         AutoFormatType=1;
                                                         AutoFormatExpr=CabFra."C¢d. divisa" }
            { 18  ;TextBox      ;10500;0    ;1680 ;423  ;SourceExpr="Tipo vehiculo" }
            { 1100217000;TextBox;2310 ;0    ;2100 ;423  ;SourceExpr=Vuelo }
          }
           }
        { PROPERTIES
          {
            SectionType=Body;
            SectionWidth=18690;
            SectionHeight=423;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT("Precio x vehiculo");
                         END;

          }
          CONTROLS
          {
            { 19  ;TextBox      ;0    ;0    ;5880 ;423  ;CaptionML=[ENU=Hotel;
                                                                    ESP=Hotel];
                                                         SourceExpr=rContVenta."Texto factura precio vehiculo" }
          }
           }
        { PROPERTIES
          {
            SectionType=TransFooter;
            SectionWidth=18690;
            SectionHeight=423;
          }
          CONTROLS
          {
            { 14  ;Label        ;9240 ;0    ;4410 ;423  ;FontSize=9;
                                                         FontBold=Yes;
                                                         LeaderDots=Yes;
                                                         CaptionML=[ENU=Sum and continue;
                                                                    ESP=Suma y sigue] }
            { 17  ;TextBox      ;13860;0    ;2940 ;423  ;FontSize=9;
                                                         FontBold=Yes;
                                                         CaptionML=[ENU=Amount;
                                                                    ESP=Importe];
                                                         SourceExpr=wImporte;
                                                         AutoFormatType=1;
                                                         AutoFormatExpr=CabFra."C¢d. divisa" }
          }
           }
        { PROPERTIES
          {
            SectionType=Footer;
            SectionWidth=18690;
            SectionHeight=423;
          }
          CONTROLS
          {
            { 8   ;TextBox      ;13860;0    ;2940 ;423  ;FontSize=9;
                                                         FontBold=Yes;
                                                         CaptionML=[ENU=Amount;
                                                                    ESP=Importe];
                                                         SourceExpr=wImporte;
                                                         AutoFormatType=1;
                                                         AutoFormatExpr=CabFra."C¢d. divisa" }
            { 13  ;TextBox      ;17010;0    ;1680 ;423  ;HorzAlign=Center;
                                                         FontSize=9;
                                                         FontBold=Yes;
                                                         SourceExpr=CabFra."C¢d. divisa" }
          }
           }
      }
       }
    { PROPERTIES
      {
        DataItemIndent=3;
        DataItemTable=Table2000000026;
        DataItemTableView=SORTING(Number);
        DataItemVarName=ContadorIVA;
        OnPreDataItem=BEGIN
                        IF LinImporIVA.COUNT < 1 THEN
                          CurrReport.BREAK;
                        SETRANGE(Number, 1, LinImporIVA.COUNT);
                        CurrReport.CREATETOTALS(LinImporIVA."VAT+EC Base",LinImporIVA."VAT Amount",LinImporIVA."EC Amount");
                      END;

        OnAfterGetRecord=BEGIN
                           LinImporIVA.GetLine(Number);
                         END;

      }
      SECTIONS
      {
        { PROPERTIES
          {
            SectionType=Header;
            SectionWidth=18690;
            SectionHeight=846;
          }
          CONTROLS
          {
            { 68  ;TextBox      ;7350 ;0    ;2520 ;846  ;HorzAlign=Right;
                                                         VertAlign=Bottom;
                                                         FontSize=9;
                                                         FontBold=Yes;
                                                         SourceExpr=Text007 + ' ' + rPar."Texto impuesto en Factura" }
            { 69  ;TextBox      ;4620 ;0    ;2520 ;846  ;HorzAlign=Right;
                                                         VertAlign=Bottom;
                                                         FontSize=9;
                                                         FontBold=Yes;
                                                         SourceExpr=Text008 + ' ' + rPar."Texto impuesto en Factura" }
            { 70  ;TextBox      ;2310 ;0    ;2100 ;846  ;HorzAlign=Right;
                                                         VertAlign=Bottom;
                                                         FontSize=9;
                                                         FontBold=Yes;
                                                         SourceExpr='% ' + rPar."Texto impuesto en Factura" }
          }
           }
        { PROPERTIES
          {
            SectionType=TransHeader;
            SectionWidth=18690;
            SectionHeight=846;
          }
          CONTROLS
          {
            { 103 ;Label        ;0    ;0    ;4410 ;423  ;ParentControl=104;
                                                         FontSize=9;
                                                         LeaderDots=Yes }
            { 104 ;TextBox      ;4620 ;0    ;2520 ;423  ;FontSize=9;
                                                         CaptionML=[ENU=Sum;
                                                                    ESP=Suma];
                                                         SourceExpr=LinImporIVA."VAT+EC Base" }
            { 105 ;TextBox      ;7350 ;0    ;2520 ;423  ;FontSize=9;
                                                         SourceExpr=LinImporIVA."VAT Amount" }
          }
           }
        { PROPERTIES
          {
            SectionType=Body;
            SectionWidth=18690;
            SectionHeight=423;
          }
          CONTROLS
          {
            { 107 ;TextBox      ;2310 ;0    ;2100 ;423  ;FontSize=9;
                                                         CaptionML=[ENU=% VAT;
                                                                    ESP=% IVA];
                                                         SourceExpr=LinImporIVA."VAT %" }
            { 108 ;TextBox      ;4620 ;0    ;2520 ;423  ;FontSize=9;
                                                         CaptionML=[ENU=Base VAT+ER;
                                                                    ESP=Base IVA+RE];
                                                         SourceExpr=LinImporIVA."VAT+EC Base" }
            { 109 ;TextBox      ;7350 ;0    ;2520 ;423  ;FontSize=9;
                                                         CaptionML=[ENU=VAT Amount;
                                                                    ESP=Importe IVA];
                                                         SourceExpr=LinImporIVA."VAT Amount" }
          }
           }
        { PROPERTIES
          {
            SectionType=TransFooter;
            SectionWidth=18690;
            SectionHeight=846;
          }
          CONTROLS
          {
            { 111 ;Label        ;0    ;423  ;4410 ;423  ;ParentControl=112;
                                                         FontSize=9;
                                                         LeaderDots=Yes }
            { 112 ;TextBox      ;4620 ;423  ;2520 ;423  ;FontSize=9;
                                                         CaptionML=[ENU=Sum;
                                                                    ESP=Suma];
                                                         SourceExpr=LinImporIVA."VAT+EC Base" }
            { 113 ;TextBox      ;7350 ;423  ;2520 ;423  ;FontSize=9;
                                                         SourceExpr=LinImporIVA."VAT Amount" }
          }
           }
        { PROPERTIES
          {
            SectionType=Footer;
            SectionWidth=18690;
            SectionHeight=846;
            OnPreSection=BEGIN
                           wTotal := (LinImporIVA."VAT+EC Base") + (LinImporIVA."VAT Amount");
                           wTotalFacDL:= ImporteDL(CabFra."C¢d. divisa",CabFra."Fecha Registro",wTotal);
                         END;

          }
          CONTROLS
          {
            { 115 ;Label        ;0    ;423  ;4410 ;423  ;ParentControl=116;
                                                         FontSize=9;
                                                         FontBold=Yes;
                                                         LeaderDots=Yes }
            { 116 ;TextBox      ;4620 ;423  ;2520 ;423  ;FontSize=9;
                                                         FontBold=Yes;
                                                         CaptionML=[ENU=Total;
                                                                    ESP=Total];
                                                         SourceExpr=LinImporIVA."VAT+EC Base";
                                                         AutoFormatType=1;
                                                         AutoFormatExpr=CabFra."C¢d. divisa" }
            { 117 ;TextBox      ;7350 ;423  ;2520 ;423  ;FontSize=9;
                                                         FontBold=Yes;
                                                         SourceExpr=LinImporIVA."VAT Amount";
                                                         AutoFormatType=1;
                                                         AutoFormatExpr=CabFra."C¢d. divisa" }
            { 33  ;TextBox      ;17010;423  ;1680 ;423  ;HorzAlign=Center;
                                                         FontSize=9;
                                                         FontBold=Yes;
                                                         SourceExpr=CabFra."C¢d. divisa" }
            { 26  ;TextBox      ;14070;423  ;2730 ;423  ;FontSize=12;
                                                         FontBold=Yes;
                                                         SourceExpr=wTotal;
                                                         AutoFormatType=1;
                                                         AutoFormatExpr=CabFra."C¢d. divisa" }
            { 10  ;Shape        ;13860;0    ;3150 ;846   }
          }
           }
      }
       }
    { PROPERTIES
      {
        DataItemIndent=3;
        DataItemTable=Table2000000026;
        DataItemTableView=SORTING(Number)
                          WHERE(Number=CONST(1));
        DataItemVarName=Total;
      }
      SECTIONS
      {
      }
       }
    { PROPERTIES
      {
        DataItemIndent=3;
        DataItemTable=Table2000000026;
        DataItemTableView=SORTING(Number)
                          WHERE(Number=CONST(1));
        DataItemVarName=Total2;
        OnPreDataItem=BEGIN
                        //IF LinImporIVA.FIND('-') THEN
                          CurrReport.BREAK;
                      END;

      }
      SECTIONS
      {
      }
       }
    { PROPERTIES
      {
        DataItemIndent=3;
        DataItemTable=Table44;
        DataItemTableView=SORTING(Document Type,No.,Document Line No.,Line No.);
        DataItemLinkReference=CabFra;
        DataItemLink=No.=FIELD(No.);
      }
      SECTIONS
      {
        { PROPERTIES
          {
            SectionType=Header;
            SectionWidth=18690;
            SectionHeight=846;
          }
          CONTROLS
          {
            { 35  ;TextBox      ;0    ;423  ;8400 ;423  ;FontSize=9;
                                                         FontBold=Yes;
                                                         FontUnderline=Yes;
                                                         SourceExpr=STRSUBSTNO(Text009, CabFra."Tipo documento", CabFra."No.") }
          }
           }
        { PROPERTIES
          {
            SectionType=Body;
            SectionWidth=18690;
            SectionHeight=423;
          }
          CONTROLS
          {
            { 59  ;TextBox      ;840  ;0    ;15960;423  ;FontSize=9;
                                                         SourceExpr=Comment }
          }
           }
      }
       }
  }
  REQUESTFORM
  {
    PROPERTIES
    {
      Width=5060;
      Height=440;
      CaptionML=[ENU=Detailed transfers invoice;
                 ESP=Factura transfers detallada];
      SaveValues=Yes;
    }
    CONTROLS
    {
      { 1   ;TextBox      ;3410 ;0    ;1650 ;440  ;CaptionML=[ENU=Copies No.;
                                                              ESP=N§ copias];
                                                   SourceExpr=NoCopias }
      { 21  ;Label        ;0    ;0    ;3300 ;440  ;ParentControl=1 }
    }
  }
  REQUESTPAGE
  {
    PROPERTIES
    {
    }
    CONTROLS
    {
    }
  }
  CODE
  {
    VAR
      Text000@1103355054 : TextConst 'ENU=Total;ESP=Total';
      Text001@1103355055 : TextConst 'ENU=Total VAT incl.;ESP=Total IVA incl.';
      Text002@1103355056 : TextConst 'ENU=Total %1;ESP=Total %1';
      Text003@1103355057 : TextConst 'ENU=Total %1 VAT incl.;ESP=Total %1 IVA incl.';
      Text004@1103355058 : TextConst 'ENU=COPY;ESP=COPIA';
      Text005@1103355059 : TextConst 'ENU=Pag. %1;ESP=P g. %1';
      Text006@1103355060 : TextConst 'ENU=Credited;ESP=Abonando';
      Text007@1103355061 : TextConst 'ENU=Amount;ESP=Importe';
      Text008@1103355062 : TextConst 'ENU=Base;ESP=Base';
      Text009@1103355063 : TextConst 'ENU="Comments %1 %2 ";ESP=Comentarios %1 %2';
      rPar@1103355000 : Record 7009700;
      Language@1100217000 : Record 8;
      CondEnv@1103355001 : Record 10;
      TerminosPago@1103355002 : Record 3;
      MetodoPago@1103355003 : Record 289;
      RepreVtasComp@1103355004 : Record 13;
      InfoEmpresa@1103355005 : Record 79;
      Clie@1103355006 : Record 18;
      LinImporIVA@1103355007 : TEMPORARY Record 290;
      VatPostingSetup@1103355008 : Record 325;
      ConfConta@1103355009 : Record 98;
      rTipoCam@1103355010 : Record 330;
      rTempRes@1103355014 : TEMPORARY Record 7009744;
      rContVenta@1103355015 : Record 7009788;
      rCodNCF@1103355043 : Record 7009831;
      ContarCabVtaImpresa@1103355013 : Codeunit 313;
      FormatDire@1103355012 : Codeunit 365;
      cCalcTrs@1103355011 : Codeunit 7009734;
      DirClie@1103355016 : ARRAY [8] OF Text[50];
      EnvADir@1103355017 : ARRAY [8] OF Text[50];
      DirEmpresa@1103355018 : ARRAY [8] OF Text[50];
      TextNoPedido@1103355019 : Text[30];
      DescriVendedor@1103355020 : Text[30];
      TextoCIF@1103355021 : Text[30];
      CIF_Cliente@1103355022 : Text[30];
      DescriRefer@1103355023 : Text[30];
      TotalTexto@1103355024 : Text[50];
      TextoTotIVAIncl@1103355025 : Text[50];
      MasLins@1103355026 : Boolean;
      NoCopias@1103355027 : Integer;
      NoBucles@1103355028 : Integer;
      NoCopia@1103355029 : Integer;
      TextoCopia@1103355030 : Text[30];
      MostrarDireEnvio@1103355031 : Boolean;
      i@1103355032 : Integer;
      CantidadTransfer@1103355033 : Integer;
      FechaTransfer@1103355034 : Code[10];
      TipoTransfer@1103355035 : Code[20];
      IVATransfer@1103355036 : Decimal;
      PrecioUnitario@1103355037 : Code[20];
      nombre_imp@1103355038 : Text[30];
      hotel_imp@1103355039 : Code[10];
      descrip_imp@1103355040 : Text[30];
      tipo_imp@1103355041 : Code[10];
      IATA_Or_Ent@1103355042 : Code[7];
      wTotalFacDL@1103355044 : Decimal;
      wBono@1103355045 : ARRAY [2] OF Code[10];
      wAgrupacion@1103355046 : Integer;
      wFechaEntrada@1103355047 : ARRAY [2] OF Date;
      wTipoPersona@1103355048 : Code[10];
      wZona@1103355049 : Code[10];
      wDesglose@1103355050 : Boolean;
      wSalta@1103355051 : Boolean;
      wImporte@1103355052 : Decimal;
      wTotal@1103355053 : Decimal;
      wDescrpNCF@1100253000 : Text[30];

    PROCEDURE ImporteDL@1(pwDivisa@1103355000 : Code[10];pwFecha@1103355001 : Date;pwImporte@1103355002 : Decimal) : Decimal;
    VAR
      lwImporte@1103355003 : Decimal;
    BEGIN
      // ImporteDL
      // DEvuelve el importe pasado en divisa local

      lwImporte := cCalcTrs.ValorDL(pwDivisa, pwFecha, pwImporte);
      EXIT(lwImporte);
    END;

    PROCEDURE InsertaiVA@4();
    VAR
      lrCabVenta@1103355000 : Record 36;
      lrLinVenta@1103355001 : Record 37;
    BEGIN
      // InsertaiVA
      // Inserta los distintos ivas en el temporal

      LinImporIVA.RESET;
      IF LinImporIVA.FIND('-') THEN
        LinImporIVA.DELETEALL;

      // Caso de factura no registrada
      IF lrCabVenta.GET(CabFra."Tipo documento", CabFra."No.") THEN BEGIN
        lrLinVenta.RESET;
        lrLinVenta.SETRANGE("Document Type", CabFra."Tipo documento" );
        lrLinVenta.SETRANGE("Document No."  , CabFra."No.");
        IF lrLinVenta.FIND('-') THEN BEGIN
          REPEAT
            IF VatPostingSetup.GET(lrLinVenta."VAT Bus. Posting Group", lrLinVenta."VAT Prod. Posting Group") THEN BEGIN
              LinImporIVA.INIT;
              LinImporIVA."VAT Identifier"          := lrLinVenta."VAT Identifier";
              LinImporIVA."VAT Calculation Type"    := lrLinVenta."VAT Calculation Type";
              LinImporIVA."Tax Group Code"          := lrLinVenta."Tax Group Code";
              LinImporIVA."VAT %"                   := VatPostingSetup."VAT %";
              LinImporIVA."EC %"                    := VatPostingSetup."EC %";

              IF lrCabVenta."Prices Including VAT" THEN BEGIN
                LinImporIVA."Amount Including VAT+EC" := lrLinVenta."Line Amount";
                LinImporIVA."VAT+EC Base"             := ROUND(lrLinVenta."Line Amount" / (1 + (VatPostingSetup."VAT+EC %" / 100)));
              END
              ELSE BEGIN
                LinImporIVA."VAT+EC Base"             := lrLinVenta."Line Amount";
                LinImporIVA."Amount Including VAT+EC" := ROUND(lrLinVenta."Line Amount" * (1 + (VatPostingSetup."VAT+EC %" / 100)));
              END;

              LinImporIVA."Line Amount"             := lrLinVenta."Line Amount";
              LinImporIVA."Pmt. Disc. Given Amount" := lrLinVenta."Pmt. Disc. Given Amount";

              IF lrLinVenta."Allow Invoice Disc." THEN
                LinImporIVA."Inv. Disc. Base Amount" := lrLinVenta."Line Amount";

              LinImporIVA."Invoice Discount Amount" := lrLinVenta."Inv. Discount Amount";

              LinImporIVA.SetCurrencyCode(lrCabVenta."Currency Code");

              LinImporIVA."VAT Difference" := lrLinVenta."VAT Difference";
              LinImporIVA."EC Difference"  := lrLinVenta."EC Difference";
              IF lrCabVenta."Prices Including VAT" THEN
                LinImporIVA."Prices Including VAT" := TRUE;
              LinImporIVA.InsertLine;
            END;

          UNTIL lrLinVenta.NEXT = 0;
        END;
      END // Si se ha registrado ya
      ELSE BEGIN
        CASE CabFra."Tipo documento" OF
          CabFra."Tipo documento"::Factura :
            CalculaIVAFactura;
          CabFra."Tipo documento"::Abono :
            CalculaIVAAbono;
        END;
      END;
    END;

    PROCEDURE CalculaIVAFactura@1103355000();
    VAR
      lrHistCabVta@1103355000 : Record 112;
      lrHistLinVta@1103355001 : Record 113;
    BEGIN
      // CalculaIVAFactura

      lrHistLinVta.RESET;
      lrHistLinVta.SETRANGE("Document No.", CabFra."No.");
      IF lrHistLinVta.FIND('-') THEN BEGIN

        lrHistCabVta.GET(CabFra."No.");

        REPEAT

          IF VatPostingSetup.GET(lrHistLinVta."VAT Bus. Posting Group", lrHistLinVta."VAT Prod. Posting Group") THEN BEGIN
            LinImporIVA.INIT;
            LinImporIVA."VAT Identifier"          := lrHistLinVta."VAT Identifier";
            LinImporIVA."VAT Calculation Type"    := lrHistLinVta."VAT Calculation Type";
            LinImporIVA."Tax Group Code"          := lrHistLinVta."Tax Group Code";
            LinImporIVA."VAT %"                   := VatPostingSetup."VAT %";
            LinImporIVA."EC %"                    := VatPostingSetup."EC %";

            IF lrHistCabVta."Prices Including VAT" THEN BEGIN
              LinImporIVA."Amount Including VAT+EC" := lrHistLinVta."Line Amount";
              LinImporIVA."VAT+EC Base"             := ROUND(lrHistLinVta."Line Amount" / (1 + (VatPostingSetup."VAT+EC %" / 100)));
            END
            ELSE BEGIN
              LinImporIVA."VAT+EC Base"             := lrHistLinVta."Line Amount";
              LinImporIVA."Amount Including VAT+EC" := ROUND(lrHistLinVta."Line Amount" * (1 + (VatPostingSetup."VAT+EC %" / 100)));
            END;

            LinImporIVA."Line Amount"             := lrHistLinVta."Line Amount";
            LinImporIVA."Pmt. Disc. Given Amount" := lrHistLinVta."Pmt. Disc. Given Amount";

            IF lrHistLinVta."Allow Invoice Disc." THEN
              LinImporIVA."Inv. Disc. Base Amount" := lrHistLinVta."Line Amount";

            LinImporIVA."Invoice Discount Amount" := lrHistLinVta."Inv. Discount Amount";

            LinImporIVA.SetCurrencyCode(lrHistCabVta."Currency Code");

            LinImporIVA."VAT Difference" := lrHistLinVta."VAT Difference";
            LinImporIVA."EC Difference"  := lrHistLinVta."EC Difference";
            IF lrHistCabVta."Prices Including VAT" THEN
              LinImporIVA."Prices Including VAT" := TRUE;
            LinImporIVA.InsertLine;
          END;

        UNTIL lrHistLinVta.NEXT = 0;
      END;
    END;

    PROCEDURE CalculaIVAAbono@1103355001();
    VAR
      lrHistVtaAbo@1103355000 : Record 114;
      lrHistLinVta@1103355002 : Record 115;
    BEGIN
      // CalculaIVAAbono

      lrHistLinVta.RESET;
      lrHistLinVta.SETRANGE("Document No.", CabFra."No.");
      IF lrHistLinVta.FIND('-') THEN BEGIN

        lrHistVtaAbo.GET(CabFra."No.");

        REPEAT

          IF VatPostingSetup.GET(lrHistLinVta."VAT Bus. Posting Group", lrHistLinVta."VAT Prod. Posting Group") THEN BEGIN
            LinImporIVA.INIT;
            LinImporIVA."VAT Identifier"          := lrHistLinVta."VAT Identifier";
            LinImporIVA."VAT Calculation Type"    := lrHistLinVta."VAT Calculation Type";
            LinImporIVA."Tax Group Code"          := lrHistLinVta."Tax Group Code";
            LinImporIVA."VAT %"                   := VatPostingSetup."VAT %";
            LinImporIVA."EC %"                    := VatPostingSetup."EC %";

            IF lrHistVtaAbo."Prices Including VAT" THEN BEGIN
              LinImporIVA."Amount Including VAT+EC" := lrHistLinVta."Line Amount";
              LinImporIVA."VAT+EC Base"             := ROUND(lrHistLinVta."Line Amount" / (1 + (VatPostingSetup."VAT+EC %" / 100)));
            END
            ELSE BEGIN
              LinImporIVA."VAT+EC Base"             := lrHistLinVta."Line Amount";
              LinImporIVA."Amount Including VAT+EC" := ROUND(lrHistLinVta."Line Amount" * (1 + (VatPostingSetup."VAT+EC %" / 100)));
            END;

            LinImporIVA."Line Amount"             := lrHistLinVta."Line Amount";
            LinImporIVA."Pmt. Disc. Given Amount" := lrHistLinVta."Pmt. Disc. Given Amount";

            IF lrHistLinVta."Allow Invoice Disc." THEN
              LinImporIVA."Inv. Disc. Base Amount" := lrHistLinVta."Line Amount";

            LinImporIVA."Invoice Discount Amount" := lrHistLinVta."Inv. Discount Amount";

            LinImporIVA.SetCurrencyCode(lrHistVtaAbo."Currency Code");

            LinImporIVA."VAT Difference" := lrHistLinVta."VAT Difference";
            LinImporIVA."EC Difference"  := lrHistLinVta."EC Difference";
            IF lrHistVtaAbo."Prices Including VAT" THEN
              LinImporIVA."Prices Including VAT" := TRUE;
            LinImporIVA.InsertLine;
          END;

        UNTIL lrHistLinVta.NEXT = 0;
      END;
    END;

    PROCEDURE DevuelveGrupoNCF@1103355002() : Code[10];
    VAR
      lrCabVenta@1103355000 : Record 36;
      lrCabFraVenta@1103355001 : Record 112;
      lrCabAboVenta@1103355002 : Record 114;
    BEGIN
      // DevuelveGrupoNCF
      //

      CASE CabFra."Tipo documento" OF
        CabFra."Tipo documento"::Factura:
        BEGIN
          IF lrCabVenta.GET(lrCabVenta."Document Type"::Invoice, CabFra."No.") THEN
            EXIT(lrCabVenta."Cod. Grupo NCF")
          ELSE
            IF lrCabFraVenta.GET(CabFra."No.") THEN
              EXIT(lrCabFraVenta."Cod. Grupo NCF");
        END;

        CabFra."Tipo documento"::Abono:
        BEGIN
          IF lrCabVenta.GET(lrCabVenta."Document Type"::"Credit Memo", CabFra."No.") THEN
            EXIT(lrCabVenta."Cod. Grupo NCF")
          ELSE
            IF lrCabAboVenta.GET(CabFra."No.") THEN
              EXIT(lrCabAboVenta."Cod. Grupo NCF");
        END;
      END;
    END;

    BEGIN
    {
      $001 AJS 14122011 A la hora de imprimir los comentarios elimino el filtro por tipo de documento
                        para que sigan saliendo despues de registrar la factura

      $002 JPT 21/03/12 GOC-LP-12016 Incluir una descripcion de NCF para los abonos

      $003 JPT 25/07/12 Cambio las tablas sobre las que trabaja para unificarlas

      $004 AJS 13122012 Agregamos la columna Vuelo entre Bono y Fecha servicio

      $005 AJS 14092013 Ampliar la visualizacion de los datos de cliente

      $006 AJS 18092013 Recolocar los datos de cabecera del cliente

      $007 AJS 13032015 Los contratos de comercializadora no se tratan en este informe
    }
    END.
  }
  RDLDATA
  {
  }
}
